<!DOCTYPE html>
<script src="/js/src/clicklove.js"></script>
<html lang="zh">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
<title>贾志翔的博客</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



    <meta name="description" content="jia jiazhixiang jiaxiaochu jiaxiaochu.github.io">
<meta property="og:type" content="website">
<meta property="og:title" content="贾志翔的博客">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="贾志翔的博客">
<meta property="og:description" content="jia jiazhixiang jiaxiaochu jiaxiaochu.github.io">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/images/og_image.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="贾志翔的博客">
<meta name="twitter:description" content="jia jiazhixiang jiaxiaochu jiaxiaochu.github.io">
<meta name="twitter:image" content="http://yoursite.com/images/og_image.png">







<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    

    
    
    
    

    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    

    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.svg" alt="贾志翔的博客" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item is-active" href="/">主页</a>
                
                <a class="navbar-item" href="/archives">归档</a>
                
                <a class="navbar-item" href="/tags">标签</a>
                
                <a class="navbar-item" href="/about">支持</a>
                
                <a class="navbar-item" href="http://www.tripwiremagazine.com/wp-content/uploads/images/stories/Articles/9_Funniest_JavaScript_effects/Unclosable%20Window.html">别点·有毒</a>
                
                <a class="navbar-item" href="http://fanfou.com/">饭否</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    
                    <a class="navbar-item" target="_blank" title="Download on GitHub" href="https://github.com/jiaxiaochu/jiaxiaochu.github.io">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="搜索" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main">
    <div class="card">
    
    <div class="card-image">
        <a href="/2019/07/23/pymysql远程连接被拒绝问题解决方法/" class="image is-7by1">
            <img class="thumbnail" src="https://ws1.sinaimg.cn/large/0065l1jqly1g592mgpd7mg30ot0ea7d5.gif" alt="pymysql远程连接被拒绝问题解决方法">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-22T16:08:33.000Z">2019-07-23</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/环境配置/">环境配置</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    10 分钟 读完 (大约 1568 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/23/pymysql远程连接被拒绝问题解决方法/">pymysql远程连接被拒绝问题解决方法</a>
            
        </h1>
        <div class="content">
            <p><strong>pymysql远程连接被拒绝问题解决方法</strong></p>
<blockquote>
<p>pymysql.err.OperationalError: (2003, “Can’t connect to MySQL server on ‘172.16.112.136’ ([Errno 61] Connection refused)”)</p>
</blockquote>
<p><strong>一、 环境信息</strong></p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">服务器系统：Ubuntu16.04</span><br><span class="line">服务器MySQL版本：mysql Ver 14.14 Distrib 5.7.26, for Linux (x86_64) using  EditLine wrapper</span><br><span class="line">本地系统：MAC</span><br><span class="line">本地客户端：Pycharm</span><br><span class="line">本地开发环境：python(3.7.3)，PyMySQL(0.9.3)</span><br><span class="line">假设：登录用户名为:root，密码为:mysql ，MySQL连接端口:3306</span><br></pre></td></tr></table></figure>
        </div>
        
        
        <div class="level is-mobile">
            <div class="level-start">
                <div class="level-item">
                <a class="button is-size-7 is-light" href="/2019/07/23/pymysql远程连接被拒绝问题解决方法/#more">阅读更多</a>
                </div>
            </div>
        </div>
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-image">
        <a href="/2019/07/22/Ubuntu系统搭建配置Python虚拟开发环境/" class="image is-7by1">
            <img class="thumbnail" src="https://ws1.sinaimg.cn/large/0065l1jqly1g590mpqs2ej30gg08c3ym.jpg" alt="Ubuntu系统搭建配置Python虚拟开发环境">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-22T14:57:27.000Z">2019-07-22</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/环境配置/">环境配置</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    7 分钟 读完 (大约 1122 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/22/Ubuntu系统搭建配置Python虚拟开发环境/">Ubuntu系统搭建配置Python虚拟开发环境</a>
            
        </h1>
        <div class="content">
            <p><strong>我们知道使用Python的过程中会安装各种库、包，甚至有时候还需要Python2和Python3两种环境混合使用，慢慢的你的Python运行环境会越来越臃肿，这倒还是其次，最可怕的是，有些应用会使用到某个Python包的特定版本，我们知道同一个Python运行环境里面是不能存在同一个包的不同版本的。所有这些都是你为什么要使用<br>Virtualenv的理由。</strong></p>
<p>Virtualenv给你一个<strong>干净的Python运行环境</strong>，并能让你不同的应用,使用不同版本的包文件提供了可能，甚至使 用<br>它可以让Python2和Python3和谐地共存。对于我们来说，我们用它的原因主要有以下几点：</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.我们需要一个干净的Python环境，这个环境只针对我目前开发的应用；</span><br><span class="line">2.我们不希望多安装一个和项目无关的包，也不希望出现和其它应用有包版本冲突的问题；</span><br><span class="line">3.我们还需要生成一个requirements.txt用来告诉其他人我项目的依赖；</span><br><span class="line">4.我们不希望使用pyinstaller打包发布的过程中，给我加进来一堆没有用处的文件。</span><br></pre></td></tr></table></figure>

<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.搭建虚拟环境主要是为了保证环境得统一性，对于不同得应用建立专属得python环境，比如针对后台开发</span><br><span class="line">得django可以建立一个虚拟环境，针对爬虫开发得应用可以在建立一个虚拟环境，避免环境之间产生冲突。</span><br><span class="line">2.可以避免一个环境造成得安装包过的多，导致环境加载缓慢.</span><br></pre></td></tr></table></figure>
        </div>
        
        
        <div class="level is-mobile">
            <div class="level-start">
                <div class="level-item">
                <a class="button is-size-7 is-light" href="/2019/07/22/Ubuntu系统搭建配置Python虚拟开发环境/#more">阅读更多</a>
                </div>
            </div>
        </div>
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-04-10T16:08:06.399Z">2019-04-11</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/ACM/">ACM</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/ACM/题解/">题解</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 分钟 读完 (大约 424 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/04/11/2019-03-31-Northwestern Europe Regional Contest (NWERC) 2018/">Northwestern Europe Regional Contest (NWERC) 2018</a>
            
        </h1>
        <div class="content">
            <h1 id="Brexit-Negotiations"><a href="#Brexit-Negotiations" class="headerlink" title="Brexit Negotiations"></a><a href="https://vjudge.net/problem/Kattis-brexitnegotiations" target="_blank" rel="noopener">Brexit Negotiations</a></h1><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">4e5</span> + <span class="hljs-number">9</span>;</span><br><span class="line"><span class="hljs-built_in">set</span>&lt;pair&lt;<span class="hljs-keyword">int</span>, <span class="hljs-keyword">int</span>&gt;&gt; q;</span><br><span class="line"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; g[N], ans;</span><br><span class="line"><span class="hljs-keyword">int</span> n, e[N];</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">work</span><span class="hljs-params">(<span class="hljs-keyword">int</span> k)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">if</span> (!q.count(&#123;e[k], k&#125;))</span><br><span class="line">		<span class="hljs-keyword">return</span>;</span><br><span class="line">	q.erase(&#123;e[k], k&#125;);</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> i : g[k])</span><br><span class="line">		work(i);</span><br><span class="line">	ans.push_back(ans.size() + e[k]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;n);</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>, d, b; i &lt; n; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>, &amp;e[i], &amp;d);</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; d; ++j)</span><br><span class="line">			<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;b), g[i].push_back(b - <span class="hljs-number">1</span>);</span><br><span class="line">		q.emplace(e[i], i);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-keyword">while</span> (!q.empty())</span><br><span class="line">		work(q.rbegin()-&gt;second);</span><br><span class="line">	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d"</span>, *max_element(ans.begin(), ans.end()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Circuit-Board-Design"><a href="#Circuit-Board-Design" class="headerlink" title="Circuit Board Design"></a><a href="https://vjudge.net/problem/Kattis-circuitdesign" target="_blank" rel="noopener">Circuit Board Design</a></h1><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">double</span> lf;</span><br><span class="line"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">complex</span>&lt;lf&gt; Coord;</span><br><span class="line"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">1023</span>, NPOS = <span class="hljs-number">-1</span>;</span><br><span class="line">Coord ans[N];</span><br><span class="line"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; g[N];</span><br><span class="line"><span class="hljs-keyword">int</span> n, siz[N];</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-keyword">int</span> u, <span class="hljs-keyword">int</span> fa, lf b)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	++siz[u];</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> to : g[u])</span><br><span class="line">		<span class="hljs-keyword">if</span> (to != fa)</span><br><span class="line">		&#123;</span><br><span class="line">			ans[to] = ans[u] + polar(<span class="hljs-number">1.0</span>, b);</span><br><span class="line">			dfs(to, u, b);</span><br><span class="line">			b += siz[to] * <span class="hljs-built_in">acos</span>(<span class="hljs-number">-1</span>) / N;</span><br><span class="line">			siz[u] += siz[to];</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;n);</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>, u, v; i &lt; n; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>, &amp;u, &amp;v);</span><br><span class="line">		g[u].push_back(v);</span><br><span class="line">		g[v].push_back(u);</span><br><span class="line">	&#125;</span><br><span class="line">	dfs(<span class="hljs-number">1</span>, NPOS, <span class="hljs-number">0</span>);</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; ++i)</span><br><span class="line">		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%.9f %.9f\n"</span>, ans[i].real(), ans[i].imag());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Hard-Drive"><a href="#Hard-Drive" class="headerlink" title="Hard Drive"></a><a href="https://vjudge.net/problem/Kattis-harddrive" target="_blank" rel="noopener">Hard Drive</a></h1><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">5e5</span> + <span class="hljs-number">9</span>;</span><br><span class="line"><span class="hljs-keyword">char</span> s[N];</span><br><span class="line"><span class="hljs-keyword">int</span> n, c, b, z[N];</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d%d"</span>, &amp;n, &amp;c, &amp;b);</span><br><span class="line">	fill(s, s + n, <span class="hljs-string">'0'</span>);</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; b; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;z[i]), --z[i];</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = i ? z[i - <span class="hljs-number">1</span>] + <span class="hljs-number">1</span> : !(c &amp; <span class="hljs-number">1</span>); c &gt; <span class="hljs-number">0</span> &amp;&amp; j &lt; z[i]; j += <span class="hljs-number">2</span>)</span><br><span class="line">			s[j] = <span class="hljs-string">'1'</span>, c -= <span class="hljs-number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%s"</span>, s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Inflation"><a href="#Inflation" class="headerlink" title="Inflation"></a><a href="https://vjudge.net/problem/Kattis-inflation" target="_blank" rel="noopener">Inflation</a></h1><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">2e5</span> + <span class="hljs-number">9</span>;</span><br><span class="line"><span class="hljs-keyword">double</span> f = <span class="hljs-number">1</span>, c[N];</span><br><span class="line"><span class="hljs-keyword">int</span> n;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;n);</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; ++i)</span><br><span class="line">		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%lf"</span>, &amp;c[i]);</span><br><span class="line">	sort(c + <span class="hljs-number">1</span>, c + n + <span class="hljs-number">1</span>);</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">if</span> (c[i] &gt; i)</span><br><span class="line">			<span class="hljs-keyword">return</span> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"impossible"</span>), <span class="hljs-number">0</span>;</span><br><span class="line">		f = min(f, c[i] / i);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%.9f"</span>, f);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Kleptography"><a href="#Kleptography" class="headerlink" title="Kleptography"></a><a href="https://vjudge.net/problem/Kattis-kleptography" target="_blank" rel="noopener">Kleptography</a></h1><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">127</span>;</span><br><span class="line"><span class="hljs-keyword">char</span> a[N], b[N], k[N];</span><br><span class="line"><span class="hljs-keyword">int</span> n, m;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">	<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s%s"</span>, a + m - n, b);</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = m - <span class="hljs-number">1</span>; ~i; --i)</span><br><span class="line">	&#123;</span><br><span class="line">		k[i] = ((b[i] - <span class="hljs-string">'a'</span>) + <span class="hljs-number">26</span> - (a[i] - <span class="hljs-string">'a'</span>)) % <span class="hljs-number">26</span> + <span class="hljs-string">'a'</span>;</span><br><span class="line">		<span class="hljs-keyword">if</span> (i &gt;= n)</span><br><span class="line">			a[i - n] = k[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%s"</span>, a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-04-10T16:08:06.399Z">2019-04-11</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/计算机网络/">计算机网络</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    14 分钟 读完 (大约 2113 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/04/11/2019-03-31-应用层实验/"></a>
            
        </h1>
        <div class="content">
            <h2 id="实验题目"><a href="#实验题目" class="headerlink" title="实验题目"></a>实验题目</h2><p>应用层实验</p>
<h2 id="实验目的"><a href="#实验目的" class="headerlink" title="实验目的"></a>实验目的</h2><p>掌握应用层的基本工作原理和实现方法</p>
<h2 id="实验工具"><a href="#实验工具" class="headerlink" title="实验工具"></a>实验工具</h2><h3 id="telnet"><a href="#telnet" class="headerlink" title="telnet"></a>telnet</h3><p>如果在命令行不能运行telnet，则需要安装telnet客户端程序。<br>telnet的安装方法见<a href="https://jingyan.baidu.com/article/3ea51489ba79e252e61bba97.html" target="_blank" rel="noopener">https://jingyan.baidu.com/article/3ea51489ba79e252e61bba97.html</a><br>在控制台可以采用鼠标右键菜单粘贴,拷贝要点击图标菜单“编辑/标记”<br>控制台修改缓冲区：属性/布局/屏幕缓冲区大小/高度:9999<br>窗口大小的宽度：200</p>
<h3 id="SecureCRT"><a href="#SecureCRT" class="headerlink" title="SecureCRT"></a>SecureCRT</h3><ul>
<li>SecureCRT 下载: <a href="http://172.18.187.9/netdisk/default.aspx?vm=17net" target="_blank" rel="noopener">http://172.18.187.9/netdisk/default.aspx?vm=17net</a> (软件下载)<br>SecureCRT下载解压后直接可以使用。</li>
<li>采用SecureCRT中的telnet：连接/sessions/点击右键/新建会话/协议：telnet/下一步/主机名:域名或IP地址 端口号:80或21或110或25/下一步/取名会话/完成。</li>
<li>SecureCRT设置中文显示：选项/会话选项/外观/字体：新宋体；字符集：中文GB2312  字符编码：utf-8</li>
<li>为了可以看到更多的响应信息，需要增加缓冲区大小。</li>
<li>secureCRT:会话选项/终端/仿真/回滚缓冲区：10000</li>
<li>控制台:属性/布局/屏幕缓冲区大小/高度：9000</li>
<li>SecureCRT的SSL配置–在SecureCRT中会话配置/连接/协议：Telnet/SSL</li>
</ul>
<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ul>
<li>截屏时注意遮盖掉自己的邮箱密码</li>
<li>sina.com的邮箱的客户端访问设置：</li>
<li>QQ邮箱需要在Web访问方式下开启POP3和SMTP服务才允许在客户端访问(设置/账号/开启POP3/SMTP)，否则会出现错误“454 Authentication failed, please open smtp flag first!”<br>要在客户端访问，QQ邮箱可能还会要求设置独立密码，即可以设置与QQ登录不同的密码。<br>QQ Web邮箱查看源码的方法：<br>QQ邮箱编程必须使用Telnet/SSL协议(加密模式)：<br>SecureCRT的SSL配置–在SecureCRT中会话配置/连接/协议：Telnet/SSL<br>QQ邮箱的接收邮件服务器：pop.qq.com，端口号为995<br>QQ邮箱的发送邮件服务器：smtp.qq.com，端口号为465<br>客户端登录的用户名为QQ号的base64编码<br>客户端登录的密码也采用base64编码</li>
</ul>
<h2 id="实验内容"><a href="#实验内容" class="headerlink" title="实验内容"></a>实验内容</h2><p>先认真阅读课件“Chapter2-applicaton-layer.pdf”,再完成下面内容。注意：协议标准可以查阅RFC；选取的内容不要与课件相同；响应内容太长时自己选取截取前后部分以及其中重点部分。</p>
<p>参考视频：<a href="http://172.18.187.9/video/" target="_blank" rel="noopener">http://172.18.187.9/video/</a></p>
<p>使用自己编写的TcpClient，采用聊天程序的客户端。该客户端采用两个进程实现：一个输入和发送线程，一个接收线程。（选做）如果不自己编写TcpClient，可以尝试使用老师给的TcpClient.exe完成步骤一~步骤四，如果不愿意尝试，可以使用telnet来完成实验。<br>源代码：</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;process.h&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ws2tcpip.h&gt; //gcc Client.c -lWs2_32 -o Client</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> comment(lib, <span class="hljs-meta-string">"ws2_32.lib"</span>)</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> BUFLEN 20 &lt;&lt; 20 <span class="hljs-comment">//20MB</span></span></span><br><span class="line"><span class="hljs-keyword">int</span> finish = <span class="hljs-number">0</span>;</span><br><span class="line"><span class="hljs-keyword">unsigned</span> __<span class="hljs-function">stdcall <span class="hljs-title">recvMessage</span><span class="hljs-params">(SOCKET *p)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">static</span> <span class="hljs-keyword">char</span> buf[BUFLEN];</span><br><span class="line">	<span class="hljs-keyword">while</span> (!finish)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">int</span> c = recv(*p, buf, BUFLEN, <span class="hljs-number">0</span>);</span><br><span class="line">		<span class="hljs-keyword">if</span> (c &gt; <span class="hljs-number">0</span>)</span><br><span class="line">			buf[c] = <span class="hljs-number">0</span>, <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%s"</span>, buf);</span><br><span class="line">		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!c)</span><br><span class="line">			<span class="hljs-built_in">printf</span>(<span class="hljs-string">"Recv connect closed.\n"</span>), finish = <span class="hljs-number">1</span>;</span><br><span class="line">		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (c == SOCKET_ERROR)</span><br><span class="line">			<span class="hljs-built_in">printf</span>(<span class="hljs-string">"Recv Error:\n%d\n"</span>, GetLastError());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">if</span> (argc &lt; <span class="hljs-number">3</span>)</span><br><span class="line">		<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">	WSADATA wsadata;</span><br><span class="line">	WSAStartup(MAKEWORD(<span class="hljs-number">2</span>, <span class="hljs-number">0</span>), &amp;wsadata);</span><br><span class="line">	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">addrinfo</span> *<span class="hljs-title">host</span>;</span></span><br><span class="line">	getaddrinfo(argv[<span class="hljs-number">1</span>], argv[<span class="hljs-number">2</span>], <span class="hljs-literal">NULL</span>, &amp;host);</span><br><span class="line">	SOCKET sock = socket(host-&gt;ai_family, host-&gt;ai_socktype, host-&gt;ai_protocol);</span><br><span class="line">	<span class="hljs-keyword">if</span> (connect(sock, host-&gt;ai_addr, host-&gt;ai_addrlen))</span><br><span class="line">		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"Connect unsuccessfully.\n"</span>);</span><br><span class="line">	HANDLE h = _beginthreadex(<span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, &amp;recvMessage, &amp;sock, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>);</span><br><span class="line">	<span class="hljs-keyword">static</span> <span class="hljs-keyword">char</span> buf[BUFLEN];</span><br><span class="line">	<span class="hljs-keyword">while</span> (!finish)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">int</span> len = <span class="hljs-number">0</span>;</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-built_in">printf</span>(<span class="hljs-string">"Input the message(end by EOF, Ctrl+Z in Windows) :\n"</span>); !finish &amp;&amp; gets(buf + len);)</span><br><span class="line">			buf[len += <span class="hljs-built_in">strlen</span>(buf + len)] = <span class="hljs-string">'\r'</span>, buf[++len] = <span class="hljs-string">'\n'</span>, buf[++len] = <span class="hljs-number">0</span>;</span><br><span class="line">		<span class="hljs-keyword">int</span> c = send(sock, buf, len, <span class="hljs-number">0</span>);</span><br><span class="line">		<span class="hljs-keyword">if</span> (!c)</span><br><span class="line">			<span class="hljs-built_in">printf</span>(<span class="hljs-string">"Send connect closed.\n"</span>), finish = <span class="hljs-number">1</span>;</span><br><span class="line">		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (c == SOCKET_ERROR)</span><br><span class="line">			<span class="hljs-built_in">printf</span>(<span class="hljs-string">"Send Error:\n%d\n"</span>, GetLastError());</span><br><span class="line">	&#125;</span><br><span class="line">	CloseHandle(h);</span><br><span class="line">	closesocket(sock);</span><br><span class="line">	freeaddrinfo(host);</span><br><span class="line">	WSACleanup();</span><br><span class="line">	getch();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a>HTTP协议</h3><p>看完HTTP协议的课件后完成以下实验：</p>
<h4 id="从学院网站（sdcs-sysu-edu-cn）找一网页下载。"><a href="#从学院网站（sdcs-sysu-edu-cn）找一网页下载。" class="headerlink" title="从学院网站（sdcs.sysu.edu.cn）找一网页下载。"></a>从学院网站（sdcs.sysu.edu.cn）找一网页下载。</h4><p>下载一个<a href="http://sdcs.sysu.edu.cn/content/2564" target="_blank" rel="noopener">老师的个人主页</a>。</p>
<p>http请求：</p>
<figure class="highlight http hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">GET</span> <span class="hljs-string">/content/2564.html</span> HTTP/1.1</span><br><span class="line"><span class="hljs-attribute">Host</span>: sdcs.sysu.edu.cn</span><br></pre></td></tr></table></figure>

<p>http响应：<br><img src="/2019/04/11/2019-03-31-应用层实验/image/2019-04-01-1.jpg" alt><br><img src="/2019/04/11/2019-03-31-应用层实验/image/2019-04-01-2.jpg" alt></p>
<h4 id="从学院网站（sdcs-sysu-edu-cn）找一图片下载。"><a href="#从学院网站（sdcs-sysu-edu-cn）找一图片下载。" class="headerlink" title="从学院网站（sdcs.sysu.edu.cn）找一图片下载。"></a>从学院网站（sdcs.sysu.edu.cn）找一图片下载。</h4><p>天河二号镇楼。<br><img src="http://sdcs.sysu.edu.cn/sites/sdcs.live1.dpcms8.sysu.edu.cn/files/styles/slideshow/public/slideshow/frontpic2.jpg" alt><br>http请求：</p>
<figure class="highlight http hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">GET</span> <span class="hljs-string">/sites/sdcs.live1.dpcms8.sysu.edu.cn/files/styles/slideshow/public/slideshow/frontpic2.jpg</span> HTTP/1.1</span><br><span class="line"><span class="hljs-attribute">Host</span>: sdcs.sysu.edu.cn</span><br></pre></td></tr></table></figure>

<p>http响应：<br><img src="/2019/04/11/2019-03-31-应用层实验/image/2019-04-01-3.jpg" alt></p>
<h4 id="在http请求的头部行中加入If-Modified-Since-Fri-16-Jan-2019-13-22-17-GMT从学院网站下载-2-的图片。"><a href="#在http请求的头部行中加入If-Modified-Since-Fri-16-Jan-2019-13-22-17-GMT从学院网站下载-2-的图片。" class="headerlink" title="在http请求的头部行中加入If-Modified-Since: Fri, 16 Jan 2019 13:22:17 GMT从学院网站下载(2)的图片。"></a>在http请求的头部行中加入<code>If-Modified-Since: Fri, 16 Jan 2019 13:22:17 GMT</code>从学院网站下载(2)的图片。</h4><p>http请求：</p>
<figure class="highlight http hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">GET</span> <span class="hljs-string">/sites/sdcs.live1.dpcms8.sysu.edu.cn/files/styles/slideshow/public/slideshow/frontpic2.jpg</span> HTTP/1.1</span><br><span class="line"><span class="hljs-attribute">If-Modified-Since</span>: Fri, 16 Jan 2019 13:22:17 GMT</span><br><span class="line"><span class="hljs-attribute">Host</span>: sdcs.sysu.edu.cn</span><br></pre></td></tr></table></figure>

<p>http响应：<br><img src="/2019/04/11/2019-03-31-应用层实验/image/2019-04-01-4.jpg" alt></p>
<h4 id="用流水线方式实现前面（1）（2），即把它们的请求拷贝到一起后发送出去（可能太长，第一部分可以只有看到末尾）。"><a href="#用流水线方式实现前面（1）（2），即把它们的请求拷贝到一起后发送出去（可能太长，第一部分可以只有看到末尾）。" class="headerlink" title="用流水线方式实现前面（1）（2），即把它们的请求拷贝到一起后发送出去（可能太长，第一部分可以只有看到末尾）。"></a>用流水线方式实现前面（1）（2），即把它们的请求拷贝到一起后发送出去（可能太长，第一部分可以只有看到末尾）。</h4><p>http请求：</p>
<figure class="highlight http hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">GET</span> <span class="hljs-string">/content/2564.html</span> HTTP/1.1</span><br><span class="line"><span class="hljs-attribute">Host</span>: sdcs.sysu.edu.cn</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">GET</span> <span class="hljs-string">/sites/sdcs.live1.dpcms8.sysu.edu.cn/files/styles/slideshow/public/slideshow/frontpic2.jpg</span> HTTP/1.1</span><br><span class="line"><span class="hljs-attribute">Host</span>: sdcs.sysu.edu.cn</span><br></pre></td></tr></table></figure>

<p>http响应：<br><img src="/2019/04/11/2019-03-31-应用层实验/image/2019-04-01-5.jpg" alt><br><img src="/2019/04/11/2019-03-31-应用层实验/image/2019-04-01-6.jpg" alt></p>
<h3 id="FTP协议"><a href="#FTP协议" class="headerlink" title="FTP协议"></a>FTP协议</h3><p>看完FTP协议的课件后完成以下实验（测试服务器上的目录结构和文件见“参考资料”）：<br>FTP服务器：IP地址为172.18.187.10，端口号为 21 （用户名：abc，密码：123666）</p>
<h4 id="上传用学号命名的一个文本文件-学号-txt"><a href="#上传用学号命名的一个文本文件-学号-txt" class="headerlink" title="上传用学号命名的一个文本文件(学号.txt)"></a>上传用学号命名的一个文本文件(学号.txt)</h4><p>控制连接的请求响应信息：</p>
<p>数据连接的截屏：</p>
<h4 id="查看当前目录内容-太多则选择一些-，并标注出-1-中自己上传的文件"><a href="#查看当前目录内容-太多则选择一些-，并标注出-1-中自己上传的文件" class="headerlink" title="查看当前目录内容(太多则选择一些)，并标注出(1)中自己上传的文件"></a>查看当前目录内容(太多则选择一些)，并标注出(1)中自己上传的文件</h4><pre><code>控制连接的请求响应信息：

数据连接的截屏：</code></pre><h4 id="下载-1-中自己上传的文本文件"><a href="#下载-1-中自己上传的文本文件" class="headerlink" title="下载(1)中自己上传的文本文件"></a>下载(1)中自己上传的文本文件</h4><pre><code>控制连接的请求响应信息：

数据连接的截屏：</code></pre><h4 id="下载-ebook下的一个二进制文件-例如，-pdf文件"><a href="#下载-ebook下的一个二进制文件-例如，-pdf文件" class="headerlink" title="下载/ebook下的一个二进制文件(例如，.pdf文件)"></a>下载/ebook下的一个二进制文件(例如，.pdf文件)</h4><p>控制连接的请求响应信息：</p>
<p>数据连接的截屏：</p>
<h4 id="采用断点续传下载一个-text下的一个文本文件的一部分"><a href="#采用断点续传下载一个-text下的一个文本文件的一部分" class="headerlink" title="采用断点续传下载一个/text下的一个文本文件的一部分"></a>采用断点续传下载一个/text下的一个文本文件的一部分</h4><p>控制连接的请求响应信息：</p>
<p>数据连接的截屏：</p>
<h4 id="编写一个程序（聊天程序的客户端），用FTP协议下载指定文件（选做）"><a href="#编写一个程序（聊天程序的客户端），用FTP协议下载指定文件（选做）" class="headerlink" title="编写一个程序（聊天程序的客户端），用FTP协议下载指定文件（选做）"></a>编写一个程序（聊天程序的客户端），用FTP协议下载指定文件（选做）</h4><p>参考运行截屏：</p>
<p>参考字符串函数：<br>strchr();<br>strrchr();<br>sprintf(buf, “retr %s\r\n”, filename);<br>sscanf(st, “%d,%d,%d,%d,%d,%d”, &amp;ip1, &amp;ip2, &amp;ip3, &amp;ip4, &amp;port1, &amp;port2);</p>
<p>参考自编函数：<br>SOCKET dataConn() { … }   建立数据连接<br>unsigned __stdcall myrecv(void *p){…}   接收服务器的消息（线程函数）<br>void sendmsg(SOCKET sock, char *msg){ … } 发送控制消息<br>int saveFile(SOCKET sock, char * fileName) { … } 通过数据连接接收数据并保存为文件<br>参考程序：ftpDownload.exe<br>源代码：</p>
<p>运行截屏：</p>
<h3 id="SMTP协议"><a href="#SMTP协议" class="headerlink" title="SMTP协议"></a>SMTP协议</h3><p>邮箱<a href="mailto:zsusender3@sina.com" target="_blank" rel="noopener">zsusender3@sina.com</a>的用户名zsusender3，密码：123456Aa<br>看完SMTP协议的课件后做以下实验：</p>
<h4 id="通过zsusender3-sina-com发一封没有附件的邮件到你的邮箱。注意更改时间为当前时间。"><a href="#通过zsusender3-sina-com发一封没有附件的邮件到你的邮箱。注意更改时间为当前时间。" class="headerlink" title="通过zsusender3@sina.com发一封没有附件的邮件到你的邮箱。注意更改时间为当前时间。"></a>通过<a href="mailto:zsusender3@sina.com" target="_blank" rel="noopener">zsusender3@sina.com</a>发一封没有附件的邮件到你的邮箱。注意更改时间为当前时间。</h4><p>请求和响应信息：<br>老师的邮箱因为被太多人发了邮件所以被封了…</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">HELO zsusender3</span><br><span class="line">AUTH LOGIN</span><br><span class="line">enN1c2VuZGVyMw==</span><br><span class="line">MTIzNDU2QWE=</span><br><span class="line">MAIL FROM:&lt;zsusender3@sina.com&gt;</span><br><span class="line">RCPT TO:&lt;wu.kan@qq.com&gt;</span><br><span class="line">data</span><br><span class="line">Date:Tue, 25 Mar 2019 14:24:01 +0800</span><br><span class="line">From: &quot;zsusender3&quot; &lt;zsusender3@sina.com&gt;</span><br><span class="line">To: &quot;WuK&quot;&lt;wu.kan@qq.com&gt;</span><br><span class="line">Subject: SDCS 17 isszym</span><br><span class="line"></span><br><span class="line">This is a SDCS message in MIME format. Hello! SDCS 17 from isszym</span><br><span class="line">.</span><br><span class="line"></span><br><span class="line">QUIT</span><br></pre></td></tr></table></figure>

<h4 id="通过zsusender3-sina-com发一封带附件-二进制文件-的邮件-MIME-txt-到你的邮箱。参考课件“MIME-pdf”和观看MIME的视频。"><a href="#通过zsusender3-sina-com发一封带附件-二进制文件-的邮件-MIME-txt-到你的邮箱。参考课件“MIME-pdf”和观看MIME的视频。" class="headerlink" title="通过zsusender3@sina.com发一封带附件(二进制文件)的邮件(MIME.txt)到你的邮箱。参考课件“MIME.pdf”和观看MIME的视频。"></a>通过<a href="mailto:zsusender3@sina.com" target="_blank" rel="noopener">zsusender3@sina.com</a>发一封带附件(二进制文件)的邮件(MIME.txt)到你的邮箱。参考课件“MIME.pdf”和观看MIME的视频。</h4><p>请求和响应信息：</p>
<h4 id="通过zsusender3-sina-com发送另一个带附件的邮件给自己。可以先给你自己发一封带附件的邮件-再通过查看源码截取该响应报文的一部分，参见MIME-txt。"><a href="#通过zsusender3-sina-com发送另一个带附件的邮件给自己。可以先给你自己发一封带附件的邮件-再通过查看源码截取该响应报文的一部分，参见MIME-txt。" class="headerlink" title="通过zsusender3@sina.com发送另一个带附件的邮件给自己。可以先给你自己发一封带附件的邮件,再通过查看源码截取该响应报文的一部分，参见MIME.txt。"></a>通过<a href="mailto:zsusender3@sina.com" target="_blank" rel="noopener">zsusender3@sina.com</a>发送另一个带附件的邮件给自己。可以先给你自己发一封带附件的邮件,再通过查看源码截取该响应报文的一部分，参见MIME.txt。</h4><h4 id="选做-从你的邮箱发一份邮件到同学的邮箱。QQ邮箱见【注意事项】。"><a href="#选做-从你的邮箱发一份邮件到同学的邮箱。QQ邮箱见【注意事项】。" class="headerlink" title="(选做)从你的邮箱发一份邮件到同学的邮箱。QQ邮箱见【注意事项】。"></a>(选做)从你的邮箱发一份邮件到同学的邮箱。QQ邮箱见【注意事项】。</h4><p>请求和响应信息：</p>
<h3 id="POP3协议"><a href="#POP3协议" class="headerlink" title="POP3协议"></a>POP3协议</h3><p>邮箱<a href="mailto:zsureceiver3@sina.com" target="_blank" rel="noopener">zsureceiver3@sina.com</a>的用户名zsureceiver3，密码：123456Aa<br>看完POP3协议的课件后做以下实验：</p>
<h4 id="查看zsureceiver3-sina-com中每个邮件大小。"><a href="#查看zsureceiver3-sina-com中每个邮件大小。" class="headerlink" title="查看zsureceiver3@sina.com中每个邮件大小。"></a>查看<a href="mailto:zsureceiver3@sina.com" target="_blank" rel="noopener">zsureceiver3@sina.com</a>中每个邮件大小。</h4><p>请求和响应信息：</p>
<h4 id="取回zsureceiver3-sina-com最后一封邮件的邮件唯一标识符。"><a href="#取回zsureceiver3-sina-com最后一封邮件的邮件唯一标识符。" class="headerlink" title="取回zsureceiver3@sina.com最后一封邮件的邮件唯一标识符。"></a>取回<a href="mailto:zsureceiver3@sina.com" target="_blank" rel="noopener">zsureceiver3@sina.com</a>最后一封邮件的邮件唯一标识符。</h4><p>请求和响应信息：</p>
<h4 id="取回zsureceiver3-sina-com最后一封邮件。"><a href="#取回zsureceiver3-sina-com最后一封邮件。" class="headerlink" title="取回zsureceiver3@sina.com最后一封邮件。"></a>取回<a href="mailto:zsureceiver3@sina.com" target="_blank" rel="noopener">zsureceiver3@sina.com</a>最后一封邮件。</h4><p>请求和响应信息：</p>
<h4 id="取回三-1-中发到你邮箱的邮件。QQ邮件见【注意事项】。"><a href="#取回三-1-中发到你邮箱的邮件。QQ邮件见【注意事项】。" class="headerlink" title="取回三(1)中发到你邮箱的邮件。QQ邮件见【注意事项】。"></a>取回三(1)中发到你邮箱的邮件。QQ邮件见【注意事项】。</h4><p>请求和响应信息：</p>
<h2 id="实验体会"><a href="#实验体会" class="headerlink" title="实验体会"></a>实验体会</h2>
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-04-10T16:08:06.399Z">2019-04-11</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/操作系统/">操作系统</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    18 分钟 读完 (大约 2721 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/04/11/2019-03-31-中断处理与系统调用/"></a>
            
        </h1>
        <div class="content">
            <h1 id="实验题目"><a href="#实验题目" class="headerlink" title="实验题目"></a>实验题目</h1><p>中断处理与系统调用</p>
<h1 id="实验目的"><a href="#实验目的" class="headerlink" title="实验目的"></a>实验目的</h1><ul>
<li>学习中断机制知识，掌握中断处理程序设计的要求</li>
<li>设计一个汇编程序，实现时钟中断处理程序</li>
<li>扩展MyOS2，增加时钟中断服务，利用时钟中断实现与时间有关的操作</li>
</ul>
<h1 id="实验要求"><a href="#实验要求" class="headerlink" title="实验要求"></a>实验要求</h1><ul>
<li>操作系统工作期间，利用时钟中断，在屏幕24行79列位置轮流显示<code>|</code>、<code>/</code>和<code>\</code>，适当控制显示速度，以方便观察效果。</li>
<li>编写键盘中断响应程序，原有的你设计的用户程序运行时，键盘事件会做出有事反应：当键盘有按键时，屏幕适当位置显示<code>OUCH!OUCH!</code>。</li>
<li>在内核中，对33号、34号、35号和36号中断编写中断服务程序，分别在屏幕1/4区域内显示一些个性化信息。再编写一个汇编语言的程序，作为用户程序，利用<code>int 33</code>、<code>int 34</code>、<code>int 35</code>和<code>int 36</code>产生中断调用你这4个服务程序。</li>
</ul>
<h1 id="实验方案"><a href="#实验方案" class="headerlink" title="实验方案"></a>实验方案</h1><h2 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h2><h3 id="软件"><a href="#软件" class="headerlink" title="软件"></a>软件</h3><ul>
<li>Windows 10, 64-bit  (Build 17763) 10.0.17763</li>
<li>Windows Subsystem for Linux [Ubuntu 18.04.2 LTS]：WSL是以软件的形式运行在Windows下的Linux子系统，是近些年微软推出来的新工具，可以在Windows系统上原生运行Linux。</li>
<li>gcc version 7.3.0 (Ubuntu 7.3.0-27ubuntu1~18.04)：C语言程序编译器，Ubuntu自带。</li>
<li>NASM version 2.13.02：汇编程序编译器，通过<code>sudo apt install nasm</code>安装在WSL上。</li>
<li>Oracle VM VirtualBox 6.0.4 r128413 (Qt5.6.2)：轻量开源的虚拟机软件。</li>
<li>VSCode - Insiders v1.33.0：好用的文本编辑器，有丰富的插件。</li>
<li>hexdump for VSCode 1.7.2: VSCode中一个好用的十六进制显示插件。</li>
<li>GNU Make 4.1：安装在Ubuntu下，一键编译并连接代码，生成最终的文件。</li>
</ul>
<p>大部分开发环境安装在WSL上，较之于双系统、虚拟机等其他开发方案，更加方便，也方便直接使用Linux下的一些指令。</p>
<h3 id="硬件"><a href="#硬件" class="headerlink" title="硬件"></a>硬件</h3><h4 id="开发环境配置"><a href="#开发环境配置" class="headerlink" title="开发环境配置"></a>开发环境配置</h4><p>所用机器型号为VAIO Z Flip 2016</p>
<ul>
<li>Intel(R) Core(TM) i7-6567U CPU @3.30GHZ 3.31GHz</li>
<li>8.00GB RAM</li>
</ul>
<h4 id="虚拟机配置"><a href="#虚拟机配置" class="headerlink" title="虚拟机配置"></a>虚拟机配置</h4><ul>
<li>处理器内核总数：1</li>
<li>RAM：4MB</li>
</ul>
<h2 id="实验原理"><a href="#实验原理" class="headerlink" title="实验原理"></a>实验原理</h2><p>本次实验的关键在于写中断向量表。x86计算机在启动时会自动进入实模式状态。系统的BIOS初始化<code>8259A</code>的各中断线的类型（参见前图），在内存的低位区（地址为<code>0~1023[3FFH]</code>，1KB）创建含256个中断向量的表IVT （每个<code>向量[地址]</code>占4个字节，格式为：<code>16位段值:16位偏移值</code>）。</p>
<p>要实现“无敌风火轮”，可以利用时钟中断，对8号中断进行编程。在屏幕固定位置显示风火轮的字符，随后将字符修改为下一个。随后将0x08放入0x20的位置，处理时钟中断函数的入口放入0x22。最后需要告诉硬件端口已经处理完中断，并正常返回。</p>
<p>在实验过程中，还遇到了进入操作系统时显示风火轮但是没有转起来的问题。经过思考，发现上一个实验中写的<code>getch</code>是阻塞函数。于是，重新写了这个函数，重复扫描键盘缓冲区，有字符键入时再读进来。</p>
<h1 id="实验过程"><a href="#实验过程" class="headerlink" title="实验过程"></a>实验过程</h1><h2 id="实验代码"><a href="#实验代码" class="headerlink" title="实验代码"></a>实验代码</h2><h3 id="bootloader-asm"><a href="#bootloader-asm" class="headerlink" title="bootloader.asm"></a>bootloader.asm</h3><p>和上一个实验中的程序完全相同，不再放出。</p>
<h3 id="kernel-asm"><a href="#kernel-asm" class="headerlink" title="kernel.asm"></a>kernel.asm</h3><p>操作系统内核的汇编部分代码，提供<code>int 33</code>~<code>int 36</code>中断在屏幕的四个象限上显示自定义信息，检测到<code>Ctrl + C</code>时返回。</p>
<p>同时，提供了如下的全局函数供C语言部分调用。</p>
<ul>
<li><code>_getch</code>从屏幕上无回显地读入一个字符。</li>
<li><code>_getCursor</code>返回屏幕光标的位置。</li>
<li><code>_setCursor</code>设置屏幕光标的位置。</li>
<li><code>_putC</code>向光标位置写入一个字符。</li>
<li><code>_pageUP</code>屏幕内容向上滚动。</li>
<li><code>_loadProgram</code>加载用户程序。</li>
</ul>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br></pre></td><td class="code"><pre><span class="line">%macro print 5 ; string, length, x, y, color</span><br><span class="line">	pusha</span><br><span class="line">	push ax</span><br><span class="line">	push bx</span><br><span class="line">	push cx</span><br><span class="line">	push dx</span><br><span class="line">	push bp</span><br><span class="line">	push ds</span><br><span class="line">	push es</span><br><span class="line">	mov ax, 0b800H</span><br><span class="line">	mov gs, ax</span><br><span class="line">	mov ax, cs</span><br><span class="line">	mov ds, ax</span><br><span class="line">	mov bp, %1</span><br><span class="line">	mov ax, ds</span><br><span class="line">	mov es, ax</span><br><span class="line">	mov cx, %2</span><br><span class="line">	mov ax, 1300H</span><br><span class="line">	mov dh, %3</span><br><span class="line">	mov dl, %4</span><br><span class="line">	mov bx, %5</span><br><span class="line">	int 10H</span><br><span class="line">	pop es</span><br><span class="line">	pop ds</span><br><span class="line">	pop bp</span><br><span class="line">	pop dx</span><br><span class="line">	pop cx</span><br><span class="line">	pop bx</span><br><span class="line">	pop ax</span><br><span class="line">	popa</span><br><span class="line">%endmacro</span><br><span class="line">%macro setIVT 2</span><br><span class="line">	push es</span><br><span class="line">	push ds</span><br><span class="line">	push si</span><br><span class="line">	pusha</span><br><span class="line">	mov ax, 0000H</span><br><span class="line">	mov es, ax</span><br><span class="line">	mov ax, %1</span><br><span class="line">	mov bx, 4</span><br><span class="line">	mul bx</span><br><span class="line">	mov si, ax</span><br><span class="line">	mov ax, %2</span><br><span class="line">	mov [es:si], ax</span><br><span class="line">	add si, 2</span><br><span class="line">	mov ax, cs</span><br><span class="line">	mov [es:si], ax</span><br><span class="line">	popa</span><br><span class="line">	pop si</span><br><span class="line">	pop ds</span><br><span class="line">	pop es</span><br><span class="line">%endmacro</span><br><span class="line">	bits 16</span><br><span class="line">	UserPrgOffset equ 0a100H</span><br><span class="line">	PrgSectorOffset equ 0</span><br><span class="line">	extern terminal</span><br><span class="line">	global _start</span><br><span class="line">	global _getch</span><br><span class="line">	global _getCursor</span><br><span class="line">	global _setCursor</span><br><span class="line">	global _putC</span><br><span class="line">	global _pageUP</span><br><span class="line">	global _loadProgram</span><br><span class="line">_start:</span><br><span class="line">	setIVT 8, int8</span><br><span class="line">	setIVT 33, int33</span><br><span class="line">	setIVT 34, int34</span><br><span class="line">	setIVT 35, int35</span><br><span class="line">	setIVT 36, int36</span><br><span class="line">	call terminal</span><br><span class="line">	ret</span><br><span class="line">_getCursor:</span><br><span class="line">	push ebp</span><br><span class="line">	mov ebp, esp</span><br><span class="line">	push ebx</span><br><span class="line">	sub esp, 4</span><br><span class="line">	mov eax, 768</span><br><span class="line">	mov edx, 0</span><br><span class="line">	mov ebx, edx</span><br><span class="line">	int 0x10</span><br><span class="line">	mov eax, edx</span><br><span class="line">	mov dword [ebp-8], eax</span><br><span class="line">	mov eax, dword [ebp-8]</span><br><span class="line">	add esp, 4</span><br><span class="line">	pop ebx</span><br><span class="line">	pop ebp</span><br><span class="line">	ret</span><br><span class="line">_getch:</span><br><span class="line">	mov ah, 01H</span><br><span class="line">	int 16H</span><br><span class="line">	jz _getch</span><br><span class="line">	mov ah, 00H</span><br><span class="line">	int 16H</span><br><span class="line">	ret</span><br><span class="line">_setCursor:</span><br><span class="line">	push ebp</span><br><span class="line">	mov ebp, esp</span><br><span class="line">	push ebx</span><br><span class="line">	mov eax, 512</span><br><span class="line">	mov ecx, 0</span><br><span class="line">	mov edx, dword [ebp+8]</span><br><span class="line">	mov ebx, ecx</span><br><span class="line">	int 0x10</span><br><span class="line">	pop ebx</span><br><span class="line">	pop ebp</span><br><span class="line">	ret</span><br><span class="line">_putC:</span><br><span class="line">	push ebp</span><br><span class="line">	mov ebp, esp</span><br><span class="line">	push ebx</span><br><span class="line">	mov eax, dword [ebp+8]</span><br><span class="line">	or ah, 9</span><br><span class="line">	mov edx, dword [ebp+12]</span><br><span class="line">	mov ecx, 1</span><br><span class="line">	mov ebx, edx</span><br><span class="line">	int 0x10</span><br><span class="line">	pop ebx</span><br><span class="line">	pop ebp</span><br><span class="line">	ret</span><br><span class="line">_pageUP:</span><br><span class="line">	push ebp</span><br><span class="line">	mov ebp, esp</span><br><span class="line">	mov eax, dword [ebp+8]</span><br><span class="line">	or ah, 6</span><br><span class="line">	mov ecx, 0</span><br><span class="line">	mov edx, 184fh</span><br><span class="line">	int 0x10</span><br><span class="line">	pop ebp</span><br><span class="line">	ret</span><br><span class="line">_loadProgram:</span><br><span class="line">	push ebp</span><br><span class="line">	mov ebp, esp</span><br><span class="line">	push ax</span><br><span class="line">	push bx</span><br><span class="line">	push cx</span><br><span class="line">	push dx</span><br><span class="line">	push es</span><br><span class="line">	mov ax, cs</span><br><span class="line">	mov es, ax</span><br><span class="line">	mov bx, UserPrgOffset</span><br><span class="line">	mov ah, 2</span><br><span class="line">	mov al, 2</span><br><span class="line">	mov dl, 0</span><br><span class="line">	mov dh, 1</span><br><span class="line">	mov ch, 0</span><br><span class="line">	mov cl, byte [ebp+8]</span><br><span class="line">	add cl, PrgSectorOffset</span><br><span class="line">	int 13H</span><br><span class="line">	call UserPrgOffset</span><br><span class="line">	pop es</span><br><span class="line">	pop dx</span><br><span class="line">	pop cx</span><br><span class="line">	pop bx</span><br><span class="line">	pop ax</span><br><span class="line">	mov esp, ebp</span><br><span class="line">	pop ebp</span><br><span class="line">	ret</span><br><span class="line">int8:</span><br><span class="line">	cli</span><br><span class="line">	pusha</span><br><span class="line">	push eax</span><br><span class="line">	call draw_slash</span><br><span class="line">	mov al, 20H</span><br><span class="line">	out 20H, al</span><br><span class="line">	out 0a0H, al</span><br><span class="line">	pop eax</span><br><span class="line">	popa</span><br><span class="line">	sti</span><br><span class="line">	iret</span><br><span class="line">int33:</span><br><span class="line">	mov word[n], 12</span><br><span class="line">	mov word[m], 30</span><br><span class="line">	mov word[top], 2</span><br><span class="line">	mov word[left], 40</span><br><span class="line">	mov word[length], 8</span><br><span class="line">	mov word[msg], msg1</span><br><span class="line">	call show</span><br><span class="line">	iret</span><br><span class="line">int34:</span><br><span class="line">	mov word[n], 12</span><br><span class="line">	mov word[m], 30</span><br><span class="line">	mov word[top], 2</span><br><span class="line">	mov word[left], 0</span><br><span class="line">	mov word[length], 10</span><br><span class="line">	mov word[msg], msg2</span><br><span class="line">	call show</span><br><span class="line">	iret</span><br><span class="line">int35:</span><br><span class="line">	mov word[n], 12</span><br><span class="line">	mov word[m], 20</span><br><span class="line">	mov word[top], 13</span><br><span class="line">	mov word[left], 0</span><br><span class="line">	mov word[length], 20</span><br><span class="line">	mov word[msg], msg3</span><br><span class="line">	call show</span><br><span class="line">	iret</span><br><span class="line">int36:</span><br><span class="line">	mov word[n], 12</span><br><span class="line">	mov word[m], 14</span><br><span class="line">	mov word[top], 13</span><br><span class="line">	mov word[left], 40</span><br><span class="line">	mov word[length], 26</span><br><span class="line">	mov word[msg], msg4</span><br><span class="line">	call show</span><br><span class="line">	iret</span><br><span class="line">draw_slash:</span><br><span class="line">	print bar,1,24,78,7</span><br><span class="line">	cmp byte[bar],&apos;|&apos;</span><br><span class="line">	jne rslash</span><br><span class="line">	mov byte[bar],&apos;/&apos;</span><br><span class="line">	ret</span><br><span class="line">rslash:</span><br><span class="line">	cmp byte[bar],&apos;/&apos;</span><br><span class="line">	jne hslash</span><br><span class="line">	mov byte[bar],&apos;-&apos;</span><br><span class="line">	ret</span><br><span class="line">hslash:</span><br><span class="line">	cmp byte[bar],&apos;-&apos;</span><br><span class="line">	jne lslash</span><br><span class="line">	mov byte[bar],&apos;\&apos;</span><br><span class="line">	ret</span><br><span class="line">lslash:</span><br><span class="line">	mov byte[bar],&apos;|&apos;</span><br><span class="line">	ret</span><br><span class="line">show:</span><br><span class="line">	dec dword[cnt]</span><br><span class="line">	jnz show</span><br><span class="line">	mov dword[cnt],99999999</span><br><span class="line">	mov word ax, [t]</span><br><span class="line">	mov word bx, [n]</span><br><span class="line">	add bx, bx</span><br><span class="line">	sub bx, 2</span><br><span class="line">	xor dx, dx</span><br><span class="line">	div bx</span><br><span class="line">	cmp dx, [n]</span><br><span class="line">	jb xok</span><br><span class="line">	sub bx, dx</span><br><span class="line">	mov dx, bx</span><br><span class="line">xok:</span><br><span class="line">	add dx, [top]</span><br><span class="line">	mov word[x], dx</span><br><span class="line">	mov word ax, [t]</span><br><span class="line">	mov word bx, [m]</span><br><span class="line">	add bx,bx</span><br><span class="line">	sub bx,2</span><br><span class="line">	xor dx, dx</span><br><span class="line">	div bx</span><br><span class="line">	cmp dx, [m]</span><br><span class="line">	jb yok</span><br><span class="line">	sub bx, dx</span><br><span class="line">	mov dx, bx</span><br><span class="line">yok:</span><br><span class="line">	add dx,[left]</span><br><span class="line">	mov word [y],dx</span><br><span class="line">	inc word[t]</span><br><span class="line">	print [msg],[length],[x],[y],[x]</span><br><span class="line">	mov ah, 01H</span><br><span class="line">	int 16H</span><br><span class="line">	jz show</span><br><span class="line">	print msgouch,10,[x],[y],[x]</span><br><span class="line">	mov ah, 00H</span><br><span class="line">	int 16H</span><br><span class="line">	cmp ax, 2e03H</span><br><span class="line">	jne show</span><br><span class="line">	ret</span><br><span class="line">datadef:</span><br><span class="line">	cnt dd 1</span><br><span class="line">	t dw 0</span><br><span class="line">	x dw 1</span><br><span class="line">	y dw 0</span><br><span class="line">	n dw 12</span><br><span class="line">	m dw 32</span><br><span class="line">	top dw 2</span><br><span class="line">	left dw 40</span><br><span class="line">	length dw 8</span><br><span class="line">	msg dw 1</span><br><span class="line">	msg1 db &apos; wu-kan &apos;</span><br><span class="line">	msg2 db &apos; 17341163 &apos;</span><br><span class="line">	msg3 db &apos; wu.kan@foxmail.com &apos;</span><br><span class="line">	msg4 db &apos; https://wu-kan.github.io &apos;</span><br><span class="line">	msgouch db &apos;Ouch!Ouch!&apos;</span><br><span class="line">	bar db &apos;|&apos;</span><br></pre></td></tr></table></figure>

<h2 id="kerner-c"><a href="#kerner-c" class="headerlink" title="kerner.c"></a>kerner.c</h2><p>操作系统内核C语言部分的代码。</p>
<p>和上一实验相比：</p>
<ul>
<li>去掉了全部的内嵌汇编，改为调用外部汇编函数</li>
<li>修改了<code>clear</code>清屏的逻辑，原来是写若干个回车，现在是屏幕向上滚动一页并将光标移至首行首列</li>
<li>修改了显示回车的逻辑，原来是写若干个空格直至光标移动到下一行，现在直接移动光标</li>
</ul>
<p>函数不能传字符变量的问题仍然没有解决。</p>

undefined


<h3 id="link-ld"><a href="#link-ld" class="headerlink" title="link.ld"></a>link.ld</h3><p>将<code>wukos.asm</code>和<code>kernel.c</code>两个文件编译出来的内容连接起来。和上一个实验中的完全相同，不再放出。</p>
<h3 id="prg1-asm-prg4-asm"><a href="#prg1-asm-prg4-asm" class="headerlink" title="prg1.asm~prg4.asm"></a>prg1.asm~prg4.asm</h3><p>直接调用int 33、int 34、int 35和int 36四个中断实现（编译出来的大小仅有3bytes）。</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">org 0a100H</span><br><span class="line">int 33</span><br><span class="line">ret</span><br></pre></td></tr></table></figure>

<p>上面是prg1.asm的内容，其余同理，不再放出。</p>
<h3 id="Makefile"><a href="#Makefile" class="headerlink" title="Makefile"></a>Makefile</h3><p>和上一个实验完全相同，不再放出。</p>
<h2 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h2><p><img src="/2019/04/11/2019-03-31-中断处理与系统调用/image/2019-03-31-1.png" alt><br>如上图，进入操作系统后开始了“无敌风火轮”（右下角）。<br><img src="/2019/04/11/2019-03-31-中断处理与系统调用/image/2019-03-31-2.png" alt><br>如上图，使用<code>exec</code>指令轮流运行我的四个程序，分别调用软中断<code>int 33</code>~<code>int 36</code>。按下Ctrl+C可以退出程序。程序检测到键盘输入，因此显示<code>Ouch!Ouch!</code></p>
<p>风火轮仍然在转。<br><img src="/2019/04/11/2019-03-31-中断处理与系统调用/image/2019-03-31-3.png" alt><br>输入若干指令。</p>
<p>风火轮仍然在转。<br><img src="/2019/04/11/2019-03-31-中断处理与系统调用/image/2019-03-31-4.png" alt><br>继续输入若干指令，此时超出屏幕显示范围，自动滚屏。</p>
<p>风火轮仍然在转。</p>
<h1 id="实验总结"><a href="#实验总结" class="headerlink" title="实验总结"></a>实验总结</h1><p>这次实验让我深入理解了中断服务程序的工作原理。中断响应后，先到内存指定位置找到中断向量表，然后跳转到中断服务程序。中断服务程序需先保存寄存器。中断服务程序完成后，需先还原寄存器，然后调用中断返回指令。所以在做实验的时候，就需要修改操作系统内核，使操作系统内核修改中断向量表，才能实现自定义中断服务程序。</p>
<p>在实验中，因为乱用宏以及没有恢复寄存器出了挺多问题，好在最终一一解决了。这也让我意识到之前的代码写的有多差、有多少隐患。因此，几乎将原先的代码完全重构了一遍。希望自己还是要多多注意一下这方面的问题。</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-04-10T16:08:06.399Z">2019-04-11</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/超级计算机原理与操作/">超级计算机原理与操作</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    2 分钟 读完 (大约 293 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/04/11/2019-03-31-MPI并行奇偶交换排序/"></a>
            
        </h1>
        <div class="content">
            <p><a href="https://easyhpc.org/problems/program/356/" target="_blank" rel="noopener">题目链接</a></p>
<p>奇偶交换后的保留操作可以用更优的二路归并解决，这里偷懒直接使用<code>qsort</code>。</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;mpi.h&gt;</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">cmpInt</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *a, <span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *b)</span> </span>&#123; <span class="hljs-keyword">return</span> *(<span class="hljs-keyword">int</span> *)a - *(<span class="hljs-keyword">int</span> *)b; &#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	MPI_Init(&amp;argc, &amp;argv);</span><br><span class="line">	<span class="hljs-keyword">int</span> comSize, comRank, n, *globalData;</span><br><span class="line">	MPI_Comm_size(MPI_COMM_WORLD, &amp;comSize);</span><br><span class="line">	MPI_Comm_rank(MPI_COMM_WORLD, &amp;comRank);</span><br><span class="line">	<span class="hljs-keyword">if</span> (!comRank)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"Input array size:"</span>);</span><br><span class="line">		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;n);</span><br><span class="line">		globalData = <span class="hljs-built_in">malloc</span>(n * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>));</span><br><span class="line">		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"Then input %d number(s):"</span>, n);</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; ++i)</span><br><span class="line">			<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;globalData[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	MPI_Bcast(&amp;n, <span class="hljs-number">1</span>, MPI_INT, <span class="hljs-number">0</span>, MPI_COMM_WORLD);</span><br><span class="line">	<span class="hljs-keyword">int</span> *sendcounts = <span class="hljs-built_in">malloc</span>(comSize * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>)), *displs = <span class="hljs-built_in">malloc</span>(comSize * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>));</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>, cnt = (n + comSize - <span class="hljs-number">1</span>) / comSize;</span><br><span class="line">		 i &lt; comSize; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		displs[i] = i * cnt;</span><br><span class="line">		sendcounts[i] = n - displs[i] &lt; cnt ? n - displs[i] : cnt;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-keyword">int</span> *localData = <span class="hljs-built_in">malloc</span>((sendcounts[comRank] + sendcounts[<span class="hljs-number">0</span>]) * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>));</span><br><span class="line">	MPI_Scatterv(</span><br><span class="line">		globalData,</span><br><span class="line">		sendcounts,</span><br><span class="line">		displs,</span><br><span class="line">		MPI_INT,</span><br><span class="line">		localData,</span><br><span class="line">		sendcounts[comRank],</span><br><span class="line">		MPI_INT,</span><br><span class="line">		<span class="hljs-number">0</span>,</span><br><span class="line">		MPI_COMM_WORLD);</span><br><span class="line">	qsort(localData, sendcounts[comRank], <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>), &amp;cmpInt);</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; comSize; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">int</span> partner = comRank + ((i + comRank) &amp; <span class="hljs-number">1</span> ? <span class="hljs-number">1</span> : <span class="hljs-number">-1</span>);</span><br><span class="line">		<span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> &lt;= partner &amp;&amp; partner &lt; comSize)</span><br><span class="line">		&#123;</span><br><span class="line">			MPI_Sendrecv(</span><br><span class="line">				localData,</span><br><span class="line">				sendcounts[comRank],</span><br><span class="line">				MPI_INT,</span><br><span class="line">				partner,</span><br><span class="line">				i,</span><br><span class="line">				localData + sendcounts[comRank],</span><br><span class="line">				sendcounts[partner],</span><br><span class="line">				MPI_INT,</span><br><span class="line">				partner,</span><br><span class="line">				i,</span><br><span class="line">				MPI_COMM_WORLD,</span><br><span class="line">				MPI_STATUS_IGNORE);</span><br><span class="line">			qsort(localData, sendcounts[comRank] + sendcounts[partner], <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>), &amp;cmpInt);</span><br><span class="line">			<span class="hljs-keyword">if</span> (comRank &gt; partner)</span><br><span class="line">				<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; sendcounts[comRank]; ++i)</span><br><span class="line">					localData[i] = localData[i + sendcounts[partner]];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	MPI_Gatherv(</span><br><span class="line">		localData,</span><br><span class="line">		sendcounts[comRank],</span><br><span class="line">		MPI_INT,</span><br><span class="line">		globalData,</span><br><span class="line">		sendcounts,</span><br><span class="line">		displs,</span><br><span class="line">		MPI_INT,</span><br><span class="line">		<span class="hljs-number">0</span>,</span><br><span class="line">		MPI_COMM_WORLD);</span><br><span class="line">	<span class="hljs-built_in">free</span>(localData), <span class="hljs-built_in">free</span>(sendcounts), <span class="hljs-built_in">free</span>(displs);</span><br><span class="line">	<span class="hljs-keyword">if</span> (!comRank)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; ++i)</span><br><span class="line">			<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d "</span>, globalData[i]);</span><br><span class="line">		<span class="hljs-built_in">free</span>(globalData);</span><br><span class="line">	&#125;</span><br><span class="line">	MPI_Finalize();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-04-10T16:08:06.398Z">2019-04-11</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/操作系统/">操作系统</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    24 分钟 读完 (大约 3669 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/04/11/2019-03-28-用汇编与C语言开发独立内核/"></a>
            
        </h1>
        <div class="content">
            <h1 id="实验题目"><a href="#实验题目" class="headerlink" title="实验题目"></a>实验题目</h1><p>用汇编与C语言开发独立内核</p>
<h1 id="实验目的"><a href="#实验目的" class="headerlink" title="实验目的"></a>实验目的</h1><ul>
<li>掌握TASM汇编语言与TURBO C语言汇合编程的方法。</li>
<li>实现内核与引导程序分离，掌握软盘上引导操作系统方法。</li>
<li>设计并实现一种简单的作业控制语言，建立具有较友好的控制命令的批处理原型操作系统，掌握操作系统提供用户界面和内部功能的实现方法。</li>
</ul>
<h1 id="实验要求"><a href="#实验要求" class="headerlink" title="实验要求"></a>实验要求</h1><ul>
<li>将实验二的原型操作系统分离为引导程序和MYOS内核，由引导程序加载内核，用C和汇编实现操作系统内核</li>
<li>扩展内核汇编代码，增加一些有用的输入输出函数，供C模块中调用</li>
<li>提供用户程序返回内核的一种解决方案</li>
<li>在内核的C模块中实现增加批处理能力<ul>
<li>在磁盘上建立一个表，记录用户程序的存储安排</li>
<li>可以在控制台命令查到用户程序的信息，如程序名、字节数、在磁盘映像文件中的位置等</li>
<li>设计一种命令，命令中可加载多个用户程序，依次执行，并能在控制台发出命令</li>
<li>在引导系统前，将一组命令存放在磁盘映像中，系统可以解释执行</li>
</ul>
</li>
</ul>
<h1 id="实验方案"><a href="#实验方案" class="headerlink" title="实验方案"></a>实验方案</h1><h2 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h2><h3 id="软件"><a href="#软件" class="headerlink" title="软件"></a>软件</h3><ul>
<li>Windows 10, 64-bit  (Build 17763) 10.0.17763</li>
<li>Windows Subsystem for Linux [Ubuntu 18.04.2 LTS]：WSL是以软件的形式运行在Windows下的Linux子系统，是近些年微软推出来的新工具，可以在Windows系统上原生运行Linux。</li>
<li>gcc version 7.3.0 (Ubuntu 7.3.0-27ubuntu1~18.04)：C语言程序编译器，Ubuntu自带。</li>
<li>NASM version 2.13.02：汇编程序编译器，通过<code>sudo apt install nasm</code>安装在WSL上。</li>
<li>Oracle VM VirtualBox 6.0.4 r128413 (Qt5.6.2)：轻量开源的虚拟机软件。</li>
<li>VSCode - Insiders v1.33.0：好用的文本编辑器，有丰富的插件。</li>
<li>hexdump for VSCode 1.7.2: VSCode中一个好用的十六进制显示插件。</li>
<li>GNU Make 4.1：安装在Ubuntu下，一键编译并连接代码，生成最终的文件。</li>
</ul>
<p>大部分开发环境安装在WSL上，较之于双系统、虚拟机等其他开发方案，更加方便，也方便直接使用Linux下的一些指令。</p>
<h3 id="硬件"><a href="#硬件" class="headerlink" title="硬件"></a>硬件</h3><h4 id="开发环境配置"><a href="#开发环境配置" class="headerlink" title="开发环境配置"></a>开发环境配置</h4><p>所用机器型号为VAIO Z Flip 2016</p>
<ul>
<li>Intel(R) Core(TM) i7-6567U CPU @3.30GHZ 3.31GHz</li>
<li>8.00GB RAM</li>
</ul>
<h4 id="虚拟机配置"><a href="#虚拟机配置" class="headerlink" title="虚拟机配置"></a>虚拟机配置</h4><ul>
<li>处理器内核总数：1</li>
<li>RAM：4MB</li>
</ul>
<h2 id="实验原理"><a href="#实验原理" class="headerlink" title="实验原理"></a>实验原理</h2><p>这次实验完成内容的结构大致如下：</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">引导程序--&gt;main</span><br><span class="line">用户==交互==&gt;C语言函数</span><br><span class="line">subgraph 汇编与C语言混合编译的内核</span><br><span class="line">main-.外部调用.-&gt; 汇编函数</span><br><span class="line">main.-&gt; C语言函数</span><br><span class="line">C语言函数-.内嵌.-&gt;汇编函数</span><br><span class="line">end</span><br><span class="line">subgraph 用户程序</span><br><span class="line">汇编函数--&gt; prg1</span><br><span class="line">汇编函数--&gt; prg2</span><br><span class="line">汇编函数--&gt; prg3</span><br><span class="line">汇编函数--&gt; prg4</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<h3 id="引导程序"><a href="#引导程序" class="headerlink" title="引导程序"></a>引导程序</h3><p>在<a href="https://wu-kan.github.io/posts/操作系统/加载用户程序的监控程序" target="_blank" rel="noopener">上一个实验</a>里已经说得很清楚了，这里就不再提了，可以直接看代码。</p>
<h3 id="汇编与C语言混合编译的内核"><a href="#汇编与C语言混合编译的内核" class="headerlink" title="汇编与C语言混合编译的内核"></a>汇编与C语言混合编译的内核</h3><p>这里的内核指的是汇编代码<code>kernel.asm</code>和C语言代码<code>kernel.c</code>混合编译而成的内核文件<code>kernel.bin</code>。</p>
<h4 id="汇编部分kernel-asm"><a href="#汇编部分kernel-asm" class="headerlink" title="汇编部分kernel.asm"></a>汇编部分<code>kernel.asm</code></h4><p>内核的第一部分是汇编程序，设置软件中断，声明一个全局的<code>_loadProgram</code>函数用于加载用户程序，然后直接调用C程序中的<code>main</code>函数链接到C程序入口点。</p>
<p>在汇编程序中调用C函数比较简单，在程序段头部添加<code>extern</code>标识符，然后在程序中直接<code>call</code>即可。</p>
<p>这里由于不太想学古董级的<code>tasm</code>，使用<code>nasm</code>替代之。</p>
<h4 id="C语言部分kernel-c"><a href="#C语言部分kernel-c" class="headerlink" title="C语言部分kernel.c"></a>C语言部分<code>kernel.c</code></h4><p>内核的主要部分，提供了shell命令行功能，用于实现用户和系统的交互。</p>
<p>C语言也可以声明外部函数<code>extern _loadProgram</code>调用汇编函数。此外，C<br>语言还支持内嵌汇编代码，通过<code>asm volatile</code>声明，其中<code>volatile</code>标识符的作用是禁止编译器自动优化，具体的例子可以看我下面的代码。由于我用的编译器<code>gcc</code>默认的内嵌汇编语法是<code>AT&amp;T</code>，在编译时要添加<code>-masm=intel</code>换成 <code>nasm</code>的语法。</p>
<p>虽然支持内嵌汇编，但是我还是不想整个C语言内核部分的代码都是这种鬼东西。因此，我只在<code>putchar</code>（向当前位置写一个字符，并移动光标到下一有效位置）、<code>getch</code>（无回显地读取一个字符）中使用了内嵌汇编，其余的屏幕IO操作都通过调用这两个函数实现。</p>
<h4 id="混合编译link-ld"><a href="#混合编译link-ld" class="headerlink" title="混合编译link.ld"></a>混合编译<code>link.ld</code></h4><p>第一次搞这种东西着实想了很久…下面直接结合Makefile代码来解释。</p>
<figure class="highlight makefile hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-section">kernel.bin: kernel.o kernel.obj</span></span><br><span class="line">	ld -m elf_i386 -N --oformat binary -Ttext 0x7e00 <span class="hljs-variable">$^</span> -o <span class="hljs-variable">$@</span></span><br></pre></td></tr></table></figure>

<p>用ld结合链接文件link.ld，将上述两个.o文件链接生成内核二进制文件kernel.bin。</p>
<figure class="highlight makefile hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-section">kernel.o: kernel.c</span></span><br><span class="line">	gcc -march=i386 -m16 -mpreferred-stack-boundary=2 -ffreestanding -fno-PIE -masm=intel -c <span class="hljs-variable">$&lt;</span> -o <span class="hljs-variable">$@</span></span><br></pre></td></tr></table></figure>

<p>把内核C语言部分编译。<code>-march=i386</code>使用i386指令集；<code>-m16</code>生成16位代码；<code>-mpreferred-stack-boundary=2</code>栈指针按照$2\times 2=4$字节对齐；<code>-ffreestanding</code>使输出程序能够独立运行；PIE能使程序像共享库一样在主存任何位置装载，这需要将程序编译成位置无关，并链接为ELF共享对象，这里用<code>-fno-PIE</code>关掉；<code>-masm=intel</code>使用<code>nasm</code>格式的内联汇编语法。</p>
<figure class="highlight makefile hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kernel.obj : kernel.asm</span><br><span class="line">	nasm -felf <span class="hljs-variable">$&lt;</span> -o <span class="hljs-variable">$@</span></span><br></pre></td></tr></table></figure>

<p>把内核汇编部分编译成ELF文件。</p>
<h3 id="用户程序"><a href="#用户程序" class="headerlink" title="用户程序"></a>用户程序</h3><p>在C语言的内核代码中，用户程序的表这样建的，用一个结构体保存用户程序名、大小、运行指令、调用地址。</p>

undefined


<p>这里实现了一个任务栈用于批量加载用户程序。当单独执行某一程序时，main函数并不会直接执行任务，而是将待做任务压入一个栈中；每次循环调用main函数时会先检查任务栈有没有清空，如果未清空则优先弹栈并执行栈中的任务。这样做的优点是批处理无需单独拉出来考虑，接受任务序列时按照反顺序压栈即可。</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> task[MAX_BUF_LEN], task_size = <span class="hljs-number">0</span>;</span><br><span class="line"><span class="hljs-keyword">if</span> (task_size)</span><br><span class="line">	<span class="hljs-keyword">return</span> _loadProgram(prg[task[--task_size]].address + PrgSectorOffset), main();</span><br></pre></td></tr></table></figure>

<p>和<a href="https://wu-kan.github.io/posts/操作系统/加载用户程序的监控程序" target="_blank" rel="noopener">上一个实验</a>一样，用户程序调用<code>int20</code>中断用于检测是否有<code>Ctrl + C</code>并退出。不一样的是，这次是退回操作系统内核而非引导程序。</p>
<h1 id="实验过程"><a href="#实验过程" class="headerlink" title="实验过程"></a>实验过程</h1><h2 id="实验代码"><a href="#实验代码" class="headerlink" title="实验代码"></a>实验代码</h2><h3 id="bootloader-asm"><a href="#bootloader-asm" class="headerlink" title="bootloader.asm"></a>bootloader.asm</h3><p>从键盘读取任意按键后进入操作系统内核。</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">%macro print 5	; string, length, x, y, color</span><br><span class="line">	pusha</span><br><span class="line">	push ax</span><br><span class="line">	push bx</span><br><span class="line">	push cx</span><br><span class="line">	push dx</span><br><span class="line">	push bp</span><br><span class="line">	push ds</span><br><span class="line">	push es</span><br><span class="line">	mov ax, 0b800H</span><br><span class="line">	mov gs, ax</span><br><span class="line">	mov ax, cs</span><br><span class="line">	mov ds, ax</span><br><span class="line">	mov bp, %1</span><br><span class="line">	mov ax, ds</span><br><span class="line">	mov es, ax</span><br><span class="line">	mov cx, %2</span><br><span class="line">	mov ax, 1301H</span><br><span class="line">	mov dh, %3</span><br><span class="line">	mov dl, %4</span><br><span class="line">	mov bx, %5</span><br><span class="line">	int 10H</span><br><span class="line">	pop es</span><br><span class="line">	pop ds</span><br><span class="line">	pop bp</span><br><span class="line">	pop dx</span><br><span class="line">	pop cx</span><br><span class="line">	pop bx</span><br><span class="line">	pop ax</span><br><span class="line">	popa</span><br><span class="line">%endmacro</span><br><span class="line">	bits 16</span><br><span class="line">	UserPrgOffset equ 7e00H</span><br><span class="line">	PrgSectorOffset equ 2</span><br><span class="line">	org 7c00H</span><br><span class="line">start:</span><br><span class="line">	print msg, 30, 0, 0, 07H</span><br><span class="line">	mov ah, 0</span><br><span class="line">	int 16H</span><br><span class="line">loadOS:</span><br><span class="line">	mov ax, 0</span><br><span class="line">	mov es, ax</span><br><span class="line">	mov bx, UserPrgOffset</span><br><span class="line">	mov ah, 2</span><br><span class="line">	mov al, 17</span><br><span class="line">	mov dl, 0</span><br><span class="line">	mov dh, 0</span><br><span class="line">	mov ch, 0</span><br><span class="line">	mov cl, PrgSectorOffset</span><br><span class="line">	int 13H</span><br><span class="line">	call UserPrgOffset</span><br><span class="line">	jmp $</span><br><span class="line">datadef:</span><br><span class="line">	msg db &apos;Press any key to enter WuK-OS.&apos;</span><br></pre></td></tr></table></figure>

<h3 id="kernel-asm"><a href="#kernel-asm" class="headerlink" title="kernel.asm"></a>kernel.asm</h3><p>操作系统内核的汇编部分代码，提供<code>int 20h</code>中断用于从用户程序中检测<code>Ctrl + C</code>并返回<code>main</code>函数，并提供<code>_loadProgram</code>函数用于加载用户程序。</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">	bits 16</span><br><span class="line">	extern main</span><br><span class="line">	global _loadProgram</span><br><span class="line">	UserPrgOffset equ 0A100h</span><br><span class="line">_start:</span><br><span class="line">	mov ax, 0000h</span><br><span class="line">	mov es, ax</span><br><span class="line">	mov ax, 20h</span><br><span class="line">	mov bx, 4</span><br><span class="line">	mul bx</span><br><span class="line">	mov si, ax</span><br><span class="line">	mov ax, _int20h</span><br><span class="line">	mov [es:si], ax</span><br><span class="line">	add si, 2</span><br><span class="line">	mov ax, cs</span><br><span class="line">	mov [es:si], ax</span><br><span class="line">	call main</span><br><span class="line">_end:</span><br><span class="line">	jmp $</span><br><span class="line">_loadProgram:</span><br><span class="line">	push ebp</span><br><span class="line">	mov ebp, esp</span><br><span class="line">	mov ecx, [ebp+8]</span><br><span class="line">	mov ax, cs</span><br><span class="line">	mov es, ax</span><br><span class="line">	mov bx, UserPrgOffset</span><br><span class="line">	mov ah, 2</span><br><span class="line">	mov al, 1</span><br><span class="line">	mov dl, 0</span><br><span class="line">	mov dh, 1</span><br><span class="line">	mov ch, 0</span><br><span class="line">	int 13H</span><br><span class="line">	jmp UserPrgOffset</span><br><span class="line">	mov esp, ebp</span><br><span class="line">	pop ebp</span><br><span class="line">	ret</span><br><span class="line">_int20h:</span><br><span class="line">	mov ah, 01h</span><br><span class="line">	int 16h</span><br><span class="line">	jz _noclick</span><br><span class="line">	mov ah, 00h</span><br><span class="line">	int 16h</span><br><span class="line">	cmp ax, 2e03h ; 检测 Ctrl + C</span><br><span class="line">	jne _noclick</span><br><span class="line">	jmp main</span><br><span class="line">_noclick:</span><br><span class="line">	iret</span><br></pre></td></tr></table></figure>

<h3 id="kerner-c"><a href="#kerner-c" class="headerlink" title="kerner.c"></a>kerner.c</h3><p>操作系统内核C语言部分的代码。</p>
<p>这里遇到一个问题，所有的字符串常量都不能直接传进函数里去…在课程群里问了之后也有别的同学遇到了这个情况。调了快一天心力交猝之后选择向现实低头，把所有的字符串先存进一个变量里去。</p>

undefined


<h3 id="link-ld"><a href="#link-ld" class="headerlink" title="link.ld"></a>link.ld</h3><p>将<code>wukos.asm</code>和<code>kernel.c</code>两个文件编译出来的内容连接起来。</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">OUTPUT_FORMAT(&quot;elf32-i386&quot;)</span><br><span class="line">ENTRY(_start)</span><br><span class="line">SECTIONS</span><br><span class="line">&#123;</span><br><span class="line">	. = 0x7E00;</span><br><span class="line">	.text ALIGN (0x00) : &#123;</span><br><span class="line">		*(.text);</span><br><span class="line">	&#125;</span><br><span class="line">	.rodata ALIGN (4) : &#123;</span><br><span class="line">		*(.rodata*);</span><br><span class="line">	&#125;</span><br><span class="line">	.data ALIGN (4) : &#123;</span><br><span class="line">		*(.data*);</span><br><span class="line">	&#125;</span><br><span class="line">	.bss ALIGN (4) : &#123;</span><br><span class="line">		*(COMMON);</span><br><span class="line">		*(.bss*);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="prg1-asm-prg4-asm"><a href="#prg1-asm-prg4-asm" class="headerlink" title="prg1.asm~prg4.asm"></a>prg1.asm~prg4.asm</h3><p>和<a href="https://wu-kan.github.io/posts/操作系统/加载用户程序的监控程序" target="_blank" rel="noopener">上一个实验</a>中的<code>a.asm</code>~<code>d.asm</code>完全相同，这里不再放出。</p>
<h3 id="Makefile"><a href="#Makefile" class="headerlink" title="Makefile"></a>Makefile</h3><p>这次文件太多，只好手动写Makefile了…</p>
<figure class="highlight makefile hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">BIN = bootloader.bin kernel.bin prg1.bin prg2.bin prg3.bin prg4.bin</span><br><span class="line">IMG = wukos.img</span><br><span class="line"><span class="hljs-section">all: clear <span class="hljs-variable">$(BIN)</span> <span class="hljs-variable">$(IMG)</span></span></span><br><span class="line"><span class="hljs-section">clear:</span></span><br><span class="line">	rm -f <span class="hljs-variable">$(BIN)</span> <span class="hljs-variable">$(IMG)</span></span><br><span class="line"><span class="hljs-section">kernel.bin: kernel.obj kernel.o</span></span><br><span class="line">	ld -m elf_i386 -N --oformat binary -Ttext 0x7e00 <span class="hljs-variable">$^</span> -o <span class="hljs-variable">$@</span></span><br><span class="line"><span class="hljs-section">kernel.o: kernel.c</span></span><br><span class="line">	gcc -march=i386 -m16 -mpreferred-stack-boundary=2 -ffreestanding -fno-PIE -masm=intel -c <span class="hljs-variable">$&lt;</span> -o <span class="hljs-variable">$@</span></span><br><span class="line">kernel.obj : kernel.asm</span><br><span class="line">	nasm -felf <span class="hljs-variable">$&lt;</span> -o <span class="hljs-variable">$@</span></span><br><span class="line"><span class="hljs-section">%.bin: %.asm</span></span><br><span class="line">	nasm -fbin <span class="hljs-variable">$&lt;</span> -o <span class="hljs-variable">$@</span></span><br><span class="line"><span class="hljs-section">%.img:</span></span><br><span class="line">	/sbin/mkfs.msdos -C <span class="hljs-variable">$@</span> 1440</span><br><span class="line">	dd if=bootloader.bin of=<span class="hljs-variable">$@</span> conv=notrunc</span><br><span class="line">	dd if=kernel.bin of=<span class="hljs-variable">$@</span> seek=1 conv=notrunc</span><br><span class="line">	dd if=prg1.bin of=<span class="hljs-variable">$@</span> seek=18 conv=notrunc</span><br><span class="line">	dd if=prg2.bin of=<span class="hljs-variable">$@</span> seek=19 conv=notrunc</span><br><span class="line">	dd if=prg3.bin of=<span class="hljs-variable">$@</span> seek=20 conv=notrunc</span><br><span class="line">	dd if=prg4.bin of=<span class="hljs-variable">$@</span> seek=21 conv=notrunc</span><br></pre></td></tr></table></figure>

<h2 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h2><h3 id="引导程序-1"><a href="#引导程序-1" class="headerlink" title="引导程序"></a>引导程序</h3><p>如图，启动后进入引导程序。<br><img src="/2019/04/11/2019-03-28-用汇编与C语言开发独立内核/image/2019-03-28-0.png" alt><br>按下键盘任意按键后进入下一步。</p>
<h3 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h3><p><img src="/2019/04/11/2019-03-28-用汇编与C语言开发独立内核/image/2019-03-28-1.png" alt><br>第一次进入系统时并没有完全清除屏幕上的提示信息，原因是我不希望自己写的内核过多地控制屏幕显示内容；取而代之的是，用户可以手动输入<code>clear</code>指令用于清除屏幕上的内容。</p>
<h3 id="测试一些指令"><a href="#测试一些指令" class="headerlink" title="测试一些指令"></a>测试一些指令</h3><p><img src="/2019/04/11/2019-03-28-用汇编与C语言开发独立内核/image/2019-03-28-2.png" alt><br>这是依次键入一个空指令、一个<code>show</code>（不支持的指令）、一个<code>help</code>指令（用于提示所有可执行的命令）、一个<code>ls</code>指令（用于显示所用户程序和对应信息）后的运行界面。</p>
<p>可以看到，我的内核完美的识别出了支持的指令并正确运行，对于空指令和不支持的指令也会有相应的提示。</p>
<h3 id="批处理"><a href="#批处理" class="headerlink" title="批处理"></a>批处理</h3><p>由于运行单个程序和批处理的原理和实际效果是完全相同的，这里只放出运行批处理的过程了。</p>
<p><img src="/2019/04/11/2019-03-28-用汇编与C语言开发独立内核/image/2019-03-28-3.png" alt><br>如图，这是运行<code>exec</code>指令后打开的第一个程序。做<a href="https://wu-kan.github.io/posts/操作系统/加载用户程序的监控程序" target="_blank" rel="noopener">上一个实验</a>时并没有在运行时清空屏幕，因此可以看到我的姓名是直接叠加在输出界面上的。</p>
<p><img src="/2019/04/11/2019-03-28-用汇编与C语言开发独立内核/image/2019-03-28-4.png" alt><br>依次按Ctrl+C退出这个程序并进入下一个程序。运行完所有四个用户程序后效果如图所示。</p>
<h3 id="清屏"><a href="#清屏" class="headerlink" title="清屏"></a>清屏</h3><p>前面说了，我不希望自己写的内核过多地自己控制屏幕显示，而是给用户提供一条指令用于清屏。输入<code>clear</code>指令后如图，瞬间舒服了。<br><img src="/2019/04/11/2019-03-28-用汇编与C语言开发独立内核/image/2019-03-28-5.png" alt></p>
<h3 id="退出"><a href="#退出" class="headerlink" title="退出"></a>退出</h3><p><img src="/2019/04/11/2019-03-28-用汇编与C语言开发独立内核/image/2019-03-28-6.png" alt><br>如图，输入<code>exit</code>指令后退出系统内核，不再响应用户的输入。</p>
<h1 id="实验总结"><a href="#实验总结" class="headerlink" title="实验总结"></a>实验总结</h1><p>这次实验出来后，朋友圈一片对这个实验的吐槽。究其原因，可能有以下几点：</p>
<ul>
<li>老师给的<code>tcc</code>+<code>tasm</code>方案过于老旧，很难有参考价值</li>
<li><code>gcc</code>的编译参数很多，只好慢慢摸索出一个“看起来能用”的编译选项，内在机理还是没有完全搞懂（这也可能是没办法传字符串的原因之一）</li>
<li>各种玄学错误，一下能运行一下又运行不了，莫名其妙的卡死，莫名其妙的执行用户程序</li>
<li>单步调试时发现C编译出来的汇编和自己想的有时候完全不同，尝试关闭编译器优化<code>-O0</code>但是没有效果</li>
</ul>
<p>并且，虽然勉强做完了，但是还遗留下C内核程序没有办法直接向函数传递字符串常量的问题，希望可以在日后的学习过程中解决。</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-04-10T16:08:06.398Z">2019-04-11</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/超级计算机原理与操作/">超级计算机原理与操作</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    9 分钟 读完 (大约 1334 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/04/11/2019-03-25-Homework 2 MPI编程直方图/">Homework 2 MPI编程直方图</a>
            
        </h1>
        <div class="content">
            <p><a href="https://easyhpc.org/problems/program/355/" target="_blank" rel="noopener">题目链接</a></p>
<p>第一次做不是ACM的题解了。</p>
<p>使用MPI实现2.7.1节讨论的直方图程序，进程0读取输入的数据，并将它们分配到其余进程，最后进程0打印该直方图。<br>请根据提供的代码，将代码补充完整！ 需要补充的部分见注释 PLEASE ADD THE RIGHT CODES 部分。可直接点击下方作业题目跳转至在线编程平台，点击参考代码，补充完整后提交。（或下载附件 prog3.1_mpi_histo(blank).zip）</p>
<p>在参考代码的基础上加了155行和168~175行就解决问题了。这里找对应下标的时候使用了二分，其实是可以直接算出来的。</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment"> * File:     prog3.1_mpi_histo.c</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * Purpose:  Use MPI to implement a program that creates a histogram</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * Compile:  mpicc -g -Wall -o prog3.1_mpi_histo prog3.1_mpi_histo.c</span></span><br><span class="line"><span class="hljs-comment"> * Run:      mpiexec -n &lt;comm_sz&gt; ./prog3.1_mpi_histo</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * Input:    Number of bins</span></span><br><span class="line"><span class="hljs-comment"> *           Minimum measurement</span></span><br><span class="line"><span class="hljs-comment"> *           Maximum measurement</span></span><br><span class="line"><span class="hljs-comment"> *           Number of data items</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * Output:   Histogram of the data.  If DEBUG flag is set, the data</span></span><br><span class="line"><span class="hljs-comment"> *           generated.</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * Notes:</span></span><br><span class="line"><span class="hljs-comment"> * 1.  The number of data must be evenly divisible by the number of processes</span></span><br><span class="line"><span class="hljs-comment"> * 2.  The program generates random floats x in the range</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> *        min measurement &lt;= x &lt; max measurement</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * 3.  If i &gt;= 1, the ith bin contains measurements x in the</span></span><br><span class="line"><span class="hljs-comment"> *     range</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> *        bin_maxes[i-1] &lt;= x &lt; bin_maxes[i]</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> *     Bin 0 will contain measurements x in the range</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> *        min measurement &lt;= x &lt; bin_maxes[0]</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * IPP:     Programming Assignment 3.1</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;mpi.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Get_input</span><span class="hljs-params">(<span class="hljs-keyword">int</span> *bin_count_p, <span class="hljs-keyword">float</span> *min_meas_p, <span class="hljs-keyword">float</span> *max_meas_p,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">			   <span class="hljs-keyword">int</span> *data_count_p, <span class="hljs-keyword">int</span> *local_data_count_p, <span class="hljs-keyword">int</span> my_rank,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">			   <span class="hljs-keyword">int</span> comm_sz, MPI_Comm comm)</span></span>;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Check_for_error</span><span class="hljs-params">(<span class="hljs-keyword">int</span> local_ok, <span class="hljs-keyword">char</span> fname[], <span class="hljs-keyword">char</span> message[],</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">					 MPI_Comm comm)</span></span>;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Gen_data</span><span class="hljs-params">(<span class="hljs-keyword">float</span> local_data[], <span class="hljs-keyword">int</span> local_data_count, <span class="hljs-keyword">int</span> data_count,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">			  <span class="hljs-keyword">float</span> min_meas, <span class="hljs-keyword">float</span> max_meas, <span class="hljs-keyword">int</span> my_rank, MPI_Comm comm)</span></span>;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Set_bins</span><span class="hljs-params">(<span class="hljs-keyword">float</span> bin_maxes[], <span class="hljs-keyword">int</span> loc_bin_cts[], <span class="hljs-keyword">float</span> min_meas,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">			  <span class="hljs-keyword">float</span> max_meas, <span class="hljs-keyword">int</span> bin_count, <span class="hljs-keyword">int</span> my_rank, MPI_Comm comm)</span></span>;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Find_bins</span><span class="hljs-params">(<span class="hljs-keyword">int</span> bin_counts[], <span class="hljs-keyword">float</span> local_data[], <span class="hljs-keyword">int</span> loc_bin_cts[],</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">			   <span class="hljs-keyword">int</span> local_data_count, <span class="hljs-keyword">float</span> bin_maxes[],</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">			   <span class="hljs-keyword">int</span> bin_count, <span class="hljs-keyword">float</span> min_meas, MPI_Comm comm)</span></span>;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Which_bin</span><span class="hljs-params">(<span class="hljs-keyword">float</span> data, <span class="hljs-keyword">float</span> bin_maxes[], <span class="hljs-keyword">int</span> bin_count,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">			  <span class="hljs-keyword">float</span> min_meas)</span></span>;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Print_histo</span><span class="hljs-params">(<span class="hljs-keyword">float</span> bin_maxes[], <span class="hljs-keyword">int</span> bin_counts[], <span class="hljs-keyword">int</span> bin_count,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">				 <span class="hljs-keyword">float</span> min_meas)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">/*---------------------------------------------------------------------*/</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">int</span> bin_count;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">float</span> min_meas, max_meas;</span><br><span class="line">	<span class="hljs-keyword">float</span> *bin_maxes;</span><br><span class="line">	<span class="hljs-keyword">int</span> *bin_counts;</span><br><span class="line">	<span class="hljs-keyword">int</span> *loc_bin_cts;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">int</span> data_count;</span><br><span class="line">	<span class="hljs-keyword">int</span> local_data_count;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">float</span> *data;</span><br><span class="line">	<span class="hljs-keyword">float</span> *local_data;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">int</span> my_rank, comm_sz;</span><br><span class="line">	MPI_Comm comm;</span><br><span class="line"></span><br><span class="line">	MPI_Init(<span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);</span><br><span class="line">	comm = MPI_COMM_WORLD;</span><br><span class="line">	MPI_Comm_size(comm, &amp;comm_sz);</span><br><span class="line">	MPI_Comm_rank(comm, &amp;my_rank);</span><br><span class="line"></span><br><span class="line">	<span class="hljs-comment">// get user inputs for bin_count, max_meas, min_meas, and data_count</span></span><br><span class="line">	Get_input(&amp;bin_count, &amp;min_meas, &amp;max_meas, &amp;data_count,</span><br><span class="line">			  &amp;local_data_count, my_rank, comm_sz, comm);</span><br><span class="line"></span><br><span class="line">	<span class="hljs-comment">// allocate arrays</span></span><br><span class="line">	bin_maxes = <span class="hljs-built_in">malloc</span>(bin_count * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>));</span><br><span class="line">	bin_counts = <span class="hljs-built_in">malloc</span>(bin_count * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>));</span><br><span class="line">	loc_bin_cts = <span class="hljs-built_in">malloc</span>(bin_count * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>));</span><br><span class="line">	data = <span class="hljs-built_in">malloc</span>(data_count * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>));</span><br><span class="line">	local_data = <span class="hljs-built_in">malloc</span>(local_data_count * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>));</span><br><span class="line"></span><br><span class="line">	Set_bins(bin_maxes, loc_bin_cts, min_meas, max_meas, bin_count,</span><br><span class="line">			 my_rank, comm);</span><br><span class="line">	Gen_data(local_data, local_data_count, data_count, min_meas,</span><br><span class="line">			 max_meas, my_rank, comm);</span><br><span class="line">	Find_bins(bin_counts, local_data, loc_bin_cts, local_data_count,</span><br><span class="line">			  bin_maxes, bin_count, min_meas, comm);</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">if</span> (my_rank == <span class="hljs-number">0</span>)</span><br><span class="line">		Print_histo(bin_maxes, bin_counts, bin_count, min_meas);</span><br><span class="line"></span><br><span class="line">	<span class="hljs-built_in">free</span>(bin_maxes);</span><br><span class="line">	<span class="hljs-built_in">free</span>(bin_counts);</span><br><span class="line">	<span class="hljs-built_in">free</span>(loc_bin_cts);</span><br><span class="line">	<span class="hljs-built_in">free</span>(data);</span><br><span class="line">	<span class="hljs-built_in">free</span>(local_data);</span><br><span class="line">	MPI_Finalize();</span><br><span class="line">	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125; <span class="hljs-comment">/* main */</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">/*---------------------------------------------------------------------*/</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Print_histo</span><span class="hljs-params">(</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">float</span> bin_maxes[] <span class="hljs-comment">/* in */</span>,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">int</span> bin_counts[] <span class="hljs-comment">/* in */</span>,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">int</span> bin_count <span class="hljs-comment">/* in */</span>,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">float</span> min_meas <span class="hljs-comment">/* in */</span>)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">int</span> i, j;</span><br><span class="line">	<span class="hljs-keyword">float</span> bin_max, bin_min;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; bin_count; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		bin_max = bin_maxes[i];</span><br><span class="line">		bin_min = (i == <span class="hljs-number">0</span>) ? min_meas : bin_maxes[i - <span class="hljs-number">1</span>];</span><br><span class="line">		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%.3f-%.3f:\t"</span>, bin_min, bin_max);</span><br><span class="line">		<span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; bin_counts[i]; j++)</span><br><span class="line">			<span class="hljs-built_in">printf</span>(<span class="hljs-string">"X"</span>);</span><br><span class="line">		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125; <span class="hljs-comment">/* Print_histo */</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">/*---------------------------------------------------------------------*/</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Find_bins</span><span class="hljs-params">(</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">int</span> bin_counts[] <span class="hljs-comment">/* out */</span>,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">float</span> local_data[] <span class="hljs-comment">/* in  */</span>,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">int</span> loc_bin_cts[] <span class="hljs-comment">/* out */</span>,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">int</span> local_data_count <span class="hljs-comment">/* in  */</span>,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">float</span> bin_maxes[] <span class="hljs-comment">/* in  */</span>,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">int</span> bin_count <span class="hljs-comment">/* in  */</span>,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">float</span> min_meas <span class="hljs-comment">/* in  */</span>,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	MPI_Comm comm)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">int</span> i, bin;</span><br><span class="line">	<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; local_data_count; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		bin = Which_bin(local_data[i], bin_maxes, bin_count, min_meas);</span><br><span class="line">		loc_bin_cts[bin]++;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-comment">/*******************************************************************/</span></span><br><span class="line"></span><br><span class="line">	<span class="hljs-comment">//PLEASE ADD THE RIGHT CODES</span></span><br><span class="line">	MPI_Reduce(loc_bin_cts, bin_counts, bin_count, MPI_INT, MPI_SUM, <span class="hljs-number">0</span>, comm);</span><br><span class="line"></span><br><span class="line">	<span class="hljs-comment">/******************************************************************/</span></span><br><span class="line">&#125; <span class="hljs-comment">/* Find_bins */</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">/*---------------------------------------------------------------------*/</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Which_bin</span><span class="hljs-params">(<span class="hljs-keyword">float</span> data, <span class="hljs-keyword">float</span> bin_maxes[], <span class="hljs-keyword">int</span> bin_count,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">			  <span class="hljs-keyword">float</span> min_meas)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-comment">/*******************************************************************/</span></span><br><span class="line"></span><br><span class="line">	<span class="hljs-comment">//PLEASE ADD THE RIGHT CODES</span></span><br><span class="line">	<span class="hljs-keyword">int</span> b = <span class="hljs-number">0</span>, e = bin_count;</span><br><span class="line">	<span class="hljs-keyword">while</span> (e - b &gt; <span class="hljs-number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">int</span> m = b + (e - b) / <span class="hljs-number">2</span>;</span><br><span class="line">		data &lt; bin_maxes[m] ? (b = m) : (e = m);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-keyword">if</span> (b)</span><br><span class="line">		<span class="hljs-keyword">return</span> b;</span><br><span class="line">	<span class="hljs-comment">/******************************************************************/</span></span><br><span class="line"></span><br><span class="line">	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"Uh oh . . .\n"</span>);</span><br><span class="line">	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">&#125; <span class="hljs-comment">/* Which_bin */</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">/*---------------------------------------------------------------------*/</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Set_bins</span><span class="hljs-params">(</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">float</span> bin_maxes[] <span class="hljs-comment">/* out */</span>,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">int</span> loc_bin_cts[] <span class="hljs-comment">/* out */</span>,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">float</span> min_meas <span class="hljs-comment">/* in  */</span>,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">float</span> max_meas <span class="hljs-comment">/* in  */</span>,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">int</span> bin_count <span class="hljs-comment">/* in  */</span>,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">int</span> my_rank <span class="hljs-comment">/* in  */</span>,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	MPI_Comm comm <span class="hljs-comment">/* in  */</span>)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">if</span> (my_rank == <span class="hljs-number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">int</span> i;</span><br><span class="line">		<span class="hljs-keyword">float</span> bin_width;</span><br><span class="line">		bin_width = (max_meas - min_meas) / bin_count;</span><br><span class="line"></span><br><span class="line">		<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; bin_count; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			loc_bin_cts[i] = <span class="hljs-number">0</span>;</span><br><span class="line">			bin_maxes[i] = min_meas + (i + <span class="hljs-number">1</span>) * bin_width;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-comment">// set bin_maxes for each proc</span></span><br><span class="line">	MPI_Bcast(bin_maxes, bin_count, MPI_FLOAT, <span class="hljs-number">0</span>, comm);</span><br><span class="line"></span><br><span class="line">	<span class="hljs-comment">// reset loc_bin_cts of each proc</span></span><br><span class="line">	MPI_Bcast(loc_bin_cts, bin_count, MPI_INT, <span class="hljs-number">0</span>, comm);</span><br><span class="line">&#125; <span class="hljs-comment">/* Set_bins */</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">/*---------------------------------------------------------------------*/</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Gen_data</span><span class="hljs-params">(</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">float</span> local_data[] <span class="hljs-comment">/* out */</span>,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">int</span> local_data_count <span class="hljs-comment">/* in  */</span>,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">int</span> data_count <span class="hljs-comment">/* in  */</span>,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">float</span> min_meas <span class="hljs-comment">/* in  */</span>,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">float</span> max_meas <span class="hljs-comment">/* in  */</span>,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">int</span> my_rank <span class="hljs-comment">/* in  */</span>,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	MPI_Comm comm <span class="hljs-comment">/* in  */</span>)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">int</span> i;</span><br><span class="line">	<span class="hljs-keyword">float</span> *data = <span class="hljs-literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">if</span> (my_rank == <span class="hljs-number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		data = <span class="hljs-built_in">malloc</span>(data_count * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">float</span>));</span><br><span class="line">		srandom(<span class="hljs-number">1</span>);</span><br><span class="line">		<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; data_count; i++)</span><br><span class="line">			data[i] =</span><br><span class="line">				min_meas + (max_meas - min_meas) * random() / ((<span class="hljs-keyword">double</span>)RAND_MAX);</span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> DEBUG</span></span><br><span class="line">		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"Generated data:\n   "</span>);</span><br><span class="line">		<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; data_count; i++)</span><br><span class="line">			<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%.3f "</span>, data[i]);</span><br><span class="line">		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"\n\n"</span>);</span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></span><br><span class="line">		MPI_Scatter(data, local_data_count, MPI_FLOAT, local_data,</span><br><span class="line">					local_data_count, MPI_FLOAT, <span class="hljs-number">0</span>, comm);</span><br><span class="line">		<span class="hljs-built_in">free</span>(data);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		MPI_Scatter(data, local_data_count, MPI_FLOAT, local_data,</span><br><span class="line">					local_data_count, MPI_FLOAT, <span class="hljs-number">0</span>, comm);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125; <span class="hljs-comment">/* Gen_data */</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">/*---------------------------------------------------------------------*/</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Get_input</span><span class="hljs-params">(<span class="hljs-keyword">int</span> *bin_count_p, <span class="hljs-keyword">float</span> *min_meas_p, <span class="hljs-keyword">float</span> *max_meas_p,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">			   <span class="hljs-keyword">int</span> *data_count_p, <span class="hljs-keyword">int</span> *local_data_count_p, <span class="hljs-keyword">int</span> my_rank,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">			   <span class="hljs-keyword">int</span> comm_sz, MPI_Comm comm)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">int</span> local_ok = <span class="hljs-number">1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">if</span> (my_rank == <span class="hljs-number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"Enter the number of bins\n"</span>);</span><br><span class="line">		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, bin_count_p);</span><br><span class="line">		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"Enter the minimum measurement\n"</span>);</span><br><span class="line">		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%f"</span>, min_meas_p);</span><br><span class="line">		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"Enter the maximum measurement\n"</span>);</span><br><span class="line">		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%f"</span>, max_meas_p);</span><br><span class="line">		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"Enter the number of data\n"</span>);</span><br><span class="line">		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, data_count_p);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	MPI_Bcast(bin_count_p, <span class="hljs-number">1</span>, MPI_INT, <span class="hljs-number">0</span>, comm);</span><br><span class="line">	MPI_Bcast(min_meas_p, <span class="hljs-number">1</span>, MPI_INT, <span class="hljs-number">0</span>, comm);</span><br><span class="line">	MPI_Bcast(max_meas_p, <span class="hljs-number">1</span>, MPI_INT, <span class="hljs-number">0</span>, comm);</span><br><span class="line">	MPI_Bcast(data_count_p, <span class="hljs-number">1</span>, MPI_INT, <span class="hljs-number">0</span>, comm);</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">if</span> (*data_count_p % comm_sz != <span class="hljs-number">0</span>)</span><br><span class="line">		local_ok = <span class="hljs-number">0</span>;</span><br><span class="line"></span><br><span class="line">	Check_for_error(local_ok, <span class="hljs-string">"Get_input"</span>,</span><br><span class="line">					<span class="hljs-string">"data_count must be evenly divisible by comm_sz"</span>,</span><br><span class="line">					comm);</span><br><span class="line">	*local_data_count_p = *data_count_p / comm_sz;</span><br><span class="line"></span><br><span class="line">&#125; <span class="hljs-comment">/* Get_input */</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">/*---------------------------------------------------------------------*/</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Check_for_error</span><span class="hljs-params">(</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">int</span> local_ok <span class="hljs-comment">/* in */</span>,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">char</span> fname[] <span class="hljs-comment">/* in */</span>,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">char</span> message[] <span class="hljs-comment">/* in */</span>,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	MPI_Comm comm <span class="hljs-comment">/* in */</span>)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">int</span> ok;</span><br><span class="line"></span><br><span class="line">	MPI_Allreduce(&amp;local_ok, &amp;ok, <span class="hljs-number">1</span>, MPI_INT, MPI_MIN, comm);</span><br><span class="line">	<span class="hljs-keyword">if</span> (ok == <span class="hljs-number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">int</span> my_rank;</span><br><span class="line">		MPI_Comm_rank(comm, &amp;my_rank);</span><br><span class="line">		<span class="hljs-keyword">if</span> (my_rank == <span class="hljs-number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Proc %d &gt; In %s, %s\n"</span>, my_rank, fname,</span><br><span class="line">					message);</span><br><span class="line">			fflush(<span class="hljs-built_in">stderr</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		MPI_Finalize();</span><br><span class="line">		<span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125; <span class="hljs-comment">/* Check_for_error */</span></span><br></pre></td></tr></table></figure>


        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-04-10T16:08:06.398Z">2019-04-11</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/并行与分布式计算/">并行与分布式计算</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    27 分钟 读完 (大约 4000 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/04/11/2019-03-25-并行与分布式计算（2）/"></a>
            
        </h1>
        <div class="content">
            <p>并行与分布式计算<br>学院：数据科学与计算机学院<br>专业：计算机科学与技术（超级计算方向）<br>学号：17341163<br>姓名：吴坎</p>
<h1 id="课后作业"><a href="#课后作业" class="headerlink" title="课后作业"></a>课后作业</h1><blockquote>
<p>Why is it difficult to construct a true shared-memory computer? What is the minimum number of switches for connecting p processors to a shared memory with b words (where each word can be accessed independently)?</p>
</blockquote>
<p>共享内存的使用大大降低了在大规模数据处理过程中内存的消耗，但是共享内存的使用中有很多的陷阱，使理解和管理数据的局部性变得困难，一不注意就很容易导致程序崩溃。数据在读写过程中会更透明，但是数据写入进程或数据读出进程中，需要附加的数据结构控制。</p>
<p>每个word都需要一个开关，一共需要$b$个开关。</p>
<blockquote>
<p>Consider a memory system with a level 1 cache of 32 KB and DRAM of 512 MB with the processor operating at 1 GHz. The latency to L1 cache is one cycle and the latency to DRAM is 100 cycles. In each memory cycle, the processor fetches four words (cache line size is four words). What is the peak achievable performance of a dot product of two vectors? Note: Where necessary, assume an optimal cache placement policy.</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="hljs-comment">/* dot product loop */</span></span><br><span class="line">&gt; <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; dim; ++i)</span><br><span class="line">&gt; 	dot_prod += a[i] * b[i];</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>最佳的内存策略是cache的一半用于缓存a，另一半用于缓存b。在这样的情况下，i每增加4，会发生两次cache miss，访问2次DRAM和6次cache。因此，完成上述循环，需要$\frac{dim}{4}\times(2\times 100+6\times 1)\times\frac{1}{1GHz}=dim\times 5.15\times 10^{-8}s$</p>
<blockquote>
<h2 id="Homework-asst-1"><a href="#Homework-asst-1" class="headerlink" title="Homework-asst-1"></a>Homework-asst-1</h2><p>Consider the following code where each line within the function represents a single function.</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><br><span class="line"><span class="hljs-class">&gt; &#123;</span></span><br><span class="line">&gt; 	<span class="hljs-keyword">float</span> x, y;</span><br><span class="line">&gt; &#125; Point;</span><br><span class="line">&gt; <span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">innerProduct</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Point *a, <span class="hljs-keyword">const</span> Point *b, <span class="hljs-keyword">float</span> *result)</span></span></span><br><span class="line">&gt; &#123;</span><br><span class="line">&gt; 	<span class="hljs-keyword">float</span> x1 = a-&gt;x, <span class="hljs-comment">//Uses a load instruction</span></span><br><span class="line">&gt; 		  x2 = b-&gt;x,</span><br><span class="line">&gt; 		  product1 = x1 * x2,</span><br><span class="line">&gt; 		  y1 = a-&gt;y,</span><br><span class="line">&gt; 		  y2 = b-&gt;y,</span><br><span class="line">&gt; 		  product2 = y1 * y2,</span><br><span class="line">&gt; 		  inner = product1 + product2;</span><br><span class="line">&gt; 	*result = inner; <span class="hljs-comment">//Uses a store instruction</span></span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt; <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">computeInnerProduct</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Point a[], <span class="hljs-keyword">const</span> Point b[], <span class="hljs-keyword">float</span> result[], <span class="hljs-keyword">int</span> n)</span></span></span><br><span class="line">&gt; &#123;</span><br><span class="line">&gt; 	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; ++i)</span><br><span class="line">&gt; 		innerProduct(&amp;a[i], &amp;b[i], &amp;result[i]);</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>In the following questions, you can assume the following:</p>
<ul>
<li>$N$ is very large($&gt;10^6$).</li>
<li>The machines described have modern CPUs, providing out-of-order execution, speculative execution, branch prediction, etc.</li>
<li>There are no cache misses.</li>
<li>The overhead of updating the loopindex i is negligible.</li>
<li>The overhead due to procedure calls, as well as starting and ending loops, is negligible.</li>
</ul>
<p>Problem 1: Instruction-Level Parallelism<br>Suppose you have a machine $M_1$ with two load/store unites that can each load or store a single value on each clock cycle, and one arithmetic unit can perform one arithmetic operation(e.g., multiplication or addition) on each clock cycle.<br>A. Assume that the load/store and arithmetic have latencies of one cycle. How many clock cycles would be required to execute <code>computeInnerProduct</code> as a function of <code>n</code>? Explain what limits the performance.</p>
</blockquote>
<p>做一次<code>innerProduct</code>需要7次load，1次store，3次arithmetic. 而<code>computeInnerProduct</code>的循环中有n次<code>innerProduct</code>，如果不考虑循环处的消耗的话需要$11n$个cycle。</p>
<blockquote>
<p>老师上课说，这一问也考虑了不同指令的并行，所以还是3n。</p>
</blockquote>
<blockquote>
<p>B. Now assume that the load/store and arithmetic unit have latencies of 10 clock cycles, but they are fully pipelined, able to initiate new operations every clock cycle. How many cycles would be required to execute <code>computeInnerProduction</code> as a function of <code>n</code>?Explain how this relates your answer to Part-A.</p>
</blockquote>
<p>最理想的情况下不发生竞争，完全并行，因此不考虑循环处的消耗的话需要<code>3n</code>个cycle。和A部分相比，由于指令完全流水线，因此每次循环时的load/store/arithmetic间没有间断。</p>
<blockquote>
<p>Problem 2: SIMD with ISPC<br>Consider running the following ISPC code.</p>
<figure class="highlight autoit hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; export void computeInnerProductISPC(</span><br><span class="line">&gt; 	uniform point[] a,</span><br><span class="line">&gt; 	uniform point[] b,</span><br><span class="line">&gt; 	uniform float[] result,</span><br><span class="line">&gt; 	uniform <span class="hljs-built_in">int</span> n</span><br><span class="line">&gt; )</span><br><span class="line">&gt; &#123;</span><br><span class="line">&gt; 	foreach (i = <span class="hljs-number">0.</span>..n)</span><br><span class="line">&gt; 		result[i] = a[i].x * b[i].x + a[i].y * b[i].y<span class="hljs-comment">;</span></span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>Suppose machine $M_2$ has one 8-wide SIMD load/store unit, and one 8-wide SIMD arithmetic unit. both have latencies of one clock cycle.<br>A. How many clock cycles would be required to execute <code>computeInnerProductISPC</code> as a function of <code>n</code>? Explain what lmits the performance.</p>
</blockquote>
<p>对于循环中的每个i，发生可4次load，1次store，3次arithmetic。所以一共需要$8n$个cycle。</p>
<blockquote>
<p>老师上课说是$\frac{5}{8}n$，因为5次内存操作是瓶颈，8路同时运算。</p>
</blockquote>
<blockquote>
<p>B. If we run the <code>computeInnerProductISPC</code> on a five-core machine $M_3$, where each core has the same SIMD capabilities as $M_2$, what would be the best speedup it could achieve over the single-core performance of Part-A? Explain.</p>
</blockquote>
<p>最理想的情况下能够加速5倍，因为每个进程间的计算是彼此独立的。</p>
<blockquote>
<p>由于使用了SIMD指令集，这是一套单盒的指令集，没有多核并行的内容，所以没有加速，一倍。太坑了！！！</p>
</blockquote>
<blockquote>
<h2 id="Homework-asst-2"><a href="#Homework-asst-2" class="headerlink" title="Homework-asst-2"></a>Homework-asst-2</h2><p>Parallel Fractal Generation Using Pthreads</p>
<p>Leverage the sample code provided in the course web site.</p>
<p>Build and run the code in the prob1_mandelbrot_threads directory of the Assignment 1 code base.This program produces the image file mandelbrot-vV -serial.ppm, where V is the view index. This image is a visualization of a famous set of complex numbers called the Mandelbrot set. As you can see in the images below, the result is a familiar and beautiful fractal. Each pixel in the image corresponds to a value in the complex plane, and the brightness of each pixel is proportional to the computational cost of determining whether the value is contained in the Mandelbrot set—white pixels required the maximum (256) number of iterations, dark ones only a few iterations, and colored pixels were somewhere in between. (See function mandel() defined in mandelbrot.cpp.) You can learn more about the definition of the Mandelbrot set at en.wikipedia.org/wiki/Mandelbrot set. Use the command option “–view V ” for V between 0 and 6 to get the different images. You can click the links below to see the different images on a browser. Take the time to do this—the images are quite striking. (View 0 is not shown— it is all white.)</p>
<p>Your job is to parallelize the computation of the images using Pthreads. The command-line option “–threads T” specifies that the computation is to be partitioned over T threads. In function mandelbrotThread(), located in mandelbrot.cpp, the main application thread creates T-1 additional thread using pthread_create(). It waits for these threads to complete using pthread_join(). Currently, neither the launched threads nor the main thread do any computation, and so the program generates an error message. You should add code to the workerThreadStart() function to accomplish this task. You will not need to use of any other Pthread API calls in this assignment. What you need to do:</p>
<ol>
<li>Modify the code in mandelbrot.cpp to parallelize the Mandelbrot generation using two cores. Specifically, compute the top half of the image in thread 0, and the bottom half of the image in thread 1. This type of problem decomposition is referred to as spatial decomposition since different spatial regions of the image are computed by different processors.</li>
<li>Extend your code to utilize T threads for {2, 4, 8,16} , partitioning the image generation work into the appropriate number of horizontal blocks. You will need to modify the code in function workerThreadStart, to partition the work over the threads.</li>
<li>To confirm (or disprove) your hypothesis, measure the amount of time each thread requires to complete its work by inserting timing code at the beginning and end of workerThreadStart(). How do your measurements explain the speedup graph you previously created?</li>
</ol>
</blockquote>
<p>问题本身还是比较容易的，只在<code>mandelbrot.cpp</code>中加入了$126\sim 134$行和$164\sim 174$行就解决了问题，详见源代码。以上三个文件都在文件夹<code>prog1_mandelbrot_threads\</code>下，虽然老师给的代码有点乱，但好在写了<code>Makefile</code>。于是在终端中执行下列指令编译并运行。</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-built_in">cd</span> prog1_mandelbrot_threads</span><br><span class="line">make</span><br><span class="line">./mandelbrot -t 2</span><br></pre></td></tr></table></figure>

<p>得到如下输出。</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[mandelbrot serial]:            [708.508] ms</span><br><span class="line">Wrote image file mandelbrot-serial.ppmHello world from thread 0</span><br><span class="line">Hello world from thread 1</span><br><span class="line">Hello world from thread 0</span><br><span class="line">Hello world from thread 1</span><br><span class="line">Hello world from thread 0</span><br><span class="line">Hello world from thread 1</span><br><span class="line">Hello world from thread 0</span><br><span class="line">Hello world from thread 1</span><br><span class="line">Hello world from thread 0</span><br><span class="line">Hello world from thread 1</span><br><span class="line">[mandelbrot thread]:            [336.797] ms</span><br><span class="line">Wrote image file mandelbrot-thread.ppm++++                            (2.10x speedup from 2 threads)</span><br></pre></td></tr></table></figure>

<p>以上输出表明并行计算的版本在双线程时比单线程快了2.1倍。生成了两个ppm格式的文件<code>mandelbrot-serial.ppm</code>、<code>mandelbrot-thread.ppm</code>，但是并看不了。使用下述指令进行转码：</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i mandelbrot-serial.ppm mandelbrot-serial.bmp</span><br><span class="line">ffmpeg -i mandelbrot-thread.ppm mandelbrot-thread.bmp</span><br></pre></td></tr></table></figure>

<p>得到如下两张图片，可以看到也是一模一样的。</p>
<table>
<thead>
<tr>
<th><img src="/2019/04/11/2019-03-25-并行与分布式计算（2）/image/2019-03-25-1.bmp" alt></th>
<th><img src="/2019/04/11/2019-03-25-并行与分布式计算（2）/image/2019-03-25-2.bmp" alt></th>
</tr>
</thead>
<tbody><tr>
<td><code>mandelbrot-serial.bmp</code></td>
<td><code>mandelbrot-thread.bmp</code></td>
</tr>
</tbody></table>
<p>假如要使用更多的线程进行计算，只需要修改<code>./mandelbrot -t 2</code>中<code>-t</code>后的参数即可。</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ ./mandelbrot -t 4</span><br><span class="line">[mandelbrot serial]:            [713.990] ms</span><br><span class="line">Wrote image file mandelbrot-serial.ppmHello world from thread 1</span><br><span class="line">Hello world from thread 2</span><br><span class="line">Hello world from thread 0</span><br><span class="line">Hello world from thread 3</span><br><span class="line">Hello world from thread 1</span><br><span class="line">Hello world from thread 2</span><br><span class="line">Hello world from thread 0</span><br><span class="line">Hello world from thread 3</span><br><span class="line">Hello world from thread 1</span><br><span class="line">Hello world from thread 0</span><br><span class="line">Hello world from thread 2</span><br><span class="line">Hello world from thread 3</span><br><span class="line">Hello world from thread 1</span><br><span class="line">Hello world from thread 2</span><br><span class="line">Hello world from thread 0</span><br><span class="line">Hello world from thread 3</span><br><span class="line">Hello world from thread 1</span><br><span class="line">Hello world from thread 2</span><br><span class="line">Hello world from thread 0</span><br><span class="line">Hello world from thread 3</span><br><span class="line">[mandelbrot thread]:            [291.995] ms</span><br><span class="line">Wrote image file mandelbrot-thread.ppm++++                            (2.45x speedup from 4 threads)</span><br></pre></td></tr></table></figure>

<p>4线程的时候只快了2.45倍。</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">$ ./mandelbrot -t 8</span><br><span class="line">[mandelbrot serial]:            [707.881] ms</span><br><span class="line">Wrote image file mandelbrot-serial.ppmHello world from thread 1</span><br><span class="line">Hello world from thread 2</span><br><span class="line">Hello world from thread 3</span><br><span class="line">Hello world from thread 4</span><br><span class="line">Hello world from thread 5</span><br><span class="line">Hello world from thread 6</span><br><span class="line">Hello world from thread 0</span><br><span class="line">Hello world from thread 7</span><br><span class="line">Hello world from thread 1</span><br><span class="line">Hello world from thread 0</span><br><span class="line">Hello world from thread 3</span><br><span class="line">Hello world from thread 4</span><br><span class="line">Hello world from thread 2</span><br><span class="line">Hello world from thread 5</span><br><span class="line">Hello world from thread 6</span><br><span class="line">Hello world from thread 7</span><br><span class="line">Hello world from thread 1</span><br><span class="line">Hello world from thread 0</span><br><span class="line">Hello world from thread 3</span><br><span class="line">Hello world from thread 4</span><br><span class="line">Hello world from thread 5</span><br><span class="line">Hello world from thread 6</span><br><span class="line">Hello world from thread 2</span><br><span class="line">Hello world from thread 7</span><br><span class="line">Hello world from thread 1</span><br><span class="line">Hello world from thread 2</span><br><span class="line">Hello world from thread 3</span><br><span class="line">Hello world from thread 4</span><br><span class="line">Hello world from thread 5</span><br><span class="line">Hello world from thread 0</span><br><span class="line">Hello world from thread 6</span><br><span class="line">Hello world from thread 7</span><br><span class="line">Hello world from thread 1</span><br><span class="line">Hello world from thread 2</span><br><span class="line">Hello world from thread 3</span><br><span class="line">Hello world from thread 4</span><br><span class="line">Hello world from thread 5</span><br><span class="line">Hello world from thread 6</span><br><span class="line">Hello world from thread 0</span><br><span class="line">Hello world from thread 7</span><br><span class="line">[mandelbrot thread]:            [196.575] ms</span><br><span class="line">Wrote image file mandelbrot-thread.ppm++++                            (3.60x speedup from 8 threads)</span><br></pre></td></tr></table></figure>

<p>8线程的时候3.6倍。</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">$ ./mandelbrot -t 16</span><br><span class="line">[mandelbrot serial]:            [738.481] ms</span><br><span class="line">Wrote image file mandelbrot-serial.ppmHello world from thread 1</span><br><span class="line">Hello world from thread 4</span><br><span class="line">Hello world from thread 13</span><br><span class="line">Hello world from thread 5</span><br><span class="line">Hello world from thread 6</span><br><span class="line">Hello world from thread 2</span><br><span class="line">Hello world from thread 7</span><br><span class="line">Hello world from thread 8</span><br><span class="line">Hello world from thread 9</span><br><span class="line">Hello world from thread 10</span><br><span class="line">Hello world from thread 11</span><br><span class="line">Hello world from thread 0</span><br><span class="line">Hello world from thread 12</span><br><span class="line">Hello world from thread 14</span><br><span class="line">Hello world from thread 15</span><br><span class="line">Hello world from thread 3</span><br><span class="line">Hello world from thread 1</span><br><span class="line">Hello world from thread 6</span><br><span class="line">Hello world from thread 3</span><br><span class="line">Hello world from thread 4</span><br><span class="line">Hello world from thread 5</span><br><span class="line">Hello world from thread 7</span><br><span class="line">Hello world from thread 8</span><br><span class="line">Hello world from thread 9</span><br><span class="line">Hello world from thread 2</span><br><span class="line">Hello world from thread 10</span><br><span class="line">Hello world from thread 11</span><br><span class="line">Hello world from thread 12</span><br><span class="line">Hello world from thread 13</span><br><span class="line">Hello world from thread 0</span><br><span class="line">Hello world from thread 14</span><br><span class="line">Hello world from thread 15</span><br><span class="line">Hello world from thread 1</span><br><span class="line">Hello world from thread 2</span><br><span class="line">Hello world from thread 0</span><br><span class="line">Hello world from thread 4</span><br><span class="line">Hello world from thread 5</span><br><span class="line">Hello world from thread 6</span><br><span class="line">Hello world from thread 7</span><br><span class="line">Hello world from thread 8</span><br><span class="line">Hello world from thread 9</span><br><span class="line">Hello world from thread 10</span><br><span class="line">Hello world from thread 11</span><br><span class="line">Hello world from thread 12</span><br><span class="line">Hello world from thread 13</span><br><span class="line">Hello world from thread 14</span><br><span class="line">Hello world from thread 15</span><br><span class="line">Hello world from thread 3</span><br><span class="line">Hello world from thread 1</span><br><span class="line">Hello world from thread 2</span><br><span class="line">Hello world from thread 9</span><br><span class="line">Hello world from thread 15</span><br><span class="line">Hello world from thread 5</span><br><span class="line">Hello world from thread 6</span><br><span class="line">Hello world from thread 7</span><br><span class="line">Hello world from thread 8</span><br><span class="line">Hello world from thread 3</span><br><span class="line">Hello world from thread 10</span><br><span class="line">Hello world from thread 11</span><br><span class="line">Hello world from thread 12</span><br><span class="line">Hello world from thread 13</span><br><span class="line">Hello world from thread 0</span><br><span class="line">Hello world from thread 14</span><br><span class="line">Hello world from thread 4</span><br><span class="line">Hello world from thread 1</span><br><span class="line">Hello world from thread 2</span><br><span class="line">Hello world from thread 9</span><br><span class="line">Hello world from thread 3</span><br><span class="line">Hello world from thread 5</span><br><span class="line">Hello world from thread 6</span><br><span class="line">Hello world from thread 7</span><br><span class="line">Hello world from thread 8</span><br><span class="line">Hello world from thread 0</span><br><span class="line">Hello world from thread 4</span><br><span class="line">Hello world from thread 10</span><br><span class="line">Hello world from thread 11</span><br><span class="line">Hello world from thread 12</span><br><span class="line">Hello world from thread 13</span><br><span class="line">Hello world from thread 14</span><br><span class="line">Hello world from thread 15</span><br><span class="line">[mandelbrot thread]:            [185.233] ms</span><br><span class="line">Wrote image file mandelbrot-thread.ppm++++                            (3.99x speedup from 16 threads)</span><br></pre></td></tr></table></figure>

<p>16线程的时候3.99倍。</p>
<p>可以看到，加速比随进程增加而增加，但是增加的量不是线性的。这是因为并行的时候会有额外的开销。</p>
<h2 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h2><h3 id="mandelbrot-cpp"><a href="#mandelbrot-cpp" class="headerlink" title="mandelbrot.cpp"></a>mandelbrot.cpp</h3><p>主要的代码，</p>
<figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="hljs-comment">// Use this code to time your threads</span></span><br><span class="line"><span class="hljs-comment">// 我加入的代码在126~134行和164~174行</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"CycleTimer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">  15418 Spring 2012 note: This code was modified from example code</span></span><br><span class="line"><span class="hljs-comment">  originally provided by Intel.  To comply with Intel's open source</span></span><br><span class="line"><span class="hljs-comment">  licensing agreement, their copyright is retained below.</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">  -----------------------------------------------------------------</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">  Copyright (c) 2010-2011, Intel Corporation</span></span><br><span class="line"><span class="hljs-comment">  All rights reserved.</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">  Redistribution and use in source and binary forms, with or without</span></span><br><span class="line"><span class="hljs-comment">  modification, are permitted provided that the following conditions are</span></span><br><span class="line"><span class="hljs-comment">  met:</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">	* Redistributions of source code must retain the above copyright</span></span><br><span class="line"><span class="hljs-comment">	  notice, this list of conditions and the following disclaimer.</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">	* Redistributions in binary form must reproduce the above copyright</span></span><br><span class="line"><span class="hljs-comment">	  notice, this list of conditions and the following disclaimer in the</span></span><br><span class="line"><span class="hljs-comment">	  documentation and/or other materials provided with the distribution.</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">	* Neither the name of Intel Corporation nor the names of its</span></span><br><span class="line"><span class="hljs-comment">	  contributors may be used to endorse or promote products derived from</span></span><br><span class="line"><span class="hljs-comment">	  this software without specific prior written permission.</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS</span></span><br><span class="line"><span class="hljs-comment">   IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED</span></span><br><span class="line"><span class="hljs-comment">   TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A</span></span><br><span class="line"><span class="hljs-comment">   PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER</span></span><br><span class="line"><span class="hljs-comment">   OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,</span></span><br><span class="line"><span class="hljs-comment">   EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,</span></span><br><span class="line"><span class="hljs-comment">   PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR</span></span><br><span class="line"><span class="hljs-comment">   PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</span></span><br><span class="line"><span class="hljs-comment">   LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span></span><br><span class="line"><span class="hljs-comment">   NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span></span><br><span class="line"><span class="hljs-comment">   SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></span><br><span class="line"><span class="hljs-comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// Core computation of Mandelbrot set membershop</span></span><br><span class="line"><span class="hljs-comment">// Iterate complex number c to determine whether it diverges</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">int</span> <span class="hljs-title">mandel</span><span class="hljs-params">(<span class="hljs-keyword">float</span> c_re, <span class="hljs-keyword">float</span> c_im, <span class="hljs-keyword">int</span> count)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">float</span> z_re = c_re, z_im = c_im;</span><br><span class="line">	<span class="hljs-keyword">int</span> i;</span><br><span class="line">	<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; count; ++i)</span><br><span class="line">	&#123;</span><br><span class="line"></span><br><span class="line">		<span class="hljs-keyword">if</span> (z_re * z_re + z_im * z_im &gt; <span class="hljs-number">4.f</span>)</span><br><span class="line">			<span class="hljs-keyword">break</span>;</span><br><span class="line"></span><br><span class="line">		<span class="hljs-keyword">float</span> new_re = z_re * z_re - z_im * z_im;</span><br><span class="line">		<span class="hljs-keyword">float</span> new_im = <span class="hljs-number">2.f</span> * z_re * z_im;</span><br><span class="line">		z_re = c_re + new_re;</span><br><span class="line">		z_im = c_im + new_im;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">return</span> i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//</span></span><br><span class="line"><span class="hljs-comment">// MandelbrotSerial --</span></span><br><span class="line"><span class="hljs-comment">//</span></span><br><span class="line"><span class="hljs-comment">// Compute an image visualizing the mandelbrot set.  The resulting</span></span><br><span class="line"><span class="hljs-comment">// array contains the number of iterations required before the complex</span></span><br><span class="line"><span class="hljs-comment">// number corresponding to a pixel could be rejected from the set.</span></span><br><span class="line"><span class="hljs-comment">//</span></span><br><span class="line"><span class="hljs-comment">// * x0, y0, x1, y1 describe the complex coordinates mapping</span></span><br><span class="line"><span class="hljs-comment">//   into the image viewport.</span></span><br><span class="line"><span class="hljs-comment">// * width, height describe the size of the output image</span></span><br><span class="line"><span class="hljs-comment">// * startRow, endRow describe how much of the image to compute</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">mandelbrotSerial</span><span class="hljs-params">(</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">float</span> x0, <span class="hljs-keyword">float</span> y0, <span class="hljs-keyword">float</span> x1, <span class="hljs-keyword">float</span> y1,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">int</span> width, <span class="hljs-keyword">int</span> height,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">int</span> startRow, <span class="hljs-keyword">int</span> endRow,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">int</span> maxIterations,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">int</span> output[])</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">float</span> dx = (x1 - x0) / width;</span><br><span class="line">	<span class="hljs-keyword">float</span> dy = (y1 - y0) / height;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = startRow; j &lt; endRow; j++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; width; ++i)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="hljs-keyword">float</span> x = x0 + i * dx;</span><br><span class="line">			<span class="hljs-keyword">float</span> y = y0 + j * dy;</span><br><span class="line"></span><br><span class="line">			<span class="hljs-keyword">int</span> index = (j * width + i);</span><br><span class="line">			output[index] = mandel(x, y, maxIterations);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// Struct for passing arguments to thread routine</span></span><br><span class="line"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><br><span class="line"><span class="hljs-class">&#123;</span></span><br><span class="line">	<span class="hljs-keyword">float</span> x0, x1;</span><br><span class="line">	<span class="hljs-keyword">float</span> y0, y1;</span><br><span class="line">	<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> width;</span><br><span class="line">	<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> height;</span><br><span class="line">	<span class="hljs-keyword">int</span> maxIterations;</span><br><span class="line">	<span class="hljs-keyword">int</span> *output;</span><br><span class="line">	<span class="hljs-keyword">int</span> threadId;</span><br><span class="line">	<span class="hljs-keyword">int</span> numThreads;</span><br><span class="line">&#125; WorkerArgs;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//</span></span><br><span class="line"><span class="hljs-comment">// workerThreadStart --</span></span><br><span class="line"><span class="hljs-comment">//</span></span><br><span class="line"><span class="hljs-comment">// Thread entrypoint.</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> *<span class="hljs-title">workerThreadStart</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *threadArgs)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line"></span><br><span class="line">	WorkerArgs *args = <span class="hljs-keyword">static_cast</span>&lt;WorkerArgs *&gt;(threadArgs);</span><br><span class="line"></span><br><span class="line">	<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Implement worker thread here.</span></span><br><span class="line"></span><br><span class="line">	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"Hello world from thread %d\n"</span>, args-&gt;threadId);</span><br><span class="line">	<span class="hljs-comment">//以下是我加的第一部分内容</span></span><br><span class="line">	mandelbrotSerial(</span><br><span class="line">		args-&gt;x0, args-&gt;y0, args-&gt;x1, args-&gt;y1,</span><br><span class="line">		args-&gt;width, args-&gt;height,</span><br><span class="line">		args-&gt;height / args-&gt;numThreads * args-&gt;threadId,																<span class="hljs-comment">//startRow</span></span><br><span class="line">		args-&gt;threadId == args-&gt;numThreads - <span class="hljs-number">1</span> ? args-&gt;height : args-&gt;height / args-&gt;numThreads * (args-&gt;threadId + <span class="hljs-number">1</span>), <span class="hljs-comment">//endRow</span></span><br><span class="line">		args-&gt;maxIterations,</span><br><span class="line">		args-&gt;output);</span><br><span class="line">	<span class="hljs-comment">//增加完毕，只需要调用串行部分的代码即可</span></span><br><span class="line">	<span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//</span></span><br><span class="line"><span class="hljs-comment">// MandelbrotThread --</span></span><br><span class="line"><span class="hljs-comment">//</span></span><br><span class="line"><span class="hljs-comment">// Multi-threaded implementation of mandelbrot set image generation.</span></span><br><span class="line"><span class="hljs-comment">// Multi-threading performed via pthreads.</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">mandelbrotThread</span><span class="hljs-params">(</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">int</span> numThreads,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">float</span> x0, <span class="hljs-keyword">float</span> y0, <span class="hljs-keyword">float</span> x1, <span class="hljs-keyword">float</span> y1,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">int</span> width, <span class="hljs-keyword">int</span> height,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">	<span class="hljs-keyword">int</span> maxIterations, <span class="hljs-keyword">int</span> output[])</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">const</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> MAX_THREADS = <span class="hljs-number">32</span>;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">if</span> (numThreads &gt; MAX_THREADS)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Error: Max allowed threads is %d\n"</span>, MAX_THREADS);</span><br><span class="line">		<span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">pthread_t</span> workers[MAX_THREADS];</span><br><span class="line">	WorkerArgs args[MAX_THREADS];</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; numThreads; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Set thread arguments here.</span></span><br><span class="line">		args[i].threadId = i;</span><br><span class="line">		<span class="hljs-comment">//以下是我加的第二段内容</span></span><br><span class="line">		args[i].x0 = x0;</span><br><span class="line">		args[i].x1 = x1;</span><br><span class="line">		args[i].y0 = y0;</span><br><span class="line">		args[i].y1 = y1;</span><br><span class="line">		args[i].width = width;</span><br><span class="line">		args[i].height = height;</span><br><span class="line">		args[i].maxIterations = maxIterations;</span><br><span class="line">		args[i].output = output;</span><br><span class="line">		args[i].numThreads = numThreads;</span><br><span class="line">		<span class="hljs-comment">//增加完毕，把所有信息传给worker线程即可</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-comment">// Fire up the worker threads.  Note that numThreads-1 pthreads</span></span><br><span class="line">	<span class="hljs-comment">// are created and the main app thread is used as a worker as</span></span><br><span class="line">	<span class="hljs-comment">// well.</span></span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; numThreads; i++)</span><br><span class="line">		pthread_create(&amp;workers[i], <span class="hljs-literal">NULL</span>, workerThreadStart, &amp;args[i]);</span><br><span class="line"></span><br><span class="line">	workerThreadStart(&amp;args[<span class="hljs-number">0</span>]);</span><br><span class="line"></span><br><span class="line">	<span class="hljs-comment">// wait for worker threads to complete</span></span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; numThreads; i++)</span><br><span class="line">		pthread_join(workers[i], <span class="hljs-literal">NULL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="main-cpp"><a href="#main-cpp" class="headerlink" title="main.cpp"></a>main.cpp</h3><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;getopt.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"CycleTimer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">extern</span> <span class="hljs-keyword">void</span> <span class="hljs-title">mandelbrotSerial</span><span class="hljs-params">(</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">    <span class="hljs-keyword">float</span> x0, <span class="hljs-keyword">float</span> y0, <span class="hljs-keyword">float</span> x1, <span class="hljs-keyword">float</span> y1,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">    <span class="hljs-keyword">int</span> width, <span class="hljs-keyword">int</span> height,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">    <span class="hljs-keyword">int</span> startRow, <span class="hljs-keyword">int</span> endRow,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">    <span class="hljs-keyword">int</span> maxIterations,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">    <span class="hljs-keyword">int</span> output[])</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">extern</span> <span class="hljs-keyword">void</span> <span class="hljs-title">mandelbrotThread</span><span class="hljs-params">(</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">    <span class="hljs-keyword">int</span> numThreads,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">    <span class="hljs-keyword">float</span> x0, <span class="hljs-keyword">float</span> y0, <span class="hljs-keyword">float</span> x1, <span class="hljs-keyword">float</span> y1,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">    <span class="hljs-keyword">int</span> width, <span class="hljs-keyword">int</span> height,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">    <span class="hljs-keyword">int</span> maxIterations,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">    <span class="hljs-keyword">int</span> output[])</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">extern</span> <span class="hljs-keyword">void</span> <span class="hljs-title">writePPMImage</span><span class="hljs-params">(</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">    <span class="hljs-keyword">int</span> *data,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">    <span class="hljs-keyword">int</span> width, <span class="hljs-keyword">int</span> height,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *filename,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">    <span class="hljs-keyword">int</span> maxIterations)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">scaleAndShift</span><span class="hljs-params">(<span class="hljs-keyword">float</span> &amp;x0, <span class="hljs-keyword">float</span> &amp;x1, <span class="hljs-keyword">float</span> &amp;y0, <span class="hljs-keyword">float</span> &amp;y1,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                   <span class="hljs-keyword">float</span> scale,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                   <span class="hljs-keyword">float</span> shiftX, <span class="hljs-keyword">float</span> shiftY)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    x0 *= scale;</span><br><span class="line">    x1 *= scale;</span><br><span class="line">    y0 *= scale;</span><br><span class="line">    y1 *= scale;</span><br><span class="line">    x0 += shiftX;</span><br><span class="line">    x1 += shiftX;</span><br><span class="line">    y0 += shiftY;</span><br><span class="line">    y1 += shiftY;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">usage</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *progname)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Usage: %s [options]\n"</span>, progname);</span><br><span class="line">    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Program Options:\n"</span>);</span><br><span class="line">    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"  -t  --threads &lt;N&gt;  Use N threads\n"</span>);</span><br><span class="line">    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"  -v  --view &lt;INT&gt;   Use specified view settings (1-6)\n"</span>);</span><br><span class="line">    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"  -?  --help         This message\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">verifyResult</span><span class="hljs-params">(<span class="hljs-keyword">int</span> *gold, <span class="hljs-keyword">int</span> *result, <span class="hljs-keyword">int</span> width, <span class="hljs-keyword">int</span> height)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">int</span> i, j;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; height; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; width; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (gold[i * width + j] != result[i * width + j])</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Mismatch : [%d][%d], Expected : %d, Actual : %d\n"</span>,</span><br><span class="line">                       i, j, gold[i * width + j], result[i * width + j]);</span><br><span class="line">                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> VIEWCNT 6</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> width = <span class="hljs-number">1440</span>;</span><br><span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> height = <span class="hljs-number">900</span>;</span><br><span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> maxIterations = <span class="hljs-number">256</span>;</span><br><span class="line">    <span class="hljs-keyword">int</span> numThreads = <span class="hljs-number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">float</span> x0 = <span class="hljs-number">-2.167</span>;</span><br><span class="line">    <span class="hljs-keyword">float</span> x1 = <span class="hljs-number">1.167</span>;</span><br><span class="line">    <span class="hljs-keyword">float</span> y0 = <span class="hljs-number">-1</span>;</span><br><span class="line">    <span class="hljs-keyword">float</span> y1 = <span class="hljs-number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// Support VIEWCNT views</span></span><br><span class="line">    <span class="hljs-keyword">float</span> scaleValues[VIEWCNT + <span class="hljs-number">1</span>] = &#123;<span class="hljs-number">1.0f</span>, <span class="hljs-number">1.0f</span>, <span class="hljs-number">0.015f</span>, <span class="hljs-number">0.02f</span>, <span class="hljs-number">0.02f</span>, <span class="hljs-number">0.02f</span>, <span class="hljs-number">0.002f</span>&#125;;</span><br><span class="line">    <span class="hljs-keyword">float</span> shiftXs[VIEWCNT + <span class="hljs-number">1</span>] = &#123;<span class="hljs-number">0.0f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">-0.98f</span>, <span class="hljs-number">0.35f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">-1.5f</span>, <span class="hljs-number">-1.4f</span>&#125;;</span><br><span class="line">    <span class="hljs-keyword">float</span> shiftYs[VIEWCNT + <span class="hljs-number">1</span>] = &#123;<span class="hljs-number">0.0f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">0.30f</span>, <span class="hljs-number">0.05f</span>, <span class="hljs-number">0.73f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">0.0f</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// parse commandline options ////////////////////////////////////////////</span></span><br><span class="line">    <span class="hljs-keyword">int</span> opt;</span><br><span class="line">    <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">option</span> <span class="hljs-title">long_options</span>[] = &#123;</span></span><br><span class="line">        &#123;<span class="hljs-string">"threads"</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-string">'t'</span>&#125;,</span><br><span class="line">        &#123;<span class="hljs-string">"view"</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-string">'v'</span>&#125;,</span><br><span class="line">        &#123;<span class="hljs-string">"help"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">'?'</span>&#125;,</span><br><span class="line">        &#123;<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">while</span> ((opt = getopt_long(argc, argv, <span class="hljs-string">"t:v:?"</span>, long_options, <span class="hljs-literal">NULL</span>)) != EOF)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">switch</span> (opt)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="hljs-keyword">case</span> <span class="hljs-string">'t'</span>:</span><br><span class="line">        &#123;</span><br><span class="line">            numThreads = atoi(optarg);</span><br><span class="line">            <span class="hljs-keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">case</span> <span class="hljs-string">'v'</span>:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="hljs-keyword">int</span> viewIndex = atoi(optarg);</span><br><span class="line">            <span class="hljs-comment">// change view settings</span></span><br><span class="line">            <span class="hljs-keyword">if</span> (viewIndex &gt;= <span class="hljs-number">1</span> &amp;&amp; viewIndex &lt;= VIEWCNT)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">float</span> scaleValue = scaleValues[viewIndex];</span><br><span class="line">                <span class="hljs-keyword">float</span> shiftX = shiftXs[viewIndex];</span><br><span class="line">                <span class="hljs-keyword">float</span> shiftY = shiftYs[viewIndex];</span><br><span class="line">                scaleAndShift(x0, x1, y0, y1, scaleValue, shiftX, shiftY);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Invalid view index\n"</span>);</span><br><span class="line">                <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">case</span> <span class="hljs-string">'?'</span>:</span><br><span class="line">        <span class="hljs-keyword">default</span>:</span><br><span class="line">            usage(argv[<span class="hljs-number">0</span>]);</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">// end parsing of commandline options</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">int</span> *output_serial = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[width * height];</span><br><span class="line">    <span class="hljs-keyword">int</span> *output_thread = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[width * height];</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//</span></span><br><span class="line">    <span class="hljs-comment">// Run the serial implementation.  Run the code three times and</span></span><br><span class="line">    <span class="hljs-comment">// take the minimum to get a good estimate.</span></span><br><span class="line">    <span class="hljs-comment">//</span></span><br><span class="line">    <span class="hljs-built_in">memset</span>(output_serial, <span class="hljs-number">0</span>, width * height * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>));</span><br><span class="line">    <span class="hljs-keyword">double</span> minSerial = <span class="hljs-number">1e30</span>;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="hljs-keyword">double</span> startTime = CycleTimer::currentSeconds();</span><br><span class="line">        mandelbrotSerial(x0, y0, x1, y1, width, height, <span class="hljs-number">0</span>, height, maxIterations, output_serial);</span><br><span class="line">        <span class="hljs-keyword">double</span> endTime = CycleTimer::currentSeconds();</span><br><span class="line">        minSerial = <span class="hljs-built_in">std</span>::min(minSerial, endTime - startTime);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"[mandelbrot serial]:\t\t[%.3f] ms\n"</span>, minSerial * <span class="hljs-number">1000</span>);</span><br><span class="line">    writePPMImage(output_serial, width, height, <span class="hljs-string">"mandelbrot-serial.ppm"</span>, maxIterations);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//</span></span><br><span class="line">    <span class="hljs-comment">// Run the threaded version</span></span><br><span class="line">    <span class="hljs-comment">//</span></span><br><span class="line">    <span class="hljs-built_in">memset</span>(output_thread, <span class="hljs-number">0</span>, width * height * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">int</span>));</span><br><span class="line">    <span class="hljs-keyword">double</span> minThread = <span class="hljs-number">1e30</span>;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="hljs-keyword">double</span> startTime = CycleTimer::currentSeconds();</span><br><span class="line">        mandelbrotThread(numThreads, x0, y0, x1, y1, width, height, maxIterations, output_thread);</span><br><span class="line">        <span class="hljs-keyword">double</span> endTime = CycleTimer::currentSeconds();</span><br><span class="line">        minThread = <span class="hljs-built_in">std</span>::min(minThread, endTime - startTime);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"[mandelbrot thread]:\t\t[%.3f] ms\n"</span>, minThread * <span class="hljs-number">1000</span>);</span><br><span class="line">    writePPMImage(output_thread, width, height, <span class="hljs-string">"mandelbrot-thread.ppm"</span>, maxIterations);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span> (!verifyResult(output_serial, output_thread, width, height))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"ERROR : Output from threads does not match serial output\n"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">delete</span>[] output_serial;</span><br><span class="line">        <span class="hljs-keyword">delete</span>[] output_thread;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// compute speedup</span></span><br><span class="line">    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"++++\t\t\t\t(%.2fx speedup from %d threads)\n"</span>, minSerial / minThread, numThreads);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">delete</span>[] output_serial;</span><br><span class="line">    <span class="hljs-keyword">delete</span>[] output_thread;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Makefile"><a href="#Makefile" class="headerlink" title="Makefile"></a>Makefile</h3><figure class="highlight makefile hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">CXX=g++ -m64</span><br><span class="line">CXXFLAGS=-I../common -Iobjs/ -O3 -Wall</span><br><span class="line"></span><br><span class="line">APP_NAME=mandelbrot</span><br><span class="line">OBJDIR=objs</span><br><span class="line">COMMONDIR=../common</span><br><span class="line"></span><br><span class="line">PPM_CXX=<span class="hljs-variable">$(COMMONDIR)</span>/ppm.cpp</span><br><span class="line">PPM_OBJ=<span class="hljs-variable">$(<span class="hljs-built_in">addprefix</span> <span class="hljs-variable">$(OBJDIR)</span>/, $(<span class="hljs-built_in">subst</span> <span class="hljs-variable">$(COMMONDIR)</span>/,, $(PPM_CXX:.cpp=.o)</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-section">default: <span class="hljs-variable">$(APP_NAME)</span></span></span><br><span class="line"></span><br><span class="line"><span class="hljs-meta"><span class="hljs-meta-keyword">.PHONY</span>: dirs clean</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-section">dirs:</span></span><br><span class="line">		/bin/mkdir -p <span class="hljs-variable">$(OBJDIR)</span>/</span><br><span class="line"></span><br><span class="line"><span class="hljs-section">clean:</span></span><br><span class="line">		/bin/rm -rf <span class="hljs-variable">$(OBJDIR)</span> *.ppm *~ <span class="hljs-variable">$(APP_NAME)</span></span><br><span class="line"></span><br><span class="line">OBJS=<span class="hljs-variable">$(OBJDIR)</span>/main.o <span class="hljs-variable">$(OBJDIR)</span>/mandelbrot.o <span class="hljs-variable">$(PPM_OBJ)</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-variable">$(APP_NAME)</span>: dirs <span class="hljs-variable">$(OBJS)</span></span><br><span class="line">		<span class="hljs-variable">$(CXX)</span> <span class="hljs-variable">$(CXXFLAGS)</span> -o <span class="hljs-variable">$@</span> <span class="hljs-variable">$(OBJS)</span> -lm -lpthread</span><br><span class="line"></span><br><span class="line"><span class="hljs-variable">$(OBJDIR)</span>/%.o: %.cpp</span><br><span class="line">		<span class="hljs-variable">$(CXX)</span> <span class="hljs-variable">$&lt;</span> <span class="hljs-variable">$(CXXFLAGS)</span> -c -o <span class="hljs-variable">$@</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-variable">$(OBJDIR)</span>/%.o: <span class="hljs-variable">$(COMMONDIR)</span>/%.cpp</span><br><span class="line">	<span class="hljs-variable">$(CXX)</span> <span class="hljs-variable">$&lt;</span> <span class="hljs-variable">$(CXXFLAGS)</span> -c -o <span class="hljs-variable">$@</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-variable">$(OBJDIR)</span>/main.o: <span class="hljs-variable">$(COMMONDIR)</span>/CycleTimer.h</span><br></pre></td></tr></table></figure>


        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-04-10T16:08:06.398Z">2019-04-11</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/计算机网络/">计算机网络</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 分钟 读完 (大约 478 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/04/11/2019-03-29-计算机网络第四章 介质控制子层/">计算机网络 第四章 介质控制子层</a>
            
        </h1>
        <div class="content">
            <h1 id="生成树协议-Spanning-Tree-Protocol"><a href="#生成树协议-Spanning-Tree-Protocol" class="headerlink" title="生成树协议(Spanning Tree Protocol)"></a>生成树协议(Spanning Tree Protocol)</h1><ul>
<li>网桥只在根端口和指定端口之间转发帧</li>
<li>指定端口：指定网桥上与网段连接的端口</li>
<li>指定网桥：网段上离根最近的网桥</li>
<li>如果到根网桥的最短路径有多条，可以采用最短路径上的下一网桥ID和下一个端口ID用于打破平衡（取更小的）</li>
</ul>
<h1 id="虚拟局域网（Virtual-LAN-VLAN）"><a href="#虚拟局域网（Virtual-LAN-VLAN）" class="headerlink" title="虚拟局域网（Virtual LAN,VLAN）"></a>虚拟局域网（Virtual LAN,VLAN）</h1><p>如果网桥只在具有相同颜色的端口(Port) 之间转发帧，就会把原来的局域网分割成多个相互隔离的局域网，称为虚拟局域网(Virtual LAN,VLAN)。所谓的颜色其实就是VLAN ID，是由管理员为每个端口配置的，具有相同的VLAN ID的端口处于同一个VLAN，端口的默认VLAN为VLAN 1。</p>
<p>一个VLAN的帧只能转发到属于同一个VLAN的端口或者干道端口。<br>只有发往干道端口的帧才需要加上VLAN ID。<br>从干道收到的帧中如果没有VLAN ID，则认为是本征VLAN(Native VLAN)，默认为VLAN 1。<br>发往干道的Native VLAN的帧不加VLAN ID。</p>
<p>CST, PVST+ and MSTP</p>
<ul>
<li>IEEE 802.1Q中定义了由所有VLAN共享一棵树的公共生成树 (Common Spanning Tree，CST) 。</li>
<li>具有思科专利的PVST(Per-VLAN Spanning Tree)协议为每个VLAN配置一 颗生成树。由于 PVST 只能用于ISL，思科又定义了同时可用于IEEE 802.1Q的PVST+标准。思科的设备现在默认使用PVST+。</li>
<li>多生成树MSTP (Multiple Spanning Tree Protocol)起初单独由IEEE 802.1s定义，后来并入IEEE 802.1Q-2005。它是RSTP的一个扩展，并可 以把VLAN分组，每个VLAN组使用一颗生成树。</li>
<li>BID：PRIORITY(4b)+VLAN ID(12b)+MAC addr(6B) PRIORITY(4b):0,4096,… ,32768(default),…, 61440</li>
</ul>

        </div>
        
        
        
    </div>
</div>









    
<div class="card card-transparent">
    <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        <div class="pagination-previous is-invisible is-hidden-mobile">
            <a class="is-flex-grow has-text-black-ter" href="/page/0/">上一页</a>
        </div>
        <div class="pagination-next">
            <a class="is-flex-grow has-text-black-ter" href="/page/2/">下一页</a>
        </div>
        <ul class="pagination-list is-hidden-mobile">
            
            <li><a class="pagination-link is-current" href="/">1</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/2/">2</a></li>
            
            <li><span class="pagination-ellipsis has-text-black-ter">&hellip;</span></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/16/">16</a></li>
            
        </ul>
    </nav>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                        <img class="image is-128x128 has-mb-6" src="/images/cat/color_cat.jpg" alt="贾小厨">
                    
                    
                    <p class="is-size-4 is-block">
                        贾小厨
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        当前，你无法预测未来会怎样，但你可以选择跟靠谱的人一同工作，选择做正确的事。
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Beijing.China</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        文章
                    </p>
                    <p class="title has-text-weight-normal">
                        158
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        分类
                    </p>
                    <p class="title has-text-weight-normal">
                        27
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        标签
                    </p>
                    <p class="title has-text-weight-normal">
                        46
                    </p>
                </div>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/jiaxiaochu" target="_blank">
                关注我</a>
        </div>
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Github" href="https://github.com/jiaxiaochu">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Facebook" href="https://facebook.com">
                
                <i class="fab fa-facebook"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Twitter" href="https://twitter.com">
                
                <i class="fab fa-twitter"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Dribbble" href="https://dribbble.com">
                
                <i class="fab fa-dribbble"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="RSS" href="/">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        
    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                分类
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/ACM/">
            <span class="level-start">
                <span class="level-item">ACM</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">84</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/ACM/Template/">
            <span class="level-start">
                <span class="level-item">Template</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">10</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/ACM/算法竞赛入门经典训练指南/">
            <span class="level-start">
                <span class="level-item">算法竞赛入门经典训练指南</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">7</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/ACM/题解/">
            <span class="level-start">
                <span class="level-item">题解</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">50</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/Linux/">
            <span class="level-start">
                <span class="level-item">Linux</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/函数程序设计实验/">
            <span class="level-start">
                <span class="level-item">函数程序设计实验</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">12</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/博客搭建/">
            <span class="level-start">
                <span class="level-item">博客搭建</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/吴恩达机器学习笔记/">
            <span class="level-start">
                <span class="level-item">吴恩达机器学习笔记</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/学习笔记/">
            <span class="level-start">
                <span class="level-item">学习笔记</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/小工具/">
            <span class="level-start">
                <span class="level-item">小工具</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/并行与分布式计算/">
            <span class="level-start">
                <span class="level-item">并行与分布式计算</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/操作系统/">
            <span class="level-start">
                <span class="level-item">操作系统</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/数字电路与逻辑设计/">
            <span class="level-start">
                <span class="level-item">数字电路与逻辑设计</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">6</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/机器学习/">
            <span class="level-start">
                <span class="level-item">机器学习</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/环境配置/">
            <span class="level-start">
                <span class="level-item">环境配置</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">14</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/程序设计/">
            <span class="level-start">
                <span class="level-item">程序设计</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">8</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/计算机组成原理/">
            <span class="level-start">
                <span class="level-item">计算机组成原理</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/计算机网络/">
            <span class="level-start">
                <span class="level-item">计算机网络</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">8</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/超级计算机原理与操作/">
            <span class="level-start">
                <span class="level-item">超级计算机原理与操作</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <a href="/2019/07/23/pymysql远程连接被拒绝问题解决方法/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://ws1.sinaimg.cn/large/0065l1jqly1g592mgpd7mg30ot0ea7d5.gif" alt="pymysql远程连接被拒绝问题解决方法">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-07-22T16:08:33.000Z">2019-07-23</time></div>
                    <a href="/2019/07/23/pymysql远程连接被拒绝问题解决方法/" class="has-link-black-ter is-size-6">pymysql远程连接被拒绝问题解决方法</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/环境配置/">环境配置</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/07/22/Ubuntu系统搭建配置Python虚拟开发环境/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://ws1.sinaimg.cn/large/0065l1jqly1g590mpqs2ej30gg08c3ym.jpg" alt="Ubuntu系统搭建配置Python虚拟开发环境">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-07-22T14:57:27.000Z">2019-07-22</time></div>
                    <a href="/2019/07/22/Ubuntu系统搭建配置Python虚拟开发环境/" class="has-link-black-ter is-size-6">Ubuntu系统搭建配置Python虚拟开发环境</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/环境配置/">环境配置</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/04/11/2019-03-31-Northwestern Europe Regional Contest (NWERC) 2018/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Northwestern Europe Regional Contest (NWERC) 2018">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-04-10T16:08:06.399Z">2019-04-11</time></div>
                    <a href="/2019/04/11/2019-03-31-Northwestern Europe Regional Contest (NWERC) 2018/" class="has-link-black-ter is-size-6">Northwestern Europe Regional Contest (NWERC) 2018</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/ACM/">ACM</a> / <a class="has-link-grey -link" href="/categories/ACM/题解/">题解</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/04/11/2019-03-31-应用层实验/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt>
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-04-10T16:08:06.399Z">2019-04-11</time></div>
                    <a href="/2019/04/11/2019-03-31-应用层实验/" class="has-link-black-ter is-size-6"></a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/计算机网络/">计算机网络</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/04/11/2019-03-31-中断处理与系统调用/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt>
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-04-10T16:08:06.399Z">2019-04-11</time></div>
                    <a href="/2019/04/11/2019-03-31-中断处理与系统调用/" class="has-link-black-ter is-size-6"></a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/操作系统/">操作系统</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
            
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            标签云
        </h3>
        <a href="/tags/Anaconda/" style="font-size: 10px;">Anaconda</a> <a href="/tags/Bug/" style="font-size: 10px;">Bug</a> <a href="/tags/ChromeDriver/" style="font-size: 10px;">ChromeDriver</a> <a href="/tags/DP/" style="font-size: 10px;">DP</a> <a href="/tags/Deepin/" style="font-size: 11.43px;">Deepin</a> <a href="/tags/ICPC模板/" style="font-size: 18.57px;">ICPC模板</a> <a href="/tags/LCA/" style="font-size: 10px;">LCA</a> <a href="/tags/MongoDB数据库/" style="font-size: 10px;">MongoDB数据库</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/NTT/" style="font-size: 10px;">NTT</a> <a href="/tags/Pycharm/" style="font-size: 11.43px;">Pycharm</a> <a href="/tags/Python解释器的安装与配置/" style="font-size: 12.86px;">Python解释器的安装与配置</a> <a href="/tags/Ubuntu/" style="font-size: 10px;">Ubuntu</a> <a href="/tags/VMware/" style="font-size: 10px;">VMware</a> <a href="/tags/chrome/" style="font-size: 10px;">chrome</a> <a href="/tags/chromedriver/" style="font-size: 10px;">chromedriver</a> <a href="/tags/pymysql/" style="font-size: 10px;">pymysql</a> <a href="/tags/三维计算几何/" style="font-size: 12.86px;">三维计算几何</a> <a href="/tags/主席树/" style="font-size: 10px;">主席树</a> <a href="/tags/二分/" style="font-size: 10px;">二分</a> <a href="/tags/二维计算几何/" style="font-size: 10px;">二维计算几何</a> <a href="/tags/动态开点/" style="font-size: 10px;">动态开点</a> <a href="/tags/励志/" style="font-size: 10px;">励志</a> <a href="/tags/单调栈/" style="font-size: 10px;">单调栈</a> <a href="/tags/单调队列/" style="font-size: 12.86px;">单调队列</a> <a href="/tags/原根/" style="font-size: 10px;">原根</a> <a href="/tags/可持久化/" style="font-size: 11.43px;">可持久化</a> <a href="/tags/扫描线/" style="font-size: 10px;">扫描线</a> <a href="/tags/拓扑排序/" style="font-size: 10px;">拓扑排序</a> <a href="/tags/搜索/" style="font-size: 10px;">搜索</a> <a href="/tags/数据库/" style="font-size: 10px;">数据库</a> <a href="/tags/数据结构/" style="font-size: 17.14px;">数据结构</a> <a href="/tags/数论/" style="font-size: 11.43px;">数论</a> <a href="/tags/无旋Treap/" style="font-size: 14.29px;">无旋Treap</a> <a href="/tags/最大流/" style="font-size: 10px;">最大流</a> <a href="/tags/最短路/" style="font-size: 10px;">最短路</a> <a href="/tags/树状数组/" style="font-size: 10px;">树状数组</a> <a href="/tags/环境配置/" style="font-size: 20px;">环境配置</a> <a href="/tags/珂朵莉树/" style="font-size: 11.43px;">珂朵莉树</a> <a href="/tags/系统配置/" style="font-size: 10px;">系统配置</a> <a href="/tags/线段树/" style="font-size: 15.71px;">线段树</a> <a href="/tags/老司机树/" style="font-size: 11.43px;">老司机树</a> <a href="/tags/莫比乌斯反演/" style="font-size: 10px;">莫比乌斯反演</a> <a href="/tags/虚拟机/" style="font-size: 10px;">虚拟机</a> <a href="/tags/虚拟环境/" style="font-size: 10px;">虚拟环境</a> <a href="/tags/谷歌输入法/" style="font-size: 10px;">谷歌输入法</a>
    </div>
</div>

        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">七月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/04/">
                <span class="level-start">
                    <span class="level-item">四月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">22</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/03/">
                <span class="level-start">
                    <span class="level-item">三月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/02/">
                <span class="level-start">
                    <span class="level-item">二月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">27</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/01/">
                <span class="level-start">
                    <span class="level-item">一月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">13</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/10/">
                <span class="level-start">
                    <span class="level-item">十月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">21</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/09/">
                <span class="level-start">
                    <span class="level-item">九月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">9</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/08/">
                <span class="level-start">
                    <span class="level-item">八月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">19</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/07/">
                <span class="level-start">
                    <span class="level-item">七月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">9</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/06/">
                <span class="level-start">
                    <span class="level-item">六月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/05/">
                <span class="level-start">
                    <span class="level-item">五月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">三月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/10/">
                <span class="level-start">
                    <span class="level-item">十月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Anaconda/">
                        <span class="tag">Anaconda</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Bug/">
                        <span class="tag">Bug</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ChromeDriver/">
                        <span class="tag">ChromeDriver</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/DP/">
                        <span class="tag">DP</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Deepin/">
                        <span class="tag">Deepin</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ICPC模板/">
                        <span class="tag">ICPC模板</span>
                        <span class="tag is-grey">10</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/LCA/">
                        <span class="tag">LCA</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MongoDB数据库/">
                        <span class="tag">MongoDB数据库</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MySQL/">
                        <span class="tag">MySQL</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/NTT/">
                        <span class="tag">NTT</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Pycharm/">
                        <span class="tag">Pycharm</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Python解释器的安装与配置/">
                        <span class="tag">Python解释器的安装与配置</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Ubuntu/">
                        <span class="tag">Ubuntu</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/VMware/">
                        <span class="tag">VMware</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/chrome/">
                        <span class="tag">chrome</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/chromedriver/">
                        <span class="tag">chromedriver</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/pymysql/">
                        <span class="tag">pymysql</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/三维计算几何/">
                        <span class="tag">三维计算几何</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/主席树/">
                        <span class="tag">主席树</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/二分/">
                        <span class="tag">二分</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/二维计算几何/">
                        <span class="tag">二维计算几何</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/动态开点/">
                        <span class="tag">动态开点</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/励志/">
                        <span class="tag">励志</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/单调栈/">
                        <span class="tag">单调栈</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/单调队列/">
                        <span class="tag">单调队列</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/原根/">
                        <span class="tag">原根</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/可持久化/">
                        <span class="tag">可持久化</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/扫描线/">
                        <span class="tag">扫描线</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/拓扑排序/">
                        <span class="tag">拓扑排序</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/搜索/">
                        <span class="tag">搜索</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数据库/">
                        <span class="tag">数据库</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数据结构/">
                        <span class="tag">数据结构</span>
                        <span class="tag is-grey">8</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数论/">
                        <span class="tag">数论</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/无旋Treap/">
                        <span class="tag">无旋Treap</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/最大流/">
                        <span class="tag">最大流</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/最短路/">
                        <span class="tag">最短路</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/树状数组/">
                        <span class="tag">树状数组</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/环境配置/">
                        <span class="tag">环境配置</span>
                        <span class="tag is-grey">14</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/珂朵莉树/">
                        <span class="tag">珂朵莉树</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/系统配置/">
                        <span class="tag">系统配置</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/线段树/">
                        <span class="tag">线段树</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/老司机树/">
                        <span class="tag">老司机树</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/莫比乌斯反演/">
                        <span class="tag">莫比乌斯反演</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/虚拟机/">
                        <span class="tag">虚拟机</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/虚拟环境/">
                        <span class="tag">虚拟环境</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/谷歌输入法/">
                        <span class="tag">谷歌输入法</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
        
            

<div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            链接
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://www.jianshu.com/u/bf4c0b4a8c83" target="_blank">
                    <span class="level-left">
                        <span class="level-item">简书</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">www.jianshu.com</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://github.com/jiaxiaochu" target="_blank">
                    <span class="level-left">
                        <span class="level-item">GitHub</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">github.com</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>


        
        </div>
    
</div>

                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right ">
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            标签云
        </h3>
        <a href="/tags/Anaconda/" style="font-size: 10px;">Anaconda</a> <a href="/tags/Bug/" style="font-size: 10px;">Bug</a> <a href="/tags/ChromeDriver/" style="font-size: 10px;">ChromeDriver</a> <a href="/tags/DP/" style="font-size: 10px;">DP</a> <a href="/tags/Deepin/" style="font-size: 11.43px;">Deepin</a> <a href="/tags/ICPC模板/" style="font-size: 18.57px;">ICPC模板</a> <a href="/tags/LCA/" style="font-size: 10px;">LCA</a> <a href="/tags/MongoDB数据库/" style="font-size: 10px;">MongoDB数据库</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/NTT/" style="font-size: 10px;">NTT</a> <a href="/tags/Pycharm/" style="font-size: 11.43px;">Pycharm</a> <a href="/tags/Python解释器的安装与配置/" style="font-size: 12.86px;">Python解释器的安装与配置</a> <a href="/tags/Ubuntu/" style="font-size: 10px;">Ubuntu</a> <a href="/tags/VMware/" style="font-size: 10px;">VMware</a> <a href="/tags/chrome/" style="font-size: 10px;">chrome</a> <a href="/tags/chromedriver/" style="font-size: 10px;">chromedriver</a> <a href="/tags/pymysql/" style="font-size: 10px;">pymysql</a> <a href="/tags/三维计算几何/" style="font-size: 12.86px;">三维计算几何</a> <a href="/tags/主席树/" style="font-size: 10px;">主席树</a> <a href="/tags/二分/" style="font-size: 10px;">二分</a> <a href="/tags/二维计算几何/" style="font-size: 10px;">二维计算几何</a> <a href="/tags/动态开点/" style="font-size: 10px;">动态开点</a> <a href="/tags/励志/" style="font-size: 10px;">励志</a> <a href="/tags/单调栈/" style="font-size: 10px;">单调栈</a> <a href="/tags/单调队列/" style="font-size: 12.86px;">单调队列</a> <a href="/tags/原根/" style="font-size: 10px;">原根</a> <a href="/tags/可持久化/" style="font-size: 11.43px;">可持久化</a> <a href="/tags/扫描线/" style="font-size: 10px;">扫描线</a> <a href="/tags/拓扑排序/" style="font-size: 10px;">拓扑排序</a> <a href="/tags/搜索/" style="font-size: 10px;">搜索</a> <a href="/tags/数据库/" style="font-size: 10px;">数据库</a> <a href="/tags/数据结构/" style="font-size: 17.14px;">数据结构</a> <a href="/tags/数论/" style="font-size: 11.43px;">数论</a> <a href="/tags/无旋Treap/" style="font-size: 14.29px;">无旋Treap</a> <a href="/tags/最大流/" style="font-size: 10px;">最大流</a> <a href="/tags/最短路/" style="font-size: 10px;">最短路</a> <a href="/tags/树状数组/" style="font-size: 10px;">树状数组</a> <a href="/tags/环境配置/" style="font-size: 20px;">环境配置</a> <a href="/tags/珂朵莉树/" style="font-size: 11.43px;">珂朵莉树</a> <a href="/tags/系统配置/" style="font-size: 10px;">系统配置</a> <a href="/tags/线段树/" style="font-size: 15.71px;">线段树</a> <a href="/tags/老司机树/" style="font-size: 11.43px;">老司机树</a> <a href="/tags/莫比乌斯反演/" style="font-size: 10px;">莫比乌斯反演</a> <a href="/tags/虚拟机/" style="font-size: 10px;">虚拟机</a> <a href="/tags/虚拟环境/" style="font-size: 10px;">虚拟环境</a> <a href="/tags/谷歌输入法/" style="font-size: 10px;">谷歌输入法</a>
    </div>
</div>

    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">七月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/04/">
                <span class="level-start">
                    <span class="level-item">四月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">22</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/03/">
                <span class="level-start">
                    <span class="level-item">三月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/02/">
                <span class="level-start">
                    <span class="level-item">二月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">27</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/01/">
                <span class="level-start">
                    <span class="level-item">一月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">13</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/10/">
                <span class="level-start">
                    <span class="level-item">十月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">21</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/09/">
                <span class="level-start">
                    <span class="level-item">九月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">9</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/08/">
                <span class="level-start">
                    <span class="level-item">八月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">19</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/07/">
                <span class="level-start">
                    <span class="level-item">七月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">9</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/06/">
                <span class="level-start">
                    <span class="level-item">六月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/05/">
                <span class="level-start">
                    <span class="level-item">五月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">三月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/10/">
                <span class="level-start">
                    <span class="level-item">十月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Anaconda/">
                        <span class="tag">Anaconda</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Bug/">
                        <span class="tag">Bug</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ChromeDriver/">
                        <span class="tag">ChromeDriver</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/DP/">
                        <span class="tag">DP</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Deepin/">
                        <span class="tag">Deepin</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ICPC模板/">
                        <span class="tag">ICPC模板</span>
                        <span class="tag is-grey">10</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/LCA/">
                        <span class="tag">LCA</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MongoDB数据库/">
                        <span class="tag">MongoDB数据库</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MySQL/">
                        <span class="tag">MySQL</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/NTT/">
                        <span class="tag">NTT</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Pycharm/">
                        <span class="tag">Pycharm</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Python解释器的安装与配置/">
                        <span class="tag">Python解释器的安装与配置</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Ubuntu/">
                        <span class="tag">Ubuntu</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/VMware/">
                        <span class="tag">VMware</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/chrome/">
                        <span class="tag">chrome</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/chromedriver/">
                        <span class="tag">chromedriver</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/pymysql/">
                        <span class="tag">pymysql</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/三维计算几何/">
                        <span class="tag">三维计算几何</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/主席树/">
                        <span class="tag">主席树</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/二分/">
                        <span class="tag">二分</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/二维计算几何/">
                        <span class="tag">二维计算几何</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/动态开点/">
                        <span class="tag">动态开点</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/励志/">
                        <span class="tag">励志</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/单调栈/">
                        <span class="tag">单调栈</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/单调队列/">
                        <span class="tag">单调队列</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/原根/">
                        <span class="tag">原根</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/可持久化/">
                        <span class="tag">可持久化</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/扫描线/">
                        <span class="tag">扫描线</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/拓扑排序/">
                        <span class="tag">拓扑排序</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/搜索/">
                        <span class="tag">搜索</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数据库/">
                        <span class="tag">数据库</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数据结构/">
                        <span class="tag">数据结构</span>
                        <span class="tag is-grey">8</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数论/">
                        <span class="tag">数论</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/无旋Treap/">
                        <span class="tag">无旋Treap</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/最大流/">
                        <span class="tag">最大流</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/最短路/">
                        <span class="tag">最短路</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/树状数组/">
                        <span class="tag">树状数组</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/环境配置/">
                        <span class="tag">环境配置</span>
                        <span class="tag is-grey">14</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/珂朵莉树/">
                        <span class="tag">珂朵莉树</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/系统配置/">
                        <span class="tag">系统配置</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/线段树/">
                        <span class="tag">线段树</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/老司机树/">
                        <span class="tag">老司机树</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/莫比乌斯反演/">
                        <span class="tag">莫比乌斯反演</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/虚拟机/">
                        <span class="tag">虚拟机</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/虚拟环境/">
                        <span class="tag">虚拟环境</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/谷歌输入法/">
                        <span class="tag">谷歌输入法</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
        

<div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            链接
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://www.jianshu.com/u/bf4c0b4a8c83" target="_blank">
                    <span class="level-left">
                        <span class="level-item">简书</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">www.jianshu.com</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://github.com/jiaxiaochu" target="_blank">
                    <span class="level-left">
                        <span class="level-item">GitHub</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">github.com</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>


    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.svg" alt="贾志翔的博客" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2019 jiazhixiang&nbsp;
                Powered &#10084; YH · Lin
                </p>
            </div>
            
            <script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

            
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Download on GitHub" href="https://github.com/jiaxiaochu/jiaxiaochu.github.io">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        <div align="center">
            <span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
            <script>
                var now = new Date(); 
                function createtime() { 
                    var grt= new Date("4/1/2019 12:49:00");//此处修改你的建站时间或者网站上线时间 
                    now.setTime(now.getTime()+250); 
                    days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); 
                    hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); 
                    if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
                    mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 
                    seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
                    snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 
                    document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 "; 
                    document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒"; 
                } 
            setInterval("createtime()",250);
            </script>
            <div align="center">
            <span id="busuanzi_container_site_pv" class="theme-info">本站总访问量-<span id="busuanzi_value_site_pv"></span>-次|
              </span>
              <span id="busuanzi_container_site_uv" class="theme-info">您是第-<span id="busuanzi_value_site_uv"></span>-位小伙伴</span>

            <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            </div>
        </div>
        <span>
        <script type="text/javascript" src="//rf.revolvermaps.com/0/0/0.js?i=0xetp0d4rdh&amp;d=2&amp;p=1&amp;b=8&amp;w=193&amp;g=2&amp;f=arial&amp;fs=12&amp;r=0&amp;c0=000000&amp;c1=00a99d&amp;c2=000000&amp;ic0=0&amp;ic1=0" async="async"></script>
        </span>
        </div>

    </div>

    <script>
        (function(){
            var bp = document.createElement('script');
            bp.src = '//push.zhanzhang.baidu.com/push.js';
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(bp, s);
        })();
</script>
<script src="https://cdn.jsdelivr.net/npm/meting@1.1.0/dist/Meting.min.js"></script>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>


    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="回到顶端" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    

    
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>
    <script src="/js/clipboard.js" defer></script>
    

    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么...">
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
        <!-- 雪花特效 -->
    <script type="text/javascript">
      var windowWidth = $(window).width();
      if (windowWidth > 480) {
        document.write('<script type="text/javascript" src="/js/src/snow.js"><\/script>');
      }
    </script>

    <script src="//code.tidio.co/wgmwb2zlxrcti0crizzmumshwbxpums2.js"></script>
    
</body>
</html>