<!DOCTYPE html>
<script src="/js/src/clicklove.js"></script>
<html lang="zh">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
<title>贾志翔的博客</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



    <meta name="description" content="jia jiazhixiang jiaxiaochu jiaxiaochu.github.io">
<meta property="og:type" content="website">
<meta property="og:title" content="贾志翔的博客">
<meta property="og:url" content="http://yoursite.com/page/5/index.html">
<meta property="og:site_name" content="贾志翔的博客">
<meta property="og:description" content="jia jiazhixiang jiaxiaochu jiaxiaochu.github.io">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/images/og_image.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="贾志翔的博客">
<meta name="twitter:description" content="jia jiazhixiang jiaxiaochu jiaxiaochu.github.io">
<meta name="twitter:image" content="http://yoursite.com/images/og_image.png">







<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    

    
    
    
    

    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    

    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.svg" alt="贾志翔的博客" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item" href="/">主页</a>
                
                <a class="navbar-item" href="/archives">归档</a>
                
                <a class="navbar-item" href="/tags">标签</a>
                
                <a class="navbar-item" href="/about">支持</a>
                
                <a class="navbar-item" href="http://www.tripwiremagazine.com/wp-content/uploads/images/stories/Articles/9_Funniest_JavaScript_effects/Unclosable%20Window.html">别点·有毒</a>
                
                <a class="navbar-item" href="http://fanfou.com/">饭否</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    
                    <a class="navbar-item" target="_blank" title="Download on GitHub" href="https://github.com/jiaxiaochu/jiaxiaochu.github.io">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="搜索" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main">
    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-02-03T10:00:02.000Z">2019-02-03</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/ACM/">ACM</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/ACM/Template/">Template</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    26 分钟 读完 (大约 3963 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/02/03/2019-02-03-计算几何/">计算几何</a>
            
        </h1>
        <div class="content">
            <h2 id="二维"><a href="#二维" class="headerlink" title="二维"></a>二维</h2><p>点和向量化为坐标Coord进行运算，使用stl中的complex实现。</p>
<p>复数相乘的几何意义为长度相乘，极角相加。</p>
<p>用直线上的一点p和方向向量v表示一条经过p的直线，直线上的所有点q满足q=p+t*v，其中t是参数；当限制t≥0时，该参数方程表示射线；限制0≤t≤1时，该参数方程表示线段。</p>
<p>此外，如果已知线段端点a1和a2，可以通过Line(a1,a2-a1)来得到对应的参数形式。</p>
<p>Morley定理：三角形每个内角的三等分线相交成等边三角形。</p>
<p>欧拉定理：平面图的点数V、边数E和面数F满足V+F-E=2。</p>
<figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">double</span> lf;</span><br><span class="line"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">complex</span>&lt;lf&gt; Coord;</span><br><span class="line"><span class="hljs-keyword">const</span> lf EPS = <span class="hljs-number">1e-9</span>, PI = <span class="hljs-built_in">acos</span>(<span class="hljs-number">-1</span>);</span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> X real()</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> Y imag()</span></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Line</span></span></span><br><span class="line"><span class="hljs-class">&#123;</span></span><br><span class="line">	Coord p, v;</span><br><span class="line">	Line(Coord p = Coord(), Coord v = Coord()) : p(p), v(v) &#123;&#125;</span><br><span class="line">	<span class="hljs-function">Coord <span class="hljs-title">point</span><span class="hljs-params">(lf t)</span> <span class="hljs-keyword">const</span> </span>&#123; <span class="hljs-keyword">return</span> p + v * t; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Circle</span></span></span><br><span class="line"><span class="hljs-class">&#123;</span></span><br><span class="line">	Coord c;</span><br><span class="line">	lf r;</span><br><span class="line">	Circle(Coord c = Coord(), lf r = <span class="hljs-number">0</span>) : c(c), r(r) &#123;&#125;</span><br><span class="line">	<span class="hljs-function">Coord <span class="hljs-title">point</span><span class="hljs-params">(lf t)</span> <span class="hljs-keyword">const</span> </span>&#123; <span class="hljs-keyword">return</span> c + polar(r, t); &#125; <span class="hljs-comment">//t为参数，幅角</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">Coord(lf x=0,lf y=0);//构造函数</span></span><br><span class="line"><span class="hljs-comment">lf real(Coord a);//a的实部（复平面的横坐标）,也可写作a.real()</span></span><br><span class="line"><span class="hljs-comment">lf imag(Coord a);//a的虚部（复平面的纵坐标）,也可写作a.imag()</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">lf abs(Coord a);//向量a的模长，或是点a到原点的距离</span></span><br><span class="line"><span class="hljs-comment">lf norm(Coord a);//abs的平方，比abs快，但是要注意浮点数精度溢出</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">lf arg(Coord a);//a的幅角，与atan2(a.real(),a.imag())等价</span></span><br><span class="line"><span class="hljs-comment">Coord polar(lf r,lf t);//极坐标生成方式，r为幅值，t为幅角</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">//运算符重载+、-、*、/（以及对应的赋值运算，但是赋值运算不能写在表达式中，详见参考地址）、&lt;&lt;、&gt;&gt;（输出括号形式的坐标）</span></span><br><span class="line"><span class="hljs-comment">*/</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">sgn</span><span class="hljs-params">(lf d)</span> </span>&#123; <span class="hljs-keyword">return</span> (d &gt; EPS) - (d &lt; -EPS); &#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>!=(<span class="hljs-keyword">const</span> Coord &amp;A, <span class="hljs-keyword">const</span> Coord &amp;B) &#123; <span class="hljs-keyword">return</span> sgn(A.X - B.X) || sgn(A.Y - B.Y); &#125; <span class="hljs-comment">//不等运算符，涉及到浮点数比较要重写</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>==(<span class="hljs-keyword">const</span> Coord &amp;A, <span class="hljs-keyword">const</span> Coord &amp;B) &#123; <span class="hljs-keyword">return</span> !(A != B); &#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">cmpCoord</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Coord &amp;A, <span class="hljs-keyword">const</span> Coord &amp;B)</span> </span>&#123; <span class="hljs-keyword">return</span> sgn(A.X - B.X) ? sgn(A.X - B.X) &lt; <span class="hljs-number">0</span> : sgn(A.Y - B.Y) &lt; <span class="hljs-number">0</span>; &#125; <span class="hljs-comment">//复数没有小于运算，只能这样定义一个比较函数</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">cmpLine</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Line &amp;A, <span class="hljs-keyword">const</span> Line &amp;B)</span> </span>&#123; <span class="hljs-keyword">return</span> sgn(arg(A.v) - arg(B.v)) &lt; <span class="hljs-number">0</span>; &#125; <span class="hljs-comment">//按极角排序，求凸包中使用</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-function">lf <span class="hljs-title">Dot</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Coord &amp;A, <span class="hljs-keyword">const</span> Coord &amp;B)</span> </span>&#123; <span class="hljs-keyword">return</span> A.X * B.X + A.Y * B.Y; &#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function">lf <span class="hljs-title">Cross</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Coord &amp;A, <span class="hljs-keyword">const</span> Coord &amp;B)</span> </span>&#123; <span class="hljs-keyword">return</span> A.X * B.Y - B.X * A.Y; &#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function">lf <span class="hljs-title">Angle</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Coord &amp;A, <span class="hljs-keyword">const</span> Coord &amp;B)</span> </span>&#123; <span class="hljs-keyword">return</span> <span class="hljs-built_in">acos</span>(Dot(A, B) / <span class="hljs-built_in">abs</span>(A) / <span class="hljs-built_in">abs</span>(B)); &#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function">lf <span class="hljs-title">Area2</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Coord &amp;A, <span class="hljs-keyword">const</span> Coord &amp;B, <span class="hljs-keyword">const</span> Coord &amp;C)</span> </span>&#123; <span class="hljs-keyword">return</span> Cross(B - A, C - A); &#125; <span class="hljs-comment">//三角形ABC有向面积的两倍</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-function">Coord <span class="hljs-title">Rotate</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Coord &amp;A, lf rad)</span> </span>&#123; <span class="hljs-keyword">return</span> A * polar(<span class="hljs-number">1.0</span>, rad);&#125; <span class="hljs-comment">//向量A逆时针旋转rad弧度</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-function">Coord <span class="hljs-title">Normal</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Coord &amp;A)</span> <span class="hljs-comment">//A的法向量，把A逆时针旋转九十度并长度化为1</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	lf L = <span class="hljs-built_in">abs</span>(A);</span><br><span class="line">	<span class="hljs-keyword">return</span> Coord(-A.Y / L, A.X / L);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">onLeft</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Coord &amp;P, <span class="hljs-keyword">const</span> Line &amp;L)</span> </span>&#123; <span class="hljs-keyword">return</span> sgn(Cross(L.v, P - L.p)) &gt; <span class="hljs-number">0</span>; &#125; <span class="hljs-comment">//p是否在有向直线L左侧，不含线上</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-function">lf <span class="hljs-title">DistanceToLine</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Coord &amp;P, <span class="hljs-keyword">const</span> Line &amp;L)</span> </span>&#123; <span class="hljs-keyword">return</span> Cross(L.v, P - L.p) / <span class="hljs-built_in">abs</span>(L.v); &#125; <span class="hljs-comment">//点到直线距离（有向）</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-function">lf <span class="hljs-title">DistanceToLine</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Coord &amp;P, <span class="hljs-keyword">const</span> Coord &amp;A, <span class="hljs-keyword">const</span> Coord &amp;B)</span> </span>&#123; <span class="hljs-keyword">return</span> DistanceToLine(P, Line(A, B - A)); &#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function">lf <span class="hljs-title">DistanceToSegment</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Coord &amp;P, <span class="hljs-keyword">const</span> Coord &amp;A, <span class="hljs-keyword">const</span> Coord &amp;B)</span> <span class="hljs-comment">//点到线段的距离（无向）</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">if</span> (A == B)</span><br><span class="line">		<span class="hljs-keyword">return</span> <span class="hljs-built_in">abs</span>(P - A);</span><br><span class="line">	Coord v1 = B - A, v2 = P - A, v3 = P - B;</span><br><span class="line">	<span class="hljs-keyword">if</span> (sgn(Dot(v1, v2)) &lt; <span class="hljs-number">0</span>)</span><br><span class="line">		<span class="hljs-keyword">return</span> <span class="hljs-built_in">abs</span>(v2);</span><br><span class="line">	<span class="hljs-keyword">if</span> (sgn(Dot(v1, v3)) &gt; <span class="hljs-number">0</span>)</span><br><span class="line">		<span class="hljs-keyword">return</span> <span class="hljs-built_in">abs</span>(v3);</span><br><span class="line">	<span class="hljs-keyword">return</span> <span class="hljs-built_in">fabs</span>(DistanceToLine(P, Line(A, B - A)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function">Coord <span class="hljs-title">getLineProjection</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Coord &amp;P, <span class="hljs-keyword">const</span> Line &amp;L)</span> </span>&#123; <span class="hljs-keyword">return</span> L.point(Dot(L.v, P - L.p) / norm(L.v)); &#125; <span class="hljs-comment">//点在直线上的投影</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-function">Coord <span class="hljs-title">getLineProjection</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Coord &amp;P, <span class="hljs-keyword">const</span> Coord &amp;A, <span class="hljs-keyword">const</span> Coord &amp;B)</span> </span>&#123; <span class="hljs-keyword">return</span> getLineProjection(P, Line(A, B - A)); &#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function">Coord <span class="hljs-title">getSymmetry</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Coord &amp;P, <span class="hljs-keyword">const</span> Coord &amp;O)</span> </span>&#123; <span class="hljs-keyword">return</span> O + O - P; &#125; <span class="hljs-comment">//P关于O的对称点</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-function">Coord <span class="hljs-title">getSymmetry</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Coord &amp;P, <span class="hljs-keyword">const</span> Line &amp;L)</span> </span>&#123; <span class="hljs-keyword">return</span> getSymmetry(P, getLineProjection(P, L)); &#125; <span class="hljs-comment">//P关于L的对称点</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-function">Coord <span class="hljs-title">getLineIntersection</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Line &amp;L1, <span class="hljs-keyword">const</span> Line &amp;L2)</span> </span>&#123; <span class="hljs-keyword">return</span> L1.point(Cross(L2.v, L1.p - L2.p) / Cross(L1.v, L2.v)); &#125; <span class="hljs-comment">//直线交点,须确保两直线相交</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-function">Coord <span class="hljs-title">getLineIntersection</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Coord &amp;A1, <span class="hljs-keyword">const</span> Coord &amp;A2, <span class="hljs-keyword">const</span> Coord &amp;B1, <span class="hljs-keyword">const</span> Coord &amp;B2)</span> </span>&#123; <span class="hljs-keyword">return</span> getLineIntersection(Line(A1, A2 - A1), Line(B1, B2 - B1)); &#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">SegmentProperIntersection</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Coord &amp;A1, <span class="hljs-keyword">const</span> Coord &amp;A2, <span class="hljs-keyword">const</span> Coord &amp;B1, <span class="hljs-keyword">const</span> Coord &amp;B2)</span> <span class="hljs-comment">//线段相交判定，交点不在一条线段的端点</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	lf C1 = Cross(A2 - A1, B1 - A1), C2 = Cross(A2 - A1, B2 - A1),</span><br><span class="line">	   C3 = Cross(B2 - B1, A1 - B1), C4 = Cross(B2 - B1, A2 - B1);</span><br><span class="line">	<span class="hljs-keyword">return</span> sgn(C1) * sgn(C2) &lt; <span class="hljs-number">0</span> &amp;&amp; sgn(C3) * sgn(C4) &lt; <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">onSegment</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Coord &amp;P, <span class="hljs-keyword">const</span> Coord &amp;A1, <span class="hljs-keyword">const</span> Coord &amp;A2)</span> </span>&#123; <span class="hljs-keyword">return</span> sgn(Dot(A1 - P, A2 - P)) &lt; <span class="hljs-number">0</span> &amp;&amp; !sgn(Cross(A1 - P, A2 - P)); &#125; <span class="hljs-comment">//判断点是否在线段上，不包含端点</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-function">lf <span class="hljs-title">PolygonArea</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">vector</span>&lt;Coord&gt; &amp;p)</span> <span class="hljs-comment">//计算多边形的有向面积，凸多边形即为面积</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	lf s = <span class="hljs-number">0</span>;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">2</span>; i &lt; p.size(); ++i)</span><br><span class="line">		s += Area2(p[<span class="hljs-number">0</span>], p[i - <span class="hljs-number">1</span>], p[i]);</span><br><span class="line">	<span class="hljs-keyword">return</span> s / <span class="hljs-number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">inPolygon</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Coord &amp;p, <span class="hljs-keyword">const</span> <span class="hljs-built_in">vector</span>&lt;Coord&gt; &amp;poly)</span> <span class="hljs-comment">//点在多边形内的判定，转角法，正值为内部，0为外部，-1在边界上</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">int</span> ans = <span class="hljs-number">0</span>;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>, k, d1, d2, n = poly.size(); i != n; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">if</span> (onSegment(p, poly[i], poly[(i + <span class="hljs-number">1</span>) % n]))</span><br><span class="line">			<span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">//在边界上</span></span><br><span class="line">		k = sgn(Cross(poly[(i + <span class="hljs-number">1</span>) % n] - poly[i], p - poly[i]));</span><br><span class="line">		d1 = sgn(poly[i].Y - p.Y);</span><br><span class="line">		d2 = sgn(poly[(i + <span class="hljs-number">1</span>) % n].Y - p.Y);</span><br><span class="line">		<span class="hljs-keyword">if</span> (k &gt; <span class="hljs-number">0</span> &amp;&amp; d1 &lt;= <span class="hljs-number">0</span> &amp;&amp; d2 &gt; <span class="hljs-number">0</span>)</span><br><span class="line">			++ans;</span><br><span class="line">		<span class="hljs-keyword">if</span> (k &lt; <span class="hljs-number">0</span> &amp;&amp; d2 &lt;= <span class="hljs-number">0</span> &amp;&amp; d1 &gt; <span class="hljs-number">0</span>)</span><br><span class="line">			--ans;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-built_in">vector</span>&lt;Coord&gt; ConvexHull(<span class="hljs-built_in">vector</span>&lt;Coord&gt; p, <span class="hljs-keyword">int</span> collineation = <span class="hljs-number">1</span>) <span class="hljs-comment">//获得凸包，不希望凸包的边上有输入点第二个参数传0</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="hljs-built_in">vector</span>&lt;Coord&gt; ans;</span><br><span class="line">	sort(p.begin(), p.end(), cmpCoord); <span class="hljs-comment">//先比横坐标再比纵坐标</span></span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; p.size(); ++i)  <span class="hljs-comment">//求出下凸包</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">while</span> (ans.size() &gt; <span class="hljs-number">1</span> &amp;&amp; sgn(Area2(ans[ans.size() - <span class="hljs-number">2</span>], ans[ans.size() - <span class="hljs-number">1</span>], p[i])) &lt; collineation)</span><br><span class="line">			ans.pop_back();</span><br><span class="line">		ans.push_back(p[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = p.size() - <span class="hljs-number">2</span>, k = ans.size(); i &gt;= <span class="hljs-number">0</span>; --i) <span class="hljs-comment">//求出上凸包</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">while</span> (ans.size() &gt; k &amp;&amp; -sgn(Area2(ans[ans.size() - <span class="hljs-number">1</span>], ans[ans.size() - <span class="hljs-number">2</span>], p[i])) &lt; collineation)</span><br><span class="line">			ans.pop_back();</span><br><span class="line">		ans.push_back(p[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-keyword">if</span> (p.size() &gt; <span class="hljs-number">1</span>)</span><br><span class="line">		ans.pop_back();</span><br><span class="line">	<span class="hljs-keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-built_in">vector</span>&lt;Coord&gt; cutPolygon(<span class="hljs-keyword">const</span> <span class="hljs-built_in">vector</span>&lt;Coord&gt; &amp;poly, <span class="hljs-keyword">const</span> Coord &amp;A, <span class="hljs-keyword">const</span> Coord &amp;B) <span class="hljs-comment">//用有向直线A-&gt;B切割多边形poly， 返回“左侧”。 如果退化，可能会返回一个单点或者线段，复杂度O(n^2)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="hljs-built_in">vector</span>&lt;Coord&gt; newpoly;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>, n = poly.size(); i != n; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		Coord C = poly[i], D = poly[(i + <span class="hljs-number">1</span>) % n];</span><br><span class="line">		<span class="hljs-keyword">if</span> (sgn(Cross(B - A, C - A)) &gt;= <span class="hljs-number">0</span>)</span><br><span class="line">			newpoly.push_back(C);</span><br><span class="line">		<span class="hljs-keyword">if</span> (!sgn(Cross(B - A, C - D)))</span><br><span class="line">		&#123;</span><br><span class="line">			Coord ip = getLineIntersection(Line(A, B - A), Line(C, D - C));</span><br><span class="line">			<span class="hljs-keyword">if</span> (onSegment(ip, C, D))</span><br><span class="line">				newpoly.push_back(ip);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-keyword">return</span> newpoly;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-built_in">vector</span>&lt;Coord&gt; getHalfPlaneIntersection(<span class="hljs-built_in">vector</span>&lt;Line&gt; L) <span class="hljs-comment">//半平面交</span></span><br><span class="line">&#123;</span><br><span class="line">	sort(L.begin(), L.end(), cmpLine);  <span class="hljs-comment">//按极角排序</span></span><br><span class="line">	<span class="hljs-built_in">vector</span>&lt;Coord&gt; p(L.size(), Coord()); <span class="hljs-comment">//p[i]为q[i]和q[i+1]的交点</span></span><br><span class="line">	<span class="hljs-keyword">int</span> first = <span class="hljs-number">0</span>, last = <span class="hljs-number">0</span>;			<span class="hljs-comment">//双端队列的第一个元素和最后一个元素</span></span><br><span class="line">	<span class="hljs-built_in">vector</span>&lt;Line&gt; q(L.size(), Line());   <span class="hljs-comment">//双端队列</span></span><br><span class="line">	q[<span class="hljs-number">0</span>] = L[<span class="hljs-number">0</span>];						<span class="hljs-comment">//队列初始化为只有一个半平面L[0]</span></span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>, n = L.size(); i != n; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">while</span> (first &lt; last &amp;&amp; !onLeft(p[last - <span class="hljs-number">1</span>], L[i]))</span><br><span class="line">			--last;</span><br><span class="line">		<span class="hljs-keyword">while</span> (first &lt; last &amp;&amp; !onLeft(p[first], L[i]))</span><br><span class="line">			++first;</span><br><span class="line"></span><br><span class="line">		q[++last] = L[i];</span><br><span class="line">		<span class="hljs-keyword">if</span> (!sgn(Cross(q[last].v, q[last - <span class="hljs-number">1</span>].v)))</span><br><span class="line">		&#123;</span><br><span class="line">			--last;</span><br><span class="line">			<span class="hljs-keyword">if</span> (onLeft(L[i].p, q[last]))</span><br><span class="line">				q[last] = L[i];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="hljs-keyword">if</span> (first &lt; last)</span><br><span class="line">			p[last - <span class="hljs-number">1</span>] = getLineIntersection(q[last - <span class="hljs-number">1</span>], q[last]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-keyword">while</span> (first &lt; last &amp;&amp; !onLeft(p[last - <span class="hljs-number">1</span>], q[first]))</span><br><span class="line">		--last; <span class="hljs-comment">//删除无用平面</span></span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">if</span> (last - first &lt;= <span class="hljs-number">1</span>)</span><br><span class="line">		<span class="hljs-keyword">return</span> <span class="hljs-built_in">vector</span>&lt;Coord&gt;(); <span class="hljs-comment">//空集</span></span><br><span class="line">	p[last] = getLineIntersection(q[last], q[first]);</span><br><span class="line">	<span class="hljs-keyword">return</span> <span class="hljs-built_in">vector</span>&lt;Coord&gt;(p.begin() + first, p.begin() + last + <span class="hljs-number">1</span>); <span class="hljs-comment">//从deque复制到输出中</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getLineCircleIntersection</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Line &amp;L, <span class="hljs-keyword">const</span> Circle &amp;C, <span class="hljs-built_in">vector</span>&lt;Coord&gt; &amp;sol)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	lf a = L.v.X,</span><br><span class="line">	   b = L.p.X - C.c.X,</span><br><span class="line">	   c = L.v.Y,</span><br><span class="line">	   d = L.p.Y - C.c.Y,</span><br><span class="line">	   e = a * a + c * c,</span><br><span class="line">	   f = <span class="hljs-number">2</span> * (a * b + c * d),</span><br><span class="line">	   g = b * b + d * d - C.r * C.r,</span><br><span class="line">	   delta = f * f - <span class="hljs-number">4</span> * e * g;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">if</span> (sgn(delta) &lt; <span class="hljs-number">0</span>)</span><br><span class="line">		<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">	<span class="hljs-keyword">if</span> (!sgn(delta))</span><br><span class="line">		<span class="hljs-keyword">return</span> sol.push_back(L.point(-f / (<span class="hljs-number">2</span> * e))), <span class="hljs-number">1</span>;</span><br><span class="line">	sol.push_back(L.point((-f - <span class="hljs-built_in">sqrt</span>(delta)) / (<span class="hljs-number">2</span> * e)));</span><br><span class="line">	sol.push_back(L.point((-f + <span class="hljs-built_in">sqrt</span>(delta)) / (<span class="hljs-number">2</span> * e)));</span><br><span class="line">	<span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getCircleIntersection</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Circle &amp;C1, <span class="hljs-keyword">const</span> Circle &amp;C2, <span class="hljs-built_in">vector</span>&lt;Coord&gt; &amp;sol)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	lf d = <span class="hljs-built_in">abs</span>(C1.c - C2.c);</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">if</span> (!sgn(d))</span><br><span class="line">		<span class="hljs-keyword">return</span> sgn(C1.r - C2.r) ? <span class="hljs-number">0</span> : <span class="hljs-number">-1</span>; <span class="hljs-comment">//重合返回-1</span></span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">if</span> (sgn(C1.r + C2.r - d) &lt; <span class="hljs-number">0</span> || sgn(<span class="hljs-built_in">fabs</span>(C1.r - C2.r) - d) &gt; <span class="hljs-number">0</span>) <span class="hljs-comment">//外离或内含</span></span><br><span class="line">		<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line"></span><br><span class="line">	lf a = arg(C2.c - C1.c),</span><br><span class="line">	   da = <span class="hljs-built_in">acos</span>((C1.r * C1.r + d * d - C2.r * C2.r) / (<span class="hljs-number">2</span> * C1.r * d));</span><br><span class="line"></span><br><span class="line">	Coord p1 = C1.point(a - da), p2 = C1.point(a + da);</span><br><span class="line"></span><br><span class="line">	sol.push_back(p1);</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">if</span> (p1 == p2)</span><br><span class="line">		<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>; <span class="hljs-comment">//相切</span></span><br><span class="line">	<span class="hljs-keyword">return</span> sol.push_back(p2), <span class="hljs-number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function">Line <span class="hljs-title">getTangent</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Coord &amp;C, <span class="hljs-keyword">const</span> Coord &amp;P)</span> </span>&#123; <span class="hljs-keyword">return</span> Line(P, Normal(C - P)); &#125; <span class="hljs-comment">//圆心C，圆上一点P处切线</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getTangents</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Coord &amp;p, <span class="hljs-keyword">const</span> Circle &amp;C, <span class="hljs-built_in">vector</span>&lt;Coord&gt; &amp;sol)</span> <span class="hljs-comment">//点到圆的切点，返回个数</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	Coord u = p - C.c;</span><br><span class="line">	lf d = <span class="hljs-built_in">abs</span>(u);</span><br><span class="line">	<span class="hljs-keyword">if</span> (d &lt; C.r)</span><br><span class="line">		<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;	  <span class="hljs-comment">//点在圆内</span></span><br><span class="line">	<span class="hljs-keyword">if</span> (!sgn(d - C.r)) <span class="hljs-comment">//点在圆上</span></span><br><span class="line">		<span class="hljs-keyword">return</span> sol.push_back(p), <span class="hljs-number">1</span>;</span><br><span class="line">	lf base = arg(u), ang = <span class="hljs-built_in">acos</span>(C.r / d);</span><br><span class="line">	sol.push_back(C.point(base + ang));</span><br><span class="line">	sol.push_back(C.point(base - ang));</span><br><span class="line">	<span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getTangents</span><span class="hljs-params">(Circle A, Circle &amp;B, <span class="hljs-built_in">vector</span>&lt;Coord&gt; &amp;a, <span class="hljs-built_in">vector</span>&lt;Coord&gt; &amp;b)</span> <span class="hljs-comment">//公共切线的切点</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">int</span> cnt = <span class="hljs-number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">if</span> (A.r &lt; B.r)</span><br><span class="line">		swap(A, B), swap(a, b); <span class="hljs-comment">//有时需标记交换</span></span><br><span class="line"></span><br><span class="line">	lf d = <span class="hljs-built_in">abs</span>(A.c - B.c),</span><br><span class="line">	   rdiff = A.r - B.r,</span><br><span class="line">	   rsum = A.r + B.r;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">if</span> (sgn(d - rdiff) &lt; <span class="hljs-number">0</span>)</span><br><span class="line">		<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; <span class="hljs-comment">//内含</span></span><br><span class="line"></span><br><span class="line">	lf base = arg(B.c - A.c);</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">if</span> (!sgn(d) &amp;&amp; !sgn(rdiff))</span><br><span class="line">		<span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">//重合，无穷多条切线</span></span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">if</span> (!sgn(d - rdiff)) <span class="hljs-comment">//内切，外公切线</span></span><br><span class="line">	&#123;</span><br><span class="line">		a.push_back(A.point(base));</span><br><span class="line">		b.push_back(B.point(base));</span><br><span class="line">		<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-comment">//有外公切线的情形</span></span><br><span class="line">	lf ang = <span class="hljs-built_in">acos</span>(rdiff / d);</span><br><span class="line">	a.push_back(A.point(base + ang));</span><br><span class="line">	b.push_back(B.point(base + ang));</span><br><span class="line">	a.push_back(A.point(base - ang));</span><br><span class="line">	b.push_back(B.point(base - ang));</span><br><span class="line">	cnt += <span class="hljs-number">2</span>;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">if</span> (!sgn(d - rsum))</span><br><span class="line">	&#123;</span><br><span class="line">		a.push_back(A.point(base));</span><br><span class="line">		b.push_back(B.point(base + PI));</span><br><span class="line">		++cnt;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (sgn(d - rsum) &gt; <span class="hljs-number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		lf ang_in = <span class="hljs-built_in">acos</span>(rsum / d);</span><br><span class="line">		a.push_back(A.point(base + ang_in));</span><br><span class="line">		b.push_back(B.point(base + ang_in + PI));</span><br><span class="line">		a.push_back(A.point(base - ang_in));</span><br><span class="line">		b.push_back(B.point(base - ang_in + PI));</span><br><span class="line">		cnt += <span class="hljs-number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-keyword">return</span> cnt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function">lf <span class="hljs-title">AreaCircleWithTriangle</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Circle &amp;C, Coord A, Coord B)</span> <span class="hljs-comment">//C和三角形OAB的相交面积，如果三角形顶点不在O上则把圆和三角形同时平移，直到有一个顶点在O上</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">int</span> sg = sgn(Cross(A, B));</span><br><span class="line">	<span class="hljs-keyword">if</span> (!sg || A == C.c || B == C.c)</span><br><span class="line">		<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line"></span><br><span class="line">	lf OA = <span class="hljs-built_in">abs</span>(A - C.c), OB = <span class="hljs-built_in">abs</span>(B - C.c), angle = Angle(A, B),</span><br><span class="line">	   d = DistanceToLine(Coord(), A, B);</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">if</span> (sgn(OA - C.r) &lt;= <span class="hljs-number">0</span> &amp;&amp; sgn(OB - C.r) &lt;= <span class="hljs-number">0</span>)</span><br><span class="line">		<span class="hljs-keyword">return</span> Cross(A, B) / <span class="hljs-number">2</span>;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">if</span> (sgn(OA - C.r) &gt;= <span class="hljs-number">0</span> &amp;&amp; sgn(OB - C.r) &gt;= <span class="hljs-number">0</span> &amp;&amp; sgn(d - C.r) &gt;= <span class="hljs-number">0</span>)</span><br><span class="line">		<span class="hljs-keyword">return</span> sg * C.r * C.r * angle / <span class="hljs-number">2</span>;</span><br><span class="line">	<span class="hljs-keyword">if</span> (sgn(OA - C.r) &gt;= <span class="hljs-number">0</span> &amp;&amp; sgn(OB - C.r) &gt;= <span class="hljs-number">0</span> &amp;&amp; sgn(d - C.r) &lt; <span class="hljs-number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		Coord prj = getLineProjection(Coord(), A, B);</span><br><span class="line">		<span class="hljs-keyword">if</span> (!onSegment(prj, A, B))</span><br><span class="line">			<span class="hljs-keyword">return</span> sg * C.r * C.r * angle / <span class="hljs-number">2</span>;</span><br><span class="line"></span><br><span class="line">		<span class="hljs-built_in">vector</span>&lt;Coord&gt; p;</span><br><span class="line">		Line L = Line(A, B - A);</span><br><span class="line">		getLineCircleIntersection(L, C, p);</span><br><span class="line"></span><br><span class="line">		lf s1 = C.r * C.r * angle / <span class="hljs-number">2</span>,</span><br><span class="line">		   s2 = C.r * C.r * Angle(p[<span class="hljs-number">0</span>], p[<span class="hljs-number">1</span>]) / <span class="hljs-number">2</span>;</span><br><span class="line">		s2 -= <span class="hljs-built_in">fabs</span>(Cross(p[<span class="hljs-number">0</span>], p[<span class="hljs-number">1</span>]) / <span class="hljs-number">2</span>);</span><br><span class="line">		s1 = s1 - s2;</span><br><span class="line"></span><br><span class="line">		<span class="hljs-keyword">return</span> sg * s1;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-keyword">if</span> (sgn(OB - C.r) &lt; <span class="hljs-number">0</span>)</span><br><span class="line">		swap(A, B);</span><br><span class="line"></span><br><span class="line">	Line L = Line(A, B - A);</span><br><span class="line">	<span class="hljs-built_in">vector</span>&lt;Coord&gt; inter;</span><br><span class="line">	getLineCircleIntersection(L, C, inter);</span><br><span class="line">	Coord inter_point = inter[!onSegment(inter[<span class="hljs-number">0</span>], A, B)];</span><br><span class="line"></span><br><span class="line">	lf s = <span class="hljs-built_in">fabs</span>(Cross(inter_point, A) / <span class="hljs-number">2</span>);</span><br><span class="line">	s += C.r * C.r * Angle(inter_point, B) / <span class="hljs-number">2</span>;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">return</span> s * sg;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function">lf <span class="hljs-title">AreaCircleWithPolygon</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Circle &amp;C, <span class="hljs-keyword">const</span> <span class="hljs-built_in">vector</span>&lt;Coord&gt; &amp;p)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	lf ans = <span class="hljs-number">0</span>;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; p.size(); ++i)</span><br><span class="line">		ans += AreaCircleWithTriangle(C, p[i], p[(i + <span class="hljs-number">1</span>) % p.size()]);</span><br><span class="line">	<span class="hljs-keyword">return</span> <span class="hljs-built_in">fabs</span>(ans);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function">Coord <span class="hljs-title">getGravityCenter</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">vector</span>&lt;Coord&gt; &amp;p)</span> <span class="hljs-comment">//多边形重心</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-function">Coord <span class="hljs-title">a</span><span class="hljs-params">(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)</span></span>;</span><br><span class="line">	lf am = <span class="hljs-number">0</span>, mj;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; p.size(); ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		mj = Cross(p[i], p[(i + <span class="hljs-number">1</span>) % p.size()]);</span><br><span class="line">		a += mj * (p[i] + p[(i + <span class="hljs-number">1</span>) % p.size()]);</span><br><span class="line">		am += mj;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-keyword">return</span> a / am / <span class="hljs-number">3.0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三维"><a href="#三维" class="headerlink" title="三维"></a>三维</h2><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">double</span> lf;</span><br><span class="line"><span class="hljs-keyword">const</span> lf EPS = <span class="hljs-number">1e-9</span>, INF = <span class="hljs-number">1e9</span>, PI = <span class="hljs-built_in">acos</span>(<span class="hljs-number">-1</span>);</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">sgn</span><span class="hljs-params">(lf d)</span> </span>&#123; <span class="hljs-keyword">return</span> (d &gt; EPS) - (d &lt; -EPS); &#125;</span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Coord3</span></span></span><br><span class="line"><span class="hljs-class">&#123;</span></span><br><span class="line">	lf X, Y, Z;</span><br><span class="line">	<span class="hljs-keyword">friend</span> <span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>!=(<span class="hljs-keyword">const</span> Coord3 &amp;a, <span class="hljs-keyword">const</span> Coord3 &amp;b) &#123; <span class="hljs-keyword">return</span> sgn(a.X - b.X) || sgn(a.Y - b.Y) || sgn(a.Z - b.Z); &#125;</span><br><span class="line">	<span class="hljs-keyword">friend</span> <span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>==(<span class="hljs-keyword">const</span> Coord3 &amp;a, <span class="hljs-keyword">const</span> Coord3 &amp;b) &#123; <span class="hljs-keyword">return</span> !(a != b); &#125;</span><br><span class="line">	Coord3 &amp;<span class="hljs-keyword">operator</span>+=(<span class="hljs-keyword">const</span> Coord3 &amp;b) &#123; <span class="hljs-keyword">return</span> X += b.X, Y += b.Y, Z += b.Z, *<span class="hljs-keyword">this</span>; &#125;</span><br><span class="line">	<span class="hljs-keyword">friend</span> Coord3 <span class="hljs-keyword">operator</span>+(Coord3 a, <span class="hljs-keyword">const</span> Coord3 &amp;b) &#123; <span class="hljs-keyword">return</span> a += b; &#125;</span><br><span class="line">	Coord3 &amp;<span class="hljs-keyword">operator</span>-=(<span class="hljs-keyword">const</span> Coord3 &amp;b) &#123; <span class="hljs-keyword">return</span> X -= b.X, Y -= b.Y, Z -= b.Z, *<span class="hljs-keyword">this</span>; &#125;</span><br><span class="line">	<span class="hljs-keyword">friend</span> Coord3 <span class="hljs-keyword">operator</span>-(Coord3 a, <span class="hljs-keyword">const</span> Coord3 &amp;b) &#123; <span class="hljs-keyword">return</span> a -= b; &#125;</span><br><span class="line">	Coord3 &amp;<span class="hljs-keyword">operator</span>*=(lf d) &#123; <span class="hljs-keyword">return</span> X *= d, Y *= d, Z *= d, *<span class="hljs-keyword">this</span>; &#125;</span><br><span class="line">	<span class="hljs-keyword">friend</span> Coord3 <span class="hljs-keyword">operator</span>*(Coord3 a, lf d) &#123; <span class="hljs-keyword">return</span> a *= d; &#125;</span><br><span class="line">	<span class="hljs-keyword">friend</span> Coord3 <span class="hljs-keyword">operator</span>*(lf d, Coord3 a) &#123; <span class="hljs-keyword">return</span> a *= d; &#125;</span><br><span class="line">	Coord3 &amp;<span class="hljs-keyword">operator</span>/=(lf d) &#123; <span class="hljs-keyword">return</span> X /= d, Y /= d, Z /= d, *<span class="hljs-keyword">this</span>; &#125;</span><br><span class="line">	<span class="hljs-keyword">friend</span> Coord3 <span class="hljs-keyword">operator</span>/(Coord3 a, lf d) &#123; <span class="hljs-keyword">return</span> a /= d; &#125;</span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">friend</span> lf <span class="hljs-title">Dot</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Coord3 &amp;A, <span class="hljs-keyword">const</span> Coord3 &amp;B)</span> </span>&#123; <span class="hljs-keyword">return</span> A.X * B.X + A.Y * B.Y + A.Z * B.Z; &#125;</span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">friend</span> Coord3 <span class="hljs-title">Cross</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Coord3 &amp;A, <span class="hljs-keyword">const</span> Coord3 &amp;B)</span> </span>&#123; <span class="hljs-keyword">return</span> &#123;A.Y * B.Z - A.Z * B.Y, A.Z * B.X - A.X * B.Z, A.X * B.Y - A.Y * B.X&#125;; &#125;</span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">friend</span> lf <span class="hljs-title">norm</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Coord3 &amp;A)</span> </span>&#123; <span class="hljs-keyword">return</span> Dot(A, A); &#125;</span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">friend</span> lf <span class="hljs-title">abs</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Coord3 &amp;A)</span> </span>&#123; <span class="hljs-keyword">return</span> <span class="hljs-built_in">sqrt</span>(norm(A)); &#125;</span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">friend</span> lf <span class="hljs-title">Angle</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Coord3 &amp;A, <span class="hljs-keyword">const</span> Coord3 &amp;B)</span> </span>&#123; <span class="hljs-keyword">return</span> <span class="hljs-built_in">acos</span>(Dot(A, B) / <span class="hljs-built_in">abs</span>(A) / <span class="hljs-built_in">abs</span>(B)); &#125;</span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">friend</span> lf <span class="hljs-title">Area2</span><span class="hljs-params">(Coord3 A, Coord3 B, Coord3 C)</span> </span>&#123; <span class="hljs-keyword">return</span> <span class="hljs-built_in">abs</span>(Cross(B - A, C - A)); &#125;</span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">friend</span> lf <span class="hljs-title">Volume6</span><span class="hljs-params">(Coord3 A, Coord3 B, Coord3 C, Coord3 D)</span> </span>&#123; <span class="hljs-keyword">return</span> Dot(D - A, Cross(B - A, C - A)); &#125;	 <span class="hljs-comment">//四面体体积</span></span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">friend</span> Coord3 <span class="hljs-title">Centroid</span><span class="hljs-params">(Coord3 A, Coord3 B, Coord3 C, Coord3 D)</span> </span>&#123; <span class="hljs-keyword">return</span> (A + B + C + D) / <span class="hljs-number">4.0</span>; &#125;		  <span class="hljs-comment">//四面体的重心</span></span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">friend</span> lf <span class="hljs-title">DistanceToPlane</span><span class="hljs-params">(Coord3 p, Coord3 p0, <span class="hljs-keyword">const</span> Coord3 &amp;n)</span> </span>&#123; <span class="hljs-keyword">return</span> Dot(p - p0, n) / <span class="hljs-built_in">abs</span>(n); &#125;		  <span class="hljs-comment">//点p到平面p0-n的有向距离</span></span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">friend</span> Coord3 <span class="hljs-title">getPlaneProjection</span><span class="hljs-params">(Coord3 p, Coord3 p0, <span class="hljs-keyword">const</span> Coord3 &amp;n)</span> </span>&#123; <span class="hljs-keyword">return</span> p - n * Dot(p - p0, n); &#125; <span class="hljs-comment">//点p在平面p0-n上的投影。n必须为单位向量</span></span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">friend</span> Coord3 <span class="hljs-title">LinePlaneIntersection</span><span class="hljs-params">(Coord3 p1, Coord3 p2, Coord3 p0, Coord3 n)</span>							  <span class="hljs-comment">//直线p1-p2 与平面p0-n的交点，假设交点唯一存在</span></span></span><br><span class="line"><span class="hljs-function">	</span>&#123;</span><br><span class="line">		Coord3 v = p2 - p1;</span><br><span class="line">		lf t = Dot(n, p0 - p1) / Dot(n, p2 - p1); <span class="hljs-comment">//分母为0，直线与平面平行或在平面上</span></span><br><span class="line">		<span class="hljs-keyword">return</span> p1 + v * t;						  <span class="hljs-comment">//如果是线段 判断t是否在0~1之间</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">friend</span> lf <span class="hljs-title">DistanceToLine</span><span class="hljs-params">(Coord3 P, Coord3 A, Coord3 B)</span> <span class="hljs-comment">//点P到直线AB的距离</span></span></span><br><span class="line"><span class="hljs-function">	</span>&#123;</span><br><span class="line">		Coord3 v1 = B - A, v2 = P - A;</span><br><span class="line">		<span class="hljs-keyword">return</span> <span class="hljs-built_in">abs</span>(Cross(v1, v2)) / <span class="hljs-built_in">abs</span>(v1);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">friend</span> lf <span class="hljs-title">DistanceToSeg</span><span class="hljs-params">(Coord3 P, Coord3 A, Coord3 B)</span> <span class="hljs-comment">//点到线段的距离</span></span></span><br><span class="line"><span class="hljs-function">	</span>&#123;</span><br><span class="line">		<span class="hljs-keyword">if</span> (A == B)</span><br><span class="line">			<span class="hljs-keyword">return</span> <span class="hljs-built_in">abs</span>(P - A);</span><br><span class="line">		Coord3 v1 = B - A, v2 = P - A, v3 = P - B;</span><br><span class="line">		<span class="hljs-keyword">if</span> (sgn(Dot(v1, v2)) &lt; <span class="hljs-number">0</span>)</span><br><span class="line">			<span class="hljs-keyword">return</span> <span class="hljs-built_in">abs</span>(v2);</span><br><span class="line">		<span class="hljs-keyword">if</span> (sgn(Dot(v1, v3)) &gt; <span class="hljs-number">0</span>)</span><br><span class="line">			<span class="hljs-keyword">return</span> <span class="hljs-built_in">abs</span>(v3);</span><br><span class="line">		<span class="hljs-keyword">return</span> <span class="hljs-built_in">fabs</span>(DistanceToLine(P, A, B));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">friend</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">LineDistance3D</span><span class="hljs-params">(Coord3 p1, Coord3 u, Coord3 p2, Coord3 v, lf &amp;s)</span> <span class="hljs-comment">//求异面直线 p1+s*u与p2+t*v的公垂线对应的s，如果平行|重合，返回0</span></span></span><br><span class="line"><span class="hljs-function">	</span>&#123;</span><br><span class="line">		lf b = Dot(u, u) * Dot(v, v) - Dot(u, v) * Dot(u, v);</span><br><span class="line">		<span class="hljs-keyword">if</span> (!sgn(b))</span><br><span class="line">			<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">		lf a = Dot(u, v) * Dot(v, p1 - p2) - Dot(v, v) * Dot(u, p1 - p2);</span><br><span class="line">		<span class="hljs-keyword">return</span> s = a / b, <span class="hljs-number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">friend</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">SameSide</span><span class="hljs-params">(Coord3 p1, Coord3 p2, Coord3 a, Coord3 b)</span> </span>&#123; <span class="hljs-keyword">return</span> sgn(Dot(Cross(b - a, p1 - a), Cross(b - a, p2 - a))) &gt;= <span class="hljs-number">0</span>; &#125; <span class="hljs-comment">//p1和p2是否在线段a-b的同侧</span></span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">friend</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">PointInTri</span><span class="hljs-params">(Coord3 PP, Coord3 P[<span class="hljs-number">3</span>])</span>																						 <span class="hljs-comment">//点P在三角形P0,P1,p中</span></span></span><br><span class="line"><span class="hljs-function">	</span>&#123;</span><br><span class="line">		<span class="hljs-keyword">return</span> SameSide(PP, P[<span class="hljs-number">0</span>], P[<span class="hljs-number">1</span>], P[<span class="hljs-number">2</span>]) &amp;&amp;</span><br><span class="line">			   SameSide(PP, P[<span class="hljs-number">1</span>], P[<span class="hljs-number">0</span>], P[<span class="hljs-number">2</span>]) &amp;&amp;</span><br><span class="line">			   SameSide(PP, P[<span class="hljs-number">2</span>], P[<span class="hljs-number">0</span>], P[<span class="hljs-number">1</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">friend</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">TriSegIntersection</span><span class="hljs-params">(Coord3 P[<span class="hljs-number">3</span>], Coord3 A, Coord3 B, Coord3 &amp;PP)</span> <span class="hljs-comment">//三角形P0P1p是否和线段AB相交，如有则为PP</span></span></span><br><span class="line"><span class="hljs-function">	</span>&#123;</span><br><span class="line">		Coord3 n = Cross(P[<span class="hljs-number">1</span>] - P[<span class="hljs-number">0</span>], P[<span class="hljs-number">2</span>] - P[<span class="hljs-number">0</span>]);</span><br><span class="line">		<span class="hljs-keyword">if</span> (sgn(Dot(n, B - A)) == <span class="hljs-number">0</span>)</span><br><span class="line">			<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;						 <span class="hljs-comment">//线段A-B和平面P0P1p平行或共面</span></span><br><span class="line">		lf t = Dot(n, P[<span class="hljs-number">0</span>] - A) / Dot(n, B - A); <span class="hljs-comment">//平面A和直线P1-p有惟一交点</span></span><br><span class="line">		<span class="hljs-keyword">if</span> (sgn(t) &lt; <span class="hljs-number">0</span> || sgn(t - <span class="hljs-number">1</span>) &gt; <span class="hljs-number">0</span>)</span><br><span class="line">			<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">//不在线段AB上</span></span><br><span class="line">		<span class="hljs-keyword">return</span> PointInTri(PP = A + (B - A) * t, P);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">friend</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">TriTriIntersection</span><span class="hljs-params">(Coord3 T1[<span class="hljs-number">3</span>], Coord3 T2[<span class="hljs-number">3</span>])</span> <span class="hljs-comment">//空间两三角形是否相交</span></span></span><br><span class="line"><span class="hljs-function">	</span>&#123;</span><br><span class="line">		Coord3 P;</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; ++i)</span><br><span class="line">			<span class="hljs-keyword">if</span> (TriSegIntersection(T1, T2[i], T2[(i + <span class="hljs-number">1</span>) % <span class="hljs-number">3</span>], P) ||</span><br><span class="line">				TriSegIntersection(T2, T1[i], T1[(i + <span class="hljs-number">1</span>) % <span class="hljs-number">3</span>], P))</span><br><span class="line">				<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;</span><br><span class="line">		<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">friend</span> lf <span class="hljs-title">SegSegDistance</span><span class="hljs-params">(Coord3 a1, Coord3 b1, Coord3 a2, Coord3 b2, Coord3 &amp;ans1, Coord3 &amp;ans2)</span> <span class="hljs-comment">//空间两直线上最近点对 返回最近距离 点对保存在ans1 ans2中</span></span></span><br><span class="line"><span class="hljs-function">	</span>&#123;</span><br><span class="line">		Coord3 v1 = (a1 - b1), v2 = (a2 - b2);</span><br><span class="line">		Coord3 N = Cross(v1, v2);</span><br><span class="line">		Coord3 ab = (a1 - a2);</span><br><span class="line">		lf ans = Dot(N, ab) / <span class="hljs-built_in">abs</span>(N);</span><br><span class="line">		Coord3 d1 = b1 - a1, d2 = b2 - a2, cd = Cross(d1, d2);</span><br><span class="line">		lf nd = norm(cd), t1 = Dot(Cross(a2 - a1, d2), cd) / nd, t2 = Dot(Cross(a2 - a1, d1), cd) / nd;</span><br><span class="line">		<span class="hljs-keyword">return</span> ans1 = a1 + (b1 - a1) * t1, ans2 = a2 + (b2 - a2) * t2, <span class="hljs-built_in">fabs</span>(ans);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">friend</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">InsideWithMinDistance</span><span class="hljs-params">(Coord3 PP, Coord3 *P, lf dist)</span> <span class="hljs-comment">//判断PP是否在三角形P中，并且到三条边的距离都至少为dist。保证P,A,B,C共面</span></span></span><br><span class="line"><span class="hljs-function">	</span>&#123;</span><br><span class="line">		<span class="hljs-keyword">return</span> PointInTri(PP, P) &amp;&amp;</span><br><span class="line">				   DistanceToLine(PP, P[<span class="hljs-number">0</span>], P[<span class="hljs-number">1</span>]) &gt;= dist ||</span><br><span class="line">			   DistanceToLine(PP, P[<span class="hljs-number">1</span>], P[<span class="hljs-number">2</span>]) &gt;= dist ||</span><br><span class="line">			   DistanceToLine(PP, P[<span class="hljs-number">2</span>], P[<span class="hljs-number">0</span>]) &gt;= dist;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Sphere</span></span></span><br><span class="line"><span class="hljs-class">&#123;</span></span><br><span class="line">	Coord3 o;</span><br><span class="line">	lf r;</span><br><span class="line">	<span class="hljs-function">Coord3 <span class="hljs-title">point</span><span class="hljs-params">(lf lat, lf lng)</span> <span class="hljs-keyword">const</span> <span class="hljs-comment">//经纬度确定球面上一点</span></span></span><br><span class="line"><span class="hljs-function">	</span>&#123;</span><br><span class="line">		lat *= PI / <span class="hljs-number">180</span>;</span><br><span class="line">		lng *= PI / <span class="hljs-number">180</span>;</span><br><span class="line">		<span class="hljs-keyword">return</span> o + r * Coord3&#123;<span class="hljs-built_in">cos</span>(lat) * <span class="hljs-built_in">cos</span>(lng), <span class="hljs-built_in">cos</span>(lat) * <span class="hljs-built_in">sin</span>(lng), <span class="hljs-built_in">sin</span>(lat)&#125;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ConvexPolyhedron</span> //空间多边形和凸包问题</span></span><br><span class="line"><span class="hljs-class">&#123;</span></span><br><span class="line">	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Face</span></span></span><br><span class="line"><span class="hljs-class">	&#123;</span></span><br><span class="line">		<span class="hljs-keyword">int</span> v[<span class="hljs-number">3</span>];</span><br><span class="line">		Face(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b, <span class="hljs-keyword">int</span> c) &#123; v[<span class="hljs-number">0</span>] = a, v[<span class="hljs-number">1</span>] = b, v[<span class="hljs-number">2</span>] = c; &#125;</span><br><span class="line">		<span class="hljs-function">Coord3 <span class="hljs-title">Normal</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">vector</span>&lt;Coord3&gt; &amp;P)</span> <span class="hljs-keyword">const</span> </span>&#123; <span class="hljs-keyword">return</span> Cross(P[v[<span class="hljs-number">1</span>]] - P[v[<span class="hljs-number">0</span>]], P[v[<span class="hljs-number">2</span>]] - P[v[<span class="hljs-number">0</span>]]); &#125;</span><br><span class="line">		<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">CanSee</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">vector</span>&lt;Coord3&gt; &amp;P, <span class="hljs-keyword">int</span> i)</span> <span class="hljs-keyword">const</span> </span>&#123; <span class="hljs-keyword">return</span> Dot(P[i] - P[v[<span class="hljs-number">0</span>]], Normal(P)) &gt; <span class="hljs-number">0</span>; &#125; <span class="hljs-comment">//f是否能看见P[i]</span></span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="hljs-built_in">vector</span>&lt;Face&gt; faces;</span><br><span class="line">	<span class="hljs-built_in">vector</span>&lt;Coord3&gt; p;</span><br><span class="line">	ConvexPolyhedron(<span class="hljs-built_in">vector</span>&lt;Coord3&gt; P) : p(P)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; p.size(); ++i)</span><br><span class="line">			P[i] += Coord3&#123;randEPS(), randEPS(), randEPS()&#125;;</span><br><span class="line">		<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;&gt; vis(P.size(), <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;(P.size()));</span><br><span class="line">		faces.push_back(Face(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>)); <span class="hljs-comment">//由于已经进行扰动，前三个点不共线</span></span><br><span class="line">		faces.push_back(Face(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>));</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">3</span>; i &lt; P.size(); ++i)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="hljs-built_in">vector</span>&lt;Face&gt; next;</span><br><span class="line">			<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; faces.size(); ++j) <span class="hljs-comment">//计算每条边的“左面”的可见性</span></span><br><span class="line">			&#123;</span><br><span class="line">				Face &amp;f = faces[j];</span><br><span class="line">				<span class="hljs-keyword">int</span> res = f.CanSee(P, i);</span><br><span class="line">				<span class="hljs-keyword">if</span> (!res)</span><br><span class="line">					next.push_back(f);</span><br><span class="line">				<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>; k &lt; <span class="hljs-number">3</span>; ++k)</span><br><span class="line">					vis[f.v[k]][f.v[(k + <span class="hljs-number">1</span>) % <span class="hljs-number">3</span>]] = res;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; faces.size(); ++j)</span><br><span class="line">				<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>; k &lt; <span class="hljs-number">3</span>; ++k)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="hljs-keyword">int</span> a = faces[j].v[k], b = faces[j].v[(k + <span class="hljs-number">1</span>) % <span class="hljs-number">3</span>];</span><br><span class="line">					<span class="hljs-keyword">if</span> (vis[a][b] != vis[b][a] &amp;&amp; vis[a][b]) <span class="hljs-comment">//(a,b)是分界线，左边对P[i]可见</span></span><br><span class="line">						next.push_back(Face(a, b, i));</span><br><span class="line">				&#125;</span><br><span class="line">			swap(faces, next);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-function">lf <span class="hljs-title">randEPS</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-keyword">return</span> (rand() / lf(RAND_MAX) - <span class="hljs-number">0.5</span>) * EPS; &#125;</span><br><span class="line">	<span class="hljs-function">Coord3 <span class="hljs-title">centroid</span><span class="hljs-params">()</span> <span class="hljs-comment">//三维凸包重心</span></span></span><br><span class="line"><span class="hljs-function">	</span>&#123;</span><br><span class="line">		Coord3 C = p[<span class="hljs-number">0</span>], tot&#123;<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>&#125;;</span><br><span class="line">		lf totv = <span class="hljs-number">0</span>;</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; faces.size(); ++i)</span><br><span class="line">		&#123;</span><br><span class="line">			Coord3 p1 = p[faces[i].v[<span class="hljs-number">0</span>]], p2 = p[faces[i].v[<span class="hljs-number">1</span>]], p3 = p[faces[i].v[<span class="hljs-number">2</span>]];</span><br><span class="line">			lf v = -Volume6(p1, p2, p3, C);</span><br><span class="line">			totv += v;</span><br><span class="line">			tot += v * Centroid(p1, p2, p3, C);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="hljs-keyword">return</span> tot / totv;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-function">lf <span class="hljs-title">dist</span><span class="hljs-params">(Coord3 C)</span> <span class="hljs-comment">//凸包内一点到表面最近距离</span></span></span><br><span class="line"><span class="hljs-function">	</span>&#123;</span><br><span class="line">		lf ans = INF;</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; faces.size(); ++i)</span><br><span class="line">		&#123;</span><br><span class="line">			Coord3 p1 = p[faces[i].v[<span class="hljs-number">0</span>]], p2 = p[faces[i].v[<span class="hljs-number">1</span>]], p3 = p[faces[i].v[<span class="hljs-number">2</span>]];</span><br><span class="line">			ans = min(ans, <span class="hljs-built_in">fabs</span>(-Volume6(p1, p2, p3, C) / Area2(p1, p2, p3)));</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="hljs-keyword">return</span> ans;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-02-03T10:00:01.000Z">2019-02-03</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/ACM/">ACM</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/ACM/Template/">Template</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    12 分钟 读完 (大约 1733 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/02/03/2019-02-03-高精度/">高精度</a>
            
        </h1>
        <div class="content">
            
## 无符号整数
[使用范例](https://vjudge.net/solution/16907599)

vector自带大小比较为字典序比较， `!=` 、 `==` 运算，其余需要时一定记得重载！

减法，当被减数小于减数时减为0。
undefined

## 分数
[使用示范](https://vjudge.net/solution/16733633)。
undefined

## bitset高精度
代替整型进行位运算，更方便并且可以处理超过最大整形范围大小的位集合。
你可以把bitset看作可以位运算的bool数组，换言之，bitset的大小是固定的。因此，用bitset做状态压缩是很方便的，也可以方便的实现集合的交并补操作。
bitset仅重载了相等不等和位运算符，原生不支持四则运算和大小比较，所以很少代替高精度数。
undefined


        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-02-03T10:00:00.000Z">2019-02-03</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/ACM/">ACM</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/ACM/Template/">Template</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 分钟 读完 (大约 415 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/02/03/2019-02-03-C++语言相关/">C++语言相关</a>
            
        </h1>
        <div class="content">
            <h2 id="GCC内置位运算"><a href="#GCC内置位运算" class="headerlink" title="GCC内置位运算"></a>GCC内置位运算</h2><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">int</span> __builtin_clz(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> x);      <span class="hljs-comment">//求前缀0的个数</span></span><br><span class="line"><span class="hljs-keyword">int</span> __builtin_ctz(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> x);      <span class="hljs-comment">//求后缀0的个数</span></span><br><span class="line"><span class="hljs-keyword">int</span> __builtin_ffs(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> x);      <span class="hljs-comment">//x的二进制末尾最后一个1的位置，从1开始</span></span><br><span class="line"><span class="hljs-keyword">int</span> __builtin_popcount(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> x); <span class="hljs-comment">//x二进制中1的个数，相当于bitset::count()</span></span><br><span class="line"><span class="hljs-keyword">int</span> __builtin_parity(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> x);   <span class="hljs-comment">//判断x的二进制中1的个数的奇（1）偶（0）性，这些函数都有相应的usigned long和usigned long long版本，只需要在函数名后面加上l或ll就可以了，比如__builtin_clzll</span></span><br></pre></td></tr></table></figure>

<h2 id="开栈"><a href="#开栈" class="headerlink" title="开栈"></a>开栈</h2><h3 id="For-C"><a href="#For-C" class="headerlink" title="For C++"></a>For C++</h3><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> comment(linker, <span class="hljs-meta-string">"/STACK:102400000,102400000"</span>) <span class="hljs-comment">//For C++</span></span></span><br></pre></td></tr></table></figure>

<h3 id="For-G"><a href="#For-G" class="headerlink" title="For G++"></a>For G++</h3><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> <span class="hljs-comment">//For G++</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">int</span> size = <span class="hljs-number">256</span> &lt;&lt; <span class="hljs-number">20</span>; <span class="hljs-comment">//256MB</span></span><br><span class="line">	<span class="hljs-keyword">char</span> *p = (<span class="hljs-keyword">char</span> *)<span class="hljs-built_in">malloc</span>(size) + size;</span><br><span class="line">	__asm__ __volatile__(<span class="hljs-string">"movq %0, %%rsp\n"</span> ::<span class="hljs-string">"r"</span>(p)); <span class="hljs-comment">//64bit，一定要最后写一句`exit(0);`退出程序，否则会得到非零退出的错误，可能RE。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="读入优化"><a href="#读入优化" class="headerlink" title="读入优化"></a>读入优化</h2><h3 id="C文件指针版"><a href="#C文件指针版" class="headerlink" title="C文件指针版"></a>C文件指针版</h3><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function">ll <span class="hljs-title">getll</span><span class="hljs-params">(FILE *in = <span class="hljs-built_in">stdin</span>)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	ll val = <span class="hljs-number">0</span>, sgn = <span class="hljs-number">1</span>, ch = getc(in);</span><br><span class="line">	<span class="hljs-keyword">for</span> (; !<span class="hljs-built_in">isdigit</span>(ch) &amp;&amp; ch != EOF; ch = getc(in))</span><br><span class="line">		<span class="hljs-keyword">if</span> (ch == <span class="hljs-string">'-'</span>)</span><br><span class="line">			sgn = -sgn;</span><br><span class="line">	<span class="hljs-keyword">for</span> (; <span class="hljs-built_in">isdigit</span>(ch); ch = getc(in))</span><br><span class="line">		val = val * <span class="hljs-number">10</span> + ch - <span class="hljs-string">'0'</span>;</span><br><span class="line">	<span class="hljs-keyword">return</span> ungetc(ch, in), sgn * val;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function">lf <span class="hljs-title">getlf</span><span class="hljs-params">(FILE *in = <span class="hljs-built_in">stdin</span>)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	lf val = getll(in), p = val &lt; <span class="hljs-number">0</span> ? <span class="hljs-number">-1</span> : <span class="hljs-number">1</span>;</span><br><span class="line">	ll ch = getc(in);</span><br><span class="line">	<span class="hljs-keyword">if</span> (ch == <span class="hljs-string">'.'</span>)</span><br><span class="line">		<span class="hljs-keyword">for</span> (ch = getc(in); <span class="hljs-built_in">isdigit</span>(ch); ch = getc(in))</span><br><span class="line">			val += (p /= <span class="hljs-number">10</span>) * (ch - <span class="hljs-string">'0'</span>);</span><br><span class="line">	<span class="hljs-keyword">return</span> ungetc(ch, in), val;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="仿C-IO流沙雕版"><a href="#仿C-IO流沙雕版" class="headerlink" title="仿C++IO流沙雕版"></a>仿C++IO流沙雕版</h3><p><a href="https://vjudge.net/solution/14388745" target="_blank" rel="noopener">使用前</a></p>
<p><a href="https://vjudge.net/solution/14388713" target="_blank" rel="noopener">使用后</a></p>
<figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> cin kin</span></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Istream</span></span></span><br><span class="line"><span class="hljs-class">&#123;</span></span><br><span class="line">	<span class="hljs-keyword">char</span> b[<span class="hljs-number">20</span> &lt;&lt; <span class="hljs-number">20</span>], *i, *e; <span class="hljs-comment">//20MB</span></span><br><span class="line">	Istream(FILE *in) : i(b), e(b + fread(b, <span class="hljs-keyword">sizeof</span>(*b), <span class="hljs-keyword">sizeof</span>(b) - <span class="hljs-number">1</span>, in)) &#123;&#125;</span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">eof</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span></span></span><br><span class="line"><span class="hljs-function">	</span>&#123;</span><br><span class="line">		<span class="hljs-keyword">return</span> i == e;</span><br><span class="line">	&#125;</span><br><span class="line">	Istream &amp;<span class="hljs-keyword">operator</span>&gt;&gt;(<span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> &amp;val)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">return</span> val = strtoll(i, &amp;i, <span class="hljs-number">10</span> <span class="hljs-comment">/*进制，取值2~36*/</span>), *<span class="hljs-keyword">this</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	Istream &amp;<span class="hljs-keyword">operator</span>&gt;&gt;(ll &amp;val) <span class="hljs-comment">//极限快</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">while</span> (*i &lt; <span class="hljs-string">'0'</span>)</span><br><span class="line">			++i; <span class="hljs-comment">//无符号</span></span><br><span class="line">		<span class="hljs-keyword">for</span> (val = <span class="hljs-number">0</span>; *i &gt;= <span class="hljs-string">'0'</span>; ++i)</span><br><span class="line">			val = (val &lt;&lt; <span class="hljs-number">3</span>) + (val &lt;&lt; <span class="hljs-number">1</span>) + *i - <span class="hljs-string">'0'</span>;</span><br><span class="line">		<span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	Istream &amp;<span class="hljs-keyword">operator</span>&gt;&gt;(<span class="hljs-keyword">double</span> &amp;val)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">return</span> val = strtod(i, &amp;i), *<span class="hljs-keyword">this</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	Istream &amp;<span class="hljs-keyword">operator</span>&gt;&gt;(<span class="hljs-built_in">string</span> &amp;s)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">while</span> (!eof() &amp;&amp; <span class="hljs-built_in">isspace</span>(*i))</span><br><span class="line">			++i;</span><br><span class="line">		<span class="hljs-keyword">for</span> (s.clear(); !eof() &amp;&amp; !<span class="hljs-built_in">isspace</span>(*i); ++i)</span><br><span class="line">			s += *i;</span><br><span class="line">		<span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; kin(<span class="hljs-built_in">stdin</span>);</span><br></pre></td></tr></table></figure>


        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-01-24T10:00:00.000Z">2019-01-24</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/ACM/">ACM</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/ACM/题解/">题解</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    7 分钟 读完 (大约 1050 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/01/24/2019-01-24-2018 ICPC Asia Jakarta Regional Contest/">2018 ICPC Asia Jakarta Regional Contest</a>
            
        </h1>
        <div class="content">
            
# [Edit Distance](https://vjudge.net/problem/Gym-102001A)
undefined

# [Icy Land](https://vjudge.net/problem/Gym-102001D)
undefined

# [Popping Balloons](https://vjudge.net/problem/Gym-102001F)
undefined

# [Go Make It Complete](https://vjudge.net/problem/Gym-102001G)
二分+贪心大暴力居然苟过去了…
undefined

# [Lexical Sign Sequence](https://vjudge.net/problem/Gym-102001H)
undefined

# [Lie Detector](https://vjudge.net/problem/Gym-102001I)
undefined

# [Future Generation](https://vjudge.net/problem/Gym-102001J)
undefined

# [Binary String](https://vjudge.net/problem/Gym-102001L)
undefined


        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-01-23T10:00:00.000Z">2019-01-23</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/ACM/">ACM</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/ACM/题解/">题解</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    10 分钟 读完 (大约 1535 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/01/23/2019-01-23-2017 ACM-ICPC Asia Tehran Regional Contest/">2017 ACM-ICPC Asia Tehran Regional Contest</a>
            
        </h1>
        <div class="content">
            
# [Sim Card](https://vjudge.net/problem/UVALive-8321)
undefined

# [Bank Card Verifier](https://vjudge.net/problem/UVALive-8322)
undefined

# [World Cup Draw](https://vjudge.net/problem/UVALive-8324)
undefined

# [Barareh on Fire](https://vjudge.net/problem/UVALive-8325)
undefined

# [Column Addition](https://vjudge.net/problem/UVALive-8328)
undefined

# [Cafe Bazaar](https://vjudge.net/problem/UVALive-8329)
undefined

# [Mars](https://vjudge.net/problem/UVALive-8331)
undefined


        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-01-22T10:00:00.000Z">2019-01-22</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/ACM/">ACM</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/ACM/题解/">题解</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    7 分钟 读完 (大约 1002 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/01/22/2019-01-22-2018-2019 Russia Open High School Programming Contest/">2018-2019 Russia Open High School Programming Contest</a>
            
        </h1>
        <div class="content">
            <h1 id="Company-Merging"><a href="#Company-Merging" class="headerlink" title="Company Merging"></a><a href="https://vjudge.net/problem/CodeForces-1090A" target="_blank" rel="noopener">Company Merging</a></h1><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> ll;</span><br><span class="line">ll n, ma, ans, t;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%lld"</span>, &amp;n);</span><br><span class="line">	<span class="hljs-keyword">for</span> (ll i = <span class="hljs-number">0</span>, z; i &lt; n; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%lld"</span>, &amp;z);</span><br><span class="line">		ll ma2 = <span class="hljs-number">0</span>;</span><br><span class="line">		<span class="hljs-keyword">for</span> (ll j = <span class="hljs-number">0</span>, x; j &lt; z; ++j)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%lld"</span>, &amp;x);</span><br><span class="line">			ma2 = max(ma2, x);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="hljs-keyword">if</span> (ma &lt; ma2)</span><br><span class="line">			ans += t * (ma2 - ma);</span><br><span class="line">		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ma &gt; ma2)</span><br><span class="line">			ans += z * (ma - ma2);</span><br><span class="line">		ma = max(ma, ma2);</span><br><span class="line">		t += z;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%lld"</span>, ans);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="LaTeX-Expert"><a href="#LaTeX-Expert" class="headerlink" title="LaTeX Expert"></a><a href="https://codeforces.com/problemset/problem/1090/B" target="_blank" rel="noopener">LaTeX Expert</a></h1><p>坑题，下面的引用可能会有多行。</p>
<figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line">const string BEGIN("\\begin&#123;thebibliography&#125;&#123;99&#125;"), END("\\end&#123;thebibliography&#125;");</span><br><span class="line"><span class="hljs-built_in">unordered_map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; mp;</span><br><span class="line"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">string</span>&gt; text, bibitem;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-built_in">string</span> s; <span class="hljs-built_in">cin</span> &gt;&gt; s, s != BEGIN;)</span><br><span class="line">		<span class="hljs-keyword">if</span> (s.find(<span class="hljs-string">"\\cite&#123;"</span>) != s.npos)</span><br><span class="line">		&#123;</span><br><span class="line">			s = s.substr(s.find(<span class="hljs-string">'&#123;'</span>) + <span class="hljs-number">1</span>);</span><br><span class="line">			s.erase(s.find(<span class="hljs-string">'&#125;'</span>));</span><br><span class="line">			text.push_back(s);</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-built_in">string</span> s, t, *p = &amp;t; getline(<span class="hljs-built_in">cin</span>, s), s != END;)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">if</span> (s.find(<span class="hljs-string">"\\bibitem&#123;"</span>) != s.npos)</span><br><span class="line">		&#123;</span><br><span class="line">			s = s.substr(s.find(<span class="hljs-string">'&#123;'</span>) + <span class="hljs-number">1</span>);</span><br><span class="line">			t = s.substr(s.find(<span class="hljs-string">'&#125;'</span>) + <span class="hljs-number">1</span>);</span><br><span class="line">			s.erase(s.find(<span class="hljs-string">'&#125;'</span>));</span><br><span class="line">			bibitem.push_back(s);</span><br><span class="line">			p = &amp;mp[s];</span><br><span class="line">			*p = t;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="hljs-keyword">else</span></span><br><span class="line">			*p += <span class="hljs-string">'\n'</span> + s;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-keyword">if</span> (text == bibitem)</span><br><span class="line">		<span class="hljs-keyword">return</span> <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Correct"</span>, <span class="hljs-number">0</span>;</span><br><span class="line">	<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Incorrect\n"</span></span><br><span class="line">		 &lt;&lt; BEGIN &lt;&lt; <span class="hljs-string">'\n'</span>;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; text.size(); ++i)</span><br><span class="line">		<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"\\bibitem&#123;"</span> &lt;&lt; text[i] &lt;&lt; <span class="hljs-string">"&#125;"</span> &lt;&lt; mp[text[i]] &lt;&lt; <span class="hljs-string">"\n"</span>;</span><br><span class="line">	<span class="hljs-built_in">cout</span> &lt;&lt; END;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Similar-Arrays"><a href="#Similar-Arrays" class="headerlink" title="Similar Arrays"></a><a href="https://vjudge.net/problem/CodeForces-1090D" target="_blank" rel="noopener">Similar Arrays</a></h1><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> ll;</span><br><span class="line"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">1e5</span> + <span class="hljs-number">9</span>;</span><br><span class="line"><span class="hljs-keyword">int</span> a[N], v[N * <span class="hljs-number">2</span>], nex[N * <span class="hljs-number">2</span>], g[N], d[N], tot, n, m, p[N];</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	v[++tot] = y, nex[tot] = g[x], g[x] = tot, ++d[x];</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">	<span class="hljs-keyword">if</span> (n == <span class="hljs-number">1</span> || n == <span class="hljs-number">2</span> &amp;&amp; m)</span><br><span class="line">		<span class="hljs-keyword">return</span> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"NO"</span>), <span class="hljs-number">0</span>;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>, x, y; i &lt; m; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>, &amp;x, &amp;y);</span><br><span class="line">		add(x, y);</span><br><span class="line">		add(y, x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-keyword">int</span> t1 = <span class="hljs-number">0</span>, t2 = <span class="hljs-number">0</span>;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; ++i)</span><br><span class="line">		<span class="hljs-keyword">if</span> (d[i] != n - <span class="hljs-number">1</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			t1 = i;</span><br><span class="line">			<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt;= n; ++j)</span><br><span class="line">				p[j] = <span class="hljs-number">0</span>;</span><br><span class="line">			p[i] = <span class="hljs-number">1</span>;</span><br><span class="line">			<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = g[i]; j; j = nex[j])</span><br><span class="line">				p[v[j]] = <span class="hljs-number">1</span>;</span><br><span class="line">			<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt;= n; ++j)</span><br><span class="line">				<span class="hljs-keyword">if</span> (!p[j])</span><br><span class="line">				&#123;</span><br><span class="line">					t2 = j;</span><br><span class="line">					<span class="hljs-keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			<span class="hljs-keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="hljs-keyword">if</span> (!t1)</span><br><span class="line">		<span class="hljs-keyword">return</span> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"NO\n"</span>), <span class="hljs-number">0</span>;</span><br><span class="line">	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"YES\n"</span>);</span><br><span class="line">	a[t1] = n;</span><br><span class="line">	a[t2] = n - <span class="hljs-number">1</span>;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>, t = <span class="hljs-number">0</span>; i &lt;= n; ++i)</span><br><span class="line">		<span class="hljs-keyword">if</span> (!a[i])</span><br><span class="line">			a[i] = ++t;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; ++i)</span><br><span class="line">		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d "</span>, a[i]);</span><br><span class="line">	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"\n"</span>);</span><br><span class="line">	a[t1] = n - <span class="hljs-number">1</span>;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; ++i)</span><br><span class="line">		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d "</span>, a[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Minimal-Product"><a href="#Minimal-Product" class="headerlink" title="Minimal Product"></a><a href="https://codeforces.com/problemset/problem/1090/I" target="_blank" rel="noopener">Minimal Product</a></h1><p>现场调到自闭的一题，该用<code>unsigned</code>的地方不能用<code>long long</code>代替。</p>
<figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> ll;</span><br><span class="line"><span class="hljs-keyword">const</span> ll INF = <span class="hljs-number">5e18</span>, N = <span class="hljs-number">1e7</span> + <span class="hljs-number">7</span>;</span><br><span class="line">ll l, r, a[N];</span><br><span class="line"><span class="hljs-keyword">unsigned</span> t, n, x, y, z, b[N];</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%u"</span>, &amp;t); t--;)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%u%lld%lld%u%u%u%u%u"</span>, &amp;n, &amp;l, &amp;r, &amp;x, &amp;y, &amp;z, &amp;b[<span class="hljs-number">1</span>], &amp;b[<span class="hljs-number">2</span>]);</span><br><span class="line">		ll ans = INF, mi = INF, ma = -INF;</span><br><span class="line">		<span class="hljs-keyword">for</span> (ll i = <span class="hljs-number">1</span>; i &lt;= n; ++i)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">2</span>)</span><br><span class="line">				b[i] = b[i - <span class="hljs-number">2</span>] * x + b[i - <span class="hljs-number">1</span>] * y + z;</span><br><span class="line">			a[i] = b[i] % (r - l + <span class="hljs-number">1</span>) + l;</span><br><span class="line">			<span class="hljs-keyword">if</span> (mi &lt; a[i])</span><br><span class="line">				ans = min(ans, mi * a[i]);</span><br><span class="line">			<span class="hljs-keyword">else</span></span><br><span class="line">				mi = a[i];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="hljs-keyword">for</span> (ll i = n; i; --i)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="hljs-keyword">if</span> (ma &gt; a[i])</span><br><span class="line">				ans = min(ans, ma * a[i]);</span><br><span class="line">			<span class="hljs-keyword">else</span></span><br><span class="line">				ma = a[i];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="hljs-keyword">if</span> (ans &lt; INF)</span><br><span class="line">			<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%lld\n"</span>, ans);</span><br><span class="line">		<span class="hljs-keyword">else</span></span><br><span class="line">			<span class="hljs-built_in">printf</span>(<span class="hljs-string">"IMPOSSIBLE\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Right-Expansion-Of-The-Mind"><a href="#Right-Expansion-Of-The-Mind" class="headerlink" title="Right Expansion Of The Mind"></a><a href="https://codeforces.com/problemset/problem/1090/K" target="_blank" rel="noopener">Right Expansion Of The Mind</a></h1><p>感兴趣具有传递性。两个人感兴趣，当仅当：</p>
<ul>
<li>两人的<code>t</code>串具有相同的字符集</li>
<li>对于两个人的<code>s</code>串，分别删去能够包含在<code>t</code>串字符集的最长后缀后相等。</li>
</ul>
<p>按照<code>a</code>~<code>z</code>是否出现分别对应二进制串中的每一位给<code>t</code>串的字符集编码，按这个编码给所有人分类，然后在每个分类里讨论分组情况即可。<code>map</code>套<code>map</code>套<code>vector</code>实现。疯了呀。</p>
<figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">1e6</span> + <span class="hljs-number">9</span>;</span><br><span class="line"><span class="hljs-built_in">unordered_map</span>&lt;<span class="hljs-keyword">int</span>, <span class="hljs-built_in">unordered_map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;&gt;&gt; mp;</span><br><span class="line"><span class="hljs-keyword">char</span> s[N], t[N];</span><br><span class="line"><span class="hljs-keyword">int</span> n, m, ans;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;n);</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s%s"</span>, s, t);</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = m = <span class="hljs-number">0</span>; t[i]; ++i)</span><br><span class="line">			m |= <span class="hljs-number">1</span> &lt;&lt; t[i] - <span class="hljs-string">'a'</span>;</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-built_in">strlen</span>(s) - <span class="hljs-number">1</span>; ~i; --i)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="hljs-keyword">if</span> (m &amp; <span class="hljs-number">1</span> &lt;&lt; s[i] - <span class="hljs-string">'a'</span>)</span><br><span class="line">				s[i] = <span class="hljs-number">0</span>;</span><br><span class="line">			<span class="hljs-keyword">else</span></span><br><span class="line">				<span class="hljs-keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		mp[m][s].push_back(i);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> mpi : mp)</span><br><span class="line">		ans += mpi.second.size();</span><br><span class="line">	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>, ans);</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> mpi : mp)</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> mpii : mpi.second)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d"</span>, mpii.second.size());</span><br><span class="line">			<span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> mpiii : mpii.second)</span><br><span class="line">				<span class="hljs-built_in">printf</span>(<span class="hljs-string">" %d"</span>, mpiii);</span><br><span class="line">			<span class="hljs-built_in">printf</span>(<span class="hljs-string">"\n"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Berland-University"><a href="#Berland-University" class="headerlink" title="Berland University"></a><a href="https://codeforces.com/problemset/problem/1090/L" target="_blank" rel="noopener">Berland University</a></h1><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> ll;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">check</span><span class="hljs-params">(ll x, ll t1, ll t2, ll a, ll b, ll k)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">if</span> (a &gt; x)</span><br><span class="line">		a = x;</span><br><span class="line">	<span class="hljs-keyword">if</span> (b &gt; x)</span><br><span class="line">		b = x;</span><br><span class="line">	ll tt1 = t1 * a / x + t2 * b / x, tt2 = t1 * a % x + t2 * b % x;</span><br><span class="line">	<span class="hljs-keyword">if</span> (tt2 &gt;= x)</span><br><span class="line">		tt1++;</span><br><span class="line">	<span class="hljs-keyword">return</span> tt1 &gt;= k;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	ll t, n, a, b, k;</span><br><span class="line">	<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%lld%lld%lld%lld%lld"</span>, &amp;t, &amp;n, &amp;a, &amp;b, &amp;k);</span><br><span class="line">	ll t1 = (n + <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>, t2 = n / <span class="hljs-number">2</span>, l = <span class="hljs-number">1</span>, r = t, ans = <span class="hljs-number">0</span>;</span><br><span class="line">	<span class="hljs-keyword">while</span> (l &lt;= r)</span><br><span class="line">	&#123;</span><br><span class="line">		ll mid = (l + r) &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">		<span class="hljs-keyword">if</span> (check(mid, t1, t2, a, b, k))</span><br><span class="line">		&#123;</span><br><span class="line">			ans = mid;</span><br><span class="line">			l = mid + <span class="hljs-number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="hljs-keyword">else</span></span><br><span class="line">			r = mid - <span class="hljs-number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%lld"</span>, ans);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="The-Pleasant-Walk"><a href="#The-Pleasant-Walk" class="headerlink" title="The Pleasant Walk"></a><a href="https://vjudge.net/problem/CodeForces-1090M" target="_blank" rel="noopener">The Pleasant Walk</a></h1><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">1e5</span> + <span class="hljs-number">7</span>;</span><br><span class="line"><span class="hljs-keyword">int</span> n, m, ans, a[N];</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; ++i)</span><br><span class="line">		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;a[i]);</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>, t = <span class="hljs-number">0</span>; i &lt;= n; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">if</span> (t &amp;&amp; a[i] == a[i - <span class="hljs-number">1</span>])</span><br><span class="line">			t = <span class="hljs-number">0</span>;</span><br><span class="line">		ans = max(ans, ++t);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d"</span>, ans);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-01-21T10:00:00.000Z">2019-01-21</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/ACM/">ACM</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/ACM/题解/">题解</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    13 分钟 读完 (大约 1931 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/01/21/2019-01-21-2018-2019 ICPC, NEERC, Northern Eurasia Finals/">2018-2019 ICPC, NEERC, Northern Eurasia Finals</a>
            
        </h1>
        <div class="content">
            <h1 id="Alice-the-Fan"><a href="#Alice-the-Fan" class="headerlink" title="Alice the Fan"></a><a href="https://vjudge.net/problem/CodeForces-1089A" target="_blank" rel="noopener">Alice the Fan</a></h1><p>记忆化搜索，记忆转移方向。</p>
<figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> dbg(x) cout &lt;&lt; (#x) &lt;&lt; <span class="hljs-meta-string">"="</span> &lt;&lt; x &lt;&lt; endl</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">207</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">int</span> m, a, b;</span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Node</span></span></span><br><span class="line"><span class="hljs-class">&#123;</span></span><br><span class="line">	Node()</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">this</span>-&gt;x = <span class="hljs-number">-2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	Node(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y, <span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">this</span>-&gt;x = x;</span><br><span class="line">		<span class="hljs-keyword">this</span>-&gt;y = y;</span><br><span class="line">		<span class="hljs-keyword">this</span>-&gt;a = a;</span><br><span class="line">		<span class="hljs-keyword">this</span>-&gt;b = b;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-keyword">int</span> x, y, a, b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">int</span> dp[<span class="hljs-number">6</span>][<span class="hljs-number">6</span>][N][N];</span><br><span class="line">Node last[<span class="hljs-number">6</span>][<span class="hljs-number">6</span>][N][N];</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">solve</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y, <span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">if</span> (x &lt; <span class="hljs-number">0</span> || y &lt; <span class="hljs-number">0</span> || a &lt; <span class="hljs-number">0</span> || b &lt; <span class="hljs-number">0</span>)</span><br><span class="line">		<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">	<span class="hljs-keyword">if</span> (dp[x][y][a][b] != <span class="hljs-number">-1</span>)</span><br><span class="line">		<span class="hljs-keyword">return</span> dp[x][y][a][b];</span><br><span class="line">	<span class="hljs-keyword">if</span> (!x &amp;&amp; !y)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">if</span> (!a &amp;&amp; !b)</span><br><span class="line">			<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;</span><br><span class="line">		<span class="hljs-keyword">else</span></span><br><span class="line">			<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-keyword">int</span> up;</span><br><span class="line">	<span class="hljs-keyword">if</span> (x + y == <span class="hljs-number">5</span>)</span><br><span class="line">		up = <span class="hljs-number">15</span>;</span><br><span class="line">	<span class="hljs-keyword">else</span></span><br><span class="line">		up = <span class="hljs-number">25</span>;</span><br><span class="line">	<span class="hljs-comment">//transfer1 up:j firstwin</span></span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt;= up - <span class="hljs-number">2</span>; j++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">if</span> (y == <span class="hljs-number">3</span>)</span><br><span class="line">			<span class="hljs-keyword">continue</span>;</span><br><span class="line">		<span class="hljs-keyword">if</span> (solve(x - <span class="hljs-number">1</span>, y, a - up, b - j))</span><br><span class="line">		&#123;</span><br><span class="line">			last[x][y][a][b] = Node(x - <span class="hljs-number">1</span>, y, a - up, b - j);</span><br><span class="line">			<span class="hljs-keyword">return</span> dp[x][y][a][b] = <span class="hljs-number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = up + <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">200</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">if</span> (y == <span class="hljs-number">3</span>)</span><br><span class="line">			<span class="hljs-keyword">continue</span>;</span><br><span class="line">		<span class="hljs-keyword">if</span> (solve(x - <span class="hljs-number">1</span>, y, a - i, b - (i - <span class="hljs-number">2</span>)))</span><br><span class="line">		&#123;</span><br><span class="line">			last[x][y][a][b] = Node(x - <span class="hljs-number">1</span>, y, a - i, b - (i - <span class="hljs-number">2</span>));</span><br><span class="line">			<span class="hljs-keyword">return</span> dp[x][y][a][b] = <span class="hljs-number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-comment">//transfer2 j:up secondwin</span></span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt;= up - <span class="hljs-number">2</span>; j++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">if</span> (x == <span class="hljs-number">3</span>)</span><br><span class="line">			<span class="hljs-keyword">continue</span>;</span><br><span class="line">		<span class="hljs-keyword">if</span> (solve(x, y - <span class="hljs-number">1</span>, a - j, b - up))</span><br><span class="line">		&#123;</span><br><span class="line">			last[x][y][a][b] = Node(x, y - <span class="hljs-number">1</span>, a - j, b - up);</span><br><span class="line">			<span class="hljs-keyword">return</span> dp[x][y][a][b] = <span class="hljs-number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = up + <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">200</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">if</span> (x == <span class="hljs-number">3</span>)</span><br><span class="line">			<span class="hljs-keyword">continue</span>;</span><br><span class="line">		<span class="hljs-keyword">if</span> (solve(x, y - <span class="hljs-number">1</span>, a - (i - <span class="hljs-number">2</span>), b - i))</span><br><span class="line">		&#123;</span><br><span class="line">			last[x][y][a][b] = Node(x, y - <span class="hljs-number">1</span>, a - (i - <span class="hljs-number">2</span>), b - i);</span><br><span class="line">			<span class="hljs-keyword">return</span> dp[x][y][a][b] = <span class="hljs-number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">return</span> dp[x][y][a][b] = <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">print</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y, <span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	Node t = last[x][y][a][b];</span><br><span class="line">	<span class="hljs-comment">//	dbg(t.x);</span></span><br><span class="line">	<span class="hljs-comment">//	dbg(t.y);</span></span><br><span class="line">	<span class="hljs-comment">//	dbg(t.a);</span></span><br><span class="line">	<span class="hljs-comment">//	dbg(t.b);</span></span><br><span class="line">	<span class="hljs-keyword">if</span> (t.x == <span class="hljs-number">-2</span>)</span><br><span class="line">		<span class="hljs-keyword">return</span>;</span><br><span class="line">	print(t.x, t.y, t.a, t.b);</span><br><span class="line">	<span class="hljs-built_in">cout</span> &lt;&lt; a - t.a &lt;&lt; <span class="hljs-string">':'</span> &lt;&lt; b - t.b;</span><br><span class="line">	<span class="hljs-keyword">if</span> (max(x, y) == <span class="hljs-number">3</span>)</span><br><span class="line">		<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-built_in">endl</span>;</span><br><span class="line">	<span class="hljs-keyword">else</span></span><br><span class="line">		<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">' '</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-comment">//	freopen("A.in", "r", stdin);</span></span><br><span class="line">	<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;m);</span><br><span class="line">	<span class="hljs-built_in">memset</span>(dp, <span class="hljs-number">-1</span>, <span class="hljs-keyword">sizeof</span>(dp));</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= m; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d %d"</span>, &amp;a, &amp;b);</span><br><span class="line">		<span class="hljs-keyword">if</span> (solve(<span class="hljs-number">3</span>, <span class="hljs-number">0</span>, a, b))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"3"</span> &lt;&lt; <span class="hljs-string">':'</span> &lt;&lt; <span class="hljs-string">"0"</span> &lt;&lt; <span class="hljs-built_in">endl</span>;</span><br><span class="line">			print(<span class="hljs-number">3</span>, <span class="hljs-number">0</span>, a, b);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (solve(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, a, b))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"3"</span> &lt;&lt; <span class="hljs-string">':'</span> &lt;&lt; <span class="hljs-string">"1"</span> &lt;&lt; <span class="hljs-built_in">endl</span>;</span><br><span class="line">			print(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, a, b);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (solve(<span class="hljs-number">3</span>, <span class="hljs-number">2</span>, a, b))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"3"</span></span><br><span class="line">				 &lt;&lt; <span class="hljs-string">":"</span></span><br><span class="line">				 &lt;&lt; <span class="hljs-string">"2"</span> &lt;&lt; <span class="hljs-built_in">endl</span>;</span><br><span class="line">			print(<span class="hljs-number">3</span>, <span class="hljs-number">2</span>, a, b);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (solve(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, a, b))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"2"</span></span><br><span class="line">				 &lt;&lt; <span class="hljs-string">":"</span></span><br><span class="line">				 &lt;&lt; <span class="hljs-string">"3"</span> &lt;&lt; <span class="hljs-built_in">endl</span>;</span><br><span class="line">			print(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, a, b);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (solve(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, a, b))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"1"</span> &lt;&lt; <span class="hljs-string">':'</span> &lt;&lt; <span class="hljs-string">"3"</span> &lt;&lt; <span class="hljs-built_in">endl</span>;</span><br><span class="line">			print(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, a, b);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (solve(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>, a, b))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"0"</span> &lt;&lt; <span class="hljs-string">':'</span> &lt;&lt; <span class="hljs-string">"3"</span> &lt;&lt; <span class="hljs-built_in">endl</span>;</span><br><span class="line">			print(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>, a, b);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="hljs-keyword">else</span></span><br><span class="line">			<span class="hljs-built_in">printf</span>(<span class="hljs-string">"Impossible\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Bimatching"><a href="#Bimatching" class="headerlink" title="Bimatching"></a><a href="https://codeforces.com/problemset/problem/1089/B" target="_blank" rel="noopener">Bimatching</a></h1><p>题意：每个骑士和两个女士配对，求能够形成的最大组数。</p>
<p>做的人很少的一题，但实际上是一道模板题。思路是把每个骑士拆成两个点，这样原来的“三元匹配”就变成传统的二元匹配了。但是这会带来新的问题，原来不能匹配的骑士此时也可以匹配了。解决办法是在拆的两点间连一条边，这样原来能够三元匹配的骑士匹配数一定是2，原来没有三元匹配的骑士匹配数一定是1。最后的结果是最大匹配数减去加入的边数n。插入边后不再是二分图了，变成一般图最大匹配，拉一个带花树的板子跑掉。</p>
<figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> NPOS = <span class="hljs-number">-1</span>;</span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">UnionfindSet</span> :</span> <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">	UnionfindSet(<span class="hljs-keyword">int</span> n) : <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;(n)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; ++i)</span><br><span class="line">			at(i) = i;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">ask</span><span class="hljs-params">(<span class="hljs-keyword">int</span> u)</span></span></span><br><span class="line"><span class="hljs-function">	</span>&#123;</span><br><span class="line">		<span class="hljs-keyword">return</span> at(u) != u ? at(u) = ask(at(u)) : u;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">merge</span><span class="hljs-params">(<span class="hljs-keyword">int</span> u, <span class="hljs-keyword">int</span> w)</span></span></span><br><span class="line"><span class="hljs-function">	</span>&#123;</span><br><span class="line">		<span class="hljs-keyword">if</span> (w = ask(w), u = ask(u), w != u)</span><br><span class="line">			at(w) = u;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Graph</span></span></span><br><span class="line"><span class="hljs-class">&#123;</span></span><br><span class="line">	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Vertex</span></span></span><br><span class="line"><span class="hljs-class">	&#123;</span></span><br><span class="line">		<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; o;</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="hljs-keyword">typedef</span> pair&lt;<span class="hljs-keyword">int</span>, <span class="hljs-keyword">int</span>&gt; Edge;</span><br><span class="line">	<span class="hljs-built_in">vector</span>&lt;Vertex&gt; v;</span><br><span class="line">	<span class="hljs-built_in">vector</span>&lt;Edge&gt; e;</span><br><span class="line">	Graph(<span class="hljs-keyword">int</span> n) : v(n) &#123;&#125;</span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Edge &amp;ed)</span></span></span><br><span class="line"><span class="hljs-function">	</span>&#123;</span><br><span class="line">		v[ed.first].o.push_back(e.size());</span><br><span class="line">		e.push_back(ed);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Blossom</span> :</span> Graph</span><br><span class="line">&#123;</span><br><span class="line">	<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; f;</span><br><span class="line">	Blossom(<span class="hljs-keyword">int</span> n) : Graph(n) &#123;&#125;</span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ask</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function">	</span>&#123;</span><br><span class="line">		<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; vis(v.size(), NPOS);</span><br><span class="line">		f = vis;</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> s = <span class="hljs-number">0</span>, t = <span class="hljs-number">0</span>; s &lt; v.size(); ++s)</span><br><span class="line">			<span class="hljs-keyword">if</span> (f[s] == NPOS)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; pre(v.size(), NPOS), flag(pre);</span><br><span class="line">				<span class="hljs-built_in">deque</span>&lt;<span class="hljs-keyword">int</span>&gt; q(flag[s] = <span class="hljs-number">1</span>, s);</span><br><span class="line">				<span class="hljs-keyword">for</span> (UnionfindSet ufs(v.size()); f[s] == NPOS &amp;&amp; !q.empty(); q.pop_front())</span><br><span class="line">					<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>, x = q.front(), y, a, b; i &lt; v[x].o.size(); ++i)</span><br><span class="line">						<span class="hljs-keyword">if</span> (y = e[v[x].o[i]].second, y != f[x] &amp;&amp; flag[y] &amp;&amp; ufs.ask(x) != ufs.ask(y))</span><br><span class="line">						&#123;</span><br><span class="line">							<span class="hljs-keyword">if</span> (flag[y] == <span class="hljs-number">1</span>)</span><br><span class="line">							&#123;</span><br><span class="line">								<span class="hljs-keyword">for</span> (a = x, b = y, ++t;; swap(a, b))</span><br><span class="line">									<span class="hljs-keyword">if</span> (a != NPOS)</span><br><span class="line">									&#123;</span><br><span class="line">										<span class="hljs-keyword">if</span> (vis[a = ufs.ask(a)] == t)</span><br><span class="line">											<span class="hljs-keyword">break</span>;</span><br><span class="line">										vis[a] = t, a = f[a] != NPOS ? pre[f[a]] : NPOS;</span><br><span class="line">									&#125;</span><br><span class="line">								<span class="hljs-keyword">if</span> (ufs.ask(x) != a)</span><br><span class="line">									pre[x] = y;</span><br><span class="line">								<span class="hljs-keyword">if</span> (ufs.ask(y) != a)</span><br><span class="line">									pre[y] = x;</span><br><span class="line">								<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> p[<span class="hljs-number">2</span>] = &#123;x, y&#125;, j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">2</span>; ++j)</span><br><span class="line">									<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> x = p[j], y, z; x != a; ufs.merge(y, x), ufs.merge(x = z, y))</span><br><span class="line">									&#123;</span><br><span class="line">										<span class="hljs-keyword">if</span> (ufs.ask(z = pre[y = f[x]]) != a)</span><br><span class="line">											pre[z] = y;</span><br><span class="line">										<span class="hljs-keyword">if</span> (!flag[y])</span><br><span class="line">											flag[y] = <span class="hljs-number">1</span>, q.push_back(y);</span><br><span class="line">										<span class="hljs-keyword">if</span> (!flag[z])</span><br><span class="line">											flag[z] = <span class="hljs-number">1</span>, q.push_back(z);</span><br><span class="line">									&#125;</span><br><span class="line">							&#125;</span><br><span class="line">							<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (f[y] == NPOS)</span><br><span class="line">							&#123;</span><br><span class="line">								<span class="hljs-keyword">for</span> (pre[y] = x; y != NPOS;)</span><br><span class="line">									swap(y, f[f[y] = pre[y]]);</span><br><span class="line">								<span class="hljs-keyword">break</span>;</span><br><span class="line">							&#125;</span><br><span class="line">							<span class="hljs-keyword">else</span></span><br><span class="line">								pre[y] = x, q.push_back(f[y]), flag[f[y]] = <span class="hljs-number">1</span>, flag[y] = <span class="hljs-number">0</span>;</span><br><span class="line">						&#125;</span><br><span class="line">			&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="hljs-keyword">char</span> s[<span class="hljs-number">255</span>];</span><br><span class="line"><span class="hljs-keyword">int</span> t, n, m, c;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;t); t--; <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>, c / <span class="hljs-number">2</span> - n))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">		<span class="hljs-function">Blossom <span class="hljs-title">g</span><span class="hljs-params">(m + n * <span class="hljs-number">2</span>)</span></span>;</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; ++i)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s"</span>, s);</span><br><span class="line">			<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; m; ++j)</span><br><span class="line">				<span class="hljs-keyword">if</span> (s[j] == <span class="hljs-string">'1'</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					g.add(&#123;j, m + i * <span class="hljs-number">2</span>&#125;);</span><br><span class="line">					g.add(&#123;m + i * <span class="hljs-number">2</span>, j&#125;);</span><br><span class="line">					g.add(&#123;j, m + i * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>&#125;);</span><br><span class="line">					g.add(&#123;m + i * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>, j&#125;);</span><br><span class="line">				&#125;</span><br><span class="line">			g.add(&#123;m + i * <span class="hljs-number">2</span>, m + i * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>&#125;);</span><br><span class="line">			g.add(&#123;m + i * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>, m + i * <span class="hljs-number">2</span>&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">		g.ask();</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = c = <span class="hljs-number">0</span>; i &lt; g.f.size(); ++i)</span><br><span class="line">			<span class="hljs-keyword">if</span> (g.f[i] != NPOS)</span><br><span class="line">				++c;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Easy-Chess"><a href="#Easy-Chess" class="headerlink" title="Easy Chess"></a><a href="https://codeforces.com/problemset/problem/1089/E" target="_blank" rel="noopener">Easy Chess</a></h1><p>小范围数据打表，否则指定几个关键节点。体验极差。</p>
<figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">string</span>&gt; ans&#123;</span><br><span class="line">	<span class="hljs-string">""</span>,</span><br><span class="line">	<span class="hljs-string">""</span>,</span><br><span class="line">	<span class="hljs-string">"a1 h1 h8"</span>,</span><br><span class="line">	<span class="hljs-string">"a1 h1 h2 h8"</span>,</span><br><span class="line">	<span class="hljs-string">"a1 h1 h2 h3 h8"</span>,</span><br><span class="line">	<span class="hljs-string">"a1 h1 h2 h3 h4 h8"</span>,</span><br><span class="line">	<span class="hljs-string">"a1 h1 h2 h3 h4 h5 h8"</span>,</span><br><span class="line">	<span class="hljs-string">"a1 h1 h2 h3 h4 h5 h6 h8"</span>,</span><br><span class="line">	<span class="hljs-string">"a1 h1 h2 h3 h4 h5 h6 h7 h8"</span>,</span><br><span class="line">	<span class="hljs-string">"a1 b1 h1 h2 h3 h4 h5 h6 h7 h8"</span>,</span><br><span class="line">	<span class="hljs-string">"a1 b1 c1 h1 h2 h3 h4 h5 h6 h7 h8"</span>,</span><br><span class="line">	<span class="hljs-string">"a1 b1 c1 d1 h1 h2 h3 h4 h5 h6 h7 h8"</span>,</span><br><span class="line">	<span class="hljs-string">"a1 b1 c1 d1 e1 h1 h2 h3 h4 h5 h6 h7 h8"</span>,</span><br><span class="line">	<span class="hljs-string">"a1 b1 c1 d1 e1 f1 h1 h2 h3 h4 h5 h6 h7 h8"</span>,</span><br><span class="line">	<span class="hljs-string">"a1 b1 c1 d1 e1 f1 g1 h1 h2 h3 h4 h5 h6 h7 h8"</span>,</span><br><span class="line">	<span class="hljs-string">"a1 a2 b2 b1 c1 d1 e1 f1 g1 h1 h2 h3 h4 h5 h6 h8"</span>,</span><br><span class="line">	<span class="hljs-string">"a1 a2 b2 b1 c1 d1 e1 f1 g1 h1 h2 h3 h4 h5 h6 h7 h8"</span>&#125;,</span><br><span class="line">	turn&#123;</span><br><span class="line">		<span class="hljs-string">"a1"</span>,</span><br><span class="line">		<span class="hljs-string">"h1"</span>,</span><br><span class="line">		<span class="hljs-string">"h2"</span>,</span><br><span class="line">		<span class="hljs-string">"a2"</span>,</span><br><span class="line">		<span class="hljs-string">"a3"</span>,</span><br><span class="line">		<span class="hljs-string">"h3"</span>,</span><br><span class="line">		<span class="hljs-string">"h4"</span>,</span><br><span class="line">		<span class="hljs-string">"a4"</span>,</span><br><span class="line">		<span class="hljs-string">"a5"</span>,</span><br><span class="line">		<span class="hljs-string">"h5"</span>,</span><br><span class="line">		<span class="hljs-string">"h6"</span>,</span><br><span class="line">		<span class="hljs-string">"a6"</span>,</span><br><span class="line">		<span class="hljs-string">"a8"</span>,</span><br><span class="line">		<span class="hljs-string">"g8"</span>,</span><br><span class="line">		<span class="hljs-string">"g7"</span>,</span><br><span class="line">		<span class="hljs-string">"a7"</span>,</span><br><span class="line">		<span class="hljs-string">"h7"</span>,</span><br><span class="line">		<span class="hljs-string">"h8"</span>&#125;,</span><br><span class="line">	jump&#123;</span><br><span class="line">		<span class="hljs-string">"a8"</span>,</span><br><span class="line">		<span class="hljs-string">"h7"</span>&#125;;</span><br><span class="line"><span class="hljs-keyword">int</span> n;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-built_in">cin</span> &gt;&gt; n;</span><br><span class="line">	<span class="hljs-keyword">if</span> (n &lt; ans.size())</span><br><span class="line">		<span class="hljs-keyword">return</span> <span class="hljs-built_in">cout</span> &lt;&lt; ans[n], <span class="hljs-number">0</span>;</span><br><span class="line">	<span class="hljs-keyword">int</span> need = n - <span class="hljs-number">17</span>, to = <span class="hljs-number">1</span>;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-built_in">string</span> now(<span class="hljs-string">"a1"</span>);;)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-built_in">cout</span> &lt;&lt; now &lt;&lt; <span class="hljs-string">' '</span>;</span><br><span class="line">		<span class="hljs-keyword">if</span> (now == turn[to])</span><br><span class="line">			++to;</span><br><span class="line">		<span class="hljs-keyword">if</span> (to &gt; turn.size())</span><br><span class="line">			<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">		<span class="hljs-keyword">if</span> (need == <span class="hljs-number">0</span> || turn[to] == jump[<span class="hljs-number">0</span>] || turn[to] == jump[<span class="hljs-number">1</span>])</span><br><span class="line">		&#123;</span><br><span class="line">			now = turn[to];</span><br><span class="line">			<span class="hljs-keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="hljs-keyword">if</span> (now[<span class="hljs-number">0</span>] &lt; turn[to][<span class="hljs-number">0</span>])</span><br><span class="line">			++now[<span class="hljs-number">0</span>];</span><br><span class="line">		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (now[<span class="hljs-number">0</span>] &gt; turn[to][<span class="hljs-number">0</span>])</span><br><span class="line">			--now[<span class="hljs-number">0</span>];</span><br><span class="line">		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (now[<span class="hljs-number">1</span>] &lt; turn[to][<span class="hljs-number">1</span>])</span><br><span class="line">			++now[<span class="hljs-number">1</span>];</span><br><span class="line">		<span class="hljs-keyword">else</span></span><br><span class="line">			--now[<span class="hljs-number">1</span>];</span><br><span class="line">		<span class="hljs-keyword">if</span> (now != turn[to])</span><br><span class="line">			--need;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Fractions"><a href="#Fractions" class="headerlink" title="Fractions"></a><a href="https://vjudge.net/problem/CodeForces-1089F" target="_blank" rel="noopener">Fractions</a></h1><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> ll;</span><br><span class="line">ll n, m;</span><br><span class="line"><span class="hljs-built_in">vector</span>&lt;ll&gt; v;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">gcd</span><span class="hljs-params">(ll a, ll b, ll &amp;x, ll &amp;y)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">if</span> (!b)</span><br><span class="line">	&#123;</span><br><span class="line">		x = (m - <span class="hljs-number">1</span>) / a, y = <span class="hljs-number">0</span>;</span><br><span class="line">		<span class="hljs-keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	gcd(b, a % b, x, y);</span><br><span class="line">	ll t = x;</span><br><span class="line">	x = y, y = t - a / b * y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%lld"</span>, &amp;n);</span><br><span class="line">	m = n;</span><br><span class="line">	<span class="hljs-keyword">for</span> (ll i = <span class="hljs-number">2</span>; i * i &lt;= m; ++i)</span><br><span class="line">		<span class="hljs-keyword">if</span> (n % i == <span class="hljs-number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			v.push_back(i);</span><br><span class="line">			<span class="hljs-keyword">while</span> (n % i == <span class="hljs-number">0</span>)</span><br><span class="line">				n /= i;</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="hljs-keyword">if</span> (n &gt; <span class="hljs-number">1</span>)</span><br><span class="line">		v.push_back(n);</span><br><span class="line">	<span class="hljs-keyword">if</span> (v.size() &lt; <span class="hljs-number">2</span>)</span><br><span class="line">		<span class="hljs-keyword">return</span> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"NO"</span>), <span class="hljs-number">0</span>;</span><br><span class="line">	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"YES\n2\n"</span>);</span><br><span class="line">	ll a = v[<span class="hljs-number">0</span>], b = v[v.size() - <span class="hljs-number">1</span>], x, y;</span><br><span class="line">	gcd(a, b, x, y);</span><br><span class="line">	a = m / a, b = m / b;</span><br><span class="line">	<span class="hljs-keyword">while</span> (x &lt;= <span class="hljs-number">0</span>)</span><br><span class="line">		x += a, y -= b;</span><br><span class="line">	<span class="hljs-keyword">while</span> (x &gt;= a)</span><br><span class="line">		x -= a, y += b;</span><br><span class="line">	<span class="hljs-keyword">while</span> (y &gt;= b)</span><br><span class="line">		x += a, y -= b;</span><br><span class="line">	<span class="hljs-keyword">while</span> (y &lt;= <span class="hljs-number">0</span>)</span><br><span class="line">		x -= a, y += b;</span><br><span class="line">	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%lld %lld\n%lld %lld"</span>, x, a, y, b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Guest-Student"><a href="#Guest-Student" class="headerlink" title="Guest Student"></a><a href="https://vjudge.net/problem/CodeForces-1089G" target="_blank" rel="noopener">Guest Student</a></h1><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"><span class="hljs-keyword">int</span> t, k, a[<span class="hljs-number">7</span>];</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;t); t--;)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;k);</span><br><span class="line">		<span class="hljs-keyword">int</span> sum = <span class="hljs-number">0</span>, x = <span class="hljs-number">0</span>, y = <span class="hljs-number">1e9</span>;</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">7</span>; ++i)</span><br><span class="line">			<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;a[i]), sum += a[i];</span><br><span class="line">		<span class="hljs-keyword">if</span> (k &gt; <span class="hljs-number">2</span> * sum)</span><br><span class="line">		&#123;</span><br><span class="line">			k -= sum;</span><br><span class="line">			x = k / sum * <span class="hljs-number">7</span>;</span><br><span class="line">			k %= sum;</span><br><span class="line">			k += sum;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>, j; i &lt; <span class="hljs-number">7</span>; ++i)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> s = j = <span class="hljs-number">0</span>; s &lt; k; ++j)</span><br><span class="line">				s += a[(i + j) % <span class="hljs-number">7</span>];</span><br><span class="line">			y = min(y, j);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>, x + y);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="King-Kog’s-Reception"><a href="#King-Kog’s-Reception" class="headerlink" title="King Kog’s Reception"></a><a href="https://vjudge.net/problem/CodeForces-1089K" target="_blank" rel="noopener">King Kog’s Reception</a></h1><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> ll;</span><br><span class="line"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">1e6</span> + <span class="hljs-number">7</span>;</span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SegmentTree</span></span></span><br><span class="line"><span class="hljs-class">&#123;</span></span><br><span class="line">	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Node</span></span></span><br><span class="line"><span class="hljs-class">	&#123;</span></span><br><span class="line">		ll val, sum;</span><br><span class="line">		<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">up</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Node &amp;lc, <span class="hljs-keyword">const</span> Node &amp;rc)</span></span></span><br><span class="line"><span class="hljs-function">		</span>&#123;</span><br><span class="line">			sum = lc.sum + rc.sum;</span><br><span class="line">			val = max(lc.val + rc.sum, rc.val);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; v[N * <span class="hljs-number">4</span>];</span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set</span><span class="hljs-params">(<span class="hljs-keyword">int</span> p, ll val, <span class="hljs-keyword">int</span> l = <span class="hljs-number">1</span>, <span class="hljs-keyword">int</span> r = N, <span class="hljs-keyword">int</span> rt = <span class="hljs-number">1</span>)</span></span></span><br><span class="line"><span class="hljs-function">	</span>&#123;</span><br><span class="line">		<span class="hljs-keyword">if</span> (l &gt;= r)</span><br><span class="line">		&#123;</span><br><span class="line">			v[rt].sum = val, v[rt].val = val ? l + val : <span class="hljs-number">0</span>;</span><br><span class="line">			<span class="hljs-keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="hljs-keyword">int</span> m = l + r &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">		<span class="hljs-keyword">if</span> (p &gt; m)</span><br><span class="line">			<span class="hljs-built_in">set</span>(p, val, m + <span class="hljs-number">1</span>, r, rt &lt;&lt; <span class="hljs-number">1</span> | <span class="hljs-number">1</span>);</span><br><span class="line">		<span class="hljs-keyword">else</span></span><br><span class="line">			<span class="hljs-built_in">set</span>(p, val, l, m, rt &lt;&lt; <span class="hljs-number">1</span>);</span><br><span class="line">		v[rt].up(v[rt &lt;&lt; <span class="hljs-number">1</span>], v[rt &lt;&lt; <span class="hljs-number">1</span> | <span class="hljs-number">1</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-function">Node <span class="hljs-title">ask</span><span class="hljs-params">(<span class="hljs-keyword">int</span> p, <span class="hljs-keyword">int</span> q, <span class="hljs-keyword">int</span> l = <span class="hljs-number">1</span>, <span class="hljs-keyword">int</span> r = N, <span class="hljs-keyword">int</span> rt = <span class="hljs-number">1</span>)</span></span></span><br><span class="line"><span class="hljs-function">	</span>&#123;</span><br><span class="line">		<span class="hljs-keyword">if</span> (p &lt;= l &amp;&amp; r &lt;= q)</span><br><span class="line">			<span class="hljs-keyword">return</span> v[rt];</span><br><span class="line">		<span class="hljs-keyword">int</span> m = l + r &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">		<span class="hljs-keyword">if</span> (m &gt;= q)</span><br><span class="line">			<span class="hljs-keyword">return</span> ask(p, q, l, m, rt &lt;&lt; <span class="hljs-number">1</span>);</span><br><span class="line">		<span class="hljs-keyword">if</span> (m &lt; p)</span><br><span class="line">			<span class="hljs-keyword">return</span> ask(p, q, m + <span class="hljs-number">1</span>, r, rt &lt;&lt; <span class="hljs-number">1</span> | <span class="hljs-number">1</span>);</span><br><span class="line">		<span class="hljs-keyword">return</span> v[<span class="hljs-number">0</span>].up(ask(p, q, l, m, rt &lt;&lt; <span class="hljs-number">1</span>), ask(p, q, m + <span class="hljs-number">1</span>, r, rt &lt;&lt; <span class="hljs-number">1</span> | <span class="hljs-number">1</span>)), v[<span class="hljs-number">0</span>];</span><br><span class="line">	&#125;</span><br><span class="line">&#125; t;</span><br><span class="line"><span class="hljs-keyword">char</span> s[<span class="hljs-number">9</span>];</span><br><span class="line"><span class="hljs-keyword">int</span> n, a[N];</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;n);</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>, y; i &lt;= n; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s%d"</span>, s, &amp;a[i]);</span><br><span class="line">		<span class="hljs-keyword">if</span> (s[<span class="hljs-number">0</span>] == <span class="hljs-string">'+'</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;y);</span><br><span class="line">			t.<span class="hljs-built_in">set</span>(a[i], y);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (s[<span class="hljs-number">0</span>] == <span class="hljs-string">'-'</span>)</span><br><span class="line">			t.<span class="hljs-built_in">set</span>(a[a[i]], <span class="hljs-number">0</span>);</span><br><span class="line">		<span class="hljs-keyword">else</span></span><br><span class="line">			<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%lld\n"</span>, max(t.ask(<span class="hljs-number">1</span>, a[i]).val - a[i], <span class="hljs-number">0L</span>L));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Lazyland"><a href="#Lazyland" class="headerlink" title="Lazyland"></a><a href="https://vjudge.net/problem/CodeForces-1089L" target="_blank" rel="noopener">Lazyland</a></h1><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">1e5</span> + <span class="hljs-number">9</span>;</span><br><span class="line"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> ll;</span><br><span class="line"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; ans, v[N];</span><br><span class="line"><span class="hljs-keyword">int</span> n, k, cnt, a[N], b[N];</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>, &amp;n, &amp;k);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;a[i]);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;b[i]);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        v[a[i]].push_back(b[i]);</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= k; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (v[i].empty())</span><br><span class="line">        &#123;</span><br><span class="line">            ++cnt;</span><br><span class="line">            <span class="hljs-keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        sort(v[i].begin(), v[i].end());</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; v[i].size() - <span class="hljs-number">1</span>; ++j)</span><br><span class="line">            ans.push_back(v[i][j]);</span><br><span class="line">    &#125;</span><br><span class="line">    sort(ans.begin(), ans.end());</span><br><span class="line">    ll tmp = <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; cnt; ++i)</span><br><span class="line">        tmp += ans[i];</span><br><span class="line">    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%lld"</span>, tmp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-01-20T10:00:00.000Z">2019-01-20</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/ACM/">ACM</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/ACM/题解/">题解</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    6 分钟 读完 (大约 839 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/01/20/2019-01-20-2018-2019 ICPC, NEERC, Southern Subregional Contest/">2018-2019 ICPC, NEERC, Southern Subregional Contest</a>
            
        </h1>
        <div class="content">
            <h1 id="Find-a-Number"><a href="#Find-a-Number" class="headerlink" title="Find a Number"></a><a href="https://vjudge.net/problem/CodeForces-1070A" target="_blank" rel="noopener">Find a Number</a></h1><p>BFS搜索并保存路径，维护两维数据：走到当前位置时的余数和总和。</p>
<figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">511</span>, M = <span class="hljs-number">5111</span>;</span><br><span class="line"><span class="hljs-keyword">int</span> d, s, vis[N][M], prex[N][M], prey[N][M], val[N][M];</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">print</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">if</span> (x == <span class="hljs-number">0</span> &amp;&amp; y == <span class="hljs-number">0</span>)</span><br><span class="line">		<span class="hljs-keyword">return</span>;</span><br><span class="line">	print(prex[x][y], prey[x][y]);</span><br><span class="line">	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d"</span>, val[x][y]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>, &amp;d, &amp;s);</span><br><span class="line">	val[<span class="hljs-number">0</span>][s] = <span class="hljs-number">-1</span>;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-built_in">deque</span>&lt;pair&lt;<span class="hljs-keyword">int</span>, <span class="hljs-keyword">int</span>&gt;&gt; q(vis[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>); !q.empty(); q.pop_front())</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> x = q.front().first, y = q.front().second, i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">9</span>; ++i)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="hljs-keyword">int</span> xx = (<span class="hljs-number">10</span> * x + i) % d, yy = y + i;</span><br><span class="line">			<span class="hljs-keyword">if</span> (vis[xx][yy] || yy &gt; s)</span><br><span class="line">				<span class="hljs-keyword">continue</span>;</span><br><span class="line">			vis[xx][yy] = <span class="hljs-number">1</span>;</span><br><span class="line">			val[xx][yy] = i;</span><br><span class="line">			prex[xx][yy] = x;</span><br><span class="line">			prey[xx][yy] = y;</span><br><span class="line">			q.push_back(make_pair(xx, yy));</span><br><span class="line">		&#125;</span><br><span class="line">	print(<span class="hljs-number">0</span>, s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Cloud-Computing"><a href="#Cloud-Computing" class="headerlink" title="Cloud Computing"></a><a href="https://vjudge.net/problem/CodeForces-1070C" target="_blank" rel="noopener">Cloud Computing</a></h1><p>线段树，现场被奇奇怪怪的思路搞到自闭了。</p>
<figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> ll;</span><br><span class="line"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">1e6</span> + <span class="hljs-number">9</span>;</span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Node</span></span></span><br><span class="line"><span class="hljs-class">&#123;</span></span><br><span class="line">	<span class="hljs-keyword">int</span> c, p;</span><br><span class="line">&#125; a[N];</span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Tree</span></span></span><br><span class="line"><span class="hljs-class">&#123;</span></span><br><span class="line">	ll x, size;</span><br><span class="line">&#125; t[N * <span class="hljs-number">4</span>];</span><br><span class="line"><span class="hljs-keyword">int</span> v[N], w[N], nex[N], g[N], tot;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y, <span class="hljs-keyword">int</span> z)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	v[++tot] = y;</span><br><span class="line">	w[tot] = z;</span><br><span class="line">	nex[tot] = g[x];</span><br><span class="line">	g[x] = tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ins</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> p, <span class="hljs-keyword">int</span> q)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">if</span> (l == r)</span><br><span class="line">	&#123;</span><br><span class="line">		t[x].size += q;</span><br><span class="line">		t[x].x += q * <span class="hljs-number">1l</span>l * l;</span><br><span class="line">		<span class="hljs-keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-keyword">int</span> mid = (l + r) &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">	<span class="hljs-keyword">if</span> (p &lt;= mid)</span><br><span class="line">		ins(x &lt;&lt; <span class="hljs-number">1</span>, l, mid, p, q);</span><br><span class="line">	<span class="hljs-keyword">else</span></span><br><span class="line">		ins(x &lt;&lt; <span class="hljs-number">1</span> | <span class="hljs-number">1</span>, mid + <span class="hljs-number">1</span>, r, p, q);</span><br><span class="line">	t[x].size = t[x &lt;&lt; <span class="hljs-number">1</span>].size + t[x &lt;&lt; <span class="hljs-number">1</span> | <span class="hljs-number">1</span>].size;</span><br><span class="line">	t[x].x = t[x &lt;&lt; <span class="hljs-number">1</span>].x + t[x &lt;&lt; <span class="hljs-number">1</span> | <span class="hljs-number">1</span>].x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function">ll <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> p)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">if</span> (t[x].size &lt;= p)</span><br><span class="line">		<span class="hljs-keyword">return</span> t[x].x;</span><br><span class="line">	<span class="hljs-keyword">if</span> (l == r)</span><br><span class="line">		<span class="hljs-keyword">return</span> l * <span class="hljs-number">1l</span>l * p;</span><br><span class="line">	<span class="hljs-keyword">int</span> mid = (l + r) &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">	<span class="hljs-keyword">if</span> (t[x &lt;&lt; <span class="hljs-number">1</span>].size &gt;= p)</span><br><span class="line">		<span class="hljs-keyword">return</span> get(x &lt;&lt; <span class="hljs-number">1</span>, l, mid, p);</span><br><span class="line">	<span class="hljs-keyword">else</span></span><br><span class="line">		<span class="hljs-keyword">return</span> get(x &lt;&lt; <span class="hljs-number">1</span>, l, mid, t[x &lt;&lt; <span class="hljs-number">1</span>].size) + get(x &lt;&lt; <span class="hljs-number">1</span> | <span class="hljs-number">1</span>, mid + <span class="hljs-number">1</span>, r, p - t[x &lt;&lt; <span class="hljs-number">1</span>].size);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">int</span> n, m, k;</span><br><span class="line">	<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d%d"</span>, &amp;n, &amp;m, &amp;k);</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>, x, y; i &lt;= k; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d%d%d"</span>, &amp;x, &amp;y, &amp;a[i].c, &amp;a[i].p);</span><br><span class="line">		add(x, i, <span class="hljs-number">1</span>);</span><br><span class="line">		add(y + <span class="hljs-number">1</span>, i, <span class="hljs-number">-1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	ll ans = <span class="hljs-number">0</span>, last = <span class="hljs-number">0</span>;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">bool</span> p = <span class="hljs-number">1</span>;</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = g[i]; j; j = nex[j])</span><br><span class="line">		&#123;</span><br><span class="line">			p = <span class="hljs-number">0</span>;</span><br><span class="line">			ins(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1e6</span>, a[v[j]].p, a[v[j]].c * w[j]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="hljs-keyword">if</span> (p)</span><br><span class="line">			ans += last;</span><br><span class="line">		<span class="hljs-keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			last = get(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1e6</span>, m);</span><br><span class="line">			ans += last;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%lld"</span>, ans);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Garbage-Disposal"><a href="#Garbage-Disposal" class="headerlink" title="Garbage Disposal"></a><a href="https://vjudge.net/problem/CodeForces-1070D" target="_blank" rel="noopener">Garbage Disposal</a></h1><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> ll;</span><br><span class="line">ll n, k, ans;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%lld%lld"</span>, &amp;n, &amp;k);</span><br><span class="line">	<span class="hljs-keyword">for</span> (ll i = <span class="hljs-number">0</span>, a, pre = <span class="hljs-number">0</span>; i &lt; n; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%lld"</span>, &amp;a);</span><br><span class="line">		ans += pre / k;</span><br><span class="line">		pre %= k;</span><br><span class="line">		<span class="hljs-keyword">if</span> (pre &gt; <span class="hljs-number">0</span>)</span><br><span class="line">			pre -= k, ++ans;</span><br><span class="line">		pre += a;</span><br><span class="line">		<span class="hljs-keyword">if</span> (pre &lt; <span class="hljs-number">0</span>)</span><br><span class="line">			pre = <span class="hljs-number">0</span>;</span><br><span class="line">		ans += pre / k;</span><br><span class="line">		pre %= k;</span><br><span class="line">		<span class="hljs-keyword">if</span> (i == n - <span class="hljs-number">1</span> &amp;&amp; pre &gt; <span class="hljs-number">0</span>)</span><br><span class="line">			++ans;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%lld"</span>, ans);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Debate"><a href="#Debate" class="headerlink" title="Debate"></a><a href="https://vjudge.net/problem/CodeForces-1070F" target="_blank" rel="noopener">Debate</a></h1><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">4e5</span> + <span class="hljs-number">9</span>;</span><br><span class="line"><span class="hljs-keyword">int</span> n, ans, t[<span class="hljs-number">4</span>], a[N], b[N], c[N * <span class="hljs-number">2</span>];</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;n);</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>, x, y; i &lt;= n; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>, &amp;x, &amp;y);</span><br><span class="line">		<span class="hljs-keyword">if</span> (x == <span class="hljs-number">11</span>)</span><br><span class="line">			++t[<span class="hljs-number">3</span>], ans += y;</span><br><span class="line">		<span class="hljs-keyword">if</span> (x == <span class="hljs-number">10</span>)</span><br><span class="line">			a[++t[<span class="hljs-number">2</span>]] = y;</span><br><span class="line">		<span class="hljs-keyword">if</span> (x == <span class="hljs-number">1</span>)</span><br><span class="line">			b[++t[<span class="hljs-number">1</span>]] = y;</span><br><span class="line">		<span class="hljs-keyword">if</span> (x == <span class="hljs-number">0</span>)</span><br><span class="line">			c[++t[<span class="hljs-number">0</span>]] = y;</span><br><span class="line">	&#125;</span><br><span class="line">	sort(a + <span class="hljs-number">1</span>, a + <span class="hljs-number">1</span> + t[<span class="hljs-number">2</span>], greater&lt;<span class="hljs-keyword">int</span>&gt;());</span><br><span class="line">	sort(b + <span class="hljs-number">1</span>, b + <span class="hljs-number">1</span> + t[<span class="hljs-number">1</span>], greater&lt;<span class="hljs-keyword">int</span>&gt;());</span><br><span class="line">	<span class="hljs-keyword">int</span> mi = min(t[<span class="hljs-number">2</span>], t[<span class="hljs-number">1</span>]);</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= mi; ++i)</span><br><span class="line">		ans += a[i] + b[i];</span><br><span class="line">	<span class="hljs-keyword">if</span> (t[<span class="hljs-number">2</span>] &gt; t[<span class="hljs-number">1</span>])</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = mi + <span class="hljs-number">1</span>; i &lt;= t[<span class="hljs-number">2</span>]; ++i)</span><br><span class="line">			c[++t[<span class="hljs-number">0</span>]] = a[i];</span><br><span class="line">	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (t[<span class="hljs-number">2</span>] &lt; t[<span class="hljs-number">1</span>])</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = mi + <span class="hljs-number">1</span>; i &lt;= t[<span class="hljs-number">1</span>]; ++i)</span><br><span class="line">			c[++t[<span class="hljs-number">0</span>]] = b[i];</span><br><span class="line">	sort(c + <span class="hljs-number">1</span>, c + <span class="hljs-number">1</span> + t[<span class="hljs-number">0</span>], greater&lt;<span class="hljs-keyword">int</span>&gt;());</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= t[<span class="hljs-number">3</span>]; ++i)</span><br><span class="line">		ans += c[i];</span><br><span class="line">	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d"</span>, ans);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="BerOS-File-Suggestion"><a href="#BerOS-File-Suggestion" class="headerlink" title="BerOS File Suggestion"></a><a href="https://vjudge.net/problem/CodeForces-1070H" target="_blank" rel="noopener">BerOS File Suggestion</a></h1><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"><span class="hljs-built_in">unordered_map</span>&lt;<span class="hljs-built_in">string</span>, pair&lt;<span class="hljs-keyword">int</span>, <span class="hljs-built_in">string</span>&gt;&gt; mp;</span><br><span class="line"><span class="hljs-built_in">string</span> s;</span><br><span class="line"><span class="hljs-keyword">int</span> n;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-built_in">cin</span> &gt;&gt; n; n--;)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-built_in">cin</span> &gt;&gt; s;</span><br><span class="line">		<span class="hljs-built_in">unordered_set</span>&lt;<span class="hljs-built_in">string</span>&gt; st;</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; s.size(); ++i)</span><br><span class="line">			<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = i; j &lt; s.size(); ++j)</span><br><span class="line">				st.insert(s.substr(i, j - i + <span class="hljs-number">1</span>));</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> it : st)</span><br><span class="line">		&#123;</span><br><span class="line">			pair&lt;<span class="hljs-keyword">int</span>, <span class="hljs-built_in">string</span>&gt; &amp;pis = mp[it];</span><br><span class="line">			<span class="hljs-keyword">if</span> (++mp[it].first == <span class="hljs-number">1</span>)</span><br><span class="line">				mp[it].second = s;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-built_in">cin</span> &gt;&gt; n; n--;)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-built_in">cin</span> &gt;&gt; s;</span><br><span class="line">		pair&lt;<span class="hljs-keyword">int</span>, <span class="hljs-built_in">string</span>&gt; &amp;pis = mp[s];</span><br><span class="line">		<span class="hljs-built_in">cout</span> &lt;&lt; pis.first &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; (!pis.second.empty() ? pis.second : <span class="hljs-string">"-"</span>) &lt;&lt; <span class="hljs-string">'\n'</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Video-Posts"><a href="#Video-Posts" class="headerlink" title="Video Posts"></a><a href="https://vjudge.net/problem/CodeForces-1070K" target="_blank" rel="noopener">Video Posts</a></h1><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">1e5</span> + <span class="hljs-number">9</span>;</span><br><span class="line"><span class="hljs-keyword">int</span> n, k, s, m, a[N];</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>, &amp;n, &amp;k);</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; ++i)</span><br><span class="line">		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;a[i]), s += a[i];</span><br><span class="line">	<span class="hljs-keyword">if</span> (s % k)</span><br><span class="line">		<span class="hljs-keyword">return</span> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"No"</span>), <span class="hljs-number">0</span>;</span><br><span class="line">	m = s / k;</span><br><span class="line">	<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; v;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = s = <span class="hljs-number">0</span>, pre = <span class="hljs-number">-1</span>; i &lt; n; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		s += a[i];</span><br><span class="line">		<span class="hljs-keyword">if</span> (s &gt; m)</span><br><span class="line">			<span class="hljs-keyword">return</span> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"No"</span>), <span class="hljs-number">0</span>;</span><br><span class="line">		<span class="hljs-keyword">if</span> (s == m)</span><br><span class="line">			v.push_back(i - pre), pre = i, s = <span class="hljs-number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"Yes\n"</span>);</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; v.size(); ++i)</span><br><span class="line">		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d "</span>, v[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-01-19T10:00:00.000Z">2019-01-19</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/ACM/">ACM</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/ACM/题解/">题解</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    5 分钟 读完 (大约 761 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/01/19/2019-01-19-ZOJ Monthly, January 2019/">ZOJ Monthly, January 2019</a>
            
        </h1>
        <div class="content">
            <p>只做了AEI三题，还是太菜了…</p>
<h1 id="Little-Sub-and-Pascal’s-Triangle"><a href="#Little-Sub-and-Pascal’s-Triangle" class="headerlink" title="Little Sub and Pascal’s Triangle"></a><a href="https://vjudge.net/problem/ZOJ-4081" target="_blank" rel="noopener">Little Sub and Pascal’s Triangle</a></h1><p>打表快乐找规律……发现的规律是，对于答案序列中每连续的<code>1&lt;&lt;n</code>个数，后一半序列是由前一半的序列乘二得到的。于是可以直接根据k的二进制得到答案。</p>
<figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"><span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> t, k, a;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%lld"</span>, &amp;t); t--; <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%lld\n"</span>, a))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%lld"</span>, &amp;k);</span><br><span class="line">		<span class="hljs-keyword">for</span> (k -= a = <span class="hljs-number">1</span>; k; k &gt;&gt;= <span class="hljs-number">1</span>)</span><br><span class="line">			<span class="hljs-keyword">if</span> (k &amp; <span class="hljs-number">1</span>)</span><br><span class="line">				a &lt;&lt;= <span class="hljs-number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Little-Sub-and-his-Geometry-Problem"><a href="#Little-Sub-and-his-Geometry-Problem" class="headerlink" title="Little Sub and his Geometry Problem"></a><a href="https://vjudge.net/problem/ZOJ-4082" target="_blank" rel="noopener">Little Sub and his Geometry Problem</a></h1><p>容易发现，对于某个固定的询问C，符合要求的点一定是随着X增加Y减少，于是使用X、Y方向的双指针维护答案。</p>
<figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> ll;</span><br><span class="line"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">1e5</span> + <span class="hljs-number">7</span>;</span><br><span class="line"><span class="hljs-keyword">int</span> t, n, k, q, ans;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;t); t--;)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>, &amp;n, &amp;k);</span><br><span class="line">		<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;&gt; e(n + <span class="hljs-number">1</span>);</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>, x, y; i &lt; k; ++i)</span><br><span class="line">			<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>, &amp;x, &amp;y), e[x].push_back(y);</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;q); q--; <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d%c"</span>, ans, q ? <span class="hljs-string">' '</span> : <span class="hljs-string">'\n'</span>))</span><br><span class="line">		&#123;</span><br><span class="line">			ll c, x = <span class="hljs-number">1</span>, y = n, cnt = ans = <span class="hljs-number">0</span>, sum = <span class="hljs-number">0</span>;</span><br><span class="line">			<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; cnty(n + <span class="hljs-number">1</span>), sumy(n + <span class="hljs-number">1</span>);</span><br><span class="line">			<span class="hljs-keyword">for</span> (<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%lld"</span>, &amp;c); x &lt;= n; ++x)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> u : e[x])</span><br><span class="line">					<span class="hljs-keyword">if</span> (u &lt;= y)</span><br><span class="line">						++cnt, ++cnty[u], sum += x + u, sumy[u] += x + u;</span><br><span class="line">				<span class="hljs-keyword">for</span> (; (x + y) * cnt - sum &gt; c; --y)</span><br><span class="line">					cnt -= cnty[y], sum -= sumy[y];</span><br><span class="line">				<span class="hljs-keyword">if</span> ((x + y) * cnt - sum == c)</span><br><span class="line">					++ans;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Little-Sub-and-Mr-Potato’s-Math-Problem"><a href="#Little-Sub-and-Mr-Potato’s-Math-Problem" class="headerlink" title="Little Sub and Mr.Potato’s Math Problem"></a><a href="https://vjudge.net/problem/ZOJ-4085" target="_blank" rel="noopener">Little Sub and Mr.Potato’s Math Problem</a></h1><p>十分不熟悉的数位DP，现场做了很久……以后要多多练习。</p>
<figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> ll;</span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">POW</span> :</span> <span class="hljs-built_in">vector</span>&lt;ll&gt;</span><br><span class="line">&#123;</span><br><span class="line">	POW(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> n) : <span class="hljs-built_in">vector</span>&lt;ll&gt;(n, <span class="hljs-number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; size(); ++i)</span><br><span class="line">			at(i) = at(i - <span class="hljs-number">1</span>) * x;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; POW10(<span class="hljs-number">10</span>, <span class="hljs-number">19</span>);</span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">DP</span></span></span><br><span class="line"><span class="hljs-class">&#123;</span></span><br><span class="line">	<span class="hljs-built_in">vector</span>&lt;ll&gt; f;</span><br><span class="line">	ll sum;</span><br><span class="line">	DP(<span class="hljs-keyword">const</span> <span class="hljs-built_in">vector</span>&lt;ll&gt; &amp;d) : f(d.size()), sum(<span class="hljs-number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; d.size(); ++i)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = f[i] = <span class="hljs-number">0</span>; j &lt;= i; ++j)</span><br><span class="line">				f[i] += (d[j] - (j == <span class="hljs-number">0</span>)) * POW10[i - j];</span><br><span class="line">			sum += f[i] + <span class="hljs-number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="hljs-function">ll <span class="hljs-title">cal</span><span class="hljs-params">(ll n, ll k, ll s, ll len)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">if</span> (n &gt; s * POW10[len])</span><br><span class="line">		<span class="hljs-keyword">return</span> cal(n - s * POW10[len], k, s, len + <span class="hljs-number">1</span>);</span><br><span class="line">	<span class="hljs-keyword">return</span> (n / POW10[len] + POW10[ll(<span class="hljs-built_in">log10</span>(k))]) * POW10[len] + n % POW10[len] - <span class="hljs-number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	ll t, k, m;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%lld"</span>, &amp;t); t--;)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%lld%lld"</span>, &amp;k, &amp;m);</span><br><span class="line">		<span class="hljs-built_in">vector</span>&lt;ll&gt; d;</span><br><span class="line">		<span class="hljs-keyword">for</span> (ll n = k; n; n /= <span class="hljs-number">10</span>)</span><br><span class="line">			d.push_back(n % <span class="hljs-number">10</span>);</span><br><span class="line">		reverse(d.begin(), d.end());</span><br><span class="line">		<span class="hljs-function">DP <span class="hljs-title">dp</span><span class="hljs-params">(d)</span></span>;</span><br><span class="line">		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%lld\n"</span>, m == dp.sum ? k : m &lt; dp.sum || k == *lower_bound(POW10.begin(), POW10.end(), k) ? <span class="hljs-number">0</span> : cal(m - dp.sum, k, dp.f.back(), <span class="hljs-number">1</span>));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Little-Sub-and-Isomorphism-Sequences"><a href="#Little-Sub-and-Isomorphism-Sequences" class="headerlink" title="Little Sub and Isomorphism Sequences"></a><a href="https://vjudge.net/problem/ZOJ-4089" target="_blank" rel="noopener">Little Sub and Isomorphism Sequences</a></h1><p>容易看出求最大的k就是求两个相同元素下标差的最大值，用一个set维护即可。为了求稳使用了离散化处理。</p>
<figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MP(i) make_pair(vs[i].size() &lt; 2 ? -1 : *vs[i].rbegin() - *vs[i].begin(), i)</span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">int</span> ll;</span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Ranker</span> :</span> <span class="hljs-built_in">vector</span>&lt;ll&gt;</span><br><span class="line">&#123;</span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function">	</span>&#123;</span><br><span class="line">		sort(begin(), end()), resize(unique(begin(), end()) - begin());</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">ask</span><span class="hljs-params">(ll x)</span> <span class="hljs-keyword">const</span></span></span><br><span class="line"><span class="hljs-function">	</span>&#123;</span><br><span class="line">		<span class="hljs-keyword">return</span> lower_bound(begin(), end(), x) - begin();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="hljs-function">ll <span class="hljs-title">getll</span><span class="hljs-params">(FILE *in = <span class="hljs-built_in">stdin</span>)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	ll val = <span class="hljs-number">0</span>, sgn = <span class="hljs-number">1</span>, ch = getc(in);</span><br><span class="line">	<span class="hljs-keyword">for</span> (; !<span class="hljs-built_in">isdigit</span>(ch) &amp;&amp; ch != EOF; ch = getc(in))</span><br><span class="line">		<span class="hljs-keyword">if</span> (ch == <span class="hljs-string">'-'</span>)</span><br><span class="line">			sgn = -sgn;</span><br><span class="line">	<span class="hljs-keyword">for</span> (; <span class="hljs-built_in">isdigit</span>(ch); ch = getc(in))</span><br><span class="line">		val = val * <span class="hljs-number">10</span> + ch - <span class="hljs-string">'0'</span>;</span><br><span class="line">	<span class="hljs-keyword">return</span> ungetc(ch, in), sgn * val;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">for</span> (ll t = getll(); t--;)</span><br><span class="line">	&#123;</span><br><span class="line">		ll n = getll(), m = getll();</span><br><span class="line">		Ranker input;</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; ++i)</span><br><span class="line">			input.push_back(getll());</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; m; ++i)</span><br><span class="line">		&#123;</span><br><span class="line">			input.push_back(getll());</span><br><span class="line">			<span class="hljs-keyword">if</span> (input.back() == <span class="hljs-number">1</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				input.push_back(getll());</span><br><span class="line">				input.push_back(getll());</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		Ranker::iterator it = input.begin();</span><br><span class="line">		Ranker rk(input), a;</span><br><span class="line">		rk.init();</span><br><span class="line">		<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">set</span>&lt;<span class="hljs-keyword">int</span>&gt;&gt; vs(rk.size());</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; ++i)</span><br><span class="line">		&#123;</span><br><span class="line">			a.push_back(rk.ask(*(it++)));</span><br><span class="line">			vs[a.back()].insert(i);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="hljs-built_in">set</span>&lt;pair&lt;<span class="hljs-keyword">int</span>, <span class="hljs-keyword">int</span>&gt;&gt; q;</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; vs.size(); ++i)</span><br><span class="line">			q.insert(MP(i));</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; m; ++i)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="hljs-keyword">if</span> (*(it++) == <span class="hljs-number">1</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				ll x = *(it++) - <span class="hljs-number">1</span>;</span><br><span class="line">				q.erase(MP(a[x]));</span><br><span class="line">				vs[a[x]].erase(x);</span><br><span class="line">				q.insert(MP(a[x]));</span><br><span class="line">				a[x] = rk.ask(*(it++));</span><br><span class="line">				q.erase(MP(a[x]));</span><br><span class="line">				vs[a[x]].insert(x);</span><br><span class="line">				q.insert(MP(a[x]));</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="hljs-keyword">else</span></span><br><span class="line">				<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>, q.rbegin()-&gt;first);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-12-23T03:42:49.000Z">2018-12-23</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/计算机组成原理/">计算机组成原理</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    44 分钟 读完 (大约 6642 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/12/23/2018-12-23-多周期CPU设计/">多周期CPU设计</a>
            
        </h1>
        <div class="content">
            <h1 id="实验目的"><a href="#实验目的" class="headerlink" title="实验目的"></a>实验目的</h1><ol>
<li>认识和掌握多周期数据通路图的构成、原理及其设计方法；</li>
<li>掌握多周期CPU的实现方法，代码实现方法；</li>
<li>编写一个编译器，将MIPS汇编程序编译为二进制机器码；</li>
<li>掌握多周期CPU的测试方法;</li>
<li>掌握多周期CPU的实现方法。</li>
</ol>
<h1 id="实验内容"><a href="#实验内容" class="headerlink" title="实验内容"></a>实验内容</h1><p>设计一个多周期CPU，该CPU至少能实现以下指令功能操作。需设计的指令与格式如下：</p>
<h2 id="算术运算指令"><a href="#算术运算指令" class="headerlink" title="算术运算指令"></a>算术运算指令</h2><h3 id="add-rd-rs-rt"><a href="#add-rd-rs-rt" class="headerlink" title="add rd rs rt"></a>add rd rs rt</h3><table>
<thead>
<tr>
<th>000000</th>
<th>rs(5位)</th>
<th>rt(5位)</th>
<th>rd(5位)</th>
<th>reserved</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>功能：<code>rd←rs + rt</code>；reserved为预留部分，即未用，一般填“0”。</p>
<h3 id="sub-rd-rs-rt"><a href="#sub-rd-rs-rt" class="headerlink" title="sub rd rs rt"></a>sub rd rs rt</h3><table>
<thead>
<tr>
<th>000001</th>
<th>rs(5位)</th>
<th>rt(5位)</th>
<th>rd(5位)</th>
<th>reserved</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>功能：<code>rd←rs - rt</code>。</p>
<h3 id="addiu-rt-rs-immediate"><a href="#addiu-rt-rs-immediate" class="headerlink" title="addiu rt rs immediate"></a>addiu rt rs immediate</h3><table>
<thead>
<tr>
<th>000010</th>
<th>rs(5位)</th>
<th>rt(5位)</th>
<th>immediate(16位)</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>功能：<code>rt←rs + (sign-extend)immediate</code>；immediate符号扩展再参加“加”运算。</p>
<h2 id="逻辑运算指令"><a href="#逻辑运算指令" class="headerlink" title="逻辑运算指令"></a>逻辑运算指令</h2><h3 id="and-rd-rs-rt"><a href="#and-rd-rs-rt" class="headerlink" title="and rd rs rt"></a>and rd rs rt</h3><table>
<thead>
<tr>
<th>010000</th>
<th>rs(5位)</th>
<th>rt(5位)</th>
<th>rd(5位)</th>
<th>reserved</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>功能：<code>rd←rs &amp; rt</code>；逻辑与运算。</p>
<h3 id="andi-rt-rs-immediate"><a href="#andi-rt-rs-immediate" class="headerlink" title="andi rt rs immediate"></a>andi rt rs immediate</h3><p>|010001|rs(5位)|rt(5位)|immediate(16位)|<br>|-|-|-|-|-|<br>||||||</p>
<p>功能：<code>rt←rs &amp; (zero-extend)immediate</code>；immediate做“0”扩展再参加“与”运算。</p>
<h3 id="ori-rt-rs-immediate"><a href="#ori-rt-rs-immediate" class="headerlink" title="ori rt rs immediate"></a>ori rt rs immediate</h3><table>
<thead>
<tr>
<th>010010</th>
<th>rs(5位)</th>
<th>rt(5位)</th>
<th>immediate(16位)</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>功能：<code>rt←rs | (zero-extend)immediate</code>；immediate做“0”扩展再参加“或”运算。</p>
<h3 id="xori-rd-rs-rt"><a href="#xori-rd-rs-rt" class="headerlink" title="xori rd rs rt"></a>xori rd rs rt</h3><table>
<thead>
<tr>
<th>010011</th>
<th>rs(5位)</th>
<th>rt(5位)</th>
<th>rd(5位)</th>
<th>reserved</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>功能：<code>rt←rs</code>$\oplus$<code>(zero-extend)immediate</code>；immediate做“0”扩展再参加“异或”运算。</p>
<h2 id="移位指令"><a href="#移位指令" class="headerlink" title="移位指令"></a>移位指令</h2><h3 id="sll-rd-rt-sa"><a href="#sll-rd-rt-sa" class="headerlink" title="sll rd rt sa"></a>sll rd rt sa</h3><table>
<thead>
<tr>
<th>011000</th>
<th>未用</th>
<th>rt(5位)</th>
<th>rd(5位)</th>
<th>sa(5位)</th>
<th>reserved</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>功能：<code>rd&lt;－rt&lt;&lt;(zero-extend)sa</code>，左移sa位 ，(zero-extend)sa。</p>
<h2 id="比较指令"><a href="#比较指令" class="headerlink" title="比较指令"></a>比较指令</h2><h3 id="slti-rt-rs-immediate"><a href="#slti-rt-rs-immediate" class="headerlink" title="slti rt rs immediate"></a>slti rt rs immediate</h3><table>
<thead>
<tr>
<th>100110</th>
<th>rs(5位)</th>
<th>rt(5位)</th>
<th>immediate(16位)</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>功能：<code>if (rs&lt; (sign-extend)immediate)  rt =1 else  rt=0</code>, 带符号比较，详见ALU运算功能表。</p>
<h3 id="slt-rd-rs-rt"><a href="#slt-rd-rs-rt" class="headerlink" title="slt rd rs rt"></a>slt rd rs rt</h3><table>
<thead>
<tr>
<th>100111</th>
<th>rs(5位)</th>
<th>rt(5位)</th>
<th>rd(5位)</th>
<th>sa(5位)</th>
<th>reserved</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>功能：<code>if (rs&lt;rt)  rd =1 else  rd=0</code>, 具体请看ALU运算功能表，带符号。</p>
<h2 id="存储器读-写指令"><a href="#存储器读-写指令" class="headerlink" title="存储器读/写指令"></a>存储器读/写指令</h2><h3 id="sw-rt-immediate-rs"><a href="#sw-rt-immediate-rs" class="headerlink" title="sw rt immediate(rs)"></a>sw rt immediate(rs)</h3><table>
<thead>
<tr>
<th>110000</th>
<th>rs(5位)</th>
<th>rt(5位)</th>
<th>immediate(16位)</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>功能：<code>memory[rs+ (sign-extend)immediate]←rt</code>；immediate符号扩展再相加。即将rt寄存器的内容保存到rs寄存器内容和立即数符号扩展后的数相加作为地址的内存单元中。</p>
<h3 id="lw-rt-immediate-rs"><a href="#lw-rt-immediate-rs" class="headerlink" title="lw rt immediate(rs)"></a>lw rt immediate(rs)</h3><table>
<thead>
<tr>
<th>110001</th>
<th>rs(5位)</th>
<th>rt(5位)</th>
<th>immediate(16位)</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>功能：<code>rt ← memory[rs + (sign-extend)immediate]</code>；immediate符号扩展再相加。即读取rs寄存器内容和立即数符号扩展后的数相加作为地址的内存单元中的数，然后保存到rt寄存器中。</p>
<h2 id="分支指令"><a href="#分支指令" class="headerlink" title="分支指令"></a>分支指令</h2><h3 id="beq-rs-rt-immediate"><a href="#beq-rs-rt-immediate" class="headerlink" title="beq rs rt immediate"></a>beq rs rt immediate</h3><table>
<thead>
<tr>
<th>110100</th>
<th>rs(5位)</th>
<th>rt(5位)</th>
<th>immediate(16位)</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>功能：<code>if(rs=rt) pc←pc + 4 + (sign-extend)immediate &lt;&lt;2  else pc ←pc + 4</code><br>特别说明：immediate是从PC+4地址开始和转移到的指令之间指令条数。immediate符号扩展之后左移2位再相加。为什么要左移2位？由于跳转到的指令地址肯定是4的倍数（每条指令占4个字节），最低两位是“00”，因此将immediate放进指令码中的时候，是右移了2位的，也就是以上说的“指令之间指令条数”。</p>
<h3 id="bne-rs-rt-immediate"><a href="#bne-rs-rt-immediate" class="headerlink" title="bne rs rt immediate"></a>bne rs rt immediate</h3><table>
<thead>
<tr>
<th>110101</th>
<th>rs(5位)</th>
<th>rt(5位)</th>
<th>immediate(16位)</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>功能：<code>if(rs!=rt) pc←pc + 4 + (sign-extend)immediate &lt;&lt;2  else pc ←pc + 4</code><br>特别说明：与beq不同点是，不等时转移，相等时顺序执行。</p>
<h3 id="bltz-rs-immediate"><a href="#bltz-rs-immediate" class="headerlink" title="bltz rs immediate"></a>bltz rs immediate</h3><table>
<thead>
<tr>
<th>110110</th>
<th>rs(5位)</th>
<th>00000</th>
<th>immediate(16位)</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>功能：<code>if(rs&lt;$zero) pc←pc + 4 + (sign-extend)immediate &lt;&lt;2  else pc ←pc + 4</code>。</p>
<h2 id="跳转指令"><a href="#跳转指令" class="headerlink" title="跳转指令"></a>跳转指令</h2><h3 id="j-addr"><a href="#j-addr" class="headerlink" title="j addr"></a>j addr</h3><table>
<thead>
<tr>
<th>111000</th>
<th>addr[27:2]</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>功能：<code>pc &lt;－{(pc+4)[31:28],addr[27:2],2&#39;b00}</code>，无条件跳转。<br>说明：由于MIPS32的指令代码长度占4个字节，所以指令地址二进制数最低2位均为0，将指令地址放进指令代码中时，可省掉！这样，除了最高6位操作码外，还有26位可用于存放地址，事实上，可存放28位地址，剩下最高4位由pc+4最高4位拼接上。</p>
<h3 id="jr-rs"><a href="#jr-rs" class="headerlink" title="jr rs"></a>jr rs</h3><table>
<thead>
<tr>
<th>111001</th>
<th>rs(5位)</th>
<th>未用</th>
<th>未用</th>
<th>reserved</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>功能：pc &lt;－ rs，跳转。</p>
<h2 id="调用子程序指令"><a href="#调用子程序指令" class="headerlink" title="调用子程序指令"></a>调用子程序指令</h2><h3 id="jal-addr"><a href="#jal-addr" class="headerlink" title="jal addr"></a>jal addr</h3><table>
<thead>
<tr>
<th>111010</th>
<th>addr[27:2]</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>功能：调用子程序，<code>pc &lt;－ {(pc+4)[31:28],addr[27:2],2&#39;b00}</code>；<code>$31&lt;－pc+4</code>，返回地址设置；子程序返回，需用指令 <code>jr $31</code>。跳转地址的形成同 j addr 指令。</p>
<h2 id="停机指令"><a href="#停机指令" class="headerlink" title="停机指令"></a>停机指令</h2><h3 id="halt"><a href="#halt" class="headerlink" title="halt"></a>halt</h3><table>
<thead>
<tr>
<th>111111</th>
<th>00000000000000000000000000(26位)</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>功能：停机；不改变PC的值，PC保持不变。</p>
<h1 id="实验原理"><a href="#实验原理" class="headerlink" title="实验原理"></a>实验原理</h1><p>多周期CPU指的是将整个CPU的执行过程分成几个阶段，每个阶段用一个时钟去完成，然后开始下一条指令的执行，而每种指令执行时所用的时钟数不尽相同，这就是所谓的多周期CPU。</p>
<h2 id="CPU在处理指令的几个步骤"><a href="#CPU在处理指令的几个步骤" class="headerlink" title="CPU在处理指令的几个步骤"></a>CPU在处理指令的几个步骤</h2><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">取指令IF--&gt;指令译码ID</span><br><span class="line">指令译码ID--&gt;指令执行EXE</span><br><span class="line">指令执行EXE--&gt;存储器访问MEM</span><br><span class="line">存储器访问MEM--&gt;结果写回WB</span><br><span class="line">结果写回WB--&gt;取指令IF</span><br></pre></td></tr></table></figure>

<p>图1 CPU指令处理过程</p>
<p>实验中就按照这五个阶段进行设计，这样一条指令的执行最长需要五个(小)时钟周期才能完成，但具体情况怎样？要根据该条指令的情况而定，有些指令不需要五个时钟周期的，这就是多周期的CPU。</p>
<h3 id="取指令-IF"><a href="#取指令-IF" class="headerlink" title="取指令(IF)"></a>取指令(IF)</h3><p>根据程序计数器pc中的指令地址，从存储器中取出一条指令，同时，pc根据指令字长度自动递增产生下一条指令所需要的指令地址，但遇到“地址转移”指令时，则控制器把“转移地址”送入pc，当然得到的“地址”需要做些变换才送入pc。</p>
<h3 id="指令译码-ID"><a href="#指令译码-ID" class="headerlink" title="指令译码(ID)"></a>指令译码(ID)</h3><p>对取指令操作中得到的指令进行分析并译码，确定这条指令需要完成的操作，从而产生相应的操作控制信号，用于驱动执行状态中的各种操作。</p>
<h3 id="指令执行-EXE"><a href="#指令执行-EXE" class="headerlink" title="指令执行(EXE)"></a>指令执行(EXE)</h3><p>根据指令译码得到的操作控制信号，具体地执行指令动作，然后转移到结果写回状态。</p>
<h3 id="存储器访问-MEM"><a href="#存储器访问-MEM" class="headerlink" title="存储器访问(MEM)"></a>存储器访问(MEM)</h3><p>所有需要访问存储器的操作都将在这个步骤中执行，该步骤给出存储器的数据地址，把数据写入到存储器中数据地址所指定的存储单元或者从存储器中得到数据地址单元中的数据。</p>
<h3 id="结果写回-WB"><a href="#结果写回-WB" class="headerlink" title="结果写回(WB)"></a>结果写回(WB)</h3><p>指令执行的结果或者访问存储器中得到的数据写回相应的目的寄存器中。</p>
<h2 id="MIPS指令的三种格式"><a href="#MIPS指令的三种格式" class="headerlink" title="MIPS指令的三种格式"></a>MIPS指令的三种格式</h2><table>
<thead>
<tr>
<th>缩写</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>op</td>
<td>操作码</td>
</tr>
<tr>
<td>rs</td>
<td>只读，为第1个源操作数寄存器，寄存器地址（编号）是<code>00000~11111，00~1F</code></td>
</tr>
<tr>
<td>rt</td>
<td>可读可写，为第2个源操作数寄存器，或目的操作数寄存器，寄存器地址（同上）</td>
</tr>
<tr>
<td>rd</td>
<td>只写，为目的操作数寄存器，寄存器地址（同上）</td>
</tr>
<tr>
<td>sa</td>
<td>位移量（shift amt），移位指令用于指定移多少位</td>
</tr>
<tr>
<td>funct</td>
<td>功能码，在寄存器类型指令中（R类型）用来指定指令的功能与操作码配合使用</td>
</tr>
<tr>
<td>immediate</td>
<td>16位立即数，用作无符号的逻辑操作数、有符号的算术操作数、数据加载（Laod）/数据保存（Store）指令的数据地址字节偏移量和分支指令中相对程序计数器（PC）的有符号偏移量；</td>
</tr>
<tr>
<td>address</td>
<td>地址</td>
</tr>
</tbody></table>
<h3 id="R类型"><a href="#R类型" class="headerlink" title="R类型"></a>R类型</h3><table>
<thead>
<tr>
<th>31-26</th>
<th>25-21</th>
<th>20-16</th>
<th>15-11</th>
<th>10-6</th>
<th>5-0</th>
</tr>
</thead>
<tbody><tr>
<td>op</td>
<td>rs</td>
<td>rt</td>
<td>rd</td>
<td>sa</td>
<td>func</td>
</tr>
<tr>
<td>6位</td>
<td>5位</td>
<td>5位</td>
<td>5位</td>
<td>5位</td>
<td>6位</td>
</tr>
</tbody></table>
<h3 id="I类型"><a href="#I类型" class="headerlink" title="I类型"></a>I类型</h3><table>
<thead>
<tr>
<th>31-26</th>
<th>25-21</th>
<th>20-16</th>
<th>15-0</th>
</tr>
</thead>
<tbody><tr>
<td>op</td>
<td>rs</td>
<td>rt</td>
<td>immediate</td>
</tr>
<tr>
<td>6位</td>
<td>5位</td>
<td>5位</td>
<td>16位</td>
</tr>
</tbody></table>
<h3 id="J类型："><a href="#J类型：" class="headerlink" title="J类型："></a>J类型：</h3><table>
<thead>
<tr>
<th>31-26</th>
<th>25-0</th>
</tr>
</thead>
<tbody><tr>
<td>op</td>
<td>address</td>
</tr>
<tr>
<td>6位</td>
<td>26位</td>
</tr>
</tbody></table>
<h2 id="多周期CPU状态转移图"><a href="#多周期CPU状态转移图" class="headerlink" title="多周期CPU状态转移图"></a>多周期CPU状态转移图</h2><p><img src="https://img-blog.csdnimg.cn/20181214161420902.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dfd2VpbGFu,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>状态的转移有的是无条件的，例如从sIF状态转移到sID就是无条件的；有些是有条件的，例如sEXE状态之后不止一个状态，到底转向哪个状态由该指令功能，即指令操作码决定。每个状态代表一个时钟周期。</p>
<h2 id="多周期CPU控制部件的原理结构图"><a href="#多周期CPU控制部件的原理结构图" class="headerlink" title="多周期CPU控制部件的原理结构图"></a>多周期CPU控制部件的原理结构图</h2><p><img src="https://img-blog.csdnimg.cn/20181214161554539.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dfd2VpbGFu,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="多周期CPU数据通路和控制线路图"><a href="#多周期CPU数据通路和控制线路图" class="headerlink" title="多周期CPU数据通路和控制线路图"></a>多周期CPU数据通路和控制线路图</h2><p><img src="https://img-blog.csdnimg.cn/20181214161735346.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dfd2VpbGFu,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>上图是一个简单的基本上能够在多周期CPU上完成所要求设计的指令功能的数据通路和必要的控制线路图。其中指令和数据各存储在不同存储器中，即有指令存储器和数据存储器。访问存储器时，先给出内存地址，然后由读或写信号控制操作。对于寄存器组，给出寄存器地址（编号），读操作时不需要时钟信号，输出端就直接输出相应数据；而在写操作时，在 WE使能信号为1时，在时钟边沿触发将数据写入寄存器。图中控制信号功能如表1所示，表2是ALU运算功能表。</p>
<p>特别提示，图上增加IR指令寄存器，目的是使指令代码保持稳定，pc写使能控制信号PCWre，是确保pc适时修改，原因都是和多周期工作的CPU有关。ADR、BDR、ALUoutDR、DBDR四个寄存器不需要写使能信号，其作用是切分数据通路，将大组合逻辑切分为若干个小组合逻辑，大延迟变为多个分段小延迟。</p>
<p>指令执行的结果总是在时钟下降沿保存到寄存器和存储器中，PC的改变是在时钟上升沿进行的，这样稳定性较好。另外，值得注意的问题，设计时，用模块化的思想方法设计，关于ALU设计、存储器设计、寄存器组设计等等，也是必须认真考虑的问题。</p>
<p>其中指令和数据各存储在不同存储器中，即有指令存储器和数据存储器。访问存储器时，先给出内存地址，然后由读或写信号控制操作。对于寄存器组，先给出寄存器地址，读操作时不需要时钟信号，输出端就直接输出相应数据；而在写操作时，在 WE使能信号为1时，在时钟边沿触发将数据写入寄存器。</p>
<h2 id="控制信号的作用表"><a href="#控制信号的作用表" class="headerlink" title="控制信号的作用表"></a>控制信号的作用表</h2><p>以上数据通路图是根据要实现的指令功能的要求画出来的，同时，还必须确定ALU的运算功能(当然，以上指令没有完全用到提供的ALU所有功能，但至少必须能实现以上指令功能操作)。从数据通路图上可以看出控制单元部分需要产生各种控制信号，当然，也有些信号必须要传送给控制单元。从指令功能要求和数据通路图的关系得出以上表1，这样，从表1可以看出各控制信号与相应指令之间的相互关系，根据这种关系就可以得出控制信号与指令之间的关系（见下面表中的“相关指令”），从而写出各控制信号的逻辑表达式，这样控制单元部分就可实现了。</p>
<table>
<thead>
<tr>
<th>控制信号名</th>
<th>状态“0”</th>
<th>状态“1”</th>
</tr>
</thead>
<tbody><tr>
<td>RST</td>
<td>对于PC，初始化PC为程序首地址</td>
<td>对于PC，PC接收下一条指令地址</td>
</tr>
<tr>
<td>PCWre</td>
<td>PC不更改，相关指令：halt，另外，除‘000’状态之外，其余状态慎改PC的值。</td>
<td>PC更改，相关指令：除指令halt外，另外，在‘000’状态时，修改PC的值合适。</td>
</tr>
<tr>
<td>ALUSrcA</td>
<td>来自寄存器堆data1输出，相关指令：add、sub、addiu、and、andi、ori、xori、slt、slti、sw、lw、beq、bne、bltz</td>
<td>来自移位数sa，同时，进行(zero-extend)sa，即<code>{ {27{1&#39;b0},sa}</code>，相关指令：sll</td>
</tr>
<tr>
<td>ALUSrcB</td>
<td>来自寄存器堆data2输出，相关指令：add、sub、and、slt、beq、bne、bltz</td>
<td>来自sign或zero扩展的立即数，相关指令：addiu、andi、ori、xori、slti、lw、sw、sll</td>
</tr>
<tr>
<td>DBDataSrc</td>
<td>来自ALU运算结果的输出，相关指令：add、sub、addiu、and、andi、ori、xori、sll、slt、slti</td>
<td>来自数据存储器（Data MEM）的输出，相关指令：lw</td>
</tr>
<tr>
<td>RegWre</td>
<td>无无写寄存器组寄存器，相关指令：beq、bne、bltz、j、sw、jr、halt</td>
<td>寄存器组寄存器写使能，相关指令：add、sub、addiu、and、andi、ori、xori、sll、slt、slti、lw、jal</td>
</tr>
<tr>
<td>WrRegDSrc</td>
<td>写入寄存器组寄存器的数据来自pc+4(pc4），相关指令：jal，写<code>$31</code></td>
<td>写入寄存器组寄存器的数据来自ALU运算结果或存储器读出的数据，相关指令：add、addiu、sub、and、andi、ori、xori、sll、slt、slti、lw</td>
</tr>
<tr>
<td>InsMemRW</td>
<td>写指令存储器</td>
<td>读指令存储器(Ins. Data)</td>
</tr>
<tr>
<td>mRD</td>
<td>输出高阻态</td>
<td>读数据存储器，相关指令：lw</td>
</tr>
<tr>
<td>mWR</td>
<td>无操作</td>
<td>写数据存储器，相关指令：sw</td>
</tr>
<tr>
<td>IRWre</td>
<td>IR(指令寄存器)不更改</td>
<td>IR寄存器写使能。向指令存储器发出读指令代码后，这个信号也接着发出，在时钟上升沿，IR接收从指令存储器送来的指令代码。与每条指令都相关。</td>
</tr>
</tbody></table>
<h3 id="ALUOp的功能表"><a href="#ALUOp的功能表" class="headerlink" title="ALUOp的功能表"></a>ALUOp的功能表</h3><table>
<thead>
<tr>
<th>ALUOp[2..0]</th>
<th>功能</th>
<th>描述</th>
<th>相关指令</th>
</tr>
</thead>
<tbody><tr>
<td>000</td>
<td>Y=A+B</td>
<td>加</td>
<td>add、addiu、sw、lw</td>
</tr>
<tr>
<td>001</td>
<td>Y=A–B</td>
<td>减</td>
<td>sub、beq、bne、bltz</td>
</tr>
<tr>
<td>010</td>
<td>Y=B&lt;&lt;A</td>
<td>B左移A位</td>
<td>sll</td>
</tr>
<tr>
<td>011</td>
<td>Y=A∨B</td>
<td>或</td>
<td>ori</td>
</tr>
<tr>
<td>100</td>
<td>Y=A∧B</td>
<td>与</td>
<td>andi、and</td>
</tr>
<tr>
<td>101</td>
<td>Y=A&lt;B</td>
<td>不带符号比较A&lt;B</td>
<td></td>
</tr>
<tr>
<td>110</td>
<td>Y=A[31]!=B[31]?A[31]&gt;B[31]:A&lt;B</td>
<td>带符号比较A&lt;B</td>
<td>slti、slt</td>
</tr>
<tr>
<td>111</td>
<td>Y=A^B</td>
<td>异或</td>
<td>xori</td>
</tr>
</tbody></table>
<h3 id="ExtSel的功能表"><a href="#ExtSel的功能表" class="headerlink" title="ExtSel的功能表"></a>ExtSel的功能表</h3><table>
<thead>
<tr>
<th>ExtSel[1..0]</th>
<th>功能</th>
<th>相关指令</th>
</tr>
</thead>
<tbody><tr>
<td>00</td>
<td>(zero-extend)sa</td>
<td>sll</td>
</tr>
<tr>
<td>01</td>
<td>(zero-extend)immediate</td>
<td>andi、xori、ori</td>
</tr>
<tr>
<td>10</td>
<td>(sign-extend)immediate</td>
<td>addiu、slti、lw、sw、beq、bne、bltz</td>
</tr>
<tr>
<td>11</td>
<td>未用</td>
<td></td>
</tr>
</tbody></table>
<h3 id="PCSrc的功能表"><a href="#PCSrc的功能表" class="headerlink" title="PCSrc的功能表"></a>PCSrc的功能表</h3><p>|PCSrc[1..0]|功能|相关指令|<br>|-|-|-|-|<br>|00|pc&lt;－pc+4|add、addiu、sub、and、andi、ori、xori、slt、slti、sll、sw、lw、beq(zero=0)、bne(zero=1)、bltz(sign=0)|<br>|01|pc&lt;－pc+4+(sign-extend)immediate ×4|beq(zero=1)、    bne(zero=0)、bltz(sign=1)|<br>|10|pc&lt;－rs|jr|<br>|11|pc&lt;－{pc[31:28],addr[27:2],2’b00}|j、jal|</p>
<h3 id="RegDs的功能表"><a href="#RegDs的功能表" class="headerlink" title="RegDs的功能表"></a>RegDs的功能表</h3><p>|RegDs[1..0]|写寄存器组寄存器的地址|相关指令|<br>|-|-|-|-|<br>|00|0x1F(<code>$31</code>)|jal（用于保存返回地址<code>$31&lt;-pc+4</code>）|<br>|01|rt|addiu、andi、ori、xori、slti、lw|<br>|10|rd|add、sub、and、slt、sll|<br>|11|未用|</p>
<h2 id="相关部件及引脚说明："><a href="#相关部件及引脚说明：" class="headerlink" title="相关部件及引脚说明："></a>相关部件及引脚说明：</h2><h3 id="Instruction-Memory"><a href="#Instruction-Memory" class="headerlink" title="Instruction Memory"></a>Instruction Memory</h3><p>指令存储器。</p>
<table>
<thead>
<tr>
<th>Iaddr</th>
<th>指令存储器地址输入端口</th>
</tr>
</thead>
<tbody><tr>
<td>IDataIn</td>
<td>指令存储器数据输入端口（指令代码输入端口）</td>
</tr>
<tr>
<td>IDataOut</td>
<td>指令存储器数据输出端口（指令代码输出端口）</td>
</tr>
<tr>
<td>RW</td>
<td>指令存储器读写控制信号，为0写，为1读</td>
</tr>
</tbody></table>
<h3 id="Data-Memory"><a href="#Data-Memory" class="headerlink" title="Data Memory"></a>Data Memory</h3><p>数据存储器。</p>
<table>
<thead>
<tr>
<th>Daddr</th>
<th>数据存储器地址输入端口</th>
</tr>
</thead>
<tbody><tr>
<td>DataIn</td>
<td>数据存储器数据输入端口</td>
</tr>
<tr>
<td>DataOut</td>
<td>数据存储器数据输出端口</td>
</tr>
<tr>
<td>RD</td>
<td>数据存储器读控制信号，为0读</td>
</tr>
<tr>
<td>WR</td>
<td>数据存储器写控制信号，为0写</td>
</tr>
</tbody></table>
<h3 id="Register-File"><a href="#Register-File" class="headerlink" title="Register File"></a>Register File</h3><p>寄存器组。</p>
<table>
<thead>
<tr>
<th>Read Reg1</th>
<th>rs寄存器地址输入端口</th>
</tr>
</thead>
<tbody><tr>
<td>Read Reg2</td>
<td>rt寄存器地址输入端口</td>
</tr>
<tr>
<td>Write Reg</td>
<td>将数据写入的寄存器端口，其地址来源rt或rd字段</td>
</tr>
<tr>
<td>Write Data</td>
<td>写入寄存器的数据输入端口</td>
</tr>
<tr>
<td>Read Data1</td>
<td>rs寄存器数据输出端口</td>
</tr>
<tr>
<td>Read Data2</td>
<td>rt寄存器数据输出端口</td>
</tr>
<tr>
<td>WE</td>
<td>写使能信号，为1时，在时钟边沿触发写入</td>
</tr>
</tbody></table>
<h3 id="IR"><a href="#IR" class="headerlink" title="IR"></a>IR</h3><p>指令寄存器，用于存放正在执行的指令代码。由于RW模块所需要的寄存器IR太多，因此合在了一起。</p>
<h3 id="ALU：算术逻辑单元"><a href="#ALU：算术逻辑单元" class="headerlink" title="ALU：算术逻辑单元"></a>ALU：算术逻辑单元</h3><table>
<thead>
<tr>
<th>result</th>
<th>ALU运算结果</th>
</tr>
</thead>
<tbody><tr>
<td>zero</td>
<td>运算结果标志，结果为0，则zero=1；否则zero=0</td>
</tr>
<tr>
<td>sign</td>
<td>运算结果标志，结果最高位为0，则sign=0，正数；否则，sign=1，负数</td>
</tr>
</tbody></table>
<h1 id="实验器材"><a href="#实验器材" class="headerlink" title="实验器材"></a>实验器材</h1><p>电脑一台，Xilinx Vivado 2017.4 软件一套，Basys3实验板一块。</p>
<h1 id="实验过程与结果"><a href="#实验过程与结果" class="headerlink" title="实验过程与结果"></a>实验过程与结果</h1><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><h3 id="MultipleCPU-v"><a href="#MultipleCPU-v" class="headerlink" title="MultipleCPU.v"></a>MultipleCPU.v</h3><p>多周期CPU的顶层连接文件，主要是调用下层模块并将它们输入输出连在一起。</p>
<figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">`<span class="hljs-meta-keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="hljs-keyword">module</span> MultipleCPU(</span><br><span class="line">	<span class="hljs-keyword">input</span> CLK,</span><br><span class="line">	<span class="hljs-keyword">input</span> Reset,</span><br><span class="line">	<span class="hljs-keyword">output</span> [<span class="hljs-number">5</span>:<span class="hljs-number">0</span>] op,</span><br><span class="line">	<span class="hljs-keyword">output</span> [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] rs,</span><br><span class="line">	<span class="hljs-keyword">output</span> [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] rt,</span><br><span class="line">	<span class="hljs-keyword">output</span> [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] rd,</span><br><span class="line">	<span class="hljs-keyword">output</span> [<span class="hljs-number">15</span>:<span class="hljs-number">0</span>] immediate,</span><br><span class="line">	<span class="hljs-keyword">output</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] ReadData1,</span><br><span class="line">	<span class="hljs-keyword">output</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] ReadData2,</span><br><span class="line">	<span class="hljs-keyword">output</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] WriteData,</span><br><span class="line">	<span class="hljs-keyword">output</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] DataOut,</span><br><span class="line">	<span class="hljs-keyword">output</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] currentAddress,</span><br><span class="line">	<span class="hljs-keyword">output</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] newAddress,</span><br><span class="line">	<span class="hljs-keyword">output</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] result,</span><br><span class="line">	<span class="hljs-keyword">output</span> PCWre</span><br><span class="line">);</span><br><span class="line">	<span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] A,B;</span><br><span class="line">	<span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] currentAddress_4, extendImmediate, currentAddress_immediate, outAddress, ALUM2DR;</span><br><span class="line">	<span class="hljs-keyword">wire</span> [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] WriteReg;</span><br><span class="line">	<span class="hljs-keyword">wire</span> [<span class="hljs-number">25</span>:<span class="hljs-number">0</span>] address;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">wire</span> zero,sign, ALUSrcA,ALUSrcB, ALUM2Reg, RegWre, WrRegData, InsMemRW, DataMemRW, IRWre;</span><br><span class="line">	<span class="hljs-keyword">wire</span> [<span class="hljs-number">1</span>:<span class="hljs-number">0</span>] ExtSel, PCSrc, RegOut;</span><br><span class="line">	<span class="hljs-keyword">wire</span> [<span class="hljs-number">2</span>:<span class="hljs-number">0</span>] ALUOp;</span><br><span class="line">	<span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] RegReadData1, RegReadData2, RegResult, RegDataOut;</span><br><span class="line"></span><br><span class="line">	ControlUnit cu(CLK, Reset, op, zero,sign,PCWre, ALUSrcA, ALUSrcB, ALUM2Reg,</span><br><span class="line">		RegWre, WrRegData, InsMemRW, DataMemRW, IRWre, ExtSel, PCSrc, RegOut, ALUOp);</span><br><span class="line"></span><br><span class="line">	PC pc(CLK, Reset, PCWre, newAddress, currentAddress);</span><br><span class="line"></span><br><span class="line">	InstructionMemory im(InsMemRW, currentAddress, CLK, IRWre, op, rs, rt, rd, immediate, address);</span><br><span class="line"></span><br><span class="line">	RegisterFile rf(CLK, RegWre, rs, rt, WriteReg, WriteData, ReadData1, ReadData2);</span><br><span class="line"></span><br><span class="line">	ALU alu(ALUOp, A, B, zero, result,sign);</span><br><span class="line"></span><br><span class="line">	SignZeroExtend sze(ExtSel, immediate, extendImmediate);</span><br><span class="line"></span><br><span class="line">	DataMemory dm(DataMemRW, RegResult, RegReadData2, DataOut);</span><br><span class="line"></span><br><span class="line">	PCjump pcj(currentAddress, address, outAddress);</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">assign</span> currentAddress_4 = currentAddress + <span class="hljs-number">4</span>;</span><br><span class="line">	<span class="hljs-keyword">assign</span> currentAddress_immediate = currentAddress_4 + (extendImmediate &lt;&lt; <span class="hljs-number">2</span>);</span><br><span class="line"></span><br><span class="line">	<span class="hljs-comment">//线转寄存器</span></span><br><span class="line">	WireToReg wtrA(CLK, <span class="hljs-number">1</span>, ReadData1, RegReadData1);</span><br><span class="line">	WireToReg wtrB(CLK, <span class="hljs-number">1</span>, ReadData2, RegReadData2);</span><br><span class="line">	WireToReg wtrALU(CLK, <span class="hljs-number">1</span>, result, RegResult);</span><br><span class="line">	WireToReg wtrMEM(CLK, <span class="hljs-number">1</span>, DataOut, RegDataOut);</span><br><span class="line"></span><br><span class="line">	<span class="hljs-comment">//2路选择器</span></span><br><span class="line">	MUX2L_32 mux2_1(WrRegData, currentAddress_4, ALUM2DR, WriteData);</span><br><span class="line">	MUX2L_32 mux2_4(ALUSrcA, RegReadData1, RegReadData2, A);</span><br><span class="line">	MUX2L_32 mux2_2(ALUSrcB, RegReadData2, extendImmediate, B);</span><br><span class="line">	MUX2L_32 mux2_3(ALUM2Reg, result, RegDataOut, ALUM2DR);</span><br><span class="line"></span><br><span class="line">	<span class="hljs-comment">//4路选择器</span></span><br><span class="line">	MUX4L_5 mux4_1(RegOut, <span class="hljs-number">5'b11111</span>, rt, rd, <span class="hljs-number">5'b00000</span>, WriteReg);</span><br><span class="line">	MUX4L_32 mux4_2(PCSrc, currentAddress_4, currentAddress_immediate,</span><br><span class="line">		ReadData1, outAddress, newAddress);</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="ControlUnit-v"><a href="#ControlUnit-v" class="headerlink" title="ControlUnit.v"></a>ControlUnit.v</h3><p>控制信号模块，通过解析op得到该指令的各种控制信号。定义了很多用到的常量，可读性还是比较高的。<br>控制单元通过输入的zero零标志位与当前指令中对应的指令部分来确定当前整个CPU程序中各模块的工作和协作情况，根据CPU运行逻辑，事先对整个CPU中控制信号的控制，以此来达到指挥各个模块协同工作的目的。</p>
<figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">`<span class="hljs-meta-keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="hljs-keyword">module</span> ControlUnit(</span><br><span class="line">	<span class="hljs-keyword">input</span> CLK,	<span class="hljs-comment">//时钟</span></span><br><span class="line">	<span class="hljs-keyword">input</span> reset,	<span class="hljs-comment">//重置信号</span></span><br><span class="line">	<span class="hljs-keyword">input</span> [<span class="hljs-number">5</span>:<span class="hljs-number">0</span>] op,	<span class="hljs-comment">//op操作符</span></span><br><span class="line">	<span class="hljs-keyword">input</span> zero,	<span class="hljs-comment">//ALU的zero输出</span></span><br><span class="line">	<span class="hljs-keyword">input</span> sign,</span><br><span class="line">	<span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span> PCWre,	<span class="hljs-comment">//(PC)PC是否更改，如果为0，PC不更改，另外，除D_Tri == 000状态之外，其余状态也不能改变PC的值。</span></span><br><span class="line">	<span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span> ALUSrcA,</span><br><span class="line">	<span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span> ALUSrcB,</span><br><span class="line">	<span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span> ALUM2Reg,</span><br><span class="line">	<span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span> RegWre,	<span class="hljs-comment">//(RF)写使能信号，为1时，在时钟上升沿写入</span></span><br><span class="line">	<span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span> WrRegData,	<span class="hljs-comment">//2路选择器，判断数据写入是否为PC指令，如果为1，则不是，jar用到</span></span><br><span class="line">	<span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span> InsMemRW,	<span class="hljs-comment">//(IM)读写控制信号，1为写，0位读，固定为0</span></span><br><span class="line">	<span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span> DataMemRW,	<span class="hljs-comment">//(DM)数据存储器读写控制信号，为1写，为0读</span></span><br><span class="line">	<span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span> IRWre,	<span class="hljs-comment">//寄存器写使能，暂时没什么用，固定为1</span></span><br><span class="line">	<span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span>[<span class="hljs-number">1</span>:<span class="hljs-number">0</span>] ExtSel,	<span class="hljs-comment">//(EXT)控制补位，如果为1，进行符号扩展，如果为0，全补0</span></span><br><span class="line">	<span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span>[<span class="hljs-number">1</span>:<span class="hljs-number">0</span>] PCSrc,	<span class="hljs-comment">//4路选择器，选择PC指令来源</span></span><br><span class="line">	<span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span>[<span class="hljs-number">1</span>:<span class="hljs-number">0</span>] RegOut,	<span class="hljs-comment">//4路选择器，判断写寄存器地址的来源</span></span><br><span class="line">	<span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span>[<span class="hljs-number">2</span>:<span class="hljs-number">0</span>] ALUOp	<span class="hljs-comment">//(ALU)ALU操作控制</span></span><br><span class="line">);</span><br><span class="line">	<span class="hljs-keyword">parameter</span>[<span class="hljs-number">2</span>:<span class="hljs-number">0</span>]</span><br><span class="line">		<span class="hljs-number">_</span>ADD=	<span class="hljs-number">3'b000</span>,</span><br><span class="line">		<span class="hljs-number">_</span>SUB=	<span class="hljs-number">3'b001</span>,</span><br><span class="line">		<span class="hljs-number">_</span>SLL=	<span class="hljs-number">3'b010</span>,</span><br><span class="line">		<span class="hljs-number">_</span>OR=	<span class="hljs-number">3'b011</span>,</span><br><span class="line">		<span class="hljs-number">_</span>AND=	<span class="hljs-number">3'b100</span>,</span><br><span class="line">		<span class="hljs-number">_</span>SLTU=	<span class="hljs-number">3'b101</span>,</span><br><span class="line">		<span class="hljs-number">_</span>SLT=	<span class="hljs-number">3'b110</span>,</span><br><span class="line">		<span class="hljs-number">_</span>XOR=	<span class="hljs-number">3'b111</span>,</span><br><span class="line">		IF=	<span class="hljs-number">3'b000</span>,	<span class="hljs-comment">//3位D触发器，代表8个状态</span></span><br><span class="line">		ID=	<span class="hljs-number">3'b001</span>,</span><br><span class="line">		EXELS=	<span class="hljs-number">3'b010</span>,</span><br><span class="line">		MEM=	<span class="hljs-number">3'b011</span>,</span><br><span class="line">		WBL=	<span class="hljs-number">3'b100</span>,</span><br><span class="line">		EXEBR=	<span class="hljs-number">3'b101</span>,</span><br><span class="line">		EXEAL=	<span class="hljs-number">3'b110</span>,</span><br><span class="line">		WBAL=	<span class="hljs-number">3'b111</span>;</span><br><span class="line">	<span class="hljs-keyword">parameter</span>[<span class="hljs-number">5</span>:<span class="hljs-number">0</span>]</span><br><span class="line">		ADD=	<span class="hljs-number">6'b000000</span>,</span><br><span class="line">		SUB=	<span class="hljs-number">6'b000001</span>,</span><br><span class="line">		ADDIU=	<span class="hljs-number">6'b000010</span>,</span><br><span class="line">		AND=	<span class="hljs-number">6'b010000</span>,</span><br><span class="line">		ANDI=	<span class="hljs-number">6'b010001</span>,</span><br><span class="line">		ORI=	<span class="hljs-number">6'b010010</span>,</span><br><span class="line">		XORI=	<span class="hljs-number">6'b010011</span>,</span><br><span class="line">		SLL=	<span class="hljs-number">6'b011000</span>,</span><br><span class="line">		SLTI=	<span class="hljs-number">6'b100110</span>,</span><br><span class="line">		SLT=	<span class="hljs-number">6'b100111</span>,</span><br><span class="line">		SW=	<span class="hljs-number">6'b110000</span>,</span><br><span class="line">		LW=	<span class="hljs-number">6'b110001</span>,</span><br><span class="line">		BEQ=	<span class="hljs-number">6'b110100</span>,</span><br><span class="line">		BNE=	<span class="hljs-number">6'b110101</span>,</span><br><span class="line">		BLTZ=	<span class="hljs-number">6'b110110</span>,</span><br><span class="line">		J=	<span class="hljs-number">6'b111000</span>,</span><br><span class="line">		JR=	<span class="hljs-number">6'b111001</span>,</span><br><span class="line">		JAL=	<span class="hljs-number">6'b111010</span>,</span><br><span class="line">		HALT=	<span class="hljs-number">6'b111111</span>;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">reg</span>[<span class="hljs-number">2</span>:<span class="hljs-number">0</span>] D_Tri;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">initial</span> <span class="hljs-keyword">begin</span></span><br><span class="line">		PCWre=<span class="hljs-number">0</span>;</span><br><span class="line">		ALUSrcB=<span class="hljs-number">0</span>;</span><br><span class="line">		ALUM2Reg=<span class="hljs-number">0</span>;</span><br><span class="line">		RegWre=<span class="hljs-number">0</span>;</span><br><span class="line">		WrRegData=<span class="hljs-number">0</span>;</span><br><span class="line">		<span class="hljs-comment">//no change</span></span><br><span class="line">		InsMemRW=<span class="hljs-number">0</span>;</span><br><span class="line">		DataMemRW=<span class="hljs-number">0</span>;</span><br><span class="line">		<span class="hljs-comment">//no change</span></span><br><span class="line">		IRWre=<span class="hljs-number">1</span>;</span><br><span class="line">		ExtSel=<span class="hljs-number">0</span>;</span><br><span class="line">		PCSrc=<span class="hljs-number">0</span>;</span><br><span class="line">		RegOut=<span class="hljs-number">0</span>;</span><br><span class="line">		ALUOp=<span class="hljs-number">0</span>;</span><br><span class="line">		D_Tri=<span class="hljs-number">0</span>;</span><br><span class="line">	<span class="hljs-keyword">end</span></span><br><span class="line"></span><br><span class="line">	<span class="hljs-comment">//D触发器变化，PS：为了避免竞争冒险，所有值变化改为下降沿触发</span></span><br><span class="line">	<span class="hljs-comment">//PCWre，RegWre和DataMemRW的变化影响很大，要在这里写</span></span><br><span class="line">	<span class="hljs-keyword">always</span>@(<span class="hljs-keyword">negedge</span> CLK <span class="hljs-keyword">or</span> <span class="hljs-keyword">posedge</span> reset)<span class="hljs-keyword">begin</span></span><br><span class="line">		<span class="hljs-keyword">if</span>(reset)<span class="hljs-keyword">begin</span><span class="hljs-comment">//重置属性</span></span><br><span class="line">			D_Tri=IF;</span><br><span class="line">			PCWre=<span class="hljs-number">0</span>;</span><br><span class="line">			RegWre=<span class="hljs-number">0</span>;</span><br><span class="line">		 <span class="hljs-keyword">end</span></span><br><span class="line">		<span class="hljs-keyword">else</span> <span class="hljs-keyword">begin</span></span><br><span class="line">			<span class="hljs-keyword">case</span> (D_Tri)</span><br><span class="line">				<span class="hljs-comment">//IF -&gt; ID</span></span><br><span class="line">				IF: <span class="hljs-keyword">begin</span></span><br><span class="line">					D_Tri &lt;= ID;</span><br><span class="line">					<span class="hljs-comment">//禁止写指令，寄存器，和内存</span></span><br><span class="line">					PCWre=<span class="hljs-number">0</span>;</span><br><span class="line">					RegWre=<span class="hljs-number">0</span>;</span><br><span class="line">					DataMemRW=<span class="hljs-number">0</span>;</span><br><span class="line">				<span class="hljs-keyword">end</span></span><br><span class="line">				<span class="hljs-comment">//ID -&gt; EXE</span></span><br><span class="line">				ID:<span class="hljs-keyword">begin</span></span><br><span class="line">					<span class="hljs-keyword">case</span> (op)</span><br><span class="line">						<span class="hljs-comment">//如果是BEQ指令，跳到EXEBR</span></span><br><span class="line">						BEQ, BNE, BLTZ:  D_Tri &lt;= EXEBR;</span><br><span class="line">						<span class="hljs-comment">//如果是SW，LW指令，跳到EXELS</span></span><br><span class="line">						SW, LW:  D_Tri &lt;= EXELS;</span><br><span class="line">						<span class="hljs-comment">//如果是j，JAL，JR，HALT，跳到IF</span></span><br><span class="line">						J, JAL, JR, HALT:<span class="hljs-keyword">begin</span></span><br><span class="line">						   D_Tri=IF;</span><br><span class="line">							<span class="hljs-comment">//如果指令是HALT，禁止写指令</span></span><br><span class="line">							<span class="hljs-keyword">if</span> (op == HALT)  PCWre=<span class="hljs-number">0</span>;</span><br><span class="line">							<span class="hljs-keyword">else</span>  PCWre=<span class="hljs-number">1</span>;</span><br><span class="line">							<span class="hljs-comment">//如果指令是JAL，允许写寄存器</span></span><br><span class="line">							<span class="hljs-keyword">if</span> (op == JAL)  RegWre=<span class="hljs-number">1</span>;</span><br><span class="line">							<span class="hljs-keyword">else</span>  RegWre=<span class="hljs-number">0</span>;</span><br><span class="line">						<span class="hljs-keyword">end</span></span><br><span class="line">						<span class="hljs-comment">//其他，跳到EXEAL</span></span><br><span class="line">						<span class="hljs-keyword">default</span>:  D_Tri=EXEAL;</span><br><span class="line">					<span class="hljs-keyword">endcase</span></span><br><span class="line">				 <span class="hljs-keyword">end</span></span><br><span class="line">				<span class="hljs-comment">//EXEAL -&gt; WBAL</span></span><br><span class="line">				EXEAL:<span class="hljs-keyword">begin</span></span><br><span class="line">					D_Tri=WBAL;</span><br><span class="line">					<span class="hljs-comment">//允许写寄存器</span></span><br><span class="line">					RegWre=<span class="hljs-number">1</span>;</span><br><span class="line">				<span class="hljs-keyword">end</span></span><br><span class="line">				<span class="hljs-comment">//EXELS -&gt; MEM</span></span><br><span class="line">				EXELS:<span class="hljs-keyword">begin</span></span><br><span class="line">					D_Tri=MEM;</span><br><span class="line">					<span class="hljs-comment">//如果指令为SW，允许写内存</span></span><br><span class="line">					<span class="hljs-keyword">if</span> (op == SW)  DataMemRW=<span class="hljs-number">1</span>;</span><br><span class="line">				<span class="hljs-keyword">end</span></span><br><span class="line">				<span class="hljs-comment">//MEM -&gt; WBL</span></span><br><span class="line">				MEM:<span class="hljs-keyword">begin</span></span><br><span class="line">					<span class="hljs-comment">//如果指令为SW，MEM -&gt; IF</span></span><br><span class="line">					<span class="hljs-keyword">if</span> (op == SW)<span class="hljs-keyword">begin</span></span><br><span class="line">						D_Tri=IF;</span><br><span class="line">						<span class="hljs-comment">//允许写指令</span></span><br><span class="line">						PCWre=<span class="hljs-number">1</span>;</span><br><span class="line">					<span class="hljs-keyword">end</span></span><br><span class="line">					<span class="hljs-comment">//如果指令为LW，MEM -&gt; WBL</span></span><br><span class="line">					<span class="hljs-keyword">else</span> <span class="hljs-keyword">begin</span></span><br><span class="line">						D_Tri=WBL;</span><br><span class="line">						<span class="hljs-comment">//允许写寄存器</span></span><br><span class="line">						RegWre=<span class="hljs-number">1</span>;</span><br><span class="line">					<span class="hljs-keyword">end</span></span><br><span class="line">				<span class="hljs-keyword">end</span></span><br><span class="line">				<span class="hljs-comment">//其他 -&gt; IF</span></span><br><span class="line">				<span class="hljs-keyword">default</span>:<span class="hljs-keyword">begin</span></span><br><span class="line">					D_Tri=IF;</span><br><span class="line">					<span class="hljs-comment">//允许写指令</span></span><br><span class="line">					PCWre=<span class="hljs-number">1</span>;</span><br><span class="line">					<span class="hljs-comment">//禁止写寄存器</span></span><br><span class="line">					RegWre=<span class="hljs-number">0</span>;</span><br><span class="line">				<span class="hljs-keyword">end</span></span><br><span class="line">			<span class="hljs-keyword">endcase</span></span><br><span class="line">		<span class="hljs-keyword">end</span></span><br><span class="line">	<span class="hljs-keyword">end</span></span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">always</span>@(op <span class="hljs-keyword">or</span> zero)<span class="hljs-keyword">begin</span><span class="hljs-comment">//一般信号</span></span><br><span class="line">		ALUSrcA=	op==SLL;</span><br><span class="line">		ALUSrcB=	op==ADDIU||op==ANDI||op==ORI||op==XORI||op==SLTI||op==LW||op==SW||op==SLL;</span><br><span class="line">		ALUM2Reg=	op==LW;</span><br><span class="line">		WrRegData=	op!=JAL;	<span class="hljs-comment">//2路选择器，判断数据写入是否为PC指令，如果为1，则不是，jar用到</span></span><br><span class="line">		InsMemRW=	<span class="hljs-number">0</span>;<span class="hljs-comment">//(IM)读写控制信号，1为写，0位读，固定为0</span></span><br><span class="line">		IRWre=	<span class="hljs-number">1</span>;   <span class="hljs-comment">//寄存器写使能，暂时没什么用，固定为1</span></span><br><span class="line">		ExtSel=	op==SLL?<span class="hljs-number">2'b00</span>:op==ANDI||op==XORI||op==ORI?<span class="hljs-number">2'b01</span>:<span class="hljs-number">2'b10</span>; <span class="hljs-comment">//(EXT)控制补位，如果为1，进行符号扩展，如果为0，全补0</span></span><br><span class="line">		PCSrc=	op==J||op==JAL?<span class="hljs-number">2'b11</span>:</span><br><span class="line">				op==JR?<span class="hljs-number">2'b10</span>:</span><br><span class="line">				(op==BEQ&amp;&amp;zero==<span class="hljs-number">1</span>)||(op==BNE&amp;&amp;zero==<span class="hljs-number">0</span>)||(op==BLTZ&amp;&amp;sign==<span class="hljs-number">1</span>)?<span class="hljs-number">2'b01</span>:</span><br><span class="line">				<span class="hljs-number">2'b00</span>;  <span class="hljs-comment">//4路选择器，选择PC指令来源</span></span><br><span class="line">		RegOut=	op==JAL?<span class="hljs-number">2'b00</span>:</span><br><span class="line">				op==ADD||op==SUB||op==AND||op==SLT||op==SLL?<span class="hljs-number">2'b10</span>:</span><br><span class="line">				<span class="hljs-number">2'b01</span>; <span class="hljs-comment">//4路选择器，判断写寄存器地址的来源</span></span><br><span class="line">		ALUOp=	op==SUB||op==BEQ||op==BNE||op==BLTZ?<span class="hljs-number">_</span>SUB:</span><br><span class="line">				op==SLL?<span class="hljs-number">_</span>SLL:</span><br><span class="line">				op==ORI?<span class="hljs-number">_</span>OR:</span><br><span class="line">				op==ANDI||op==AND?<span class="hljs-number">_</span>AND:</span><br><span class="line">				op==SLT||op==SLTI?<span class="hljs-number">_</span>SLT:</span><br><span class="line">				op==XORI?<span class="hljs-number">_</span>XOR:<span class="hljs-number">_</span>ADD;	<span class="hljs-comment">//(ALU)ALU操作控制</span></span><br><span class="line">	 <span class="hljs-keyword">end</span></span><br><span class="line"><span class="hljs-keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="ALU-v"><a href="#ALU-v" class="headerlink" title="ALU.v"></a>ALU.v</h3><p>该部分为算术逻辑单元，用于逻辑指令计算和跳转指令比较。ALUOp用于控制算数的类型，A、B为输入数，result为运算结果，zero、sign主要用于beq、bne、bltz等指令的判断。<br>ALU算术逻辑单元的功能是根据控制信号从输入的数据中选取对应的操作数，根据操作码进行运算并输出结果与零标志位。</p>
<figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">`<span class="hljs-meta-keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="hljs-keyword">module</span> ALU(</span><br><span class="line">	<span class="hljs-keyword">input</span>[<span class="hljs-number">2</span>:<span class="hljs-number">0</span>] ALUOp,</span><br><span class="line">	<span class="hljs-keyword">input</span>[<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] A,</span><br><span class="line">	<span class="hljs-keyword">input</span>[<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] B,</span><br><span class="line">	<span class="hljs-keyword">output</span> zero,</span><br><span class="line">	<span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span>[<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] result,</span><br><span class="line">	<span class="hljs-keyword">output</span> sign</span><br><span class="line">);</span><br><span class="line">	<span class="hljs-keyword">parameter</span> <span class="hljs-number">_</span>ADD=	<span class="hljs-number">3'b000</span>;</span><br><span class="line">	<span class="hljs-keyword">parameter</span> <span class="hljs-number">_</span>SUB=	<span class="hljs-number">3'b001</span>;</span><br><span class="line">	<span class="hljs-keyword">parameter</span> <span class="hljs-number">_</span>SLL=	<span class="hljs-number">3'b010</span>;</span><br><span class="line">	<span class="hljs-keyword">parameter</span> <span class="hljs-number">_</span>OR=	<span class="hljs-number">3'b011</span>;</span><br><span class="line">	<span class="hljs-keyword">parameter</span> <span class="hljs-number">_</span>AND=	<span class="hljs-number">3'b100</span>;</span><br><span class="line">	<span class="hljs-keyword">parameter</span> <span class="hljs-number">_</span>SLTU=	<span class="hljs-number">3'b101</span>;</span><br><span class="line">	<span class="hljs-keyword">parameter</span> <span class="hljs-number">_</span>SLT=	<span class="hljs-number">3'b110</span>;</span><br><span class="line">	<span class="hljs-keyword">parameter</span> <span class="hljs-number">_</span>XOR=	<span class="hljs-number">3'b111</span>;</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">assign</span> zero=	result==<span class="hljs-number">0</span>;</span><br><span class="line">	<span class="hljs-keyword">assign</span> sign=	result[<span class="hljs-number">31</span>];</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">always</span>@(*)<span class="hljs-keyword">begin</span></span><br><span class="line">		<span class="hljs-keyword">case</span>(ALUOp)</span><br><span class="line">		<span class="hljs-number">_</span>ADD:	result=	A+B;</span><br><span class="line">		<span class="hljs-number">_</span>SUB:	result=	A-B;</span><br><span class="line">		<span class="hljs-number">_</span>SLL:	result=	A&lt;&lt;B;</span><br><span class="line">		<span class="hljs-number">_</span>OR:	result=	A|B;</span><br><span class="line">		<span class="hljs-number">_</span>AND:	result=	A&amp;B;</span><br><span class="line">		<span class="hljs-number">_</span>SLTU:	result=	A&lt;B;</span><br><span class="line">		<span class="hljs-number">_</span>SLT:	result=	A[<span class="hljs-number">31</span>]!=B[<span class="hljs-number">31</span>]?A[<span class="hljs-number">31</span>]&gt;B[<span class="hljs-number">31</span>]:A&lt;B;</span><br><span class="line">		<span class="hljs-number">_</span>XOR:	result=	A^B;</span><br><span class="line">		<span class="hljs-keyword">default</span>:	result=	<span class="hljs-number">0</span>;</span><br><span class="line">		<span class="hljs-keyword">endcase</span></span><br><span class="line">	<span class="hljs-keyword">end</span></span><br><span class="line"><span class="hljs-keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="DataMemory-v"><a href="#DataMemory-v" class="headerlink" title="DataMemory.v"></a>DataMemory.v</h3><p>该部分控制内存存储，用于内存存储、读写。用256大小的8位寄存器数组模拟内存，采用小端模式。DataMenRW控制内存读写。由于指令为真实地址，所以不需要<code>&lt;&lt;2</code>。</p>
<figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">`<span class="hljs-meta-keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="hljs-keyword">module</span> DataMemory(</span><br><span class="line">	<span class="hljs-keyword">input</span> DataMemRW,</span><br><span class="line">	<span class="hljs-keyword">input</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] DAddr,</span><br><span class="line">	<span class="hljs-keyword">input</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] DataIn,</span><br><span class="line">	<span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] DataOut</span><br><span class="line">);</span><br><span class="line">	<span class="hljs-keyword">reg</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] memory[<span class="hljs-number">0</span>:<span class="hljs-number">255</span>];</span><br><span class="line">	<span class="hljs-keyword">integer</span> i;</span><br><span class="line">	<span class="hljs-keyword">initial</span>  <span class="hljs-keyword">begin</span></span><br><span class="line">		<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; i = i + <span class="hljs-number">1</span>)memory[i] &lt;= <span class="hljs-number">0</span>;</span><br><span class="line">		<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i = i + <span class="hljs-number">1</span>)DataOut[i] &lt;= <span class="hljs-number">0</span>;</span><br><span class="line">	<span class="hljs-keyword">end</span></span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">always</span>@(DAddr <span class="hljs-keyword">or</span> DataMemRW)<span class="hljs-keyword">begin</span></span><br><span class="line">		<span class="hljs-keyword">if</span> (DataMemRW)<span class="hljs-keyword">begin</span></span><br><span class="line">		   memory[DAddr] &lt;= DataIn[<span class="hljs-number">31</span>:<span class="hljs-number">24</span>];</span><br><span class="line">			memory[DAddr + <span class="hljs-number">1</span>] &lt;= DataIn[<span class="hljs-number">23</span>:<span class="hljs-number">16</span>];</span><br><span class="line">			memory[DAddr + <span class="hljs-number">2</span>] &lt;= DataIn[<span class="hljs-number">15</span>:<span class="hljs-number">8</span>];</span><br><span class="line">			memory[DAddr + <span class="hljs-number">3</span>] &lt;= DataIn[<span class="hljs-number">7</span>:<span class="hljs-number">0</span>];</span><br><span class="line">		<span class="hljs-keyword">end</span></span><br><span class="line">		<span class="hljs-keyword">else</span> <span class="hljs-keyword">begin</span></span><br><span class="line">		   DataOut[<span class="hljs-number">31</span>:<span class="hljs-number">24</span>] &lt;= memory[DAddr];</span><br><span class="line">			DataOut[<span class="hljs-number">23</span>:<span class="hljs-number">16</span>] &lt;= memory[DAddr + <span class="hljs-number">1</span>];</span><br><span class="line">			DataOut[<span class="hljs-number">15</span>:<span class="hljs-number">8</span>] &lt;= memory[DAddr + <span class="hljs-number">2</span>];</span><br><span class="line">			DataOut[<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] &lt;= memory[DAddr + <span class="hljs-number">3</span>];</span><br><span class="line">		<span class="hljs-keyword">end</span></span><br><span class="line">	<span class="hljs-keyword">end</span></span><br><span class="line"><span class="hljs-keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="InstructionMemory-v"><a href="#InstructionMemory-v" class="headerlink" title="InstructionMemory.v"></a>InstructionMemory.v</h3><p>该部分为指令寄存器，通过一个256大小的8位寄存器数组来保存从文件输入的全部指令。然后通过输入的地址，找到相应的指令，输出到IDataOut。<br>指令存储器的功能是存储读入的所有32-bit位宽的指令，根据程序计数器PC中的指令地址进行取指令操作并对指令类型进行分析，通过指令类型对所取指令的各字段进行区分识别，最后将对应部分传递给其他模块进行后续处理。<br>指令存储器中每个单元的位宽为8-bit，也就是存储每条32-bit位宽的指令都需要占据4个单元，所以第n（n大于或等于0）条指令所对应的起始地址为4n，且占据第4n，4n+1，4n+2，4n+3这四个单元。取出指令就是将这四个单元分别取出，因为指令的存储服从高位指令存储在低位地址的规则，所以4n单元中的字段是该条指令的最高8位，后面以此类推，并通过左移操作将指令的四个单元部分移动到相对应的位置，以此来得到所存指令。</p>
<figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">`<span class="hljs-meta-keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="hljs-keyword">module</span> InstructionMemory(</span><br><span class="line">	<span class="hljs-keyword">input</span> InsMemRW,	<span class="hljs-comment">//读写控制信号，1为写，0位读</span></span><br><span class="line">	<span class="hljs-keyword">input</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] IAddr,	<span class="hljs-comment">//指令地址输入入口</span></span><br><span class="line">	<span class="hljs-comment">//input IDataIn,	//没用到</span></span><br><span class="line">	<span class="hljs-keyword">input</span> CLK,	<span class="hljs-comment">//时钟信号</span></span><br><span class="line">	<span class="hljs-keyword">input</span> IRWre,	<span class="hljs-comment">//输出寄存器写使能</span></span><br><span class="line">	<span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span>[<span class="hljs-number">5</span>:<span class="hljs-number">0</span>] op,</span><br><span class="line">	<span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span>[<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] rs,</span><br><span class="line">	<span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span>[<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] rt,</span><br><span class="line">	<span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span>[<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] rd,</span><br><span class="line">	<span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span>[<span class="hljs-number">15</span>:<span class="hljs-number">0</span>] immediate,	<span class="hljs-comment">//指令代码分时段输出</span></span><br><span class="line">	<span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span>[<span class="hljs-number">25</span>:<span class="hljs-number">0</span>] address</span><br><span class="line">);</span><br><span class="line">	<span class="hljs-keyword">reg</span>[<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] mem[<span class="hljs-number">0</span>:<span class="hljs-number">255</span>];	<span class="hljs-comment">//新建一个256位的数组用于储存指令</span></span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">initial</span> <span class="hljs-keyword">begin</span></span><br><span class="line">		<span class="hljs-comment">//初始化</span></span><br><span class="line">		op &lt;= <span class="hljs-number">0</span>;</span><br><span class="line">		rs &lt;= <span class="hljs-number">0</span>;</span><br><span class="line">		rt &lt;= <span class="hljs-number">0</span>;</span><br><span class="line">		rd &lt;= <span class="hljs-number">0</span>;</span><br><span class="line">		immediate &lt;= <span class="hljs-number">0</span>;</span><br><span class="line">		address &lt;= <span class="hljs-number">0</span>;</span><br><span class="line">		<span class="hljs-built_in">$readmemb</span>(<span class="hljs-string">"C:/Users/wukan/Documents/VIVADO/MultipleCPU/input.txt"</span>,mem);</span><br><span class="line">	<span class="hljs-keyword">end</span></span><br><span class="line"></span><br><span class="line">	<span class="hljs-comment">//从地址取值，然后输出</span></span><br><span class="line">	<span class="hljs-keyword">always</span>@(<span class="hljs-keyword">posedge</span> CLK <span class="hljs-keyword">or</span> <span class="hljs-keyword">posedge</span> IRWre)<span class="hljs-keyword">begin</span></span><br><span class="line">		<span class="hljs-keyword">if</span> (IRWre == <span class="hljs-number">1</span>)<span class="hljs-keyword">begin</span></span><br><span class="line">			op = mem[IAddr][<span class="hljs-number">7</span>:<span class="hljs-number">2</span>];</span><br><span class="line">			rs[<span class="hljs-number">4</span>:<span class="hljs-number">3</span>] = mem[IAddr][<span class="hljs-number">1</span>:<span class="hljs-number">0</span>];</span><br><span class="line">			rs[<span class="hljs-number">2</span>:<span class="hljs-number">0</span>] = mem[IAddr + <span class="hljs-number">1</span>][<span class="hljs-number">7</span>:<span class="hljs-number">5</span>];</span><br><span class="line">			rt = mem[IAddr + <span class="hljs-number">1</span>][<span class="hljs-number">4</span>:<span class="hljs-number">0</span>];</span><br><span class="line">			rd = mem[IAddr + <span class="hljs-number">2</span>][<span class="hljs-number">7</span>:<span class="hljs-number">3</span>];</span><br><span class="line">			immediate[<span class="hljs-number">15</span>:<span class="hljs-number">8</span>] = mem[IAddr + <span class="hljs-number">2</span>];</span><br><span class="line">			immediate[<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] = mem[IAddr + <span class="hljs-number">3</span>];</span><br><span class="line">			<span class="hljs-comment">//地址赋值</span></span><br><span class="line">			address[<span class="hljs-number">25</span>:<span class="hljs-number">21</span>] = rs;</span><br><span class="line">			address[<span class="hljs-number">20</span>:<span class="hljs-number">16</span>] = rt;</span><br><span class="line">			address[<span class="hljs-number">15</span>:<span class="hljs-number">0</span>] = immediate;</span><br><span class="line">		<span class="hljs-keyword">end</span></span><br><span class="line">	<span class="hljs-keyword">end</span></span><br><span class="line"><span class="hljs-keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="MUX2L-32-v"><a href="#MUX2L-32-v" class="headerlink" title="MUX2L_32.v"></a>MUX2L_32.v</h3><p>三十二线双路选择器。</p>
<figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">`<span class="hljs-meta-keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="hljs-keyword">module</span> MUX2L_32(</span><br><span class="line">	<span class="hljs-keyword">input</span> control,</span><br><span class="line">	<span class="hljs-keyword">input</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] in0,</span><br><span class="line">	<span class="hljs-keyword">input</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] in1,</span><br><span class="line">	<span class="hljs-keyword">output</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] out</span><br><span class="line">);</span><br><span class="line">	<span class="hljs-keyword">assign</span> out = control ? in1 : in0;</span><br><span class="line"><span class="hljs-keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="MUX4L-32-v"><a href="#MUX4L-32-v" class="headerlink" title="MUX4L_32.v"></a>MUX4L_32.v</h3><p>三十二线四路选择器。</p>
<figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">`<span class="hljs-meta-keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="hljs-keyword">module</span> MUX4L_32(</span><br><span class="line">	<span class="hljs-keyword">input</span> [<span class="hljs-number">1</span>:<span class="hljs-number">0</span>]control,</span><br><span class="line">	<span class="hljs-keyword">input</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] in00,</span><br><span class="line">	<span class="hljs-keyword">input</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] in01,</span><br><span class="line">	<span class="hljs-keyword">input</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] in10,</span><br><span class="line">	<span class="hljs-keyword">input</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] in11,</span><br><span class="line">	<span class="hljs-keyword">output</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] out</span><br><span class="line">);</span><br><span class="line">	<span class="hljs-keyword">assign</span> out = control[<span class="hljs-number">0</span>] ? (control[<span class="hljs-number">1</span>] ? in11 : in01) : (control[<span class="hljs-number">1</span>] ? in10 : in00);</span><br><span class="line"><span class="hljs-keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="MUX4L-5-v"><a href="#MUX4L-5-v" class="headerlink" title="MUX4L_5.v"></a>MUX4L_5.v</h3><p>五线四路选择器。</p>
<figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">`<span class="hljs-meta-keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="hljs-keyword">module</span> MUX4L_5(</span><br><span class="line">	<span class="hljs-keyword">input</span> [<span class="hljs-number">1</span>:<span class="hljs-number">0</span>] control,</span><br><span class="line">	<span class="hljs-keyword">input</span> [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] in00,</span><br><span class="line">	<span class="hljs-keyword">input</span> [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] in01,</span><br><span class="line">	<span class="hljs-keyword">input</span> [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] in10,</span><br><span class="line">	<span class="hljs-keyword">input</span> [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] in11,</span><br><span class="line">	<span class="hljs-keyword">output</span> [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] out</span><br><span class="line">);</span><br><span class="line">	<span class="hljs-keyword">assign</span> out = control[<span class="hljs-number">0</span>] ? (control[<span class="hljs-number">1</span>] ? in11 : in01) : (control[<span class="hljs-number">1</span>] ? in10 : in00);</span><br><span class="line"><span class="hljs-keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="PC-v"><a href="#PC-v" class="headerlink" title="PC.v"></a>PC.v</h3><p>CLK上升沿触发，更改指令地址。由于指令地址存储在寄存器里，一开始需要赋currentAddress为0。Reset是重置信号，当为1时，指令寄存器地址重置。PCWre的作用为保留现场，如果PCWre为0，指令地址不变。<br>PC程序计数器用于存放当前指令的地址，当PC的值发生改变的时候，CPU会根据程序计数器PC中新得到的指令地址，从指令存储器中取出对应地址的指令，根据PCSrc控制信号的值选择指令地址是要进行PC+4或者跳转等操作。若PC程序计数器检测到Reset输入信号为1时，则对程序计数器存储的当前指令地址进行清零处理。</p>
<figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">`<span class="hljs-meta-keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="hljs-keyword">module</span> PC(</span><br><span class="line">	<span class="hljs-keyword">input</span> CLK,	<span class="hljs-comment">//时钟</span></span><br><span class="line">	<span class="hljs-keyword">input</span> Reset,	<span class="hljs-comment">//重置信号</span></span><br><span class="line">	<span class="hljs-keyword">input</span> PCWre,	<span class="hljs-comment">//PC是否更改，如果为0，PC不更改</span></span><br><span class="line">	<span class="hljs-keyword">input</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] newAddress,	<span class="hljs-comment">//新指令</span></span><br><span class="line">	<span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span>[<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] currentAddress	<span class="hljs-comment">//当前指令</span></span><br><span class="line">);</span><br><span class="line">	<span class="hljs-keyword">initial</span> <span class="hljs-keyword">begin</span></span><br><span class="line">		currentAddress &lt;= <span class="hljs-number">0</span>;  <span class="hljs-comment">//非阻塞赋值</span></span><br><span class="line">	<span class="hljs-keyword">end</span></span><br><span class="line">	<span class="hljs-keyword">always</span>@(<span class="hljs-keyword">posedge</span> CLK <span class="hljs-keyword">or</span> <span class="hljs-keyword">posedge</span> Reset)<span class="hljs-keyword">begin</span></span><br><span class="line">		<span class="hljs-keyword">if</span> (Reset == <span class="hljs-number">1</span>)  currentAddress &lt;= <span class="hljs-number">0</span>;  <span class="hljs-comment">//如果重置，赋值为0</span></span><br><span class="line">		<span class="hljs-keyword">else</span> <span class="hljs-keyword">begin</span></span><br><span class="line">			<span class="hljs-keyword">if</span> (PCWre)  currentAddress &lt;= newAddress;</span><br><span class="line">			<span class="hljs-keyword">else</span>  currentAddress &lt;= currentAddress;</span><br><span class="line">		<span class="hljs-keyword">end</span></span><br><span class="line">	<span class="hljs-keyword">end</span></span><br><span class="line"><span class="hljs-keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="PCjump-v"><a href="#PCjump-v" class="headerlink" title="PCjump.v"></a>PCjump.v</h3><figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">`<span class="hljs-meta-keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="hljs-keyword">module</span> PCjump(</span><br><span class="line">	<span class="hljs-keyword">input</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] PC0,	<span class="hljs-comment">//指令</span></span><br><span class="line">	<span class="hljs-keyword">input</span> [<span class="hljs-number">25</span>:<span class="hljs-number">0</span>] inAddress,	<span class="hljs-comment">//输入地址</span></span><br><span class="line">	<span class="hljs-keyword">output</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] outAddress	<span class="hljs-comment">//输出地址(指令)</span></span><br><span class="line">);</span><br><span class="line">	<span class="hljs-keyword">assign</span> outAddress[<span class="hljs-number">31</span>:<span class="hljs-number">28</span>] = PC0[<span class="hljs-number">31</span>:<span class="hljs-number">28</span>];</span><br><span class="line">	<span class="hljs-keyword">assign</span> outAddress[<span class="hljs-number">27</span>:<span class="hljs-number">2</span>] = inAddress;</span><br><span class="line">	<span class="hljs-keyword">assign</span> outAddress[<span class="hljs-number">1</span>:<span class="hljs-number">0</span>] = <span class="hljs-number">2'b00</span>;</span><br><span class="line"><span class="hljs-keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="RegisterFile-v"><a href="#RegisterFile-v" class="headerlink" title="RegisterFile.v"></a>RegisterFile.v</h3><p>该部分为寄存器读写单元，储存寄存器组，并根据地址对寄存器组进行读写。WE的作用是控制寄存器是否写入。同上，通过一个32大小的32位寄存器数组来模拟寄存器，开始时全部置0。通过访问寄存器的地址，来获取寄存器里面的值，并进行操作。（由于$0恒为0，所以写入寄存器的地址不能为0）<br>寄存器组中的每个寄存器位宽32-bit,是存放ALU计算所需要的临时数据的,与数据存储器不同，可能会在程序执行的过程中被多次覆盖，而数据存储器内的数据一般只有sw指令才能进行修改覆盖。寄存器组会根据操作码opCode与rs，rt字段相应的地址读取数据,同时将rs，rt寄存器的地址和其中的数据输出，在CLK的下降沿到来时将数据存放到rd或者rt字段的相应地址的寄存器内。</p>
<figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">`<span class="hljs-meta-keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="hljs-keyword">module</span> RegisterFile(</span><br><span class="line">	<span class="hljs-keyword">input</span> CLK,	<span class="hljs-comment">//时钟</span></span><br><span class="line">	<span class="hljs-keyword">input</span> RegWre,	<span class="hljs-comment">//写使能信号，为1时，在时钟上升沿写入</span></span><br><span class="line">	<span class="hljs-keyword">input</span> [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] rs,	<span class="hljs-comment">//rs寄存器地址输入端口</span></span><br><span class="line">	<span class="hljs-keyword">input</span> [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] rt,	<span class="hljs-comment">//rt寄存器地址输入端口</span></span><br><span class="line">	<span class="hljs-keyword">input</span> [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] WriteReg,	<span class="hljs-comment">//将数据写入的寄存器端口，其地址来源rt或rd字段</span></span><br><span class="line">	<span class="hljs-keyword">input</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] WriteData,	<span class="hljs-comment">//写入寄存器的数据输入端口</span></span><br><span class="line">	<span class="hljs-keyword">output</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] ReadData1,	<span class="hljs-comment">//rs数据输出端口</span></span><br><span class="line">	<span class="hljs-keyword">output</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] ReadData2	<span class="hljs-comment">//rt数据输出端口</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] register[<span class="hljs-number">0</span>:<span class="hljs-number">31</span>];  <span class="hljs-comment">//新建32个寄存器，用于操作</span></span><br><span class="line">	<span class="hljs-comment">//初始时，将32个寄存器和ReadData全部赋值为0</span></span><br><span class="line">	<span class="hljs-keyword">integer</span> i;</span><br><span class="line">	<span class="hljs-keyword">initial</span> <span class="hljs-keyword">begin</span></span><br><span class="line">		<span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i = i + <span class="hljs-number">1</span>)  register[i] &lt;= <span class="hljs-number">0</span>;</span><br><span class="line">	<span class="hljs-keyword">end</span></span><br><span class="line"></span><br><span class="line">	<span class="hljs-comment">//直接读寄存器</span></span><br><span class="line">	<span class="hljs-keyword">assign</span> ReadData1 = register[rs];</span><br><span class="line">	<span class="hljs-keyword">assign</span> ReadData2 = register[rt];</span><br><span class="line"></span><br><span class="line">	<span class="hljs-comment">//接受信号并读寄存器</span></span><br><span class="line">	<span class="hljs-keyword">always</span>@(<span class="hljs-keyword">posedge</span> CLK)<span class="hljs-keyword">begin</span></span><br><span class="line">		<span class="hljs-comment">//如果寄存器不为0，并且RegWre为真，写入数据</span></span><br><span class="line">		<span class="hljs-keyword">if</span> (RegWre &amp;&amp; WriteReg != <span class="hljs-number">0</span>)  register[WriteReg] = WriteData;</span><br><span class="line">	<span class="hljs-keyword">end</span></span><br><span class="line"><span class="hljs-keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="SignZeroExtend-v"><a href="#SignZeroExtend-v" class="headerlink" title="SignZeroExtend.v"></a>SignZeroExtend.v</h3><p>比较简单的一个模块，用于立即数的扩展。ExtSel为控制补位信号。判断后，将extendImmediate的前16位全补1或0即可。</p>
<figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">`<span class="hljs-meta-keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="hljs-keyword">module</span> SignZeroExtend(</span><br><span class="line">	<span class="hljs-keyword">input</span> [<span class="hljs-number">1</span>:<span class="hljs-number">0</span>]ExtSel,	<span class="hljs-comment">//控制补位，如果为1X，进行符号扩展；01，immediate全补0；00，sa全补0</span></span><br><span class="line">	<span class="hljs-keyword">input</span> [<span class="hljs-number">15</span>:<span class="hljs-number">0</span>] immediate,	<span class="hljs-comment">//16位立即数</span></span><br><span class="line">	<span class="hljs-keyword">output</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] extendImmediate	<span class="hljs-comment">//输出的32位立即数</span></span><br><span class="line">);</span><br><span class="line">	<span class="hljs-keyword">assign</span> extendImmediate[<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] = (ExtSel == <span class="hljs-number">2'b00</span>) ? immediate[<span class="hljs-number">10</span>:<span class="hljs-number">6</span>] : immediate[<span class="hljs-number">4</span>:<span class="hljs-number">0</span>];</span><br><span class="line">	<span class="hljs-keyword">assign</span> extendImmediate[<span class="hljs-number">15</span>:<span class="hljs-number">5</span>] = (ExtSel == <span class="hljs-number">2'b00</span>) ? <span class="hljs-number">3'b00000000000</span> : immediate[<span class="hljs-number">15</span>:<span class="hljs-number">5</span>];</span><br><span class="line">	<span class="hljs-keyword">assign</span> extendImmediate[<span class="hljs-number">31</span>:<span class="hljs-number">16</span>] = (ExtSel == <span class="hljs-number">2'b10</span>) ? (immediate[<span class="hljs-number">15</span>] ? <span class="hljs-number">16'hffff</span> : <span class="hljs-number">16'h0000</span>) : <span class="hljs-number">16'h0000</span>;</span><br><span class="line"><span class="hljs-keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="仿真检验"><a href="#仿真检验" class="headerlink" title="仿真检验"></a>仿真检验</h2><h3 id="编写一个编译器，将MIPS汇编程序编译为二进制机器码"><a href="#编写一个编译器，将MIPS汇编程序编译为二进制机器码" class="headerlink" title="编写一个编译器，将MIPS汇编程序编译为二进制机器码"></a>编写一个编译器，将MIPS汇编程序编译为二进制机器码</h3><p>使用支持<code>c++11</code>以上标准的编译器编译下述代码，得到编译器<code>wkmips</code>。</p>
<figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> TRANS(s,len) (bitset<span class="hljs-meta-string">&lt;len&gt;(stoi(s,0,0)).to_string())</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"><span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">compiler</span><span class="hljs-params">(<span class="hljs-built_in">string</span> s)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">static</span> <span class="hljs-built_in">unordered_map</span>&lt;<span class="hljs-built_in">string</span>,<span class="hljs-built_in">string</span>&gt; mp</span><br><span class="line">	&#123;</span><br><span class="line">		&#123;<span class="hljs-string">"add"</span>,<span class="hljs-string">"000000"</span>&#125;,</span><br><span class="line">		&#123;<span class="hljs-string">"sub"</span>,<span class="hljs-string">"000001"</span>&#125;,</span><br><span class="line">		&#123;<span class="hljs-string">"addiu"</span>,<span class="hljs-string">"000010"</span>&#125;,</span><br><span class="line">		&#123;<span class="hljs-string">"and"</span>,<span class="hljs-string">"010000"</span>&#125;,</span><br><span class="line">		&#123;<span class="hljs-string">"andi"</span>,<span class="hljs-string">"010001"</span>&#125;,</span><br><span class="line">		&#123;<span class="hljs-string">"ori"</span>,<span class="hljs-string">"010010"</span>&#125;,</span><br><span class="line">		&#123;<span class="hljs-string">"xori"</span>,<span class="hljs-string">"010011"</span>&#125;,</span><br><span class="line">		&#123;<span class="hljs-string">"sll"</span>,<span class="hljs-string">"011000"</span>&#125;,</span><br><span class="line">		&#123;<span class="hljs-string">"slti"</span>,<span class="hljs-string">"100110"</span>&#125;,</span><br><span class="line">		&#123;<span class="hljs-string">"slt"</span>,<span class="hljs-string">"100111"</span>&#125;,</span><br><span class="line">		&#123;<span class="hljs-string">"sw"</span>,<span class="hljs-string">"110000"</span>&#125;,</span><br><span class="line">		&#123;<span class="hljs-string">"lw"</span>,<span class="hljs-string">"110001"</span>&#125;,</span><br><span class="line">		&#123;<span class="hljs-string">"beq"</span>,<span class="hljs-string">"110100"</span>&#125;,</span><br><span class="line">		&#123;<span class="hljs-string">"bne"</span>,<span class="hljs-string">"110101"</span>&#125;,</span><br><span class="line">		&#123;<span class="hljs-string">"bltz"</span>,<span class="hljs-string">"110110"</span>&#125;,</span><br><span class="line">		&#123;<span class="hljs-string">"j"</span>,<span class="hljs-string">"111000"</span>&#125;,</span><br><span class="line">		&#123;<span class="hljs-string">"jr"</span>,<span class="hljs-string">"111001"</span>&#125;,</span><br><span class="line">		&#123;<span class="hljs-string">"jal"</span>,<span class="hljs-string">"111010"</span>&#125;,</span><br><span class="line">		&#123;<span class="hljs-string">"halt"</span>,<span class="hljs-string">"111111"</span>&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">string</span>&gt; v;</span><br><span class="line">	<span class="hljs-keyword">for</span>(<span class="hljs-keyword">char</span> &amp;c:s)<span class="hljs-keyword">if</span>(!<span class="hljs-built_in">isgraph</span>(c)||c==<span class="hljs-string">'$'</span>||c==<span class="hljs-string">'('</span>||c==<span class="hljs-string">')'</span>)c=<span class="hljs-string">','</span>;</span><br><span class="line">	<span class="hljs-keyword">for</span>(<span class="hljs-built_in">istringstream</span> <span class="hljs-built_in">sin</span>(s); getline(<span class="hljs-built_in">sin</span>,s,<span class="hljs-string">','</span>);)</span><br><span class="line">		<span class="hljs-keyword">if</span>(!s.empty())v.push_back(s);</span><br><span class="line">	<span class="hljs-keyword">if</span>(v.empty())<span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;</span><br><span class="line">	s=mp[v[<span class="hljs-number">0</span>]];</span><br><span class="line">	<span class="hljs-keyword">if</span>(v.size()==<span class="hljs-number">1</span>)s+=<span class="hljs-built_in">string</span>(<span class="hljs-number">26</span>,<span class="hljs-string">'0'</span>);</span><br><span class="line">	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(v.size()==<span class="hljs-number">2</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">if</span>(v[<span class="hljs-number">0</span>]==<span class="hljs-string">"jr"</span>)s+=TRANS(v[<span class="hljs-number">1</span>],<span class="hljs-number">5</span>)+<span class="hljs-built_in">string</span>(<span class="hljs-number">21</span>,<span class="hljs-string">'0'</span>);</span><br><span class="line">		<span class="hljs-keyword">else</span> s+=<span class="hljs-built_in">bitset</span>&lt;<span class="hljs-number">26</span>&gt;(stoi(v[<span class="hljs-number">1</span>],<span class="hljs-number">0</span>,<span class="hljs-number">0</span>)&gt;&gt;<span class="hljs-number">2</span>).to_string();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(v.size()==<span class="hljs-number">3</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">if</span>(v[<span class="hljs-number">0</span>]==<span class="hljs-string">"bltz"</span>)s+=TRANS(v[<span class="hljs-number">1</span>],<span class="hljs-number">5</span>)+<span class="hljs-built_in">string</span>(<span class="hljs-number">5</span>,<span class="hljs-string">'0'</span>)+TRANS(v[<span class="hljs-number">2</span>],<span class="hljs-number">16</span>);</span><br><span class="line">		<span class="hljs-keyword">else</span> s+=TRANS(v[<span class="hljs-number">1</span>],<span class="hljs-number">5</span>)+TRANS(v[<span class="hljs-number">2</span>],<span class="hljs-number">21</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="hljs-keyword">if</span>(v[<span class="hljs-number">0</span>]==<span class="hljs-string">"sw"</span>||v[<span class="hljs-number">0</span>]==<span class="hljs-string">"lw"</span>)swap(v[<span class="hljs-number">2</span>],v[<span class="hljs-number">3</span>]);</span><br><span class="line">		<span class="hljs-keyword">if</span>(v[<span class="hljs-number">0</span>]==<span class="hljs-string">"sll"</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			s+=<span class="hljs-built_in">string</span>(<span class="hljs-number">5</span>,<span class="hljs-string">'0'</span>);</span><br><span class="line">			s+=TRANS(v[<span class="hljs-number">2</span>],<span class="hljs-number">5</span>)+TRANS(v[<span class="hljs-number">1</span>],<span class="hljs-number">5</span>);</span><br><span class="line">			s+=TRANS(v[<span class="hljs-number">3</span>],<span class="hljs-number">5</span>)+<span class="hljs-built_in">string</span>(<span class="hljs-number">6</span>,<span class="hljs-string">'0'</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(v[<span class="hljs-number">0</span>].find(<span class="hljs-string">'i'</span>)!=v[<span class="hljs-number">0</span>].npos</span><br><span class="line">		        ||v[<span class="hljs-number">0</span>]==<span class="hljs-string">"sw"</span>||v[<span class="hljs-number">0</span>]==<span class="hljs-string">"lw"</span></span><br><span class="line">		        ||v[<span class="hljs-number">0</span>]==<span class="hljs-string">"beq"</span>||v[<span class="hljs-number">0</span>]==<span class="hljs-string">"bne"</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			s+=TRANS(v[<span class="hljs-number">2</span>],<span class="hljs-number">5</span>)+TRANS(v[<span class="hljs-number">1</span>],<span class="hljs-number">5</span>);</span><br><span class="line">			s+=TRANS(v[<span class="hljs-number">3</span>],<span class="hljs-number">16</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="hljs-keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			s+=TRANS(v[<span class="hljs-number">2</span>],<span class="hljs-number">5</span>)+TRANS(v[<span class="hljs-number">3</span>],<span class="hljs-number">5</span>);</span><br><span class="line">			s+=TRANS(v[<span class="hljs-number">1</span>],<span class="hljs-number">5</span>)+<span class="hljs-built_in">string</span>(<span class="hljs-number">11</span>,<span class="hljs-string">'0'</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc,<span class="hljs-keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">if</span>(argc&lt;<span class="hljs-number">2</span>)<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">	<span class="hljs-function">ifstream <span class="hljs-title">fin</span><span class="hljs-params">(argv[<span class="hljs-number">1</span>])</span></span>;</span><br><span class="line">	<span class="hljs-function">ofstream <span class="hljs-title">fout</span><span class="hljs-params">(argv[argc<span class="hljs-number">-1</span>])</span></span>;</span><br><span class="line">	<span class="hljs-keyword">for</span>(<span class="hljs-built_in">string</span> s; getline(fin,s); fout&lt;&lt;<span class="hljs-string">'\n'</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		s=compiler(s);</span><br><span class="line">		<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;s.size(); ++i)</span><br><span class="line">		&#123;</span><br><span class="line">			fout&lt;&lt;s[i];</span><br><span class="line">			<span class="hljs-keyword">if</span>(i%<span class="hljs-number">8</span>==<span class="hljs-number">7</span>)fout&lt;&lt;<span class="hljs-string">' '</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>待转换的MIPS代码<code>test.txt</code>内容如下：</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">addiu  $1,$0,8</span><br><span class="line">ori  $2,$0,2</span><br><span class="line">xori  $3,$2,8</span><br><span class="line">sub  $4,$3,$1</span><br><span class="line">and  $5,$4,$2</span><br><span class="line">sll   $5,$5,2</span><br><span class="line">beq  $5,$1,-2</span><br><span class="line">jal  0x0000050</span><br><span class="line">slt  $8,$13,$1</span><br><span class="line">addiu  $14,$0,-2</span><br><span class="line">slt  $9,$8,$14</span><br><span class="line">slti  $10,$9,2</span><br><span class="line">slti  $11,$10,0</span><br><span class="line">add  $11,$11,$10</span><br><span class="line">bne  $11,$2,-2</span><br><span class="line">addiu  $12,$0,-2</span><br><span class="line">addiu  $12,$12,1</span><br><span class="line">bltz  $12,-2</span><br><span class="line">andi  $12,$2,2</span><br><span class="line">j  0x000005C</span><br><span class="line">sw  $2,4($1)</span><br><span class="line">lw  $13,4($1)</span><br><span class="line">jr  $31</span><br><span class="line">halt</span><br></pre></td></tr></table></figure>

<p>在命令行中键入<code>wkmips test.txt input.txt</code>，得到编译后文件<code>input.txt</code>：</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">00001000 00000001 00000000 00001000</span><br><span class="line">01001000 00000010 00000000 00000010</span><br><span class="line">01001100 01000011 00000000 00001000</span><br><span class="line">00000100 01100001 00100000 00000000</span><br><span class="line">01000000 10000010 00101000 00000000</span><br><span class="line">01100000 00000101 00101000 10000000</span><br><span class="line">11010000 00100101 11111111 11111110</span><br><span class="line">11101000 00000000 00000000 00010100</span><br><span class="line">10011101 10100001 01000000 00000000</span><br><span class="line">00001000 00001110 11111111 11111110</span><br><span class="line">10011101 00001110 01001000 00000000</span><br><span class="line">10011001 00101010 00000000 00000010</span><br><span class="line">10011001 01001011 00000000 00000000</span><br><span class="line">00000001 01101010 01011000 00000000</span><br><span class="line">11010100 01001011 11111111 11111110</span><br><span class="line">00001000 00001100 11111111 11111110</span><br><span class="line">00001001 10001100 00000000 00000001</span><br><span class="line">11011001 10000000 11111111 11111110</span><br><span class="line">01000100 01001100 00000000 00000010</span><br><span class="line">11100000 00000000 00000000 00010111</span><br><span class="line">11000000 00100010 00000000 00000100</span><br><span class="line">11000100 00101101 00000000 00000100</span><br><span class="line">11100111 11100000 00000000 00000000</span><br><span class="line">11111100 00000000 00000000 00000000</span><br></pre></td></tr></table></figure>

<p>检验：手动将指令转换成二进制代码如下表，可对比检验上述编译器转换结果无误。</p>
<table>
<thead>
<tr>
<th>地址</th>
<th>汇编程序</th>
<th>op（6）</th>
<th>rs(5)</th>
<th>rt(5)</th>
<th>rd(5)/immediate(16)</th>
<th>16进制数代码</th>
</tr>
</thead>
<tbody><tr>
<td>0x00000000</td>
<td><code>addiu $1,$0,8</code></td>
<td>000010</td>
<td>00000</td>
<td>00001</td>
<td>00000000 00001000</td>
<td>08010008</td>
</tr>
<tr>
<td>0x00000004</td>
<td><code>ori $2,$0,2</code></td>
<td>010010</td>
<td>00000</td>
<td>00010</td>
<td>00000000 00000010</td>
<td>48020002</td>
</tr>
<tr>
<td>0x00000008</td>
<td><code>xori $3,$2,8</code></td>
<td>010011</td>
<td>00010</td>
<td>00011</td>
<td>00000000 00001000</td>
<td>4c430008</td>
</tr>
<tr>
<td>0x0000000c</td>
<td><code>sub $4,$3,$1</code></td>
<td>000001</td>
<td>00011</td>
<td>00001</td>
<td>00100000 00000000</td>
<td>04612000</td>
</tr>
<tr>
<td>0x00000010</td>
<td><code>and $5,$4,$2</code></td>
<td>010000</td>
<td>00100</td>
<td>00010</td>
<td>00101000 00000000</td>
<td>40822800</td>
</tr>
<tr>
<td>0x00000014</td>
<td><code>sll $5,$5,2</code></td>
<td>011000</td>
<td>00000</td>
<td>00101</td>
<td>00101000 10000000</td>
<td>60052880</td>
</tr>
<tr>
<td>0x00000018</td>
<td><code>beq $5,$1,-2</code></td>
<td>110100</td>
<td>00001</td>
<td>00101</td>
<td>11111111 11111110</td>
<td>d025fffe</td>
</tr>
<tr>
<td>0x0000001c</td>
<td><code>jal 0x0000050</code></td>
<td>111010</td>
<td>00000</td>
<td>00000</td>
<td>00000000 00010100</td>
<td>e8000014</td>
</tr>
<tr>
<td>0x00000020</td>
<td><code>slt $8,$13,$1</code></td>
<td>100111</td>
<td>01101</td>
<td>00001</td>
<td>01000000 00000000</td>
<td>9da14000</td>
</tr>
<tr>
<td>0x00000024</td>
<td><code>addiu $14,$0,-2</code></td>
<td>000010</td>
<td>00000</td>
<td>01110</td>
<td>11111111 11111110</td>
<td>080efffe</td>
</tr>
<tr>
<td>0x00000028</td>
<td><code>slt $9,$8,$14</code></td>
<td>100111</td>
<td>01000</td>
<td>01110</td>
<td>01001000 00000000</td>
<td>9d0e4800</td>
</tr>
<tr>
<td>0x0000002c</td>
<td><code>slti $10,$9,2</code></td>
<td>100110</td>
<td>01001</td>
<td>01010</td>
<td>00000000 00000010</td>
<td>992a0002</td>
</tr>
<tr>
<td>0x00000030</td>
<td><code>slti $11,$10,0</code></td>
<td>100110</td>
<td>01010</td>
<td>01011</td>
<td>00000000 00000000</td>
<td>994b0000</td>
</tr>
<tr>
<td>0x00000034</td>
<td><code>add $11,$11,$10</code></td>
<td>000000</td>
<td>01011</td>
<td>01010</td>
<td>01011000 00000000</td>
<td>016a5800</td>
</tr>
<tr>
<td>0x00000038</td>
<td><code>bne $11,$2,-2</code></td>
<td>110101</td>
<td>00010</td>
<td>01011</td>
<td>11111111 11111110</td>
<td>d44bfffe</td>
</tr>
<tr>
<td>0x0000003c</td>
<td><code>addiu $12,$0,-2</code></td>
<td>000010</td>
<td>00000</td>
<td>01100</td>
<td>11111111 11111110</td>
<td>080cfffe</td>
</tr>
<tr>
<td>0x00000040</td>
<td><code>addiu $12,$12,1</code></td>
<td>000010</td>
<td>01100</td>
<td>01100</td>
<td>00000000 00000001</td>
<td>098c0001</td>
</tr>
<tr>
<td>0x00000044</td>
<td><code>bltz $12,-2</code></td>
<td>110110</td>
<td>01100</td>
<td>00000</td>
<td>11111111 11111110</td>
<td>d980fffe</td>
</tr>
<tr>
<td>0x00000048</td>
<td><code>andi $12,$2,2</code></td>
<td>010001</td>
<td>00010</td>
<td>01100</td>
<td>00000000 00000010</td>
<td>444c0002</td>
</tr>
<tr>
<td>0x0000004c</td>
<td><code>j 0x000005C</code></td>
<td>111000</td>
<td>00000</td>
<td>00000</td>
<td>00000000 00010111</td>
<td>e0000017</td>
</tr>
<tr>
<td>0x00000050</td>
<td><code>sw $2,4($1)</code></td>
<td>110000</td>
<td>00001</td>
<td>00010</td>
<td>00000000 00000100</td>
<td>c0220004</td>
</tr>
<tr>
<td>0x00000054</td>
<td><code>lw $13,4($1)</code></td>
<td>110001</td>
<td>00001</td>
<td>01101</td>
<td>00000000 00000100</td>
<td>c42d0004</td>
</tr>
<tr>
<td>0x00000058</td>
<td><code>jr $31</code></td>
<td>111001</td>
<td>11111</td>
<td>00000</td>
<td>00000000 00000000</td>
<td>e7e00000</td>
</tr>
<tr>
<td>0x0000005c</td>
<td><code>halt</code></td>
<td>111111</td>
<td>00000</td>
<td>00000</td>
<td>00000000 00000000</td>
<td>fc000000</td>
</tr>
</tbody></table>
<h3 id="Sim-v"><a href="#Sim-v" class="headerlink" title="Sim.v"></a>Sim.v</h3><p>仿真模块。</p>
<figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">`<span class="hljs-meta-keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="hljs-keyword">module</span> Sim;</span><br><span class="line">	<span class="hljs-keyword">reg</span> CLK;	<span class="hljs-comment">//时钟信号</span></span><br><span class="line">	<span class="hljs-keyword">reg</span> Reset;	<span class="hljs-comment">//置零信号</span></span><br><span class="line">	MultipleCPU mcpu(CLK,Reset);</span><br><span class="line">	<span class="hljs-keyword">initial</span> <span class="hljs-keyword">begin</span></span><br><span class="line">		CLK=	<span class="hljs-number">0</span>;</span><br><span class="line">		Reset=	<span class="hljs-number">1</span>;	<span class="hljs-comment">//刚开始设置pc为0</span></span><br><span class="line">		#<span class="hljs-number">50</span>;	<span class="hljs-comment">//等待Reset完成</span></span><br><span class="line">		CLK=	!CLK;	<span class="hljs-comment">//下降沿，使PC先清零</span></span><br><span class="line">		#<span class="hljs-number">50</span>;</span><br><span class="line">		Reset=	<span class="hljs-number">0</span>;	<span class="hljs-comment">//清除保持信号</span></span><br><span class="line">	  	<span class="hljs-keyword">forever</span> #<span class="hljs-number">50</span> <span class="hljs-keyword">begin</span>	<span class="hljs-comment">//产生时钟信号，周期为50s</span></span><br><span class="line">			CLK=	!CLK;</span><br><span class="line">		<span class="hljs-keyword">end</span></span><br><span class="line">	<span class="hljs-keyword">end</span></span><br><span class="line"><span class="hljs-keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="仿真波形"><a href="#仿真波形" class="headerlink" title="仿真波形"></a>仿真波形</h3><p>波形比较长，分成三部分逐一分析。<br><img src="https://img-blog.csdnimg.cn/20181221020005449.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dfd2VpbGFu,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>第一次执行到地址<code>0x00000018</code>的时候，执行了<code>beq $5,$1,-2</code>，此时<code>$5</code>和<code>$1</code>都是8，回退到<code>0x00000014</code>；第二次执行到地址<code>0x00000018</code>的时候，<code>$5</code>是32，<code>$1</code>都是8，不等，继续执行下一条指令<code>jal 0x0000050</code>。于是跳到<code>0x00000050</code>，并在<code>0x00000058</code>地址上跳回<code>0x00000020</code>。<br><img src="https://img-blog.csdnimg.cn/20181221020023779.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dfd2VpbGFu,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>第一次执行到地址<code>0x00000038</code>的时候，执行了<code>bne $11,$2,-2</code>，此时<code>$11</code>是1，<code>$2</code>是2，不等，回退到<code>0x00000034</code>；第二次执行到地址<code>0x00000038</code>的时候，<code>$11</code>和<code>$2</code>都是2，继续执行下一条指令。<br><img src="https://img-blog.csdnimg.cn/2018122102003755.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dfd2VpbGFu,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>第一次执行到地址<code>0x00000044</code>的时候，执行了<code>bltz $12,-2</code>，此时<code>$12</code>是-1，小于0，回退到<code>0x00000040</code>；第二次执行到地址<code>0x00000044</code>的时候，<code>$12</code>是0，继续执行下一条指令。<br>执行到地址<code>0x0000004C</code>的时候，执行了<code>j 0x000005C</code>，直接跳转到<code>0x000005C</code>，于是执行该地址上的<code>Halt</code>，波形不再变化。</p>
<h2 id="烧写到Basys3实验板"><a href="#烧写到Basys3实验板" class="headerlink" title="烧写到Basys3实验板"></a>烧写到Basys3实验板</h2><h3 id="Basys3-v"><a href="#Basys3-v" class="headerlink" title="Basys3.v"></a>Basys3.v</h3><p>顶层模块。和单周期没有太大区别。（Reset的取值）改了。</p>
<figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">`<span class="hljs-meta-keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="hljs-keyword">module</span> Basys3(</span><br><span class="line">	<span class="hljs-keyword">input</span> CLK,</span><br><span class="line">	<span class="hljs-keyword">input</span>[<span class="hljs-number">1</span>:<span class="hljs-number">0</span>] SW,	<span class="hljs-comment">//选择输出信号</span></span><br><span class="line">	<span class="hljs-keyword">input</span> Reset,	<span class="hljs-comment">//重置按钮</span></span><br><span class="line">	<span class="hljs-keyword">input</span> Button,	<span class="hljs-comment">//单脉冲</span></span><br><span class="line">	<span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span>[<span class="hljs-number">3</span>:<span class="hljs-number">0</span>] AN,	<span class="hljs-comment">//数码管位选择信号</span></span><br><span class="line">	<span class="hljs-keyword">output</span>[<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] Out	<span class="hljs-comment">//数码管输入信号</span></span><br><span class="line">);</span><br><span class="line">	<span class="hljs-keyword">parameter</span> T1MS=	<span class="hljs-number">100000</span>;</span><br><span class="line">	<span class="hljs-keyword">reg</span>[<span class="hljs-number">16</span>:<span class="hljs-number">0</span>] showCounter;</span><br><span class="line">	<span class="hljs-keyword">wire</span>[<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] ALU_Out;	<span class="hljs-comment">//ALU的result输出值</span></span><br><span class="line">	<span class="hljs-keyword">wire</span>[<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] CurPC;</span><br><span class="line">	<span class="hljs-keyword">wire</span>[<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] WriteData;	<span class="hljs-comment">//DB总线值</span></span><br><span class="line">	<span class="hljs-keyword">wire</span>[<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] Reg1Out;	<span class="hljs-comment">//寄存器组rs寄存器的值</span></span><br><span class="line">	<span class="hljs-keyword">wire</span>[<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] Reg2Out;	<span class="hljs-comment">//寄存器组rt寄存器的值</span></span><br><span class="line">	<span class="hljs-keyword">wire</span>[<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] DataOut;</span><br><span class="line">	<span class="hljs-keyword">wire</span>[<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] instcode;</span><br><span class="line">	<span class="hljs-keyword">wire</span> myCLK;</span><br><span class="line">	<span class="hljs-keyword">reg</span>[<span class="hljs-number">3</span>:<span class="hljs-number">0</span>] store;	<span class="hljs-comment">//记录当前要显示位的值</span></span><br><span class="line">	<span class="hljs-keyword">wire</span>[<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] newAddress;</span><br><span class="line"></span><br><span class="line">	MultipleCPU mcpu(myCLK,Reset,instcode[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>],instcode[<span class="hljs-number">25</span>:<span class="hljs-number">21</span>],instcode[<span class="hljs-number">20</span>:<span class="hljs-number">16</span>],instcode[<span class="hljs-number">15</span>:<span class="hljs-number">11</span>],instcode[<span class="hljs-number">15</span>:<span class="hljs-number">0</span>],Reg1Out,Reg2Out,WriteData,DataOut,CurPC,newAddress,ALU_Out);</span><br><span class="line">	Debounce debounce(CLK,Button,myCLK);</span><br><span class="line"></span><br><span class="line">	<span class="hljs-keyword">initial</span> <span class="hljs-keyword">begin</span></span><br><span class="line">		showCounter&lt;=	<span class="hljs-number">0</span>;</span><br><span class="line">		AN&lt;=	<span class="hljs-number">4'b0111</span>;</span><br><span class="line">	<span class="hljs-keyword">end</span></span><br><span class="line">	<span class="hljs-keyword">always</span>@(<span class="hljs-keyword">posedge</span> CLK)</span><br><span class="line">		<span class="hljs-keyword">begin</span></span><br><span class="line">		<span class="hljs-keyword">if</span>(Reset==<span class="hljs-number">1</span>)<span class="hljs-keyword">begin</span></span><br><span class="line">		  showCounter&lt;=	<span class="hljs-number">0</span>;</span><br><span class="line">		  AN&lt;=	<span class="hljs-number">4'b0000</span>;</span><br><span class="line">		<span class="hljs-keyword">end</span> <span class="hljs-keyword">else</span> <span class="hljs-keyword">begin</span></span><br><span class="line">			showCounter&lt;=	showCounter+<span class="hljs-number">1</span>;</span><br><span class="line">			<span class="hljs-keyword">if</span>(showCounter==T1MS)</span><br><span class="line">				<span class="hljs-keyword">begin</span></span><br><span class="line">					showCounter&lt;=	<span class="hljs-number">0</span>;</span><br><span class="line">					<span class="hljs-keyword">case</span>(AN)</span><br><span class="line">						<span class="hljs-number">4'b1110</span>:	<span class="hljs-keyword">begin</span></span><br><span class="line">							AN&lt;=	<span class="hljs-number">4'b1101</span>;</span><br><span class="line">						<span class="hljs-keyword">end</span></span><br><span class="line">						<span class="hljs-number">4'b1101</span>:	<span class="hljs-keyword">begin</span></span><br><span class="line">							AN&lt;=	<span class="hljs-number">4'b1011</span>;</span><br><span class="line">						<span class="hljs-keyword">end</span></span><br><span class="line">						<span class="hljs-number">4'b1011</span>:	<span class="hljs-keyword">begin</span></span><br><span class="line">							AN&lt;=	<span class="hljs-number">4'b0111</span>;</span><br><span class="line">						<span class="hljs-keyword">end</span></span><br><span class="line">						<span class="hljs-number">4'b0111</span>:	<span class="hljs-keyword">begin</span></span><br><span class="line">							AN&lt;=	<span class="hljs-number">4'b1110</span>;</span><br><span class="line">						<span class="hljs-keyword">end</span></span><br><span class="line">						<span class="hljs-number">4'b0000</span>:	<span class="hljs-keyword">begin</span></span><br><span class="line">							AN&lt;=	<span class="hljs-number">4'b0111</span>;</span><br><span class="line">					   <span class="hljs-keyword">end</span></span><br><span class="line">					<span class="hljs-keyword">endcase</span></span><br><span class="line">				<span class="hljs-keyword">end</span></span><br><span class="line">			<span class="hljs-keyword">end</span></span><br><span class="line">		<span class="hljs-keyword">end</span></span><br><span class="line">	SegLED led(store,Reset,Out);</span><br><span class="line">	<span class="hljs-keyword">always</span>@(myCLK)<span class="hljs-keyword">begin</span></span><br><span class="line">	   <span class="hljs-keyword">case</span>(AN)</span><br><span class="line">			<span class="hljs-number">4'b1110</span>:	<span class="hljs-keyword">begin</span></span><br><span class="line">				<span class="hljs-keyword">case</span>(SW)</span><br><span class="line">					<span class="hljs-number">2'b00</span>:	store&lt;=	newAddress[<span class="hljs-number">3</span>:<span class="hljs-number">0</span>];</span><br><span class="line">					<span class="hljs-number">2'b01</span>:	store&lt;=	Reg1Out[<span class="hljs-number">3</span>:<span class="hljs-number">0</span>];</span><br><span class="line">					<span class="hljs-number">2'b10</span>:	store&lt;=	Reg2Out[<span class="hljs-number">3</span>:<span class="hljs-number">0</span>];</span><br><span class="line">					<span class="hljs-number">2'b11</span>:	store&lt;=	WriteData[<span class="hljs-number">3</span>:<span class="hljs-number">0</span>];</span><br><span class="line">				<span class="hljs-keyword">endcase</span></span><br><span class="line">			<span class="hljs-keyword">end</span></span><br><span class="line">			<span class="hljs-number">4'b1101</span>:	<span class="hljs-keyword">begin</span></span><br><span class="line">				<span class="hljs-keyword">case</span>(SW)</span><br><span class="line">					<span class="hljs-number">2'b00</span>:	store&lt;=	newAddress[<span class="hljs-number">7</span>:<span class="hljs-number">4</span>];</span><br><span class="line">					<span class="hljs-number">2'b01</span>:	store&lt;=	Reg1Out[<span class="hljs-number">7</span>:<span class="hljs-number">4</span>];</span><br><span class="line">					<span class="hljs-number">2'b10</span>:	store&lt;=	Reg2Out[<span class="hljs-number">7</span>:<span class="hljs-number">4</span>];</span><br><span class="line">					<span class="hljs-number">2'b11</span>:	store&lt;=	WriteData[<span class="hljs-number">7</span>:<span class="hljs-number">4</span>];</span><br><span class="line">				<span class="hljs-keyword">endcase</span></span><br><span class="line">			<span class="hljs-keyword">end</span></span><br><span class="line">			<span class="hljs-number">4'b1011</span>:	<span class="hljs-keyword">begin</span></span><br><span class="line">				<span class="hljs-keyword">case</span>(SW)</span><br><span class="line">					<span class="hljs-number">2'b00</span>:	store&lt;=	CurPC[<span class="hljs-number">3</span>:<span class="hljs-number">0</span>];</span><br><span class="line">					<span class="hljs-number">2'b01</span>:	store&lt;=	instcode[<span class="hljs-number">24</span>:<span class="hljs-number">21</span>];</span><br><span class="line">					<span class="hljs-number">2'b10</span>:	store&lt;=	instcode[<span class="hljs-number">19</span>:<span class="hljs-number">16</span>];</span><br><span class="line">					<span class="hljs-number">2'b11</span>:	store&lt;=	ALU_Out[<span class="hljs-number">3</span>:<span class="hljs-number">0</span>];</span><br><span class="line">				<span class="hljs-keyword">endcase</span></span><br><span class="line">			<span class="hljs-keyword">end</span></span><br><span class="line">			<span class="hljs-number">4'b0111</span> : <span class="hljs-keyword">begin</span></span><br><span class="line">				<span class="hljs-keyword">case</span>(SW)</span><br><span class="line">					<span class="hljs-number">2'b00</span>:	store&lt;=	CurPC[<span class="hljs-number">7</span>:<span class="hljs-number">4</span>];</span><br><span class="line">					<span class="hljs-number">2'b01</span>:	store&lt;=	&#123;<span class="hljs-number">3'b000</span>,instcode[<span class="hljs-number">25</span>]&#125;;</span><br><span class="line">					<span class="hljs-number">2'b10</span>:	store&lt;=	&#123;<span class="hljs-number">3'b000</span>,instcode[<span class="hljs-number">20</span>]&#125;;</span><br><span class="line">					<span class="hljs-number">2'b11</span>:	store&lt;=	ALU_Out[<span class="hljs-number">7</span>:<span class="hljs-number">4</span>];</span><br><span class="line">				<span class="hljs-keyword">endcase</span></span><br><span class="line">			<span class="hljs-keyword">end</span></span><br><span class="line">		<span class="hljs-keyword">endcase</span></span><br><span class="line">	<span class="hljs-keyword">end</span></span><br><span class="line"><span class="hljs-keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="Debounce-v"><a href="#Debounce-v" class="headerlink" title="Debounce.v"></a>Debounce.v</h3><p>和单周期一样的按键消抖模块。Basys3板采用的是机械按键，在按下按键时按键会出现人眼无法观测但是系统会检测到的抖动变化，这可能会使短时间内电平频繁变化，导致程序接收到许多错误的触发信号而出现许多不可知的错误。消抖操作是每当检测到CLK上升沿到来时检测一次当前电平信号并记录，同计数器开始计数，若在计数器达到5000之前电平发生变化，则将计数器清零，若达到5000，则将该记录电平取反输出。<br>因为程序开始时已经运行第一条指令，为避免跳过第一条指令计算值的写入，我们的输入需要从下降沿开始，因此我们给按键信号取反后再输入。</p>
<figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">`<span class="hljs-meta-keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="hljs-keyword">module</span> Debounce(clk,key_in,key_out);</span><br><span class="line">    <span class="hljs-keyword">parameter</span> SAMPLE_TIME = <span class="hljs-number">5000</span>;</span><br><span class="line">    <span class="hljs-keyword">input</span> clk;</span><br><span class="line">    <span class="hljs-keyword">input</span> key_in;</span><br><span class="line">    <span class="hljs-keyword">output</span> key_out;</span><br><span class="line">    <span class="hljs-keyword">reg</span> [<span class="hljs-number">21</span>:<span class="hljs-number">0</span>] count_low;</span><br><span class="line">    <span class="hljs-keyword">reg</span> [<span class="hljs-number">21</span>:<span class="hljs-number">0</span>] count_high;</span><br><span class="line">    <span class="hljs-keyword">reg</span> key_out_reg;</span><br><span class="line">    <span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk)</span><br><span class="line">    <span class="hljs-keyword">if</span>(key_in ==<span class="hljs-number">1'b0</span>)</span><br><span class="line">        count_low &lt;= count_low + <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-keyword">else</span></span><br><span class="line">        count_low &lt;= <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk)</span><br><span class="line">        <span class="hljs-keyword">if</span>(key_in ==<span class="hljs-number">1'b1</span>)</span><br><span class="line">            count_high &lt;= count_high + <span class="hljs-number">1</span>;</span><br><span class="line">        <span class="hljs-keyword">else</span></span><br><span class="line">            count_high &lt;= <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk)</span><br><span class="line">        <span class="hljs-keyword">if</span>(count_high == SAMPLE_TIME)</span><br><span class="line">            key_out_reg &lt;= <span class="hljs-number">1</span>;</span><br><span class="line">        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(count_low == SAMPLE_TIME)</span><br><span class="line">            key_out_reg &lt;= <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-keyword">assign</span> key_out = !key_out_reg;</span><br><span class="line"><span class="hljs-keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="SegLED-v"><a href="#SegLED-v" class="headerlink" title="SegLED.v"></a>SegLED.v</h3><p>数码管译码模块。译码模块将CPU运算的结果转换成7段数码管中各个数码管显示所需的高低电平信号,该单元的输入为4-bit位宽的二进制数。其中，七段数码管的八个电平控制输出中最低位是小数点的显示信号，但小数点在CPU运行时没有用到，恰好用于标记Reset状态。</p>
<figure class="highlight verilog hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">`<span class="hljs-meta-keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="hljs-keyword">module</span> SegLED(</span><br><span class="line">	<span class="hljs-keyword">input</span>[<span class="hljs-number">3</span>:<span class="hljs-number">0</span>] Store,</span><br><span class="line">	<span class="hljs-keyword">input</span> Reset,</span><br><span class="line">	<span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span>[<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] Out</span><br><span class="line">);</span><br><span class="line">	<span class="hljs-keyword">always</span>@(Store <span class="hljs-keyword">or</span> Reset)<span class="hljs-keyword">begin</span></span><br><span class="line">		<span class="hljs-keyword">begin</span></span><br><span class="line">			<span class="hljs-keyword">case</span>(Store)</span><br><span class="line">				<span class="hljs-number">4'b0000</span>:	Out=	<span class="hljs-number">8'b00000011</span>;	<span class="hljs-comment">//0</span></span><br><span class="line">				<span class="hljs-number">4'b0001</span>:	Out=	<span class="hljs-number">8'b10011111</span>;	<span class="hljs-comment">//1</span></span><br><span class="line">				<span class="hljs-number">4'b0010</span>:	Out=	<span class="hljs-number">8'b00100101</span>;	<span class="hljs-comment">//2</span></span><br><span class="line">				<span class="hljs-number">4'b0011</span>:	Out=	<span class="hljs-number">8'b00001101</span>;	<span class="hljs-comment">//3</span></span><br><span class="line">				<span class="hljs-number">4'b0100</span>:	Out=	<span class="hljs-number">8'b10011001</span>;	<span class="hljs-comment">//4</span></span><br><span class="line">				<span class="hljs-number">4'b0101</span>:	Out=	<span class="hljs-number">8'b01001001</span>;	<span class="hljs-comment">//5</span></span><br><span class="line">				<span class="hljs-number">4'b0110</span>:	Out=	<span class="hljs-number">8'b01000001</span>;	<span class="hljs-comment">//6</span></span><br><span class="line">				<span class="hljs-number">4'b0111</span>:	Out=	<span class="hljs-number">8'b00011111</span>;	<span class="hljs-comment">//7</span></span><br><span class="line">				<span class="hljs-number">4'b1000</span>:	Out=	<span class="hljs-number">8'b00000001</span>;	<span class="hljs-comment">//8</span></span><br><span class="line">				<span class="hljs-number">4'b1001</span>:	Out=	<span class="hljs-number">8'b00001001</span>;	<span class="hljs-comment">//9</span></span><br><span class="line">				<span class="hljs-number">4'b1010</span>:	Out=	<span class="hljs-number">8'b00010001</span>;	<span class="hljs-comment">//A</span></span><br><span class="line">				<span class="hljs-number">4'b1011</span>:	Out=	<span class="hljs-number">8'b11000001</span>;	<span class="hljs-comment">//b</span></span><br><span class="line">				<span class="hljs-number">4'b1100</span>:	Out=	<span class="hljs-number">8'b01100011</span>;	<span class="hljs-comment">//C</span></span><br><span class="line">				<span class="hljs-number">4'b1101</span>:	Out=	<span class="hljs-number">8'b10000101</span>;	<span class="hljs-comment">//d</span></span><br><span class="line">				<span class="hljs-number">4'b1110</span>:	Out=	<span class="hljs-number">8'b01100001</span>;	<span class="hljs-comment">//E</span></span><br><span class="line">				<span class="hljs-number">4'b1111</span>:	Out=	<span class="hljs-number">8'b01110001</span>;	<span class="hljs-comment">//F</span></span><br><span class="line">				<span class="hljs-keyword">default</span>:	Out=	<span class="hljs-number">8'b00000000</span>;	<span class="hljs-comment">//all light</span></span><br><span class="line">			<span class="hljs-keyword">endcase</span></span><br><span class="line">		<span class="hljs-keyword">end</span></span><br><span class="line">	<span class="hljs-keyword">end</span></span><br><span class="line"><span class="hljs-keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h3><h4 id="端口映射"><a href="#端口映射" class="headerlink" title="端口映射"></a>端口映射</h4><p><img src="https://img-blog.csdnimg.cn/20181221021436787.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dfd2VpbGFu,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h4><p><img src="https://img-blog.csdnimg.cn/20181123000309833.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dfd2VpbGFu,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>所有寄存器被初始化为0。</p>
<h4 id="第1条指令addiu-1-0-8"><a href="#第1条指令addiu-1-0-8" class="headerlink" title="第1条指令addiu $1,$0,8"></a>第1条指令<code>addiu $1,$0,8</code></h4><p><img src="https://img-blog.csdnimg.cn/20181221190330815.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dfd2VpbGFu,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>当前地址00，下一地址04。<br><img src="https://img-blog.csdnimg.cn/20181221190655762.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dfd2VpbGFu,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>0号寄存器，值为0。<br><img src="https://img-blog.csdnimg.cn/20181221190810804.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dfd2VpbGFu,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>1号寄存器。立即数8。<br><img src="https://img-blog.csdnimg.cn/20181221190936342.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dfd2VpbGFu,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>运算结果8。</p>
<h4 id="第2条指令ori-2-0-2"><a href="#第2条指令ori-2-0-2" class="headerlink" title="第2条指令ori $2,$0,2"></a>第2条指令<code>ori $2,$0,2</code></h4><p><img src="https://img-blog.csdnimg.cn/20181221191719342.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dfd2VpbGFu,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>当前地址04，下一地址08。<br><img src="https://img-blog.csdnimg.cn/20181221191838658.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dfd2VpbGFu,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>0号寄存器，值为0。<br><img src="https://img-blog.csdnimg.cn/20181221192006996.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dfd2VpbGFu,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>2号寄存器，立即数2。<br><img src="https://img-blog.csdnimg.cn/20181221192133926.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dfd2VpbGFu,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>ALU结果为2。</p>
<h4 id="第3条指令xori-3-2-8"><a href="#第3条指令xori-3-2-8" class="headerlink" title="第3条指令xori $3,$2,8"></a>第3条指令<code>xori $3,$2,8</code></h4><p><img src="https://img-blog.csdnimg.cn/20181221193904422.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dfd2VpbGFu,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>当前地址08，下一地址0c。<br><img src="https://img-blog.csdnimg.cn/20181221193958504.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dfd2VpbGFu,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>2号寄存器，值为02。<br><img src="https://img-blog.csdnimg.cn/20181221194104632.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dfd2VpbGFu,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>3号寄存器，值为0a（这里是已经写入后的结果）。<br><img src="https://img-blog.csdnimg.cn/20181221194202734.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dfd2VpbGFu,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>ALU结果为0a。</p>
<h4 id="第4条指令sub-4-3-1"><a href="#第4条指令sub-4-3-1" class="headerlink" title="第4条指令sub $4,$3,$1"></a>第4条指令<code>sub $4,$3,$1</code></h4><p><img src="https://img-blog.csdnimg.cn/20181221194506471.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dfd2VpbGFu,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>当前地址0c，下一地址10。<br><img src="https://img-blog.csdnimg.cn/20181221194617211.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dfd2VpbGFu,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>3号寄存器，值为0a。<br><img src="https://img-blog.csdnimg.cn/20181221194717607.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dfd2VpbGFu,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>1号寄存器，值为08。<br><img src="https://img-blog.csdnimg.cn/20181221194834961.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dfd2VpbGFu,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>ALU结果为02。</p>
<h4 id="第5条指令and-5-4-2"><a href="#第5条指令and-5-4-2" class="headerlink" title="第5条指令and $5,$4,$2"></a>第5条指令<code>and $5,$4,$2</code></h4><p><img src="https://img-blog.csdnimg.cn/20181221194925863.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dfd2VpbGFu,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>当前地址10，下一地址14。<br><img src="https://img-blog.csdnimg.cn/20181221195026307.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dfd2VpbGFu,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>4号寄存器，值为2。<br><img src="https://img-blog.csdnimg.cn/20181221195135275.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dfd2VpbGFu,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>2号寄存器，值为2。<br><img src="https://img-blog.csdnimg.cn/20181221195239672.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dfd2VpbGFu,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>ALU结果为2。</p>
<h1 id="实验心得"><a href="#实验心得" class="headerlink" title="实验心得"></a>实验心得</h1><p>多周期CPU相对于单周期主要是要多思考一下自动状态机转换的问题。此外，还需要单独增加几个寄存器用于接收中间的结果，并且需要连上时钟。</p>
<p>两个学期的实验课终于到此告一段落。作为公认较难的一门课，即使学分较为少，我觉得对人的锻炼却是非常大的。每一年计组的课题都会略有区别，这让我们很难找到参考的地方；甚至很多东西往年的资料和今年的完全相反，如果不加思考完全照抄可能反而会带来误导。因此，虽然难度较大，但是却更加符合我们日后工作科研中可能会遇到的情况。不管怎样，自己总是算是做掉了多周期CPU，几天来的心血没有白费。</p>

        </div>
        
        
        
    </div>
</div>









    
<div class="card card-transparent">
    <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        <div class="pagination-previous">
            <a class="is-flex-grow has-text-black-ter" href="/page/4/">上一页</a>
        </div>
        <div class="pagination-next">
            <a class="is-flex-grow has-text-black-ter" href="/page/6/">下一页</a>
        </div>
        <ul class="pagination-list is-hidden-mobile">
            
            <li><a class="pagination-link has-text-black-ter" href="/">1</a></li>
            
            <li><span class="pagination-ellipsis has-text-black-ter">&hellip;</span></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/4/">4</a></li>
            
            <li><a class="pagination-link is-current" href="/page/5/">5</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/6/">6</a></li>
            
            <li><span class="pagination-ellipsis has-text-black-ter">&hellip;</span></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/11/">11</a></li>
            
        </ul>
    </nav>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                        <img class="image is-128x128 has-mb-6" src="/images/cat/color_cat.jpg" alt="贾小厨">
                    
                    
                    <p class="is-size-4 is-block">
                        贾小厨
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        当前，你无法预测未来会怎样，但你可以选择跟靠谱的人一同工作，选择做正确的事。
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Beijing.China</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        文章
                    </p>
                    <p class="title has-text-weight-normal">
                        102
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        分类
                    </p>
                    <p class="title has-text-weight-normal">
                        24
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        标签
                    </p>
                    <p class="title has-text-weight-normal">
                        38
                    </p>
                </div>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/jiaxiaochu" target="_blank">
                关注我</a>
        </div>
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Github" href="https://github.com/jiaxiaochu">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Facebook" href="https://facebook.com">
                
                <i class="fab fa-facebook"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Twitter" href="https://twitter.com">
                
                <i class="fab fa-twitter"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Dribbble" href="https://dribbble.com">
                
                <i class="fab fa-dribbble"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="RSS" href="/">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        
    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                分类
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/ACM/">
            <span class="level-start">
                <span class="level-item">ACM</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">39</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/ACM/Template/">
            <span class="level-start">
                <span class="level-item">Template</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">10</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/ACM/算法竞赛入门经典训练指南/">
            <span class="level-start">
                <span class="level-item">算法竞赛入门经典训练指南</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/ACM/题解/">
            <span class="level-start">
                <span class="level-item">题解</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">18</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/Linux/">
            <span class="level-start">
                <span class="level-item">Linux</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Python/">
            <span class="level-start">
                <span class="level-item">Python</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Spider/">
            <span class="level-start">
                <span class="level-item">Spider</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/函数程序设计实验/">
            <span class="level-start">
                <span class="level-item">函数程序设计实验</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">12</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/吴恩达机器学习笔记/">
            <span class="level-start">
                <span class="level-item">吴恩达机器学习笔记</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/学习笔记/">
            <span class="level-start">
                <span class="level-item">学习笔记</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/小工具/">
            <span class="level-start">
                <span class="level-item">小工具</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/并行与分布式计算/">
            <span class="level-start">
                <span class="level-item">并行与分布式计算</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/操作系统/">
            <span class="level-start">
                <span class="level-item">操作系统</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/机器学习/">
            <span class="level-start">
                <span class="level-item">机器学习</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/环境配置/">
            <span class="level-start">
                <span class="level-item">环境配置</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">14</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/程序设计/">
            <span class="level-start">
                <span class="level-item">程序设计</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">8</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/计算机组成原理/">
            <span class="level-start">
                <span class="level-item">计算机组成原理</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/计算机网络/">
            <span class="level-start">
                <span class="level-item">计算机网络</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">7</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/超级计算机原理与操作/">
            <span class="level-start">
                <span class="level-item">超级计算机原理与操作</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <a href="/2019/07/23/pymysql远程连接被拒绝问题解决方法/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://ws1.sinaimg.cn/large/0065l1jqly1g592mgpd7mg30ot0ea7d5.gif" alt="pymysql远程连接被拒绝问题解决方法">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-07-22T16:08:33.000Z">2019-07-23</time></div>
                    <a href="/2019/07/23/pymysql远程连接被拒绝问题解决方法/" class="has-link-black-ter is-size-6">pymysql远程连接被拒绝问题解决方法</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/环境配置/">环境配置</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/07/22/Ubuntu系统搭建配置Python虚拟开发环境/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://ws1.sinaimg.cn/large/0065l1jqly1g590mpqs2ej30gg08c3ym.jpg" alt="Ubuntu系统搭建配置Python虚拟开发环境">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-07-22T14:57:27.000Z">2019-07-22</time></div>
                    <a href="/2019/07/22/Ubuntu系统搭建配置Python虚拟开发环境/" class="has-link-black-ter is-size-6">Ubuntu系统搭建配置Python虚拟开发环境</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/环境配置/">环境配置</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/07/14/2017-11-17-垃圾回收/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Python中的垃圾回收机制">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-07-14T08:06:52.968Z">2019-07-14</time></div>
                    <a href="/2019/07/14/2017-11-17-垃圾回收/" class="has-link-black-ter is-size-6">Python中的垃圾回收机制</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Python/">Python</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/07/14/2017-08-14-爬取网易财经中股票的历史交易数据/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="爬取网易财经中股票的历史交易数据">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-07-14T08:06:52.967Z">2019-07-14</time></div>
                    <a href="/2019/07/14/2017-08-14-爬取网易财经中股票的历史交易数据/" class="has-link-black-ter is-size-6">爬取网易财经中股票的历史交易数据</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Spider/">Spider</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/04/11/2019-03-31-中断处理与系统调用/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt>
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-04-10T16:08:06.399Z">2019-04-11</time></div>
                    <a href="/2019/04/11/2019-03-31-中断处理与系统调用/" class="has-link-black-ter is-size-6"></a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/操作系统/">操作系统</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
            
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            标签云
        </h3>
        <a href="/tags/Anaconda/" style="font-size: 10px;">Anaconda</a> <a href="/tags/Bug/" style="font-size: 10px;">Bug</a> <a href="/tags/ChromeDriver/" style="font-size: 10px;">ChromeDriver</a> <a href="/tags/DP/" style="font-size: 10px;">DP</a> <a href="/tags/Deepin/" style="font-size: 11.67px;">Deepin</a> <a href="/tags/ICPC模板/" style="font-size: 18.33px;">ICPC模板</a> <a href="/tags/LCA/" style="font-size: 10px;">LCA</a> <a href="/tags/MongoDB数据库/" style="font-size: 10px;">MongoDB数据库</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/Pycharm/" style="font-size: 11.67px;">Pycharm</a> <a href="/tags/Python解释器的安装与配置/" style="font-size: 13.33px;">Python解释器的安装与配置</a> <a href="/tags/Ubuntu/" style="font-size: 10px;">Ubuntu</a> <a href="/tags/VMware/" style="font-size: 10px;">VMware</a> <a href="/tags/chrome/" style="font-size: 10px;">chrome</a> <a href="/tags/chromedriver/" style="font-size: 10px;">chromedriver</a> <a href="/tags/pymysql/" style="font-size: 10px;">pymysql</a> <a href="/tags/主席树/" style="font-size: 10px;">主席树</a> <a href="/tags/二分/" style="font-size: 10px;">二分</a> <a href="/tags/二维计算几何/" style="font-size: 10px;">二维计算几何</a> <a href="/tags/动态开点/" style="font-size: 10px;">动态开点</a> <a href="/tags/励志/" style="font-size: 10px;">励志</a> <a href="/tags/可持久化/" style="font-size: 11.67px;">可持久化</a> <a href="/tags/扫描线/" style="font-size: 10px;">扫描线</a> <a href="/tags/数据库/" style="font-size: 10px;">数据库</a> <a href="/tags/数据结构/" style="font-size: 15px;">数据结构</a> <a href="/tags/数论/" style="font-size: 10px;">数论</a> <a href="/tags/无旋Treap/" style="font-size: 10px;">无旋Treap</a> <a href="/tags/最短路/" style="font-size: 10px;">最短路</a> <a href="/tags/树状数组/" style="font-size: 10px;">树状数组</a> <a href="/tags/环境配置/" style="font-size: 20px;">环境配置</a> <a href="/tags/珂朵莉树/" style="font-size: 11.67px;">珂朵莉树</a> <a href="/tags/系统配置/" style="font-size: 10px;">系统配置</a> <a href="/tags/线段树/" style="font-size: 16.67px;">线段树</a> <a href="/tags/老司机树/" style="font-size: 11.67px;">老司机树</a> <a href="/tags/莫比乌斯反演/" style="font-size: 10px;">莫比乌斯反演</a> <a href="/tags/虚拟机/" style="font-size: 10px;">虚拟机</a> <a href="/tags/虚拟环境/" style="font-size: 10px;">虚拟环境</a> <a href="/tags/谷歌输入法/" style="font-size: 10px;">谷歌输入法</a>
    </div>
</div>

        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">七月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/04/">
                <span class="level-start">
                    <span class="level-item">四月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">15</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/03/">
                <span class="level-start">
                    <span class="level-item">三月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/02/">
                <span class="level-start">
                    <span class="level-item">二月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">20</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/01/">
                <span class="level-start">
                    <span class="level-item">一月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">13</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/10/">
                <span class="level-start">
                    <span class="level-item">十月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">12</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/08/">
                <span class="level-start">
                    <span class="level-item">八月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/07/">
                <span class="level-start">
                    <span class="level-item">七月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/06/">
                <span class="level-start">
                    <span class="level-item">六月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/05/">
                <span class="level-start">
                    <span class="level-item">五月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">三月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/10/">
                <span class="level-start">
                    <span class="level-item">十月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Anaconda/">
                        <span class="tag">Anaconda</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Bug/">
                        <span class="tag">Bug</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ChromeDriver/">
                        <span class="tag">ChromeDriver</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/DP/">
                        <span class="tag">DP</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Deepin/">
                        <span class="tag">Deepin</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ICPC模板/">
                        <span class="tag">ICPC模板</span>
                        <span class="tag is-grey">10</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/LCA/">
                        <span class="tag">LCA</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MongoDB数据库/">
                        <span class="tag">MongoDB数据库</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MySQL/">
                        <span class="tag">MySQL</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Pycharm/">
                        <span class="tag">Pycharm</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Python解释器的安装与配置/">
                        <span class="tag">Python解释器的安装与配置</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Ubuntu/">
                        <span class="tag">Ubuntu</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/VMware/">
                        <span class="tag">VMware</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/chrome/">
                        <span class="tag">chrome</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/chromedriver/">
                        <span class="tag">chromedriver</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/pymysql/">
                        <span class="tag">pymysql</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/主席树/">
                        <span class="tag">主席树</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/二分/">
                        <span class="tag">二分</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/二维计算几何/">
                        <span class="tag">二维计算几何</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/动态开点/">
                        <span class="tag">动态开点</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/励志/">
                        <span class="tag">励志</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/可持久化/">
                        <span class="tag">可持久化</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/扫描线/">
                        <span class="tag">扫描线</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数据库/">
                        <span class="tag">数据库</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数据结构/">
                        <span class="tag">数据结构</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数论/">
                        <span class="tag">数论</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/无旋Treap/">
                        <span class="tag">无旋Treap</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/最短路/">
                        <span class="tag">最短路</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/树状数组/">
                        <span class="tag">树状数组</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/环境配置/">
                        <span class="tag">环境配置</span>
                        <span class="tag is-grey">14</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/珂朵莉树/">
                        <span class="tag">珂朵莉树</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/系统配置/">
                        <span class="tag">系统配置</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/线段树/">
                        <span class="tag">线段树</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/老司机树/">
                        <span class="tag">老司机树</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/莫比乌斯反演/">
                        <span class="tag">莫比乌斯反演</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/虚拟机/">
                        <span class="tag">虚拟机</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/虚拟环境/">
                        <span class="tag">虚拟环境</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/谷歌输入法/">
                        <span class="tag">谷歌输入法</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
        
            

<div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            链接
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://www.jianshu.com/u/bf4c0b4a8c83" target="_blank">
                    <span class="level-left">
                        <span class="level-item">简书</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">www.jianshu.com</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://github.com/jiaxiaochu" target="_blank">
                    <span class="level-left">
                        <span class="level-item">GitHub</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">github.com</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>


        
        </div>
    
</div>

                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right ">
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            标签云
        </h3>
        <a href="/tags/Anaconda/" style="font-size: 10px;">Anaconda</a> <a href="/tags/Bug/" style="font-size: 10px;">Bug</a> <a href="/tags/ChromeDriver/" style="font-size: 10px;">ChromeDriver</a> <a href="/tags/DP/" style="font-size: 10px;">DP</a> <a href="/tags/Deepin/" style="font-size: 11.67px;">Deepin</a> <a href="/tags/ICPC模板/" style="font-size: 18.33px;">ICPC模板</a> <a href="/tags/LCA/" style="font-size: 10px;">LCA</a> <a href="/tags/MongoDB数据库/" style="font-size: 10px;">MongoDB数据库</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/Pycharm/" style="font-size: 11.67px;">Pycharm</a> <a href="/tags/Python解释器的安装与配置/" style="font-size: 13.33px;">Python解释器的安装与配置</a> <a href="/tags/Ubuntu/" style="font-size: 10px;">Ubuntu</a> <a href="/tags/VMware/" style="font-size: 10px;">VMware</a> <a href="/tags/chrome/" style="font-size: 10px;">chrome</a> <a href="/tags/chromedriver/" style="font-size: 10px;">chromedriver</a> <a href="/tags/pymysql/" style="font-size: 10px;">pymysql</a> <a href="/tags/主席树/" style="font-size: 10px;">主席树</a> <a href="/tags/二分/" style="font-size: 10px;">二分</a> <a href="/tags/二维计算几何/" style="font-size: 10px;">二维计算几何</a> <a href="/tags/动态开点/" style="font-size: 10px;">动态开点</a> <a href="/tags/励志/" style="font-size: 10px;">励志</a> <a href="/tags/可持久化/" style="font-size: 11.67px;">可持久化</a> <a href="/tags/扫描线/" style="font-size: 10px;">扫描线</a> <a href="/tags/数据库/" style="font-size: 10px;">数据库</a> <a href="/tags/数据结构/" style="font-size: 15px;">数据结构</a> <a href="/tags/数论/" style="font-size: 10px;">数论</a> <a href="/tags/无旋Treap/" style="font-size: 10px;">无旋Treap</a> <a href="/tags/最短路/" style="font-size: 10px;">最短路</a> <a href="/tags/树状数组/" style="font-size: 10px;">树状数组</a> <a href="/tags/环境配置/" style="font-size: 20px;">环境配置</a> <a href="/tags/珂朵莉树/" style="font-size: 11.67px;">珂朵莉树</a> <a href="/tags/系统配置/" style="font-size: 10px;">系统配置</a> <a href="/tags/线段树/" style="font-size: 16.67px;">线段树</a> <a href="/tags/老司机树/" style="font-size: 11.67px;">老司机树</a> <a href="/tags/莫比乌斯反演/" style="font-size: 10px;">莫比乌斯反演</a> <a href="/tags/虚拟机/" style="font-size: 10px;">虚拟机</a> <a href="/tags/虚拟环境/" style="font-size: 10px;">虚拟环境</a> <a href="/tags/谷歌输入法/" style="font-size: 10px;">谷歌输入法</a>
    </div>
</div>

    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">七月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/04/">
                <span class="level-start">
                    <span class="level-item">四月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">15</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/03/">
                <span class="level-start">
                    <span class="level-item">三月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/02/">
                <span class="level-start">
                    <span class="level-item">二月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">20</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/01/">
                <span class="level-start">
                    <span class="level-item">一月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">13</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/10/">
                <span class="level-start">
                    <span class="level-item">十月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">12</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/08/">
                <span class="level-start">
                    <span class="level-item">八月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/07/">
                <span class="level-start">
                    <span class="level-item">七月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/06/">
                <span class="level-start">
                    <span class="level-item">六月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/05/">
                <span class="level-start">
                    <span class="level-item">五月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">三月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/10/">
                <span class="level-start">
                    <span class="level-item">十月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Anaconda/">
                        <span class="tag">Anaconda</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Bug/">
                        <span class="tag">Bug</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ChromeDriver/">
                        <span class="tag">ChromeDriver</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/DP/">
                        <span class="tag">DP</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Deepin/">
                        <span class="tag">Deepin</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ICPC模板/">
                        <span class="tag">ICPC模板</span>
                        <span class="tag is-grey">10</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/LCA/">
                        <span class="tag">LCA</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MongoDB数据库/">
                        <span class="tag">MongoDB数据库</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MySQL/">
                        <span class="tag">MySQL</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Pycharm/">
                        <span class="tag">Pycharm</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Python解释器的安装与配置/">
                        <span class="tag">Python解释器的安装与配置</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Ubuntu/">
                        <span class="tag">Ubuntu</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/VMware/">
                        <span class="tag">VMware</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/chrome/">
                        <span class="tag">chrome</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/chromedriver/">
                        <span class="tag">chromedriver</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/pymysql/">
                        <span class="tag">pymysql</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/主席树/">
                        <span class="tag">主席树</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/二分/">
                        <span class="tag">二分</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/二维计算几何/">
                        <span class="tag">二维计算几何</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/动态开点/">
                        <span class="tag">动态开点</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/励志/">
                        <span class="tag">励志</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/可持久化/">
                        <span class="tag">可持久化</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/扫描线/">
                        <span class="tag">扫描线</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数据库/">
                        <span class="tag">数据库</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数据结构/">
                        <span class="tag">数据结构</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数论/">
                        <span class="tag">数论</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/无旋Treap/">
                        <span class="tag">无旋Treap</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/最短路/">
                        <span class="tag">最短路</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/树状数组/">
                        <span class="tag">树状数组</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/环境配置/">
                        <span class="tag">环境配置</span>
                        <span class="tag is-grey">14</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/珂朵莉树/">
                        <span class="tag">珂朵莉树</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/系统配置/">
                        <span class="tag">系统配置</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/线段树/">
                        <span class="tag">线段树</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/老司机树/">
                        <span class="tag">老司机树</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/莫比乌斯反演/">
                        <span class="tag">莫比乌斯反演</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/虚拟机/">
                        <span class="tag">虚拟机</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/虚拟环境/">
                        <span class="tag">虚拟环境</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/谷歌输入法/">
                        <span class="tag">谷歌输入法</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
        

<div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            链接
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://www.jianshu.com/u/bf4c0b4a8c83" target="_blank">
                    <span class="level-left">
                        <span class="level-item">简书</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">www.jianshu.com</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://github.com/jiaxiaochu" target="_blank">
                    <span class="level-left">
                        <span class="level-item">GitHub</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">github.com</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>


    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.svg" alt="贾志翔的博客" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2019 jiazhixiang&nbsp;
                Powered &#10084; YH · Lin
                </p>
            </div>
            
            <script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

            
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Download on GitHub" href="https://github.com/jiaxiaochu/jiaxiaochu.github.io">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        <div align="center">
            <span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
            <script>
                var now = new Date(); 
                function createtime() { 
                    var grt= new Date("4/1/2019 12:49:00");//此处修改你的建站时间或者网站上线时间 
                    now.setTime(now.getTime()+250); 
                    days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); 
                    hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); 
                    if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
                    mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 
                    seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
                    snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 
                    document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 "; 
                    document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒"; 
                } 
            setInterval("createtime()",250);
            </script>
            <div align="center">
            <span id="busuanzi_container_site_pv" class="theme-info">本站总访问量-<span id="busuanzi_value_site_pv"></span>-次|
              </span>
              <span id="busuanzi_container_site_uv" class="theme-info">您是第-<span id="busuanzi_value_site_uv"></span>-位小伙伴</span>

            <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            </div>
        </div>
        <span>
        <script type="text/javascript" src="//rf.revolvermaps.com/0/0/0.js?i=0xetp0d4rdh&amp;d=2&amp;p=1&amp;b=8&amp;w=193&amp;g=2&amp;f=arial&amp;fs=12&amp;r=0&amp;c0=000000&amp;c1=00a99d&amp;c2=000000&amp;ic0=0&amp;ic1=0" async="async"></script>
        </span>
        </div>

    </div>

    <script>
        (function(){
            var bp = document.createElement('script');
            bp.src = '//push.zhanzhang.baidu.com/push.js';
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(bp, s);
        })();
</script>
<script src="https://cdn.jsdelivr.net/npm/meting@1.1.0/dist/Meting.min.js"></script>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>


    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="回到顶端" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    

    
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>
    <script src="/js/clipboard.js" defer></script>
    

    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么...">
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
        <!-- 雪花特效 -->
    <script type="text/javascript">
      var windowWidth = $(window).width();
      if (windowWidth > 480) {
        document.write('<script type="text/javascript" src="/js/src/snow.js"><\/script>');
      }
    </script>

    <script src="//code.tidio.co/wgmwb2zlxrcti0crizzmumshwbxpums2.js"></script>
    
</body>
</html>